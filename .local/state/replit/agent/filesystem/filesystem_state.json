{"file_contents":{"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# HealthHire Portal\n\n## Overview\n\nHealthHire Portal is a comprehensive healthcare career toolkit designed to transform NHS job hunting from scattered, manual processes into a guided, intelligent journey. The platform serves healthcare professionals at various career stages - from overseas professionals needing visa guidance to UK care workers transitioning to NHS roles. It provides AI-powered personalization, NHS-specific expertise, and gamified engagement to guide users from career discovery to job offer acceptance.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React 18 with TypeScript using Vite for build tooling\n- **UI Components**: Shadcn/ui component library with Radix UI primitives\n- **Styling**: Tailwind CSS with CSS variables for theming\n- **State Management**: TanStack Query (React Query) for server state management\n- **Routing**: Wouter for lightweight client-side routing\n- **Form Handling**: React Hook Form with Zod validation\n\n### Backend Architecture\n- **Runtime**: Node.js with Express server\n- **Language**: TypeScript with ES modules\n- **Authentication**: Replit Auth integration with OpenID Connect\n- **Session Management**: Express sessions with PostgreSQL storage\n- **API Design**: RESTful endpoints with proper error handling and middleware\n\n### Database Design\n- **Primary Database**: PostgreSQL via Neon serverless\n- **ORM**: Drizzle ORM with schema-first approach\n- **Schema Structure**:\n  - Users table for authentication\n  - Profiles table for healthcare professional details (profession, registration numbers, specialties)\n  - Applications table for job tracking with status workflow\n  - Interview sessions table for practice tracking and scoring\n  - Documents table for CV and Supporting Information management\n  - Sessions table for authentication session persistence\n\n### Data Architecture Patterns\n- **Shared Schema**: Common schema definitions between client and server in `/shared` directory\n- **Type Safety**: End-to-end TypeScript with Zod validation schemas\n- **Data Relationships**: Proper foreign key relationships with user-centric data isolation\n- **Completion Tracking**: Profile completion percentage calculation for gamification\n\n### Component Architecture\n- **Dashboard-Centric Design**: Clean, card-based interface with 7 distinct sections\n- **Progressive Disclosure**: Information revealed on demand to prevent cognitive overload\n- **Reusable Components**: Modular UI components with consistent styling\n- **Responsive Design**: Mobile-first approach with breakpoint considerations\n\n### Security and Authentication\n- **Replit Auth Integration**: OAuth flow with session-based authentication\n- **Session Security**: HTTP-only cookies with secure flags\n- **Authorization Middleware**: Route protection with user context injection\n- **Data Isolation**: User-scoped queries preventing data leakage\n\n### File Organization\n- **Monorepo Structure**: Client, server, and shared code in organized directories\n- **Path Aliases**: Configured imports for clean module resolution\n- **Asset Management**: Centralized asset handling with proper imports\n\n## External Dependencies\n\n### Database Services\n- **Neon PostgreSQL**: Serverless PostgreSQL hosting for production data storage\n- **Connection Pooling**: Built-in connection management for serverless environments\n\n### Authentication Services\n- **Replit Auth**: Integrated authentication provider with OpenID Connect support\n- **Session Storage**: PostgreSQL-backed session management with TTL support\n\n### Development Tools\n- **Vite**: Modern build tool with hot module replacement\n- **TypeScript**: Static type checking across the entire stack\n- **ESBuild**: Fast bundling for production builds\n- **Drizzle Kit**: Database schema management and migrations\n\n### UI and Styling Dependencies\n- **Tailwind CSS**: Utility-first CSS framework\n- **Radix UI**: Headless component primitives\n- **Lucide React**: Icon library for consistent iconography\n- **Class Variance Authority**: Component variant management\n\n### AI Integration\n- **Google Gemini**: AI-powered document generation using Gemini 2.5 Flash Lite for CV and Supporting Information generation\n- **Interview Practice**: AI-powered interview feedback systems using Gemini for scoring and constructive feedback\n- **Q&A Generator**: Gemini-based generation of tailored interview questions and model answers\n- **Job Matching**: Prepared for vector embedding-based job matching algorithms\n\n### Frontend Libraries\n- **TanStack Query**: Powerful data fetching and caching\n- **React Hook Form**: Performant form handling\n- **Wouter**: Lightweight routing solution\n- **Date-fns**: Date manipulation utilities\n\n### Development and Testing\n- **Runtime Error Overlay**: Replit-specific development tooling\n- **Hot Reload**: Development experience optimization\n- **TypeScript Compiler**: Strict type checking configuration\n\nThe architecture is designed to scale from MVP to full-featured platform while maintaining clean separation of concerns and type safety throughout the stack.","size_bytes":5124},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2766},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"server/ai-service.ts":{"content":"import { GoogleGenAI } from \"@google/genai\";\nimport { storage } from \"./storage\";\nimport type { Profile, StarExample, NhsJob } from \"@shared/schema\";\n\nconst ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY || \"\" });\n\nexport interface DocumentGenerationContext {\n  userProfile: Profile;\n  starExamples: StarExample[];\n  jobDescription?: NhsJob;\n  experienceLevel: 'junior' | 'mid' | 'senior';\n  targetBand?: string;\n}\n\nexport class AIService {\n  // Get hidden AI prompt (never exposed to users)\n  async getPrompt(promptName: string): Promise<string | null> {\n    const prompt = await storage.getActivePrompt(promptName);\n    return prompt?.prompt || null;\n  }\n\n  // Generate CV with AI using hidden prompts\n  async generateCV(context: DocumentGenerationContext): Promise<string> {\n    const basePrompt = await this.getPrompt('cv_generation');\n    if (!basePrompt) {\n      throw new Error('CV generation prompt not found');\n    }\n\n    // Inject user context into hidden prompt\n    const prompt = this.interpolatePrompt(basePrompt, context);\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash-lite\",\n      config: {\n        systemInstruction: prompt,\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: \"object\",\n          properties: {\n            cv_content: { type: \"string\" }\n          },\n          required: [\"cv_content\"]\n        }\n      },\n      contents: \"Generate CV content based on the provided context.\",\n    });\n\n    const result = JSON.parse(response.text || '{\"cv_content\": \"\"}');\n    return result.cv_content || '';\n  }\n\n  // Generate Supporting Information with NHS values mapping\n  async generateSupportingInfo(context: DocumentGenerationContext): Promise<string> {\n    const basePrompt = await this.getPrompt('supporting_info_generation');\n    if (!basePrompt) {\n      throw new Error('Supporting Information generation prompt not found');\n    }\n\n    const prompt = this.interpolatePrompt(basePrompt, context);\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash-lite\",\n      config: {\n        systemInstruction: prompt,\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: \"object\",\n          properties: {\n            supporting_info_content: { type: \"string\" }\n          },\n          required: [\"supporting_info_content\"]\n        }\n      },\n      contents: \"Generate supporting information based on the provided context.\",\n    });\n\n    const result = JSON.parse(response.text || '{\"supporting_info_content\": \"\"}');\n    return result.supporting_info_content || '';\n  }\n\n  // Generate interview Q&A for specific job/role\n  async generateInterviewQA(jobDescription: string, difficulty: string): Promise<{ questions: Array<{ question: string, suggestedAnswer: string }> }> {\n    const basePrompt = await this.getPrompt('interview_qa_generation');\n    if (!basePrompt) {\n      throw new Error('Interview Q&A generation prompt not found');\n    }\n\n    const prompt = basePrompt\n      .replace('{JOB_DESCRIPTION}', jobDescription)\n      .replace('{DIFFICULTY_LEVEL}', difficulty);\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash-lite\",\n      config: {\n        systemInstruction: prompt,\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: \"object\",\n          properties: {\n            questions: {\n              type: \"array\",\n              items: {\n                type: \"object\",\n                properties: {\n                  question: { type: \"string\" },\n                  suggestedAnswer: { type: \"string\" }\n                },\n                required: [\"question\", \"suggestedAnswer\"]\n              }\n            }\n          },\n          required: [\"questions\"]\n        }\n      },\n      contents: \"Generate interview questions and answers for this position.\",\n    });\n\n    const result = JSON.parse(response.text || '{\"questions\": []}');\n    return result;\n  }\n\n  // Analyze and score interview response\n  async scoreInterviewResponse(question: string, userResponse: string): Promise<{ score: number, feedback: string, improvements: string[] }> {\n    const basePrompt = await this.getPrompt('interview_scoring');\n    if (!basePrompt) {\n      throw new Error('Interview scoring prompt not found');\n    }\n\n    const prompt = basePrompt\n      .replace('{QUESTION}', question)\n      .replace('{USER_RESPONSE}', userResponse);\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash-lite\",\n      config: {\n        systemInstruction: prompt,\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: \"object\",\n          properties: {\n            score: { type: \"number\" },\n            feedback: { type: \"string\" },\n            improvements: {\n              type: \"array\",\n              items: { type: \"string\" }\n            }\n          },\n          required: [\"score\", \"feedback\", \"improvements\"]\n        }\n      },\n      contents: \"Score this interview response and provide feedback.\",\n    });\n\n    const result = JSON.parse(response.text || '{\"score\": 0, \"feedback\": \"\", \"improvements\": []}');\n    return {\n      score: Math.max(0, Math.min(10, result.score || 0)),\n      feedback: result.feedback || '',\n      improvements: result.improvements || []\n    };\n  }\n\n  // Calculate job fit score using AI\n  async calculateJobFit(userProfile: Profile, jobDescription: NhsJob): Promise<{ score: number, breakdown: any }> {\n    const basePrompt = await this.getPrompt('job_fit_scoring');\n    if (!basePrompt) {\n      throw new Error('Job fit scoring prompt not found');\n    }\n\n    const prompt = basePrompt\n      .replace('{USER_PROFILE}', JSON.stringify(userProfile))\n      .replace('{JOB_DESCRIPTION}', JSON.stringify(jobDescription));\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash-lite\",\n      config: {\n        systemInstruction: prompt,\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: \"object\",\n          properties: {\n            score: { type: \"number\" },\n            breakdown: { type: \"object\" }\n          },\n          required: [\"score\", \"breakdown\"]\n        }\n      },\n      contents: \"Calculate job fit score based on profile and job description.\",\n    });\n\n    const result = JSON.parse(response.text || '{\"score\": 0, \"breakdown\": {}}');\n    return {\n      score: Math.max(0, Math.min(100, result.score || 0)),\n      breakdown: result.breakdown || {}\n    };\n  }\n\n  // Private helper to inject context into prompts\n  private interpolatePrompt(prompt: string, context: DocumentGenerationContext): string {\n    return prompt\n      .replace('{USER_PROFILE}', JSON.stringify(context.userProfile))\n      .replace('{STAR_EXAMPLES}', JSON.stringify(context.starExamples))\n      .replace('{JOB_DESCRIPTION}', JSON.stringify(context.jobDescription || {}))\n      .replace('{EXPERIENCE_LEVEL}', context.experienceLevel)\n      .replace('{TARGET_BAND}', context.targetBand || 'Not specified');\n  }\n}\n\nexport const aiService = new AIService();","size_bytes":7115},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });","size_bytes":482},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  \n  // Only capture response JSON in development mode\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n  if (app.get(\"env\") === \"development\") {\n    const originalResJson = res.json;\n    res.json = function (bodyJson, ...args) {\n      capturedJsonResponse = bodyJson;\n      return originalResJson.apply(res, [bodyJson, ...args]);\n    };\n  }\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      \n      // Only include response JSON in development\n      if (app.get(\"env\") === \"development\" && capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      // Truncate long log lines to prevent log bloat\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2324},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nif (!process.env.REPLIT_DOMAINS) {\n  throw new Error(\"Environment variable REPLIT_DOMAINS not provided\");\n}\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  for (const domain of process.env\n    .REPLIT_DOMAINS!.split(\",\")) {\n    const strategy = new Strategy(\n      {\n        name: `replitauth:${domain}`,\n        config,\n        scope: \"openid email profile offline_access\",\n        callbackURL: `https://${domain}/api/callback`,\n      },\n      verify,\n    );\n    passport.use(strategy);\n  }\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","size_bytes":4221},"server/routes.ts":{"content":"import type { Express, RequestHandler } from \"express\";\nimport express from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated } from \"./replitAuth\";\nimport { insertProfileSchema, insertApplicationSchema, insertDocumentSchema, insertStarExampleSchema, interviewSessions, interviewQuestions, interviewResponses, qaSessions, qaQuestions, qaProgress } from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, desc, sql } from \"drizzle-orm\";\nimport { registerPaymentRoutes } from \"./routes/payments\";\nimport aiGeminiRoutes from \"./routes/ai-gemini\";\nimport { aiService } from \"./ai-service\";\nimport { NhsJobsService } from \"./nhs-jobs-service\";\nimport { ScotNhsJobsService } from \"./scot-nhs-service\";\nimport { HealthJobsUkService } from \"./healthjobs-uk-service\";\nimport { AIDocumentService } from \"./ai-document-service\";\nimport { geminiService } from \"./gemini-service\";\nimport { paymentService } from \"./payment-service\";\nimport { ObjectStorageService, ObjectNotFoundError } from \"./objectStorage\";\nimport { checkUsageRestrictions, getUserUsageStats, type AuthenticatedRequest } from \"./middleware/usageMonitoring\";\nimport { auditDataAccess, logApiDataAccess, logGdprDataExport } from \"./middleware/auditLogging\";\nimport { validateCSRFToken, generateCSRFToken } from \"./middleware/security\";\nimport { randomUUID } from \"crypto\";\n\nconst nhsJobsService = new NhsJobsService();\nconst scotNhsJobsService = new ScotNhsJobsService();\nconst healthJobsUkService = new HealthJobsUkService();\nconst aiDocumentService = new AIDocumentService(); // Use Gemini instead of OpenAI\nconst objectStorageService = new ObjectStorageService();\n\n// Format date to Month/Year format\nfunction formatDateToMonthYear(dateStr: string): string {\n  if (!dateStr) return '';\n  \n  // Handle YYYY-MM format\n  if (dateStr.match(/^\\d{4}-\\d{2}$/)) {\n    const [year, month] = dateStr.split('-');\n    const date = new Date(parseInt(year), parseInt(month) - 1);\n    return date.toLocaleDateString('en-GB', { month: '2-digit', year: 'numeric' }).replace('/', '/');\n  }\n  \n  // Handle YYYY format\n  if (dateStr.match(/^\\d{4}$/)) {\n    return dateStr;\n  }\n  \n  // Handle other formats - try to parse and format\n  try {\n    const date = new Date(dateStr);\n    if (!isNaN(date.getTime())) {\n      return date.toLocaleDateString('en-GB', { month: '2-digit', year: 'numeric' }).replace('/', '/');\n    }\n  } catch (error) {\n    console.warn(`Failed to parse date string \"${dateStr}\":`, error);\n  }\n  \n  return dateStr; // Return as-is if can't parse\n}\n\n// Helper function to generate CV HTML for PDF download\nfunction generateCVHTML(cvData: any): string {\n  return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset=\"UTF-8\">\n      <title>CV - ${cvData.personalInfo.name}</title>\n      <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body { \n          font-family: 'Calibri', 'Arial', sans-serif; \n          font-size: 11pt; \n          line-height: 1.5; \n          color: #333; \n          max-width: 8.5in;\n          margin: 0 auto;\n          padding: 0.75in;\n          background: white;\n        }\n        \n        .header { \n          text-align: center; \n          margin-bottom: 32px; \n          border-bottom: 2px solid #2c5aa0;\n          padding-bottom: 20px;\n        }\n        \n        .name { \n          font-size: 24pt; \n          font-weight: bold; \n          color: #2c5aa0; \n          margin-bottom: 8px; \n          text-transform: uppercase;\n        }\n        \n        .contact { \n          font-size: 10pt; \n          color: #555;\n          line-height: 1.4;\n        }\n        \n        .contact-line { \n          margin: 2px 0; \n        }\n        \n        .section { \n          margin-bottom: 24px; \n          page-break-inside: avoid;\n        }\n        \n        .section-title { \n          font-size: 12pt; \n          font-weight: bold; \n          color: #2c5aa0; \n          text-transform: uppercase;\n          border-bottom: 1px solid #2c5aa0; \n          margin-bottom: 12px; \n          padding-bottom: 2px;\n        }\n        \n        .experience-item, .education-item { \n          margin-bottom: 16px; \n          page-break-inside: avoid;\n        }\n        \n        .job-title { \n          font-size: 11pt;\n          font-weight: bold; \n          color: #2c5aa0;\n          margin-bottom: 2px;\n        }\n        \n        .company { \n          font-size: 10pt;\n          font-weight: 600; \n          color: #333;\n          margin-bottom: 2px;\n        }\n        \n        .location-date {\n          font-size: 9pt; \n          color: #666; \n          margin-bottom: 6px;\n        }\n        \n        .duties { \n          margin-top: 4px; \n          padding-left: 16px;\n        }\n        \n        .duties li { \n          margin-bottom: 3px; \n          line-height: 1.3;\n          font-size: 10pt;\n        }\n        \n        .skills-list {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 6px;\n          margin-top: 4px;\n        }\n        \n        .skill-item { \n          background: #f0f0f0; \n          padding: 4px 8px; \n          border-radius: 4px;\n          font-size: 9pt;\n          font-weight: 500;\n        }\n        \n        .registration-item {\n          background: #f8f9fa;\n          border-left: 3px solid #2c5aa0;\n          padding: 8px 12px;\n          margin-bottom: 6px;\n        }\n        \n        .reg-type {\n          font-weight: bold;\n          color: #2c5aa0;\n          margin-bottom: 2px;\n          font-size: 10pt;\n        }\n        \n        .reg-details {\n          font-size: 9pt;\n          color: #555;\n        }\n\n        @media print {\n          body { margin: 0; padding: 0.5in; }\n          .section { page-break-inside: avoid; }\n          @page { margin: 0; }\n        }\n        \n        @page {\n          margin: 0;\n          @top-left { content: none; }\n          @top-center { content: none; }\n          @top-right { content: none; }\n          @bottom-left { content: none; }\n          @bottom-center { content: none; }\n          @bottom-right { content: none; }\n        }\n        \n        .duties-list {\n          margin-top: 6px;\n          padding-left: 16px;\n          font-size: 9pt;\n          line-height: 1.4;\n          color: #444;\n        }\n        \n        .duties-list li {\n          margin-bottom: 2px;\n        }\n        \n        /* Add print button for easy PDF generation */\n        .print-instructions {\n          background: #e3f2fd;\n          border: 2px solid #2196f3;\n          border-radius: 8px;\n          padding: 16px;\n          margin-bottom: 24px;\n          text-align: center;\n        }\n        \n        .print-button {\n          background: #2196f3;\n          color: white;\n          border: none;\n          padding: 12px 24px;\n          border-radius: 6px;\n          font-size: 14px;\n          cursor: pointer;\n          margin-top: 8px;\n        }\n        \n        .print-button:hover {\n          background: #1976d2;\n        }\n        \n        @media print {\n          .print-instructions { display: none; }\n        }\n      </style>\n    </head>\n    <body>\n      <div class=\"print-instructions\">\n        <h3 style=\"margin: 0 0 8px 0; color: #1976d2;\">üìÑ Print to PDF</h3>\n        <p style=\"margin: 0; color: #666;\">Press Ctrl+P (or Cmd+P on Mac) and select \"Save as PDF\" to download your CV</p>\n        <button class=\"print-button\" onclick=\"window.print()\">üñ®Ô∏è Print/Save as PDF</button>\n      </div>\n      \n      <div class=\"header\">\n        <div class=\"name\">${cvData.personalInfo.name || 'Healthcare Professional'}</div>\n        <div class=\"contact\">\n          ${cvData.personalInfo.location ? `<div class=\"contact-line\">${cvData.personalInfo.location}</div>` : ''}\n          ${cvData.personalInfo.phone ? `<div class=\"contact-line\">${cvData.personalInfo.phone}</div>` : ''}\n          ${cvData.personalInfo.email ? `<div class=\"contact-line\">${cvData.personalInfo.email}</div>` : ''}\n        </div>\n      </div>\n\n      ${cvData.registrations.length > 0 ? `\n        <div class=\"section\">\n          <div class=\"section-title\">Professional Registration</div>\n          ${cvData.registrations.map((reg: any) => `\n            <div class=\"registration-item\">\n              <div class=\"reg-type\">${reg.type}</div>\n              <div class=\"reg-details\">Registration Number: ${reg.number}${reg.expiry ? ` ‚Ä¢ Expires: ${reg.expiry}` : ''}</div>\n            </div>\n          `).join('')}\n        </div>\n      ` : ''}\n\n      ${cvData.experience.length > 0 ? `\n        <div class=\"section\">\n          <div class=\"section-title\">Work Experience</div>\n          ${cvData.experience.map((exp: any) => `\n            <div class=\"experience-item\">\n              <div class=\"job-title\">${exp.jobTitle}</div>\n              <div class=\"company\">${exp.employer || ''}</div>\n              <div class=\"location-date\">\n                ${exp.location ? `${exp.location} ‚Ä¢ ` : ''}${formatDateToMonthYear(exp.startDate)} - ${exp.current ? 'Present' : formatDateToMonthYear(exp.endDate)}\n              </div>\n              ${exp.duties && exp.duties.length > 0 ? `\n                <ul class=\"duties-list\">\n                  ${exp.duties.map((duty: string) => `<li>${duty}</li>`).join('')}\n                </ul>\n              ` : exp.description ? `\n                <ul class=\"duties-list\">\n                  ${exp.description.split('\\n').filter((line: string) => line.trim()).map((duty: string) => `<li>${duty.trim()}</li>`).join('')}\n                </ul>\n              ` : ''}\n            </div>\n          `).join('')}\n        </div>\n      ` : ''}\n\n      ${cvData.education.length > 0 ? `\n        <div class=\"section\">\n          <div class=\"section-title\">Education & Qualifications</div>\n          ${cvData.education.map((edu: any) => `\n            <div class=\"education-item\">\n              <div class=\"job-title\">${edu.qualification || edu.degree || 'Qualification'}</div>\n              <div class=\"company\">${edu.institution || ''}</div>\n              <div class=\"location-date\">\n                ${edu.location ? `${edu.location} ‚Ä¢ ` : ''}${formatDateToMonthYear(edu.year || edu.endDate || '')}${edu.grade ? ` ‚Ä¢ ${edu.grade}` : ''}\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      ` : ''}\n\n      ${cvData.courses && cvData.courses.length > 0 ? `\n        <div class=\"section\">\n          <div class=\"section-title\">Courses & Certifications</div>\n          ${cvData.courses.map((course: any) => `\n            <div class=\"education-item\">\n              <div class=\"job-title\">${course.name || ''}</div>\n              <div class=\"company\">${course.provider || ''}</div>\n              <div class=\"location-date\">\n                ${formatDateToMonthYear(course.completionDate || '')}\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      ` : ''}\n\n      ${cvData.skills.length > 0 ? `\n        <div class=\"section\">\n          <div class=\"section-title\">Skills</div>\n          <div class=\"skills-list\">\n            ${cvData.skills.map((skill: string) => `<span class=\"skill-item\">${skill}</span>`).join('')}\n          </div>\n        </div>\n      ` : ''}\n\n      <!-- References section -->\n      <div class=\"section\">\n        <div class=\"section-title\">References</div>\n        <p style=\"margin: 8px 0; font-style: italic;\">Available upon request</p>\n      </div>\n    </body>\n    </html>\n  `;\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Auth middleware\n  await setupAuth(app);\n\n  // Payment routes\n  registerPaymentRoutes(app);\n  \n  // Register Gemini AI routes\n  app.use('/api/ai/gemini', aiGeminiRoutes);\n  \n  // Raw body middleware for Stripe webhooks (must be before express.json())\n  app.use('/api/webhooks/stripe', express.raw({ type: 'application/json' }));\n\n  // Auth routes\n  app.get('/api/auth/user', isAuthenticated, auditDataAccess('user_profile', 'view', 'User profile access'), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      const profile = await storage.getProfile(userId);\n      \n      const userWithProfile = {\n        ...user,\n        profile\n      };\n      \n      res.json(userWithProfile);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // AI Usage Statistics\n  app.get('/api/usage/stats', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const stats = await getUserUsageStats(userId);\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching usage stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch usage statistics\" });\n    }\n  });\n\n  // CSRF Token endpoint\n  app.get('/api/csrf-token', isAuthenticated, async (req: any, res) => {\n    try {\n      const token = generateCSRFToken();\n      res.json({ csrfToken: token });\n    } catch (error) {\n      console.error(\"Error generating CSRF token:\", error);\n      res.status(500).json({ message: \"Failed to generate CSRF token\" });\n    }\n  });\n\n  // =====================================================\n  // GDPR COMPLIANCE ENDPOINTS\n  // =====================================================\n\n  // Record or update user consent\n  app.post('/api/gdpr/consent', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { consent_type, consent_given, legal_basis } = req.body;\n      const ipAddress = req.ip || req.connection.remoteAddress;\n      const userAgent = req.get('User-Agent');\n\n      if (!consent_type || typeof consent_given !== 'boolean') {\n        return res.status(400).json({ \n          error: 'consent_type and consent_given are required' \n        });\n      }\n\n      const consent = await storage.updateConsent(\n        userId, \n        consent_type, \n        consent_given, \n        ipAddress, \n        userAgent\n      );\n\n      res.json({\n        success: true,\n        message: consent_given ? 'Consent recorded' : 'Consent withdrawn',\n        consent: {\n          type: consent.consentType,\n          given: consent.consentGiven,\n          date: consent.consentDate\n        }\n      });\n\n    } catch (error) {\n      console.error('Error updating consent:', error);\n      res.status(500).json({ error: 'Failed to update consent' });\n    }\n  });\n\n  // Get user's current consents\n  app.get('/api/gdpr/consents', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const consents = await storage.getUserConsents(userId);\n      \n      // Get the latest consent for each type\n      const latestConsents = consents.reduce((acc, consent) => {\n        if (!acc[consent.consentType] || \n            (consent.consentDate && acc[consent.consentType].consentDate && \n             new Date(consent.consentDate) > new Date(acc[consent.consentType].consentDate))) {\n          acc[consent.consentType] = consent;\n        }\n        return acc;\n      }, {} as Record<string, any>);\n\n      res.json({\n        consents: Object.values(latestConsents).map(c => ({\n          type: c.consentType,\n          given: c.consentGiven,\n          date: c.consentDate,\n          legalBasis: c.legalBasis,\n          version: c.consentVersion\n        }))\n      });\n\n    } catch (error) {\n      console.error('Error fetching consents:', error);\n      res.status(500).json({ error: 'Failed to fetch consents' });\n    }\n  });\n\n  // Submit data subject access request\n  app.post('/api/gdpr/request/access', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { details } = req.body;\n\n      const request = await storage.createDataSubjectRequest({\n        userId,\n        requestType: 'access',\n        requestDetails: details || 'User requested access to all personal data',\n        verificationMethod: 'authenticated_session'\n      });\n\n      res.json({\n        success: true,\n        message: 'Your data access request has been submitted.',\n        referenceId: request.referenceId,\n        expectedCompletion: '30 days from submission',\n        requestId: request.id\n      });\n\n    } catch (error) {\n      console.error('Error submitting access request:', error);\n      res.status(500).json({ error: 'Failed to submit access request' });\n    }\n  });\n\n  // Submit data rectification request\n  app.post('/api/gdpr/request/rectification', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { field, currentValue, requestedValue, reason } = req.body;\n\n      if (!field || !requestedValue) {\n        return res.status(400).json({ \n          error: 'field and requestedValue are required' \n        });\n      }\n\n      const requestDetails = JSON.stringify({\n        field,\n        currentValue,\n        requestedValue,\n        reason\n      });\n\n      const request = await storage.createDataSubjectRequest({\n        userId,\n        requestType: 'rectification',\n        requestDetails,\n        verificationMethod: 'authenticated_session'\n      });\n\n      res.json({\n        success: true,\n        message: 'Rectification request submitted for review.',\n        referenceId: request.referenceId,\n        requestId: request.id\n      });\n\n    } catch (error) {\n      console.error('Error submitting rectification request:', error);\n      res.status(500).json({ error: 'Failed to submit rectification request' });\n    }\n  });\n\n  // Submit data erasure request\n  app.post('/api/gdpr/request/erasure', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { reason, specificData } = req.body;\n\n      // Basic validation for legitimate erasure grounds\n      const validReasons = [\n        'no_longer_necessary',\n        'withdraw_consent',\n        'unlawful_processing',\n        'legal_obligation',\n        'processed_as_child'\n      ];\n\n      if (reason && !validReasons.includes(reason)) {\n        return res.status(400).json({\n          error: 'Invalid erasure reason provided'\n        });\n      }\n\n      const requestDetails = JSON.stringify({\n        reason: reason || 'user_request',\n        specificData: specificData || 'all_personal_data'\n      });\n\n      const request = await storage.createDataSubjectRequest({\n        userId,\n        requestType: 'erasure',\n        requestDetails,\n        verificationMethod: 'authenticated_session'\n      });\n\n      res.json({\n        success: true,\n        message: 'Erasure request submitted for processing.',\n        referenceId: request.referenceId,\n        note: 'Account deletion will be processed within 30 days.',\n        requestId: request.id\n      });\n\n    } catch (error) {\n      console.error('Error submitting erasure request:', error);\n      res.status(500).json({ error: 'Failed to submit erasure request' });\n    }\n  });\n\n  // Data portability request - immediate export\n  app.post('/api/gdpr/request/portability', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n\n      // Log GDPR data export\n      await logGdprDataExport(userId, 'portability_request', req);\n\n      // Generate portable data export\n      const portableData = await storage.getUserDataExport(userId);\n\n      // Log the request\n      const request = await storage.createDataSubjectRequest({\n        userId,\n        requestType: 'portability',\n        requestDetails: 'User requested portable data export',\n        status: 'completed',\n        verificationMethod: 'authenticated_session',\n        responseData: { exportGenerated: true, exportDate: new Date().toISOString() }\n      });\n\n      res.json({\n        success: true,\n        data: portableData,\n        format: 'structured_json',\n        referenceId: request.referenceId,\n        note: 'This data is provided in a commonly used, machine-readable format.'\n      });\n\n    } catch (error) {\n      console.error('Error generating portable data:', error);\n      res.status(500).json({ error: 'Failed to generate portable data' });\n    }\n  });\n\n  // Get user's GDPR requests\n  app.get('/api/gdpr/requests', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const requests = await storage.getDataSubjectRequests(userId);\n\n      res.json({\n        requests: requests.map(r => ({\n          id: r.id,\n          type: r.requestType,\n          status: r.status,\n          submittedDate: r.submittedDate,\n          completedDate: r.completedDate,\n          referenceId: r.referenceId,\n          details: r.requestDetails\n        }))\n      });\n\n    } catch (error) {\n      console.error('Error fetching GDPR requests:', error);\n      res.status(500).json({ error: 'Failed to fetch requests' });\n    }\n  });\n\n  // Download data export (for completed access requests)\n  app.get('/api/gdpr/export/:requestId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { requestId } = req.params;\n\n      // Verify the request belongs to the user\n      const requests = await storage.getDataSubjectRequests(userId);\n      const request = requests.find(r => r.id === requestId && r.requestType === 'access');\n\n      if (!request) {\n        return res.status(404).json({ error: 'Export request not found' });\n      }\n\n      if (request.status !== 'completed') {\n        return res.status(400).json({ \n          error: 'Export not ready', \n          status: request.status \n        });\n      }\n\n      // Log GDPR data export\n      await logGdprDataExport(userId, 'access_request', req);\n\n      // Generate fresh export\n      const exportData = await storage.getUserDataExport(userId);\n\n      res.setHeader('Content-Type', 'application/json');\n      res.setHeader('Content-Disposition', `attachment; filename=\"personal_data_export_${userId}.json\"`);\n      res.json(exportData);\n\n    } catch (error) {\n      console.error('Error downloading export:', error);\n      res.status(500).json({ error: 'Failed to download export' });\n    }\n  });\n\n  // Update user and profile route\n  app.patch('/api/auth/user', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Update user data (firstName, lastName)\n      if (req.body.firstName || req.body.lastName) {\n        await storage.updateUser(userId, {\n          firstName: req.body.firstName,\n          lastName: req.body.lastName\n        });\n      }\n      \n      // Update profile data\n      const profileData = {\n        userId,\n        profession: req.body.profession,\n        registrationNumber: req.body.registrationNumber,\n        email: req.body.email,\n        phone: req.body.phone,\n        city: req.body.city,\n        country: req.body.country,\n        yearsExperience: req.body.yearsExperience,\n        visaStatus: req.body.visaStatus,\n        skills: req.body.skills || [],\n        workExperience: req.body.workExperience || [],\n        education: req.body.education || [],\n        courses: req.body.courses || [],\n        specialties: req.body.specialties || [],\n      };\n        \n      await storage.upsertProfile(profileData);\n      \n      // Return updated user data with profile\n      const updatedUser = await storage.getUser(userId);\n      const updatedProfile = await storage.getProfile(userId);\n      \n      const userWithProfile = {\n        ...updatedUser,\n        profile: updatedProfile\n      };\n      \n      res.json(userWithProfile);\n    } catch (error) {\n      console.error(\"Error updating user:\", error);\n      res.status(500).json({ message: \"Failed to update user\" });\n    }\n  });\n\n  // Dashboard data route\n  app.get('/api/dashboard', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Get user profile\n      const profile = await storage.getProfile(userId);\n      \n      // Get applications\n      const applications = await storage.getApplications(userId);\n      const inProgressApplications = applications.filter(app => \n        ['applied', 'interview'].includes(app.status)\n      );\n      \n      // Get latest interview score\n      const latestScore = await storage.getLatestInterviewScore(userId);\n      \n      // Get latest documents\n      const latestCV = await storage.getLatestDocument(userId, 'cv');\n      \n      // Calculate stats\n      const dashboardData = {\n        profileCompletion: profile?.completionPercentage || 0,\n        newJobMatches: 14, // This would come from job matching service\n        applicationsInProgress: inProgressApplications.length,\n        totalApplications: applications.length,\n        latestInterviewScore: latestScore || 0,\n        interviewsThisWeek: applications.filter(app => \n          app.interviewDate && \n          new Date(app.interviewDate) > new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)\n        ).length,\n        successRate: applications.length > 0 \n          ? Math.round((applications.filter(app => app.status === 'offered').length / applications.length) * 100)\n          : 0,\n        recentApplications: applications.slice(0, 3),\n        latestDocument: latestCV\n      };\n      \n      res.json(dashboardData);\n    } catch (error) {\n      console.error(\"Error fetching dashboard data:\", error);\n      res.status(500).json({ message: \"Failed to fetch dashboard data\" });\n    }\n  });\n\n  // Profile routes\n  app.get('/api/profile', isAuthenticated, auditDataAccess('profile', 'view', 'Profile data access'), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const profile = await storage.getProfile(userId);\n      res.json(profile);\n    } catch (error) {\n      console.error(\"Error fetching profile:\", error);\n      res.status(500).json({ message: \"Failed to fetch profile\" });\n    }\n  });\n\n  app.post('/api/profile', isAuthenticated, validateCSRFToken, auditDataAccess('profile', 'edit', 'Profile data update'), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const validatedData = insertProfileSchema.parse({\n        ...req.body,\n        userId\n      });\n      \n      const profile = await storage.upsertProfile(validatedData);\n      res.json(profile);\n    } catch (error) {\n      console.error(\"Error updating profile:\", error);\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  // Application routes\n  app.get('/api/applications', isAuthenticated, auditDataAccess('applications', 'view', 'Job applications access'), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const applications = await storage.getApplications(userId);\n      res.json(applications);\n    } catch (error) {\n      console.error(\"Error fetching applications:\", error);\n      res.status(500).json({ message: \"Failed to fetch applications\" });\n    }\n  });\n\n  app.post('/api/applications', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const validatedData = insertApplicationSchema.parse({\n        ...req.body,\n        userId\n      });\n      \n      const application = await storage.createApplication(validatedData);\n      res.json(application);\n    } catch (error) {\n      console.error(\"Error creating application:\", error);\n      res.status(500).json({ message: \"Failed to create application\" });\n    }\n  });\n\n  app.put('/api/applications/:id', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const updates = req.body;\n      \n      const application = await storage.updateApplication(id, updates);\n      res.json(application);\n    } catch (error) {\n      console.error(\"Error updating application:\", error);\n      res.status(500).json({ message: \"Failed to update application\" });\n    }\n  });\n\n  // Update application notes specifically\n  app.patch('/api/applications/:id/notes', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const { notes } = req.body;\n      const userId = req.user.claims.sub;\n      \n      const application = await storage.updateApplicationNotes(id, userId, notes);\n      res.json(application);\n    } catch (error) {\n      console.error(\"Error updating application notes:\", error);\n      res.status(500).json({ message: \"Failed to update application notes\" });\n    }\n  });\n\n  // Update user profile photo\n  app.patch('/api/user/profile-photo', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { uploadURL } = req.body;\n      \n      if (!uploadURL) {\n        return res.status(400).json({ message: \"Upload URL is required\" });\n      }\n      \n      // Normalize the upload URL to object path\n      const objectPath = objectStorageService.normalizeObjectEntityPath(uploadURL);\n      \n      const updatedUser = await storage.updateUser(userId, { profileImageUrl: objectPath });\n      res.json({ success: true, objectPath, user: updatedUser });\n    } catch (error) {\n      console.error(\"Error updating profile photo:\", error);\n      res.status(500).json({ message: \"Failed to update profile photo\" });\n    }\n  });\n\n  // Get object upload URL\n  app.post('/api/objects/upload', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const uploadURL = await objectStorageService.getUserDocumentUploadURL(userId, 'profile-photo');\n      res.json({ uploadURL });\n    } catch (error) {\n      console.error(\"Error generating upload URL:\", error);\n      res.status(500).json({ message: \"Failed to generate upload URL\" });\n    }\n  });\n\n  // Interview session routes\n  app.get('/api/interviews', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const sessions = await storage.getInterviewSessions(userId);\n      res.json(sessions);\n    } catch (error) {\n      console.error(\"Error fetching interview sessions:\", error);\n      res.status(500).json({ message: \"Failed to fetch interview sessions\" });\n    }\n  });\n\n  app.post('/api/interviews', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const session = await storage.createInterviewSession({\n        userId,\n        score: req.body.score,\n        duration: req.body.duration,\n        feedback: req.body.feedback\n      });\n      res.json(session);\n    } catch (error) {\n      console.error(\"Error creating interview session:\", error);\n      res.status(500).json({ message: \"Failed to create interview session\" });\n    }\n  });\n\n  // Documents routes\n  app.get('/api/documents', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const documents = await storage.getDocuments(userId);\n      res.json(documents);\n    } catch (error) {\n      console.error(\"Error fetching documents:\", error);\n      res.status(500).json({ message: \"Failed to fetch documents\" });\n    }\n  });\n\n  app.post('/api/documents', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const validatedData = insertDocumentSchema.parse({\n        ...req.body,\n        userId\n      });\n      \n      const document = await storage.createDocument(validatedData);\n      res.json(document);\n    } catch (error) {\n      console.error(\"Error creating document:\", error);\n      res.status(500).json({ message: \"Failed to create document\" });\n    }\n  });\n\n  // AI Document Generation Routes\n  app.post('/api/documents/generate-cv', isAuthenticated, validateCSRFToken, checkUsageRestrictions('document_generation'), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Get user profile and STAR examples\n      const profile = await storage.getProfile(userId);\n      const starExamples = await storage.getStarExamples(userId);\n      \n      if (!profile) {\n        return res.status(400).json({ message: \"Profile required for CV generation\" });\n      }\n      \n      // Prepare generation context\n      const context = {\n        userProfile: profile,\n        starExamples,\n        experienceLevel: req.body.experienceLevel || 'mid',\n        targetBand: req.body.targetBand || 'Band 5',\n        jobDescription: req.body.jobDescription\n      };\n      \n      // Generate CV using AI\n      const cvContent = await aiService.generateCV(context);\n      \n      // Save generated document\n      const document = await storage.createDocument({\n        userId,\n        type: 'cv',\n        title: `CV - ${new Date().toLocaleDateString()}`,\n        content: cvContent,\n        version: \"1.0\"\n      });\n      \n      res.json(document);\n    } catch (error) {\n      console.error(\"Error generating CV:\", error);\n      res.status(500).json({ message: \"Failed to generate CV\" });\n    }\n  });\n\n  app.post('/api/documents/generate-supporting-info', isAuthenticated, validateCSRFToken, checkUsageRestrictions('document_generation'), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Get user profile and STAR examples  \n      const profile = await storage.getProfile(userId);\n      const starExamples = await storage.getStarExamples(userId);\n      \n      if (!profile) {\n        return res.status(400).json({ message: \"Profile required for Supporting Information generation\" });\n      }\n      \n      if (!req.body.jobDescription) {\n        return res.status(400).json({ message: \"Job description required for Supporting Information\" });\n      }\n      \n      // Prepare generation context\n      const context = {\n        userProfile: profile,\n        starExamples,\n        experienceLevel: req.body.experienceLevel || 'mid',\n        targetBand: req.body.targetBand || 'Band 5',\n        jobDescription: req.body.jobDescription\n      };\n      \n      // Generate Supporting Information using AI\n      const supportingInfoContent = await aiService.generateSupportingInfo(context);\n      \n      // Save generated document\n      const document = await storage.createDocument({\n        userId,\n        type: 'supporting_info', \n        title: `Supporting Information - ${req.body.jobTitle || 'NHS Role'}`,\n        content: supportingInfoContent,\n        version: \"1.0\"\n      });\n      \n      res.json(document);\n    } catch (error) {\n      console.error(\"Error generating Supporting Information:\", error);\n      res.status(500).json({ message: \"Failed to generate Supporting Information\" });\n    }\n  });\n\n  // STAR Examples Routes\n  app.get('/api/star-examples', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const examples = await storage.getStarExamples(userId);\n      res.json(examples);\n    } catch (error) {\n      console.error(\"Error fetching STAR examples:\", error);\n      res.status(500).json({ message: \"Failed to fetch STAR examples\" });\n    }\n  });\n\n  app.post('/api/star-examples', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const validatedData = insertStarExampleSchema.parse({\n        ...req.body,\n        userId\n      });\n      \n      const example = await storage.createStarExample(validatedData);\n      res.json(example);\n    } catch (error) {\n      console.error(\"Error creating STAR example:\", error);\n      res.status(500).json({ message: \"Failed to create STAR example\" });\n    }\n  });\n\n  app.put('/api/star-examples/:id', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const updatedExample = await storage.updateStarExample(id, req.body);\n      res.json(updatedExample);\n    } catch (error) {\n      console.error(\"Error updating STAR example:\", error);\n      res.status(500).json({ message: \"Failed to update STAR example\" });\n    }\n  });\n\n  app.delete('/api/star-examples/:id', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      await storage.deleteStarExample(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting STAR example:\", error);\n      res.status(500).json({ message: \"Failed to delete STAR example\" });\n    }\n  });\n\n  // Interview Practice Routes\n  app.post('/api/interview/generate-questions', isAuthenticated, validateCSRFToken, checkUsageRestrictions('interview_practice'), async (req: any, res) => {\n    try {\n      const { jobDescription, difficulty = 'mid' } = req.body;\n      \n      if (!jobDescription) {\n        return res.status(400).json({ message: \"Job description required\" });\n      }\n      \n      const questions = await aiService.generateInterviewQA(jobDescription, difficulty);\n      res.json(questions);\n    } catch (error) {\n      console.error(\"Error generating interview questions:\", error);\n      res.status(500).json({ message: \"Failed to generate interview questions\" });\n    }\n  });\n\n  app.post('/api/interview/score-response', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { question, userResponse } = req.body;\n      \n      if (!question || !userResponse) {\n        return res.status(400).json({ message: \"Question and response required\" });\n      }\n      \n      const scoring = await aiService.scoreInterviewResponse(question, userResponse);\n      res.json(scoring);\n    } catch (error) {\n      console.error(\"Error scoring interview response:\", error);\n      res.status(500).json({ message: \"Failed to score interview response\" });\n    }\n  });\n\n  // === Interview Practice Feature - As Per Specification ===\n  \n  // Start interview practice session\n  app.post('/api/generate-questions', isAuthenticated, validateCSRFToken, checkUsageRestrictions('interview_practice'), async (req: any, res) => {\n    try {\n      // Create session ID for the interview practice\n      const sessionId = randomUUID();\n      \n      res.json({\n        session_id: sessionId,\n        message: \"Interview practice session ready to start\"\n      });\n    } catch (error) {\n      console.error(\"Error starting interview practice:\", error);\n      res.status(500).json({ message: \"Failed to start interview practice\" });\n    }\n  });\n\n  // Start interview session with 5 random questions from the standard bank\n  app.post('/api/interview/start', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { session_id } = req.body;\n      \n      if (!session_id) {\n        return res.status(400).json({ message: \"Session ID required\" });\n      }\n\n      // Get all questions from database and select 5 random ones\n      const allQuestions = await db\n        .select()\n        .from(interviewQuestions)\n        .orderBy(sql`RANDOM()`)\n        .limit(5);\n\n      // Extract just the question text\n      const selectedQuestions = allQuestions.map(q => q.question);\n\n      res.json({\n        questions: selectedQuestions,\n        time_limit: 600 // 10 minutes in seconds\n      });\n    } catch (error) {\n      console.error(\"Error starting interview:\", error);\n      res.status(500).json({ message: \"Failed to start interview\" });\n    }\n  });\n\n  // Submit answers and get Henry's feedback  \n  app.post('/api/interview/submit', isAuthenticated, validateCSRFToken, checkUsageRestrictions('interview_practice'), async (req: any, res) => {\n    try {\n      const userId = req.user!.claims!.sub;\n      const { session_id, answers } = req.body;\n      \n      if (!answers || answers.length !== 5) {\n        return res.status(400).json({ message: \"Must provide exactly 5 answers\" });\n      }\n\n      // Generate feedback using Henry the Helper demo mode - more critical approach\n      const score = Math.floor(Math.random() * 6) + 4; // Random score between 4-9 (more realistic range)\n      \n      const criticalFeedback = [\n        \"Your answer lacks specific examples. NHS interviewers want concrete evidence using the STAR method.\",\n        \"You mentioned the topic but didn't demonstrate deep understanding. Provide more detail about your actual experience.\",\n        \"Good start, but you need to connect your answer more clearly to NHS values and patient outcomes.\",\n        \"Your response was too generic. NHS roles require specific, measurable examples of your impact.\",\n        \"You touched on the right themes but need to show more critical thinking about the challenges involved.\",\n        \"Adequate response but lacks the depth expected for this level. Consider the complexities of real healthcare scenarios.\",\n        \"You need to be more specific about your role versus team achievements. What did YOU specifically do?\",\n        \"Your answer shows awareness but doesn't demonstrate the level of insight needed for NHS interviews.\"\n      ];\n\n      const feedback = {\n        individual_feedback: answers.map((a: any, i: number) => ({\n          question_num: i + 1,\n          feedback: criticalFeedback[Math.floor(Math.random() * criticalFeedback.length)]\n        })),\n        overall_feedback: `Your interview session is complete. Henry the Helper (Demo Mode) has scored your performance at ${score}/10. While you demonstrated some understanding of NHS values, there are significant areas for improvement. Your answers often lacked the specific, evidence-based examples that NHS interviewers expect. Healthcare interviews require concrete stories using the STAR method, measurable outcomes, and clear connections to patient care. You need to practice articulating your actual impact rather than describing general approaches.`,\n        score: score,\n        improvement_tips: [\n          \"Use the STAR method religiously - every answer needs Situation, Task, Action, Result\",\n          \"Prepare 10-15 specific examples from your experience with measurable outcomes\", \n          \"Research NHS values deeply and weave them authentically into your responses\",\n          \"Practice explaining complex situations clearly and concisely\",\n          \"Prepare for follow-up questions that probe deeper into your examples\"\n        ]\n      };\n      \n      // Save session to database\n      const [session] = await db\n        .insert(interviewSessions)\n        .values({\n          userId,\n          score: feedback.score,\n          feedback: feedback.overall_feedback,\n          duration: 10 // Default to 10 minutes\n        })\n        .returning();\n\n      // Clean up old sessions - keep only the last 5 for this user\n      const allUserSessions = await db\n        .select({ id: interviewSessions.id })\n        .from(interviewSessions)\n        .where(eq(interviewSessions.userId, userId))\n        .orderBy(desc(interviewSessions.createdAt));\n\n      if (allUserSessions.length > 5) {\n        const sessionsToDelete = allUserSessions.slice(5);\n        const idsToDelete = sessionsToDelete.map(s => s.id);\n        \n        await db\n          .delete(interviewSessions)\n          .where(sql`${interviewSessions.id} IN (${idsToDelete.map(id => `'${id}'`).join(',')})`);\n        \n        console.log(`Cleaned up ${idsToDelete.length} old interview sessions for user ${userId}`);\n      }\n\n      res.json(feedback);\n    } catch (error) {\n      console.error(\"Error submitting interview:\", error);\n      res.status(500).json({ message: \"Failed to submit interview\" });\n    }\n  });\n\n  // Get user interview history\n  app.get('/api/interview/history/:user_id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.params.user_id;\n      \n      const sessions = await db\n        .select()\n        .from(interviewSessions)\n        .where(eq(interviewSessions.userId, userId))\n        .orderBy(sql`created_at DESC`);\n\n      res.json({\n        sessions: sessions.map(s => ({\n          date: s.createdAt?.toISOString().split('T')[0],\n          score: s.score,\n          feedback: s.feedback\n        }))\n      });\n    } catch (error) {\n      console.error(\"Error fetching history:\", error);\n      res.status(500).json({ message: \"Failed to fetch history\" });\n    }\n  });\n\n  // Legacy endpoint - remove after testing new system\n  app.post('/api/interview-practice/submit-answers', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { answers } = req.body; // Array of {questionId, question, answer}\n\n      if (!answers || answers.length !== 10) {\n        return res.status(400).json({ message: \"Must provide exactly 10 answers\" });\n      }\n\n      // Create session record\n      const [session] = await db\n        .insert(interviewSessions)\n        .values({\n          userId,\n          score: 0, // Will be updated after Henry's feedback\n          duration: 0,\n          feedback: null, // Will be updated after Henry's feedback\n        })\n        .returning();\n\n      // Get Henry's feedback using Gemini\n      const prompt = `You are Henry the Helper, a friendly AI assistant helping NHS healthcare professionals with interview practice. \n\nPlease review these 10 interview answers and provide:\n1. An overall score out of 10\n2. Constructive feedback on strengths and areas for improvement  \n3. Specific tips for better answers\n\nQuestions and Answers:\n${answers.map((a: any, i: number) => `\n${i + 1}. ${a.question}\nAnswer: ${a.answer}\n`).join('')}\n\nPlease respond in JSON format:\n{\n  \"overallScore\": number (1-10),\n  \"feedback\": \"detailed feedback string\",\n  \"strengths\": [\"strength1\", \"strength2\"],\n  \"improvements\": [\"improvement1\", \"improvement2\"]\n}`;\n\n      // Use Gemini for Henry's feedback\n      const { GoogleGenAI } = await import(\"@google/genai\");\n      const ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY || \"\" });\n      const response = await ai.models.generateContent({\n        model: \"gemini-2.5-flash-lite\",\n        config: {\n          responseMimeType: \"application/json\",\n          responseSchema: {\n            type: \"object\",\n            properties: {\n              overallScore: { type: \"number\" },\n              feedback: { type: \"string\" },\n              strengths: { type: \"array\", items: { type: \"string\" } },\n              improvements: { type: \"array\", items: { type: \"string\" } }\n            },\n            required: [\"overallScore\", \"feedback\", \"strengths\", \"improvements\"]\n          }\n        },\n        contents: prompt,\n      });\n\n      const henryFeedback = JSON.parse(response.text || '{}');\n\n      // Update session with Henry's feedback\n      const [updatedSession] = await db\n        .update(interviewSessions)\n        .set({\n          score: henryFeedback.overallScore,\n          feedback: JSON.stringify(henryFeedback)\n        })\n        .where(eq(interviewSessions.id, session.id))\n        .returning();\n\n      res.json({\n        session: updatedSession,\n        henryFeedback\n      });\n    } catch (error) {\n      console.error(\"Error processing answers:\", error);\n      res.status(500).json({ message: \"Failed to process answers\" });\n    }\n  });\n\n  // Submit answer for a question in session\n  app.post('/api/interview-practice/submit-answer', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { sessionId, questionId, response, timeSpent } = req.body;\n\n      // Verify session belongs to user\n      const [session] = await db\n        .select()\n        .from(interviewSessions)\n        .where(\n          and(\n            eq(interviewSessions.id, sessionId),\n            eq(interviewSessions.userId, userId)\n          )\n        );\n\n      if (!session) {\n        return res.status(403).json({ message: \"Session not found or unauthorized\" });\n      }\n\n      // Generate score and feedback using Henry AI (placeholder for now)\n      let score = Math.floor(Math.random() * 4) + 7; // 7-10 range for demo\n      let feedback = \"Great answer! Consider using the STAR method to structure your response more effectively.\";\n\n      // Try to use AI if available\n      try {\n        const question = await db\n          .select()\n          .from(interviewQuestions)\n          .where(eq(interviewQuestions.id, questionId))\n          .limit(1);\n\n        if (question.length > 0) {\n          const aiResult = await aiService.scoreInterviewResponse(question[0].question, response);\n          if (aiResult && aiResult.score !== undefined) {\n            score = aiResult.score;\n            feedback = aiResult.feedback || feedback;\n          }\n        }\n      } catch (aiError) {\n        console.error(\"AI scoring failed, using fallback:\", aiError);\n      }\n\n      // Save the response\n      const [savedResponse] = await db\n        .insert(interviewResponses)\n        .values({\n          sessionId,\n          questionId,\n          response,\n          score,\n          feedback,\n          timeSpent,\n        })\n        .returning();\n\n      res.json({\n        response: savedResponse,\n        score,\n        feedback\n      });\n    } catch (error) {\n      console.error(\"Error submitting interview answer:\", error);\n      res.status(500).json({ message: \"Failed to submit answer\" });\n    }\n  });\n\n  // Complete interview session\n  app.post('/api/interview-practice/complete-session', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { sessionId, duration } = req.body;\n\n      // Verify session belongs to user\n      const [session] = await db\n        .select()\n        .from(interviewSessions)\n        .where(\n          and(\n            eq(interviewSessions.id, sessionId),\n            eq(interviewSessions.userId, userId)\n          )\n        );\n\n      if (!session) {\n        return res.status(403).json({ message: \"Session not found or unauthorized\" });\n      }\n\n      // Get all responses for this session\n      const responses = await db\n        .select()\n        .from(interviewResponses)\n        .where(eq(interviewResponses.sessionId, sessionId));\n\n      // Calculate overall score\n      const totalScore = responses.reduce((sum, r) => sum + (r.score || 0), 0);\n      const averageScore = responses.length > 0 ? Math.round(totalScore / responses.length) : 0;\n\n      // Generate overall feedback\n      let overallFeedback = `You completed ${responses.length} questions with an average score of ${averageScore}/10.`;\n      \n      if (averageScore >= 8) {\n        overallFeedback += \" Excellent work! You demonstrated strong interview skills.\";\n      } else if (averageScore >= 6) {\n        overallFeedback += \" Good effort! Focus on using the STAR method for more structured answers.\";\n      } else {\n        overallFeedback += \" Keep practicing! Consider reviewing common NHS interview questions and the STAR method.\";\n      }\n\n      // Update session with final score and feedback\n      const [updatedSession] = await db\n        .update(interviewSessions)\n        .set({\n          score: averageScore,\n          duration: Math.round(duration / 60), // Convert to minutes\n          feedback: overallFeedback,\n        })\n        .where(eq(interviewSessions.id, sessionId))\n        .returning();\n\n      res.json({\n        session: updatedSession,\n        responses,\n        summary: {\n          totalQuestions: responses.length,\n          averageScore,\n          timeSpent: duration,\n          feedback: overallFeedback\n        }\n      });\n    } catch (error) {\n      console.error(\"Error completing interview session:\", error);\n      res.status(500).json({ message: \"Failed to complete session\" });\n    }\n  });\n\n  // Get interview practice history (last 5 sessions only)\n  app.get('/api/interview-practice/history', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Only return the last 5 sessions\n      const sessions = await db\n        .select()\n        .from(interviewSessions)\n        .where(eq(interviewSessions.userId, userId))\n        .orderBy(desc(interviewSessions.createdAt))\n        .limit(5);\n\n      res.json(sessions);\n    } catch (error) {\n      console.error(\"Error fetching interview history:\", error);\n      res.status(500).json({ message: \"Failed to fetch interview history\" });\n    }\n  });\n\n  // Admin route to seed general questions\n  app.post('/api/interview-practice/seed-questions', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { questions } = req.body;\n      \n      if (!questions || !Array.isArray(questions)) {\n        return res.status(400).json({ message: \"Questions array required\" });\n      }\n\n      const questionsToInsert = questions.map(q => ({\n        question: q,\n        category: 'general',\n        difficulty: 'mid',\n        suggestedAnswer: null,\n        tags: [],\n      }));\n\n      await db.insert(interviewQuestions).values(questionsToInsert);\n      \n      res.json({ \n        message: `Successfully added ${questions.length} general questions`,\n        count: questions.length \n      });\n    } catch (error) {\n      console.error(\"Error seeding questions:\", error);\n      res.status(500).json({ message: \"Failed to seed questions\" });\n    }\n  });\n\n  // Get single job by ID - search across all sources\n  app.get('/api/jobs/:id', async (req: any, res) => {\n    try {\n      const jobId = req.params.id;\n      let job = null;\n      \n      // Try each job source to find the job\n      if (jobId.startsWith('scot_')) {\n        job = await scotNhsJobsService.getJobById(jobId);\n      } else if (jobId.startsWith('hjuk_')) {\n        job = await healthJobsUkService.getJobById(jobId);\n      } else {\n        // Try NHS Jobs first for regular IDs\n        job = await nhsJobsService.getJobById(jobId);\n        \n        // If not found, try other sources\n        if (!job) {\n          job = await scotNhsJobsService.getJobById(jobId) || \n                await healthJobsUkService.getJobById(jobId);\n        }\n      }\n      \n      if (!job) {\n        return res.status(404).json({ message: \"Job not found\" });\n      }\n      \n      res.json(job);\n    } catch (error) {\n      console.error(\"Error fetching job:\", error);\n      res.status(500).json({ message: \"Failed to fetch job details\" });\n    }\n  });\n\n  // Multi-Source Job Discovery Routes - Aggregates NHS Jobs, Scottish NHS, and HealthJobsUK\n  app.get('/api/jobs', async (req: any, res) => {\n    try {\n      const { band, location, visa, search, page } = req.query;\n      \n      // Prepare search parameters for all sources\n      const searchParams = {\n        keyword: search,\n        location: location,\n        page: page ? parseInt(page) : 1\n      };\n      \n      // Fetch jobs from all three sources simultaneously\n      const [nhsResults, scotNhsResults, healthJobsResults] = await Promise.all([\n        // NHS Jobs England\n        nhsJobsService.searchJobs({\n          ...searchParams,\n          payBandFilter: band && band !== 'all-bands' ? band : undefined\n        }).catch(error => {\n          console.error(\"NHS Jobs API error:\", error);\n          return { vacancies: [], totalResults: 0, totalPages: 0 };\n        }),\n        \n        // NHS Scotland  \n        scotNhsJobsService.searchJobs({\n          ...searchParams,\n          salaryBand: band && band !== 'all-bands' ? band : undefined\n        }).catch(error => {\n          console.error(\"Scottish NHS Jobs error:\", error);\n          return { jobs: [], totalResults: 0 };\n        }),\n        \n        // HealthJobsUK\n        healthJobsUkService.searchJobs({\n          ...searchParams\n        }).catch(error => {\n          console.error(\"HealthJobsUK error:\", error);\n          return { jobs: [], totalResults: 0 };\n        })\n      ]);\n\n      // Aggregate results from all NHS job sources\n      \n      // Convert all jobs to our internal format\n      const allJobs = [\n        // NHS Jobs England\n        ...nhsResults.vacancies.map(job => {\n          const converted = nhsJobsService.convertToInternalFormat(job);\n          return {\n            id: job.id,\n            ...converted,\n            source: 'NHS Jobs England'\n          };\n        }),\n        \n        // NHS Scotland\n        ...scotNhsResults.jobs.map(job => {\n          const converted = scotNhsJobsService.convertToInternalFormat(job);\n          return {\n            id: job.id,\n            ...converted,\n            source: 'NHS Scotland'\n          };\n        }),\n        \n        // HealthJobsUK\n        ...healthJobsResults.jobs.map(job => {\n          const converted = healthJobsUkService.convertToInternalFormat(job);\n          return {\n            id: job.id,\n            ...converted,\n            source: 'HealthJobsUK'\n          };\n        })\n      ];\n\n      // Jobs successfully aggregated from all sources\n      \n      // Filter by visa sponsorship if requested\n      const filteredJobs = visa === 'true' \n        ? allJobs.filter(job => job.visaSponsorship || job.description?.toLowerCase().includes('visa'))\n        : allJobs;\n      \n      // Sort by relevance (featured first, then by salary)\n      const sortedJobs = filteredJobs.sort((a, b) => {\n        if (a.featured && !b.featured) return -1;\n        if (!a.featured && b.featured) return 1;\n        if (a.salaryMin && b.salaryMin) return b.salaryMin - a.salaryMin;\n        return 0;\n      });\n      \n      // Allow reasonable caching for job search results (5 minutes)\n      res.set({\n        'Cache-Control': 'public, max-age=300',\n        'Last-Modified': new Date().toUTCString()\n      });\n      \n      res.json(sortedJobs);\n    } catch (error) {\n      console.error(\"Error fetching jobs from multiple sources:\", error);\n      // Fallback to stored jobs if all APIs fail\n      const fallbackJobs = await storage.getNhsJobs({ \n        band: req.query.band || undefined,\n        location: req.query.location || undefined,\n        visaSponsorship: req.query.visa === 'true' || undefined\n      });\n      res.json(fallbackJobs);\n    }\n  });\n\n  app.get('/api/jobs/featured', async (req: any, res) => {\n    try {\n      // Get featured jobs from all sources\n      const [nhsFeatured, scotNhsFeatured, healthJobsFeatured] = await Promise.all([\n        nhsJobsService.getFeaturedJobs(3).catch(error => {\n          console.error(\"NHS Jobs featured error:\", error);\n          return [];\n        }),\n        scotNhsJobsService.getFeaturedJobs(3).catch(error => {\n          console.error(\"Scottish NHS featured error:\", error);\n          return [];\n        }),\n        healthJobsUkService.getFeaturedJobs(3).catch(error => {\n          console.error(\"HealthJobsUK featured error:\", error);\n          return [];\n        })\n      ]);\n      \n      // Convert all featured jobs to our internal format\n      const allFeaturedJobs = [\n        ...nhsFeatured.map(job => ({\n          id: job.id,\n          ...nhsJobsService.convertToInternalFormat(job),\n          source: 'NHS Jobs England',\n          featured: true\n        })),\n        ...scotNhsFeatured.map(job => ({\n          id: job.id,\n          ...scotNhsJobsService.convertToInternalFormat(job),\n          source: 'NHS Scotland',\n          featured: true\n        })),\n        ...healthJobsFeatured.map(job => ({\n          id: job.id,\n          ...healthJobsUkService.convertToInternalFormat(job),\n          source: 'HealthJobsUK',\n          featured: true\n        }))\n      ];\n      \n      // Sort by salary (highest first) and limit to 9 total\n      const sortedFeatured = allFeaturedJobs\n        .sort((a, b) => (b.salaryMin || 0) - (a.salaryMin || 0))\n        .slice(0, 9);\n      \n      res.json(sortedFeatured);\n    } catch (error) {\n      console.error(\"Error fetching featured jobs from multiple sources:\", error);\n      // Fallback to stored featured jobs\n      const fallbackJobs = await storage.getFeaturedJobs();\n      res.json(fallbackJobs);\n    }\n  });\n\n  app.post('/api/jobs/:jobId/calculate-fit', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { jobId } = req.params;\n      \n      // Get user profile\n      const profile = await storage.getProfile(userId);\n      if (!profile) {\n        return res.status(400).json({ message: \"Profile required for job fit calculation\" });\n      }\n      \n      // Get job details\n      const jobs = await storage.getNhsJobs();\n      const job = jobs.find(j => j.id === jobId);\n      if (!job) {\n        return res.status(404).json({ message: \"Job not found\" });\n      }\n      \n      // Calculate job fit using AI with error handling\n      try {\n        const fitResult = await aiService.calculateJobFit(profile, job);\n        \n        // Store job match\n        await storage.createJobMatch({\n          userId,\n          jobId,\n          fitScore: fitResult.score,\n          skillsMatch: fitResult.breakdown\n        });\n        \n        res.json(fitResult);\n      } catch (aiError: any) {\n        // Handle AI quota/API errors gracefully\n        if (aiError.status === 429) {\n          res.status(503).json({ \n            message: \"AI service temporarily unavailable. Please try again later.\",\n            error: \"quota_exceeded\"\n          });\n        } else {\n          throw aiError; // Re-throw other errors\n        }\n      }\n    } catch (error) {\n      console.error(\"Error calculating job fit:\", error);\n      res.status(500).json({ message: \"Failed to calculate job fit\" });\n    }\n  });\n\n  app.get('/api/job-matches', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const matches = await storage.getJobMatches(userId);\n      res.json(matches);\n    } catch (error) {\n      console.error(\"Error fetching job matches:\", error);\n      res.status(500).json({ message: \"Failed to fetch job matches\" });\n    }\n  });\n\n  // Dashboard customization routes\n  app.put('/api/dashboard/card-order', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { cardOrder } = req.body;\n      \n      if (!Array.isArray(cardOrder)) {\n        return res.status(400).json({ message: \"Card order must be an array\" });\n      }\n      \n      await storage.updateDashboardCardOrder(userId, cardOrder);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error updating dashboard card order:\", error);\n      res.status(500).json({ message: \"Failed to update dashboard card order\" });\n    }\n  });\n\n  app.get('/api/dashboard/card-order', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      let cardOrder = user?.dashboardCardOrder || [\"profile\", \"jobs\", \"documents\", \"resources\", \"practice\", \"qa\", \"tracker\", \"news\", \"referrals\", \"support\"];\n      \n      // Ensure news is always included (for users who had saved order before news was added)\n      if (!cardOrder.includes(\"news\")) {\n        cardOrder = [...cardOrder, \"news\"];\n      }\n      \n      // Ensure referrals is always included (for users who had saved order before referrals was added)\n      if (!cardOrder.includes(\"referrals\")) {\n        cardOrder = [...cardOrder, \"referrals\"];\n      }\n      \n      // Ensure support is always included (for users who had saved order before support was added)\n      if (!cardOrder.includes(\"support\")) {\n        cardOrder = [...cardOrder, \"support\"];\n      }\n      \n      res.json(cardOrder);\n    } catch (error) {\n      console.error(\"Error fetching dashboard card order:\", error);\n      res.status(500).json({ message: \"Failed to fetch dashboard card order\" });\n    }\n  });\n\n  // Get onboarding status\n  app.get('/api/onboarding/status', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      res.json({\n        hasCompletedOnboarding: user?.hasCompletedOnboarding || false,\n        hasCompletedPremiumOnboarding: user?.hasCompletedPremiumOnboarding || false,\n        subscriptionStatus: user?.subscriptionStatus || 'free'\n      });\n    } catch (error) {\n      console.error(\"Error fetching onboarding status:\", error);\n      res.status(500).json({ message: \"Failed to fetch onboarding status\" });\n    }\n  });\n\n  // Complete onboarding\n  app.post('/api/onboarding/complete', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { type } = req.body; // 'free' or 'premium'\n      \n      const user = await storage.getUser(userId);\n      const isPremium = user?.subscriptionStatus === 'paid';\n      \n      // Update onboarding status\n      const updateData: any = {};\n      if (type === 'premium' && isPremium) {\n        updateData.hasCompletedPremiumOnboarding = true;\n      } else {\n        updateData.hasCompletedOnboarding = true;\n      }\n      \n      await storage.updateUser(userId, updateData);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error completing onboarding:\", error);\n      res.status(500).json({ message: \"Failed to complete onboarding\" });\n    }\n  });\n\n  // ==================== ADMIN SETUP ROUTE ====================\n  // One-time Master Admin setup - can only be used if no master admin exists\n  app.post('/api/setup-master-admin', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Check if any master admin already exists\n      const existingAdmins = await storage.getAllUsers();\n      const masterAdminExists = existingAdmins.some(u => u.adminRole === 'master_admin');\n      \n      if (masterAdminExists) {\n        return res.status(403).json({ message: \"Master Admin already exists\" });\n      }\n\n      // Make current user the Master Admin\n      const masterAdmin = await storage.makeUserAdmin(userId, 'master_admin');\n      \n      // Log the setup\n      await storage.createAdminActivityLog({\n        adminId: userId,\n        action: 'setup_master_admin',\n        targetType: 'system',\n        description: `Master Admin account created for ${user.email}`,\n        metadata: { setupTimestamp: new Date() }\n      });\n\n      res.json({\n        success: true,\n        message: \"Master Admin account created successfully!\",\n        admin: {\n          email: masterAdmin.email,\n          role: masterAdmin.adminRole,\n          createdAt: masterAdmin.adminCreatedAt\n        }\n      });\n    } catch (error) {\n      console.error(\"Error setting up Master Admin:\", error);\n      res.status(500).json({ message: \"Failed to setup Master Admin account\" });\n    }\n  });\n\n  // ==================== ADMIN ROUTES ====================\n  // Import admin authentication middleware\n  const { \n    isAdmin: requireAdmin, \n    isMasterAdmin: requireMasterAdmin, \n    isSecondaryAdminOrHigher: requireSecondaryAdminOrHigher, \n    AdminService \n  } = await import('./adminAuth.js');\n\n  // Admin dashboard overview  \n  app.get('/api/admin/dashboard', async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n    \n    const userId = req.user.claims.sub;\n    const user = await storage.getUser(userId);\n    \n    if (!user?.isAdmin) {\n      return res.status(403).json({ message: \"Admin access required\" });\n    }\n    try {\n      const stats = await AdminService.getDashboardStats();\n      const systemAnalytics = await storage.getSystemAnalytics();\n      \n      res.json({\n        ...systemAnalytics,\n        adminInfo: {\n          role: user.adminRole,\n          isMasterAdmin: user.adminRole === 'master_admin',\n          isSecondaryAdmin: user.adminRole === 'secondary_admin'\n        }\n      });\n    } catch (error) {\n      console.error(\"Error fetching admin dashboard:\", error);\n      res.status(500).json({ message: \"Failed to fetch admin dashboard data\" });\n    }\n  });\n\n  // User management - Get all users\n  app.get('/api/admin/users', async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n    \n    const userId = req.user.claims.sub;\n    const user = await storage.getUser(userId);\n    \n    if (!user?.isAdmin) {\n      return res.status(403).json({ message: \"Admin access required\" });\n    }\n    try {\n      const users = await storage.getAllUsers();\n      \n      // Log admin activity\n      await AdminService.logActivity(\n        userId, \n        'view_users', \n        'users', \n        null, \n        'Viewed user list'\n      );\n      \n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  // Make user admin (Master Admin only)\n  app.post('/api/admin/users/:userId/make-admin', requireMasterAdmin, async (req: any, res) => {\n    try {\n      const { userId } = req.params;\n      const { adminRole } = req.body; // 'secondary_admin'\n      \n      if (adminRole !== 'secondary_admin') {\n        return res.status(400).json({ message: \"Only secondary_admin role can be assigned\" });\n      }\n      \n      const updatedUser = await storage.makeUserAdmin(userId, adminRole, req.admin.userId);\n      \n      // Log admin activity\n      await AdminService.logActivity(\n        req.admin.userId,\n        'create_admin',\n        'user',\n        userId,\n        `Made user ${updatedUser.email} a secondary admin`\n      );\n      \n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error making user admin:\", error);\n      res.status(500).json({ message: \"Failed to make user admin\" });\n    }\n  });\n\n  // Delete user (Master Admin only)\n  app.delete('/api/admin/users/:userId', requireMasterAdmin, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { userId } = req.params;\n      const adminUserId = req.admin.userId;\n      \n      // Prevent deleting self\n      if (userId === adminUserId) {\n        return res.status(400).json({ message: \"Cannot delete your own account\" });\n      }\n      \n      // Get user info for logging before deletion\n      const userToDelete = await storage.getUser(userId);\n      if (!userToDelete) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      await storage.deleteUser(userId);\n      \n      // Log admin activity\n      await AdminService.logActivity(\n        adminUserId,\n        'delete_user',\n        'user',\n        userId,\n        `Deleted user ${userToDelete.email}`\n      );\n      \n      res.json({ message: 'User deleted successfully' });\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      res.status(500).json({ message: \"Failed to delete user\" });\n    }\n  });\n\n  // Suspend user\n  app.post('/api/admin/users/:userId/suspend', requireSecondaryAdminOrHigher, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { userId } = req.params;\n      const { reason } = req.body;\n      const adminUserId = req.admin.userId;\n      \n      const suspendedUser = await storage.suspendUser(userId, reason, adminUserId);\n      \n      // Log admin activity\n      await AdminService.logActivity(\n        adminUserId,\n        'suspend_user',\n        'user',\n        userId,\n        `Suspended user ${suspendedUser.email}. Reason: ${reason || 'No reason provided'}`\n      );\n      \n      res.json(suspendedUser);\n    } catch (error) {\n      console.error(\"Error suspending user:\", error);\n      res.status(500).json({ message: \"Failed to suspend user\" });\n    }\n  });\n\n  // Update user details\n  app.patch('/api/admin/users/:userId', requireSecondaryAdminOrHigher, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { userId } = req.params;\n      const updates = req.body;\n      const adminUserId = req.admin.userId;\n      \n      const updatedUser = await storage.updateUserByAdmin(userId, updates, adminUserId);\n      \n      // Log admin activity\n      await AdminService.logActivity(\n        adminUserId,\n        'update_user',\n        'user',\n        userId,\n        `Updated user ${updatedUser.email}: ${JSON.stringify(updates)}`\n      );\n      \n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error updating user:\", error);\n      res.status(500).json({ message: \"Failed to update user\" });\n    }\n  });\n\n  // System health monitoring\n  app.get('/api/admin/system-health', requireSecondaryAdminOrHigher, async (req: any, res) => {\n    try {\n      const health = await storage.getSystemHealth();\n      res.json(health);\n    } catch (error) {\n      console.error(\"Error fetching system health:\", error);\n      res.status(500).json({ \n        dbStatus: 'error',\n        aiServiceStatus: 'error', \n        paymentServiceStatus: 'error',\n        errorCount: 0,\n        avgResponseTime: 0,\n        uptime: '0s'\n      });\n    }\n  });\n\n  // Admin: Get all GDPR requests\n  app.get('/api/admin/gdpr-requests', requireSecondaryAdminOrHigher, async (req: any, res) => {\n    try {\n      const requests = await storage.getAllDataSubjectRequests();\n      \n      res.json({\n        requests: requests.map(r => ({\n          id: r.id,\n          userId: r.userId,\n          userEmail: r.userEmail, // We'll need to join with users table\n          type: r.requestType,\n          status: r.status,\n          submittedDate: r.submittedDate,\n          completedDate: r.completedDate,\n          referenceId: r.referenceId,\n          details: r.requestDetails,\n          adminNotes: r.adminNotes\n        }))\n      });\n    } catch (error) {\n      console.error('Error fetching admin GDPR requests:', error);\n      res.status(500).json({ error: 'Failed to fetch GDPR requests' });\n    }\n  });\n\n  // Admin: Update GDPR request status\n  app.patch('/api/admin/gdpr-requests/:requestId', requireSecondaryAdminOrHigher, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { requestId } = req.params;\n      const { status, adminNotes } = req.body;\n      const adminUserId = req.admin.userId;\n      \n      if (!['pending', 'in_progress', 'completed', 'rejected'].includes(status)) {\n        return res.status(400).json({ error: 'Invalid status' });\n      }\n      \n      const updatedRequest = await storage.updateDataSubjectRequestStatus(\n        requestId, \n        status, \n        adminNotes, \n        adminUserId\n      );\n      \n      // Log admin activity\n      await AdminService.logActivity(\n        adminUserId,\n        'update_gdpr_request',\n        'gdpr_request',\n        requestId,\n        `Updated GDPR request ${updatedRequest.referenceId} status to ${status}`\n      );\n      \n      res.json(updatedRequest);\n    } catch (error) {\n      console.error('Error updating GDPR request:', error);\n      res.status(500).json({ error: 'Failed to update GDPR request' });\n    }\n  });\n\n  // Content management - Get all content\n  app.get('/api/admin/content', async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n    \n    const userId = req.user.claims.sub;\n    const user = await storage.getUser(userId);\n    \n    if (!user?.isAdmin) {\n      return res.status(403).json({ message: \"Admin access required\" });\n    }\n    try {\n      const content = await storage.getAdminContent();\n      res.json(content);\n    } catch (error) {\n      console.error(\"Error fetching content:\", error);\n      res.status(500).json({ message: \"Failed to fetch content\" });\n    }\n  });\n\n  // Content management - Update content\n  app.put('/api/admin/content/:contentKey', async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n    \n    const userId = req.user.claims.sub;\n    const user = await storage.getUser(userId);\n    \n    if (!user?.isAdmin) {\n      return res.status(403).json({ message: \"Admin access required\" });\n    }\n    try {\n      const { contentKey } = req.params;\n      const { title, content, contentType } = req.body;\n      \n      const updatedContent = await storage.updateAdminContent(\n        contentKey,\n        { title, content, contentType },\n        userId\n      );\n      \n      // Log admin activity\n      await AdminService.logActivity(\n        userId,\n        'update_content',\n        'content',\n        contentKey,\n        `Updated content: ${title}`\n      );\n      \n      res.json(updatedContent);\n    } catch (error) {\n      console.error(\"Error updating content:\", error);\n      res.status(500).json({ message: \"Failed to update content\" });\n    }\n  });\n\n  // AI Prompt management - Get all prompts\n  app.get('/api/admin/prompts', async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n    \n    const userId = req.user.claims.sub;\n    const user = await storage.getUser(userId);\n    \n    if (!user?.isAdmin) {\n      return res.status(403).json({ message: \"Admin access required\" });\n    }\n    try {\n      const { category } = req.query;\n      const prompts = await storage.getAiPrompts(category as string);\n      res.json(prompts);\n    } catch (error) {\n      console.error(\"Error fetching prompts:\", error);\n      res.status(500).json({ message: \"Failed to fetch prompts\" });\n    }\n  });\n\n  // AI Prompt management - Update prompt\n  app.put('/api/admin/prompts/:promptKey', async (req: any, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n    \n    const userId = req.user.claims.sub;\n    const user = await storage.getUser(userId);\n    \n    if (!user?.isAdmin) {\n      return res.status(403).json({ message: \"Admin access required\" });\n    }\n    try {\n      const { promptKey } = req.params;\n      const { name, description, systemPrompt, userPromptTemplate, temperature, maxTokens, isActive } = req.body;\n      \n      const updatedPrompt = await storage.updateAiPrompt(\n        promptKey,\n        { name, description, systemPrompt, userPromptTemplate, temperature, maxTokens, isActive },\n        userId\n      );\n      \n      // Log admin activity\n      await AdminService.logActivity(\n        userId,\n        'update_prompt',\n        'prompt',\n        promptKey,\n        `Updated AI prompt: ${name}`\n      );\n      \n      res.json(updatedPrompt);\n    } catch (error) {\n      console.error(\"Error updating prompt:\", error);\n      res.status(500).json({ message: \"Failed to update prompt\" });\n    }\n  });\n\n  // Analytics endpoint\n  app.get('/api/admin/analytics', requireSecondaryAdminOrHigher, async (req: any, res) => {\n    try {\n      const analytics = await storage.getSystemAnalytics();\n      const userStats = await storage.getUserStats();\n      \n      res.json({\n        ...analytics,\n        ...userStats\n      });\n    } catch (error) {\n      console.error(\"Error fetching analytics:\", error);\n      res.status(500).json({ message: \"Failed to fetch analytics\" });\n    }\n  });\n\n  // Premium Subscription Payment Routes\n  app.post(\"/api/create-payment-intent\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { amount, description } = req.body;\n      const result = await paymentService.createPaymentIntent(\n        amount || 70, \n        description || \"HealthHire Portal Premium - Lifetime Access\"\n      );\n      res.json(result);\n    } catch (error: any) {\n      console.error(\"Payment intent creation error:\", error);\n      res.status(500).json({ message: \"Error creating payment intent: \" + error.message });\n    }\n  });\n\n  app.post('/api/payment/verify', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { paymentIntentId } = req.body;\n      const result = await paymentService.verifyPayment(paymentIntentId);\n      \n      if (result.success) {\n        // Update user to premium status\n        const userId = req.user.claims.sub;\n        await storage.updateUserPremiumStatus(userId, true);\n      }\n      \n      res.json(result);\n    } catch (error) {\n      console.error(\"Payment verification error:\", error);\n      res.status(500).json({ message: \"Failed to verify payment\" });\n    }\n  });\n\n  app.post('/api/webhooks/stripe', async (req, res) => {\n    try {\n      const signature = req.headers['stripe-signature'] as string;\n      const event = await paymentService.handleWebhook(req.body, signature);\n      \n      // Handle successful payments\n      if (event.type === 'payment_intent.succeeded') {\n        const paymentIntent = event.data.object as any;\n        // Payment processing completed successfully\n        // Additional payment success handling can be added here\n      }\n      \n      res.json({ received: true });\n    } catch (error) {\n      console.error('Webhook error:', error);\n      res.status(400).json({ error: 'Webhook signature verification failed' });\n    }\n  });\n\n  // Document Generation Routes\n  app.post('/api/supporting-information', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { jobDescription, personSpec, tone, targetLength } = req.body;\n      \n      if (!jobDescription) {\n        return res.status(400).json({ message: \"Job description required\" });\n      }\n      \n      const profile = await storage.getProfile(userId);\n      if (!profile) {\n        return res.status(400).json({ message: \"Profile required for document generation\" });\n      }\n      \n      const document = await aiDocumentService.generateSupportingInformation({\n        profile,\n        jobDescription,\n        personSpec,\n        tone,\n        targetLength\n      });\n      \n      res.json(document);\n    } catch (error) {\n      console.error(\"Error generating supporting information:\", error);\n      res.status(500).json({ message: \"Failed to generate supporting information\" });\n    }\n  });\n\n  app.post('/api/ai/generate-cv', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { targetRoles, format } = req.body;\n      \n      const profile = await storage.getProfile(userId);\n      if (!profile) {\n        return res.status(400).json({ message: \"Profile required for CV generation\" });\n      }\n      \n      const document = await aiDocumentService.generateCV({\n        profile,\n        targetRoles,\n        format\n      });\n      \n      res.json(document);\n    } catch (error) {\n      console.error(\"Error generating CV:\", error);\n      res.status(500).json({ message: \"Failed to generate CV\" });\n    }\n  });\n\n  // CV viewer endpoints\n  app.get('/api/cv/generate-from-profile', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      const profile = await storage.getProfile(userId);\n      if (!profile) {\n        return res.status(400).json({ message: \"Profile required for CV generation\" });\n      }\n\n      // Get user data for name\n      const user = await storage.getUser(userId);\n      \n      // Generate CV data from profile\n      const cvData = {\n        personalInfo: {\n          name: `${user?.firstName || ''} ${user?.lastName || ''}`.trim(),\n          email: profile.email || '',\n          phone: profile.phone || '',\n          location: profile.city && profile.country ? `${profile.city}, ${profile.country}` : profile.city || profile.country || '',\n          summary: '' // Will be added when we add summary field to profile\n        },\n        experience: profile.workExperience || [],\n        education: profile.education || [],\n        skills: profile.skills || [],\n        courses: profile.courses || [],\n        registrations: profile.registrationNumber ? [{\n          type: profile.profession || 'Professional Registration',\n          number: profile.registrationNumber,\n          expiry: undefined // Will be added when we add expiry field to profile\n        }] : [],\n        lastUpdated: profile.updatedAt || new Date().toISOString()\n      };\n      \n      res.json(cvData);\n    } catch (error) {\n      console.error(\"Error generating CV from profile:\", error);\n      res.status(500).json({ message: \"Failed to generate CV from profile\" });\n    }\n  });\n\n  app.get('/api/cv/download-pdf', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      const profile = await storage.getProfile(userId);\n      if (!profile) {\n        return res.status(400).json({ message: \"Profile required for CV PDF generation\" });\n      }\n\n      // Get user data for name\n      const user = await storage.getUser(userId);\n      \n      \n      // Generate CV HTML content\n      const cvData = {\n        personalInfo: {\n          name: `${user?.firstName || ''} ${user?.lastName || ''}`.trim(),\n          email: profile.email || '',\n          phone: profile.phone || '',\n          location: profile.city && profile.country ? `${profile.city}, ${profile.country}` : profile.city || profile.country || '',\n          summary: '' // Will be added when we add summary field to profile\n        },\n        experience: profile.workExperience || [],\n        education: profile.education || [],\n        skills: profile.skills || [],\n        courses: profile.courses || [],\n        registrations: profile.registrationNumber ? [{\n          type: profile.profession || 'Professional Registration',\n          number: profile.registrationNumber,\n          expiry: undefined // Will be added when we add expiry field to profile\n        }] : []\n      };\n\n      // Generate HTML content that's optimized for printing to PDF\n      const htmlContent = generateCVHTML(cvData);\n      \n      // Return print-ready HTML file\n      res.setHeader('Content-Type', 'text/html; charset=utf-8');\n      res.setHeader('Content-Disposition', 'attachment; filename=\"my-cv.html\"');\n      res.send(htmlContent);\n      \n    } catch (error) {\n      console.error(\"Error downloading CV PDF:\", error);\n      res.status(500).json({ message: \"Failed to download CV PDF\" });\n    }\n  });\n\n  app.post('/api/ai/map-person-spec', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { personSpec, jobDescription } = req.body;\n      \n      if (!personSpec || !jobDescription) {\n        return res.status(400).json({ message: \"Person specification and job description required\" });\n      }\n      \n      const profile = await storage.getProfile(userId);\n      if (!profile) {\n        return res.status(400).json({ message: \"Profile required for person spec mapping\" });\n      }\n      \n      const mapping = await aiDocumentService.mapPersonSpec({\n        profile,\n        personSpec,\n        jobDescription\n      });\n      \n      res.json(mapping);\n    } catch (error) {\n      console.error(\"Error mapping person spec:\", error);\n      res.status(500).json({ message: \"Failed to map person specification\" });\n    }\n  });\n\n  // Sample job duties database for demo mode\n  const sampleJobDuties: Record<string, string[]> = {\n    \"staff nurse\": [\n      \"Provided comprehensive patient care across medical wards, ensuring optimal health outcomes\",\n      \"Administered medications safely and monitored patient responses to treatments\",\n      \"Collaborated with multidisciplinary teams to develop and implement care plans\",\n      \"Maintained accurate patient records and documentation in compliance with NHS standards\"\n    ],\n    \"healthcare assistant\": [\n      \"Assisted patients with daily living activities while maintaining dignity and respect\",\n      \"Supported qualified nurses with clinical tasks and patient monitoring\",\n      \"Maintained clean and safe ward environments following infection control protocols\",\n      \"Communicated effectively with patients, families, and healthcare team members\"\n    ],\n    \"senior nurse\": [\n      \"Led nursing teams in delivering high-quality patient care across specialist units\",\n      \"Mentored junior staff and coordinated professional development programs\",\n      \"Implemented evidence-based practices to improve patient safety and care quality\",\n      \"Managed ward operations including resource allocation and staff scheduling\"\n    ],\n    \"nurse practitioner\": [\n      \"Conducted comprehensive patient assessments and developed treatment plans\",\n      \"Prescribed medications and treatments within scope of practice guidelines\",\n      \"Provided advanced clinical care for patients with complex health conditions\",\n      \"Collaborated with consultants and GPs to ensure continuity of care\"\n    ],\n    \"physiotherapist\": [\n      \"Assessed and treated patients with mobility and movement disorders\",\n      \"Developed personalized rehabilitation programs to optimize patient recovery\",\n      \"Educated patients and families on exercise techniques and injury prevention\",\n      \"Collaborated with occupational therapists and medical teams on treatment plans\"\n    ],\n    \"occupational therapist\": [\n      \"Evaluated patients' functional abilities and designed intervention strategies\",\n      \"Provided adaptive equipment training to enhance independence in daily activities\",\n      \"Conducted home and workplace assessments for safe discharge planning\",\n      \"Worked with patients to develop coping strategies for long-term conditions\"\n    ],\n    \"radiographer\": [\n      \"Performed diagnostic imaging procedures ensuring optimal image quality and patient safety\",\n      \"Operated complex radiological equipment including X-ray, CT, and MRI machines\",\n      \"Explained procedures to patients and provided reassurance during examinations\",\n      \"Maintained equipment calibration and followed strict radiation safety protocols\"\n    ],\n    \"pharmacist\": [\n      \"Reviewed medication charts and provided clinical pharmacy services to wards\",\n      \"Counseled patients on proper medication use and potential side effects\",\n      \"Collaborated with medical teams to optimize drug therapy outcomes\",\n      \"Conducted medication reconciliation and discharge planning activities\"\n    ]\n  };\n\n  // Function to get sample duties for a job title\n  function getSampleDuties(jobTitle: string): string[] {\n    const normalizedTitle = jobTitle.toLowerCase().trim();\n    \n    // Direct match\n    if (sampleJobDuties[normalizedTitle]) {\n      return sampleJobDuties[normalizedTitle];\n    }\n    \n    // Partial matches for common roles\n    for (const [key, duties] of Object.entries(sampleJobDuties)) {\n      if (normalizedTitle.includes(key) || key.includes(normalizedTitle)) {\n        return duties;\n      }\n    }\n    \n    // Generic healthcare professional duties as fallback\n    return [\n      \"Delivered high-quality patient care in accordance with professional standards\",\n      \"Collaborated effectively with multidisciplinary healthcare teams\",\n      \"Maintained accurate documentation and followed clinical governance procedures\",\n      \"Participated in continuous professional development and quality improvement initiatives\"\n    ];\n  }\n\n  // Henry the Helper - Generate Supporting Information\n  app.post('/api/henry/generate-supporting-info', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { jobDescription, personSpecification } = req.body;\n      \n      if (!jobDescription || typeof jobDescription !== 'string' || jobDescription.trim().length === 0) {\n        return res.status(400).json({ message: \"Job description is required\" });\n      }\n\n      if (jobDescription.length > 10000) {\n        return res.status(400).json({ message: \"Job description too long\" });\n      }\n\n      // Get user's CV information for personalization\n      const userId = req.user?.claims?.sub;\n      const user = await storage.getUser(userId);\n      let cvInfo = '';\n      \n      try {\n        // Get user profile information directly from database\n        const profile = await storage.getProfile(userId);\n        // Extract real name from user object (primary source)\n        const firstName = user?.firstName || 'Professional';\n        const lastName = user?.lastName || '';\n        const fullName = `${firstName} ${lastName}`.trim();\n        \n        // Handle JSONB work experience data\n        let workExperience = [];\n        if (profile?.workExperience) {\n          if (Array.isArray(profile.workExperience)) {\n            workExperience = profile.workExperience;\n          } else if (typeof profile.workExperience === 'object') {\n            workExperience = Object.values(profile.workExperience);\n          }\n        }\n        \n        const experienceDetails = workExperience.map(exp => {\n          const position = exp.position || exp.jobTitle || exp.title || 'Healthcare Role';\n          const employer = exp.employer || exp.company || exp.organization || 'Healthcare Organization';\n          const startDate = exp.startDate || exp.from || 'Previous';\n          const endDate = exp.endDate || exp.to || exp.current ? 'Present' : 'Previous';\n          const description = exp.description || exp.duties || 'Patient care and clinical responsibilities';\n          return `‚Ä¢ ${position} at ${employer} (${startDate} - ${endDate}): ${description}`;\n        }).join('\\n');\n        \n        // Handle JSONB education data\n        let education = [];\n        if (profile?.education) {\n          if (Array.isArray(profile.education)) {\n            education = profile.education;\n          } else if (typeof profile.education === 'object') {\n            education = Object.values(profile.education);\n          }\n        }\n        \n        const educationDetails = education.map(edu => {\n          const qualification = edu.degree || edu.qualification || edu.course || 'Healthcare Qualification';\n          const institution = edu.institution || edu.university || edu.school || 'Accredited Institution';\n          const year = edu.year || edu.graduationYear || 'Completed';\n          return `‚Ä¢ ${qualification} from ${institution} (${year})`;\n        }).join('\\n');\n        \n        // Get actual skills from profile (should be array)\n        const skills = Array.isArray(profile?.skills) ? profile.skills : [];\n        const skillsList = skills.length > 0 ? skills.join(', ') : 'Clinical skills, patient care, teamwork, communication';\n        \n        // Handle JSONB courses data\n        let courses = [];\n        if (profile?.courses) {\n          if (Array.isArray(profile.courses)) {\n            courses = profile.courses;\n          } else if (typeof profile.courses === 'object') {\n            courses = Object.values(profile.courses);\n          }\n        }\n        \n        const coursesDetails = courses.map(course => {\n          const name = course.name || course.title || course.course || 'Professional Development Course';\n          const provider = course.provider || course.institution || 'Accredited Provider';\n          const year = course.year || course.completionYear || 'Completed';\n          return `‚Ä¢ ${name} (${provider}, ${year})`;\n        }).join('\\n');\n        \n        cvInfo = `CANDIDATE PROFILE:\nFull Name: ${fullName}\nProfession: ${profile?.profession || 'Healthcare Professional'}\nRegistration Number: ${profile?.registrationNumber || 'Not specified'}\nCurrent Location: ${profile?.city || ''} ${profile?.country || ''}\n\nWORK EXPERIENCE:\n${experienceDetails || '‚Ä¢ Healthcare professional with relevant NHS/clinical experience'}\n\nEDUCATION & QUALIFICATIONS:\n${educationDetails || '‚Ä¢ Healthcare qualification from accredited institution'}\n\nCOURSES & CERTIFICATES:\n${coursesDetails || '‚Ä¢ Professional development courses completed'}\n\nCORE SKILLS:\n${skillsList}\n\nSPECIALTIES: ${profile?.specialties?.join(', ') || 'General healthcare'}`;\n        \n        \n      } catch (error) {\n        console.log('Error getting profile data:', error);\n        cvInfo = 'Healthcare professional with relevant NHS experience and qualifications';\n      }\n\n      // Use Gemini AI\n      try {\n        const { GoogleGenAI } = await import(\"@google/genai\");\n        const ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY || \"\" });\n\n        const prompt = `You are writing a supporting information for an NHS job application. You MUST use the EXACT candidate information provided below - do not make up or generalize anything.\n\n# FOLLOW THIS WRITING STYLE:\n\n‚Ä¢ SHOULD use clear, simple language.\n‚Ä¢ SHOULD be spartan and informative.\n‚Ä¢ SHOULD use short, impactful sentences.\n‚Ä¢ SHOULD use active voice; avoid passive voice.\n‚Ä¢ SHOULD focus on practical, actionable insights.\n‚Ä¢ AVOID using em dashes (‚Äî) anywhere in your response. Use only commas, periods, or other standard punctuation. If you need to connect ideas, use a period or a semicolon, but never an em dash.\n‚Ä¢ AVOID constructions like \"...not just this, but also this\".\n‚Ä¢ AVOID metaphors and clich√©s.\n‚Ä¢ AVOID generalizations.\n‚Ä¢ AVOID common setup language in any sentence, including: in conclusion, in closing, etc.\n‚Ä¢ AVOID unnecessary adjectives and adverbs.\n‚Ä¢ AVOID semicolons.\n‚Ä¢ AVOID markdown.\n‚Ä¢ AVOID asterisks.\n. Avoid Quotation marks\n‚Ä¢ AVOID these words:\n\"can, may, just, that, very, really, literally, actually, certainly, probably, basically, could, maybe, delve, embark, enlightening, esteemed, shed light, craft, crafting, imagine, realm, game-changer, unlock, discover, skyrocket, abyss, not alone, in a world where, revolutionize, disruptive, utilize, utilizing, dive deep, tapestry, illuminate, unveil, pivotal, intricate, elucidate, hence, furthermore, realm, however, harness, exciting, groundbreaking, cutting-edge, remarkable, it, remains to be seen, glimpse into, navigating, landscape, stark, testament, in summary, in conclusion, moreover, boost, skyrocketing, opened up, powerful, inquiries, ever-evolving\"\n\nMANDATORY RULES:\n1. Start with: \"I am [insert their EXACT full name from profile], a [insert their exact profession]...\"\n2. Reference every work experience if 3 or less, or reference any relevant ones if more than 3 work experiences, using EXACT job titles and organizations\n3. Quote EXACT qualifications and institutions from their education\n4. List EVERY skill they have and explain how each relates to the job\n5. Mention ANY courses/certificates they have completed\n6. Use first person \"I\" statements throughout\n7. Write 800+ words connecting their real background to job requirements\n8. Do NOT use headings or bold text anywhere\n9. Keep it focused on how the candidate details match the job specification\n10. Use human and extremely simple tone with varying sentence lengths and structure\n11. Keep text all same format - no italics or any formatting, all text should be plain format even parts that you add in\n12. All points in the person specification MUST be addressed - ensure every requirement is covered\n13. Only give the output as supporting information - no other text, introductions, or requests for further instructions. Output should be ready to use in the application.\n\n${cvInfo}\n\nJob Description:\n${jobDescription.trim()}\n\n${personSpecification ? `Person Specification:\n${personSpecification.trim()}` : ''}\n\nCRITICAL: Copy the EXACT names, job titles, organizations, qualifications, and institutions from the candidate profile above. Do not paraphrase or generalize - use their precise details.`;\n\n        const response = await ai.models.generateContent({\n          model: \"gemini-2.5-flash-lite\",\n          contents: prompt,\n        });\n\n        const content = response.text;\n        if (!content) {\n          throw new Error('No response from Henry');\n        }\n\n        res.json({ \n          supportingInfo: content,\n          message: \"Henry generated this supporting information for you!\",\n          isDemo: false\n        });\n      } catch (apiError: any) {\n        // If Gemini fails, fall back to demo mode\n        console.log(\"Gemini API unavailable, falling back to demo mode:\", apiError.message);\n        \n        const demoSupportingInfo = `Dear Hiring Manager,\n\nI am writing to express my strong interest in this healthcare position within the NHS. As a dedicated healthcare professional, I am committed to delivering exceptional patient care and contributing positively to your team.\n\nThroughout my career, I have developed strong clinical skills and a deep understanding of NHS values. I believe in treating every patient with dignity, respect, and compassion, ensuring they receive the highest standard of care possible.\n\nMy experience has taught me the importance of working collaboratively with multidisciplinary teams. I understand that effective healthcare delivery requires excellent communication, both with patients and colleagues from different professional backgrounds.\n\nI am particularly drawn to this role because it aligns with my passion for making a real difference in people's lives. The NHS represents everything I value about healthcare - providing comprehensive, equitable care to all members of our community regardless of their background or circumstances.\n\nIn my previous roles, I have consistently demonstrated reliability, attention to detail, and the ability to work under pressure. I understand the demanding nature of healthcare work and am committed to maintaining high professional standards even in challenging situations.\n\nI am eager to bring my skills, enthusiasm, and dedication to your team. I believe my experience and values make me well-suited for this position, and I am excited about the opportunity to contribute to the excellent care your organization provides.\n\nI would welcome the opportunity to discuss how my background and passion for healthcare can benefit your team and the patients we serve.\n\nThank you for considering my application.\n\nYours sincerely,\nHealthcare Professional`;\n\n        res.json({ \n          supportingInfo: demoSupportingInfo,\n          message: \"Henry generated this supporting information for you! (Demo Mode)\",\n          isDemo: true\n        });\n      }\n    } catch (error) {\n      console.error(\"Error generating supporting information:\", error);\n      res.status(500).json({ message: \"Failed to generate supporting information\" });\n    }\n  });\n\n  // Henry the Helper - Generate Cover Letter\n  app.post('/api/henry/generate-cover-letter', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const { jobDescription, companyName, roleName } = req.body;\n      \n      if (!jobDescription || typeof jobDescription !== 'string' || jobDescription.trim().length === 0) {\n        return res.status(400).json({ message: \"Job description is required\" });\n      }\n\n      if (jobDescription.length > 10000) {\n        return res.status(400).json({ message: \"Job description too long\" });\n      }\n\n      // Get user's detailed profile information (same as supporting information)\n      const userId = req.user?.claims?.sub;\n      const user = await storage.getUser(userId);\n      let cvInfo = '';\n      \n      try {\n        // Get user profile information directly from database\n        const profile = await storage.getProfile(userId);\n        \n        // Extract real name from user object (primary source)\n        const firstName = user?.firstName || 'Professional';\n        const lastName = user?.lastName || '';\n        const fullName = `${firstName} ${lastName}`.trim();\n        \n        // Handle JSONB work experience data\n        let workExperience = [];\n        if (profile?.workExperience) {\n          if (Array.isArray(profile.workExperience)) {\n            workExperience = profile.workExperience;\n          } else if (typeof profile.workExperience === 'object') {\n            workExperience = Object.values(profile.workExperience);\n          }\n        }\n        \n        const experienceDetails = workExperience.map(exp => {\n          const position = exp.position || exp.jobTitle || exp.title || 'Healthcare Role';\n          const employer = exp.employer || exp.company || exp.organization || 'Healthcare Organization';\n          return `${position} at ${employer}`;\n        }).join(', ');\n        \n        // Handle JSONB education data\n        let education = [];\n        if (profile?.education) {\n          if (Array.isArray(profile.education)) {\n            education = profile.education;\n          } else if (typeof profile.education === 'object') {\n            education = Object.values(profile.education);\n          }\n        }\n        \n        const educationDetails = education.map(edu => {\n          const qualification = edu.degree || edu.qualification || edu.course || 'Healthcare Qualification';\n          const institution = edu.institution || edu.university || edu.school || 'Accredited Institution';\n          return `${qualification} from ${institution}`;\n        }).join(', ');\n        \n        // Get actual skills from profile\n        const skills = Array.isArray(profile?.skills) ? profile.skills : [];\n        const skillsList = skills.length > 0 ? skills.join(', ') : 'Clinical skills, patient care, teamwork, communication';\n        \n        cvInfo = `CANDIDATE PROFILE:\nFull Name: ${fullName}\nProfession: ${profile?.profession || 'Healthcare Professional'}\nRegistration Number: ${profile?.registrationNumber || 'Not specified'}\nCurrent Location: ${profile?.city || ''} ${profile?.country || ''}\n\nWORK EXPERIENCE:\n${experienceDetails || 'Healthcare professional with relevant NHS/clinical experience'}\n\nEDUCATION & QUALIFICATIONS:\n${educationDetails || 'Healthcare qualification from accredited institution'}\n\nCORE SKILLS:\n${skillsList}\n\nSPECIALTIES: ${profile?.specialties?.join(', ') || 'General healthcare'}`;\n\n        // Profile data prepared for cover letter generation\n        \n      } catch (error) {\n        console.log('Error getting profile data:', error);\n        cvInfo = 'Healthcare professional with relevant experience and qualifications';\n      }\n\n      // Use Gemini AI\n      try {\n        const { GoogleGenAI } = await import(\"@google/genai\");\n        const ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY || \"\" });\n\n        const prompt = `You are writing a professional cover letter for a private sector healthcare role. You MUST use the EXACT candidate information provided below but keep references brief and natural for a cover letter format.\n\nMANDATORY RULES:\n1. Use the candidate's EXACT name and profession from their profile\n2. Briefly reference their specific work experience with EXACT job titles and organizations\n3. Mention their EXACT qualifications and institutions\n4. Keep it maximum 400 words - concise but compelling\n5. Use simple, professional language that sounds natural and human\n6. Show enthusiasm for the private sector opportunity\n7. Only give the cover letter output - no additional text or instructions\n\n# FOLLOW THIS WRITING STYLE:\n‚Ä¢ SHOULD use clear, simple language.\n‚Ä¢ SHOULD be spartan and informative.\n‚Ä¢ SHOULD use short, impactful sentences.\n‚Ä¢ SHOULD use active voice; avoid passive voice.\n‚Ä¢ SHOULD focus on practical, actionable insights.\n‚Ä¢ SHOULD use data and examples to support claims when possible.\n‚Ä¢ AVOID using em dashes (‚Äî) anywhere in your response. Use only commas, periods, or other standard punctuation. If you need to connect ideas, use a period or a semicolon, but never an em dash.\n‚Ä¢ AVOID constructions like \"...not just this, but also this\".\n‚Ä¢ AVOID metaphors and clich√©s.\n‚Ä¢ AVOID generalizations.\n‚Ä¢ AVOID quotation marks, bullet points, bold or italic text\n‚Ä¢ AVOID common setup language in any sentence, including: in conclusion, in closing, etc.\n‚Ä¢ AVOID output warnings or notes, just the output requested.\n‚Ä¢ AVOID unnecessary adjectives and adverbs.\n‚Ä¢ AVOID hashtags.\n‚Ä¢ AVOID semicolons.\n‚Ä¢ AVOID markdown.\n‚Ä¢ AVOID asterisks.\n‚Ä¢ AVOID these words: \"can, may, just, that, very, really, literally, actually, certainly, probably, basically, could, maybe, delve, embark, enlightening, esteemed, shed light, craft, crafting, imagine, realm, game-changer, unlock, discover, skyrocket, abyss, not alone, in a world where, revolutionize, disruptive, utilize, utilizing, dive deep, tapestry, illuminate, unveil, pivotal, intricate, elucidate, hence, furthermore, realm, however, harness, exciting, groundbreaking, cutting-edge, remarkable, it, remains to be seen, glimpse into, navigating, landscape, stark, testament, in summary, in conclusion, moreover, boost, skyrocketing, opened up, powerful, inquiries, ever-evolving\"\n\n${cvInfo}\n\n${companyName ? `Company: ${companyName}` : ''}\n${roleName ? `Role: ${roleName}` : ''}\n\nJob Description:\n${jobDescription.trim()}\n\nWrite a compelling cover letter that briefly draws upon their actual experience, education, and skills to connect with this private sector role. Use their real details but keep it concise and professional.`;\n\n        const response = await ai.models.generateContent({\n          model: \"gemini-2.5-flash-lite\",\n          contents: prompt,\n        });\n\n        const content = response.text;\n        if (!content) {\n          throw new Error('No response from Henry');\n        }\n\n        res.json({ \n          coverLetter: content,\n          message: \"Henry generated this cover letter for you!\",\n          isDemo: false\n        });\n      } catch (apiError: any) {\n        // If Gemini fails, fall back to demo mode\n        console.log(\"Gemini API unavailable, falling back to demo mode:\", apiError.message);\n        \n        const demoCoverLetter = `Dear Hiring Manager,\n\nI am writing to express my interest in this healthcare position with your organization. As a dedicated healthcare professional, I am excited about the opportunity to bring my clinical skills and experience to the private sector.\n\nThroughout my healthcare career, I have developed strong clinical competencies and a deep commitment to patient-centered care. My experience in NHS settings has provided me with excellent communication skills, the ability to work under pressure, and a thorough understanding of healthcare best practices.\n\nI am particularly drawn to private sector healthcare because of the opportunity to deliver personalized, high-quality care in a more focused environment. I believe my experience in clinical settings, combined with my dedication to continuous professional development, makes me well-suited for this role.\n\nYour organization's reputation for excellence in healthcare delivery aligns perfectly with my professional values. I am eager to contribute to your team's success while continuing to develop my skills in a dynamic private healthcare environment.\n\nI would welcome the opportunity to discuss how my background and enthusiasm can contribute to your organization's mission of providing exceptional patient care.\n\nThank you for considering my application. I look forward to hearing from you.\n\nYours sincerely,\nHealthcare Professional`;\n\n        res.json({ \n          coverLetter: demoCoverLetter,\n          message: \"Henry generated this cover letter for you! (Demo Mode)\",\n          isDemo: true\n        });\n      }\n    } catch (error) {\n      console.error(\"Error generating cover letter:\", error);\n      res.status(500).json({ message: \"Failed to generate cover letter\" });\n    }\n  });\n\n  // Henry the Helper - Generate Job Duties\n  app.post('/api/henry/generate-duties', isAuthenticated, validateCSRFToken, checkUsageRestrictions('henry_feedback'), async (req: any, res) => {\n    try {\n      const { jobTitle } = req.body;\n      \n      if (!jobTitle || typeof jobTitle !== 'string' || jobTitle.trim().length === 0) {\n        return res.status(400).json({ message: \"Job title is required\" });\n      }\n\n      if (jobTitle.length > 100) {\n        return res.status(400).json({ message: \"Job title too long\" });\n      }\n\n      // Use Gemini AI\n      try {\n        const { GoogleGenAI } = await import(\"@google/genai\");\n        const ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY || \"\" });\n\n        const prompt = `CRITICAL: This is for a CV (resume). Write ONLY in past tense. NEVER use \"You will\" or \"You'll\" or any future tense.\n\nYou are Henry the Helper writing CV accomplishment statements for someone's previous work experience as a ${jobTitle.trim()}.\n\nMANDATORY RULES:\n1. Use PAST TENSE ONLY - \"Delivered\", \"Maintained\", \"Assisted\", \"Provided\", \"Monitored\"\n2. NEVER use \"You will\", \"You'll\", \"Will\", or any future tense\n3. These describe what they DID in a previous job, not what they will do\n4. Start each statement with a past tense action verb\n5. Keep sentences clear and concise\n6. MAXIMUM 25 WORDS per statement - be concise and impactful\n\nCORRECT EXAMPLES (past tense):\nDelivered safe, patient-centred care including monitoring vital signs, assisting with daily activities, and supporting clinical procedures.\nMaintained accurate patient records and documentation in line with NHS and regulatory standards.\nWorked collaboratively within a multidisciplinary team to support treatment plans and ensure continuity of care.\nPromoted health, safety, and infection control practices to protect patients, staff, and visitors.\n\nWRONG EXAMPLES (never do this):\nYou will deliver safe care...\nYou'll maintain records...\nWill provide patient support...\n\nCreate exactly 4 past tense accomplishment statements for the healthcare role \"${jobTitle.trim()}\". Start each with a strong past tense verb. Return only the 4 statements, one per line, no other text.`;\n\n        const response = await ai.models.generateContent({\n          model: \"gemini-2.5-flash-lite\",\n          contents: prompt,\n        });\n\n        const content = response.text;\n        if (!content) {\n          throw new Error('No response from Henry');\n        }\n\n        // Parse the response into individual duties\n        const duties = content\n          .split('\\n')\n          .map((duty: string) => duty.trim())\n          .filter((duty: string) => duty.length > 0)\n          .slice(0, 4); // Ensure only 4 duties\n\n        if (duties.length === 0) {\n          throw new Error('Could not parse duties from response');\n        }\n\n        res.json({ \n          duties,\n          jobTitle: jobTitle.trim(),\n          message: \"Henry generated these job duties for you!\",\n          isDemo: false\n        });\n      } catch (apiError: any) {\n        // If Gemini fails, fall back to demo mode\n        console.log(\"Gemini API unavailable, falling back to demo mode:\", apiError.message);\n        \n        const sampleDuties = getSampleDuties(jobTitle);\n        \n        res.json({\n          duties: sampleDuties,\n          jobTitle: jobTitle.trim(),\n          message: \"Henry is showing sample duties (AI temporarily unavailable)\",\n          isDemo: true\n        });\n      }\n    } catch (error: any) {\n      console.error(\"Henry encountered an error:\", error);\n      res.status(500).json({ \n        message: \"Henry is taking a break. Please try again in a moment!\" \n      });\n    }\n  });\n\n  // Henry the Helper - Interview Practice\n  app.post('/api/henry/interview-practice', isAuthenticated, validateCSRFToken, checkUsageRestrictions('henry_feedback'), async (req: any, res) => {\n    try {\n      const { jobTitle, question, userAnswer, timeSpent } = req.body;\n      \n      if (!jobTitle || typeof jobTitle !== 'string' || jobTitle.trim().length === 0) {\n        return res.status(400).json({ message: \"Job title is required\" });\n      }\n\n      if (!question || typeof question !== 'string' || question.trim().length === 0) {\n        return res.status(400).json({ message: \"Interview question is required\" });\n      }\n\n      if (!userAnswer || typeof userAnswer !== 'string' || userAnswer.trim().length === 0) {\n        return res.status(400).json({ message: \"Your answer is required\" });\n      }\n\n      if (userAnswer.length > 2000) {\n        return res.status(400).json({ message: \"Answer too long (max 2000 characters)\" });\n      }\n\n      // Use Gemini for harsh but constructive feedback\n      try {\n        const { GoogleGenAI } = await import(\"@google/genai\");\n        const ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY || \"\" });\n\n        const prompt = `You are Henry the Helper, a supportive but honest interview coach for healthcare professionals. Give constructive feedback to help people improve their NHS interview skills.\n\nCRITICAL: Do NOT use \"SCORE:\", \"WHAT WENT WRONG:\", \"HOW TO IMPROVE:\", or \"ENCOURAGEMENT:\" headings. Do NOT use bullet points or numbered lists.\n\n# FOLLOW THIS WRITING STYLE:\n‚Ä¢ SHOULD use clear, simple language.\n‚Ä¢ SHOULD use short, impactful sentences.\n‚Ä¢ AVOID quotation marks, bullet points, bold or italic text\n‚Ä¢ AVOID output warnings or notes, just the output requested.\n‚Ä¢ Maximum 200 words total for all feedback\n\nJob Role: ${jobTitle.trim()}\nInterview Question: \"${question.trim()}\"\nCandidate's Answer: \"${userAnswer.trim()}\"\n\nWrite feedback using this exact structure with NO headings or formatting:\n\nHow you performed overall: [Score out of 10 and brief assessment]\n\nWhat could be improved: [Main areas needing work]\n\nWhat you did well: [Positive aspects of the answer]\n\nKeep feedback encouraging but honest. Use simple language. Do not use any headings, bullet points, or bold text.`;\n\n        const response = await ai.models.generateContent({\n          model: \"gemini-2.5-flash-lite\",\n          contents: prompt,\n        });\n\n        const feedback = response.text;\n        if (!feedback) {\n          throw new Error('No feedback from Henry');\n        }\n\n        // Save interview attempt to database\n        try {\n          await storage.saveInterviewAttempt({\n            userId: req.user.claims.sub,\n            question: question.trim(),\n            answer: userAnswer.trim(),\n            feedback: feedback.trim(),\n            timeSpent: timeSpent || null\n          });\n        } catch (saveError) {\n          console.error(\"Failed to save interview attempt:\", saveError);\n          // Don't fail the request if saving fails\n        }\n\n        res.json({ \n          feedback: feedback.trim(),\n          jobTitle: jobTitle.trim(),\n          question: question.trim(),\n          userAnswer: userAnswer.trim(),\n          message: \"Henry reviewed your interview answer!\",\n          isDemo: false\n        });\n\n      } catch (apiError: any) {\n        // If Gemini fails, fall back to demo mode\n        console.log(\"Gemini API unavailable, falling back to demo feedback:\", apiError.message);\n        \n        const demoFeedback = `How you performed overall: You scored 6 out of 10. Your answer shows basic understanding but needs more specific examples and clearer structure.\n\nWhat could be improved: Add specific examples from your healthcare experience. Use the STAR method to structure your answer. Connect your response to NHS values like patient safety and teamwork.\n\nWhat you did well: You demonstrated good understanding of the role requirements. Your answer was relevant to the question asked. You showed genuine interest in providing quality patient care.`;\n\n        // Save interview attempt to database (even in demo mode)\n        try {\n          await storage.saveInterviewAttempt({\n            userId: req.user.claims.sub,\n            question: question.trim(),\n            answer: userAnswer.trim(),\n            feedback: demoFeedback,\n            timeSpent: timeSpent || null\n          });\n        } catch (saveError) {\n          console.error(\"Failed to save interview attempt:\", saveError);\n          // Don't fail the request if saving fails\n        }\n\n        res.json({\n          feedback: demoFeedback,\n          jobTitle: jobTitle.trim(),\n          question: question.trim(),\n          userAnswer: userAnswer.trim(),\n          message: \"Henry is showing sample feedback (AI temporarily unavailable)\",\n          isDemo: true\n        });\n      }\n\n    } catch (error: any) {\n      console.error(\"Henry interview practice error:\", error);\n      res.status(500).json({ \n        message: \"Henry is taking a break. Please try again in a moment!\" \n      });\n    }\n  });\n\n  // Get Interview Practice History (last 3 attempts)\n  app.get('/api/henry/interview-history', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const attempts = await storage.getLastInterviewAttempts(userId, 3);\n      \n      res.json({\n        attempts,\n        message: \"Interview history retrieved successfully\"\n      });\n    } catch (error: any) {\n      console.error(\"Error fetching interview history:\", error);\n      res.status(500).json({ \n        message: \"Failed to fetch interview history\" \n      });\n    }\n  });\n\n  // Generate Interview Questions\n  app.post('/api/henry/generate-questions', isAuthenticated, validateCSRFToken, checkUsageRestrictions('henry_feedback'), async (req: any, res) => {\n    try {\n      const { jobTitle, experienceLevel } = req.body;\n      \n      if (!jobTitle || typeof jobTitle !== 'string' || jobTitle.trim().length === 0) {\n        return res.status(400).json({ message: \"Job title is required\" });\n      }\n\n      const level = experienceLevel || 'mid';\n\n      // Use Gemini to generate realistic interview questions\n      try {\n        const { GoogleGenAI } = await import(\"@google/genai\");\n        const ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY || \"\" });\n\n        const prompt = `You are Henry the Helper generating realistic NHS interview questions for healthcare professionals.\n\nGenerate 3 challenging but realistic interview questions for a ${jobTitle.trim()} position at ${level} experience level.\n\nGUIDELINES:\n- Make questions NHS-specific and healthcare-focused\n- Include competency-based questions (values, teamwork, patient safety)\n- Mix different question types (scenario, experience, values)\n- Keep questions clear and professional\n- Focus on real situations healthcare professionals face\n- Maximum 50 words per question\n\nExperience Level: ${level}\nJob Title: ${jobTitle.trim()}\n\nReturn exactly 3 questions, one per line, no numbering or extra text:`;\n\n        const response = await ai.models.generateContent({\n          model: \"gemini-2.5-flash-lite\",\n          contents: prompt,\n        });\n\n        const content = response.text;\n        if (!content) {\n          throw new Error('No questions from Henry');\n        }\n\n        // Parse the response into individual questions\n        const questions = content\n          .split('\\n')\n          .map((q: string) => q.trim())\n          .filter((q: string) => q.length > 0)\n          .slice(0, 3); // Ensure only 3 questions\n\n        if (questions.length === 0) {\n          throw new Error('Could not parse questions from response');\n        }\n\n        res.json({ \n          questions,\n          jobTitle: jobTitle.trim(),\n          experienceLevel: level,\n          message: \"Henry generated interview questions for you!\",\n          isDemo: false\n        });\n\n      } catch (apiError: any) {\n        // If Gemini fails, fall back to demo questions\n        console.log(\"Gemini API unavailable, falling back to demo questions:\", apiError.message);\n        \n        const demoQuestions = [\n          \"Tell me about a time when you had to deal with a difficult patient and how you handled the situation.\",\n          \"How would you ensure patient safety while working under pressure in a busy healthcare environment?\",\n          \"Describe a situation where you had to work as part of a multidisciplinary team to achieve a patient outcome.\"\n        ];\n\n        res.json({\n          questions: demoQuestions,\n          jobTitle: jobTitle.trim(),\n          experienceLevel: level,\n          message: \"Henry is showing sample questions (AI temporarily unavailable)\",\n          isDemo: true\n        });\n      }\n\n    } catch (error: any) {\n      console.error(\"Henry question generation error:\", error);\n      res.status(500).json({ \n        message: \"Henry is taking a break. Please try again in a moment!\" \n      });\n    }\n  });\n\n  // File Upload Routes for Documents and Certificates\n  app.post('/api/upload/document', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { documentType = 'general' } = req.body;\n      \n      const uploadURL = await objectStorageService.getUserDocumentUploadURL(userId, documentType);\n      res.json({ uploadURL });\n    } catch (error) {\n      console.error(\"Error getting upload URL:\", error);\n      res.status(500).json({ message: \"Failed to get upload URL\" });\n    }\n  });\n\n  app.post('/api/documents/uploaded', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { fileName, uploadURL, documentType, fileSize } = req.body;\n      \n      if (!fileName || !uploadURL) {\n        return res.status(400).json({ message: \"File name and upload URL required\" });\n      }\n      \n      // Create document record\n      const document = await storage.createDocument({\n        userId,\n        title: fileName,\n        type: documentType || 'certificate',\n        content: objectStorageService.normalizeObjectEntityPath(uploadURL), // Store file path in content field\n      });\n      \n      res.json(document);\n    } catch (error) {\n      console.error(\"Error recording uploaded document:\", error);\n      res.status(500).json({ message: \"Failed to record uploaded document\" });\n    }\n  });\n\n  // Serve uploaded documents\n  app.get('/objects/:objectPath(*)', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const objectFile = await objectStorageService.getObjectEntityFile(req.path);\n      \n      // Basic access control - users can only access their own files\n      const [metadata] = await objectFile.getMetadata();\n      if (metadata.metadata?.userId && metadata.metadata.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      objectStorageService.downloadObject(objectFile, res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (error instanceof ObjectNotFoundError) {\n        return res.status(404).json({ message: \"File not found\" });\n      }\n      return res.status(500).json({ message: \"Failed to download file\" });\n    }\n  });\n\n  // User activity tracking\n  app.get('/api/user/activity', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const activity = await storage.getUserActivity(userId, 20);\n      res.json(activity);\n    } catch (error) {\n      console.error(\"Error fetching user activity:\", error);\n      res.status(500).json({ message: \"Failed to fetch user activity\" });\n    }\n  });\n\n  // Weekly stats for rotating stats bar\n  app.get('/api/user/weekly-stats', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Calculate date ranges for this week and last week\n      const now = new Date();\n      const startOfThisWeek = new Date(now);\n      startOfThisWeek.setDate(now.getDate() - now.getDay()); // Sunday\n      startOfThisWeek.setHours(0, 0, 0, 0);\n      \n      const startOfLastWeek = new Date(startOfThisWeek);\n      startOfLastWeek.setDate(startOfThisWeek.getDate() - 7);\n      \n      const endOfLastWeek = new Date(startOfThisWeek);\n      endOfLastWeek.setTime(endOfLastWeek.getTime() - 1);\n\n      // Get applications this week and last week\n      const applications = await storage.getApplications(userId);\n      const applicationsThisWeek = applications.filter(app => \n        app.createdAt && new Date(app.createdAt) >= startOfThisWeek\n      ).length;\n      const applicationsLastWeek = applications.filter(app => \n        app.createdAt && new Date(app.createdAt) >= startOfLastWeek && new Date(app.createdAt) <= endOfLastWeek\n      ).length;\n\n      // Get job search activity (we'll use job matches as proxy for searches)\n      const jobMatches = await storage.getJobMatches(userId);\n      const jobSearchesThisWeek = jobMatches.filter(match => \n        match.createdAt && new Date(match.createdAt) >= startOfThisWeek\n      ).length;\n      const jobSearchesLastWeek = jobMatches.filter(match => \n        match.createdAt && new Date(match.createdAt) >= startOfLastWeek && new Date(match.createdAt) <= endOfLastWeek\n      ).length;\n\n      // Get interviews scheduled this week and last week\n      const interviewsThisWeek = applications.filter(app => \n        app.interviewDate && new Date(app.interviewDate) >= startOfThisWeek\n      ).length;\n      const interviewsLastWeek = applications.filter(app => \n        app.interviewDate && new Date(app.interviewDate) >= startOfLastWeek && new Date(app.interviewDate) <= endOfLastWeek\n      ).length;\n\n      // Get documents created this week and last week\n      const documents = await storage.getDocuments(userId);\n      const documentsCreatedThisWeek = documents.filter(doc => \n        doc.createdAt && new Date(doc.createdAt) >= startOfThisWeek\n      ).length;\n      const documentsCreatedLastWeek = documents.filter(doc => \n        doc.createdAt && new Date(doc.createdAt) >= startOfLastWeek && new Date(doc.createdAt) <= endOfLastWeek\n      ).length;\n\n      // Get practice sessions this week and last week\n      const practiceSessions = await storage.getInterviewSessions(userId);\n      const practiceSessionsThisWeek = practiceSessions.filter(session => \n        session.createdAt && new Date(session.createdAt) >= startOfThisWeek\n      ).length;\n      const practiceSessionsLastWeek = practiceSessions.filter(session => \n        session.createdAt && new Date(session.createdAt) >= startOfLastWeek && new Date(session.createdAt) <= endOfLastWeek\n      ).length;\n\n      const weeklyStats = {\n        applicationsThisWeek,\n        applicationsLastWeek,\n        jobSearchesThisWeek,\n        jobSearchesLastWeek,\n        interviewsThisWeek,\n        interviewsLastWeek,\n        documentsCreatedThisWeek,\n        documentsCreatedLastWeek,\n        practiceSessionsThisWeek,\n        practiceSessionsLastWeek\n      };\n\n      res.json(weeklyStats);\n    } catch (error) {\n      console.error(\"Error fetching weekly stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch weekly stats\" });\n    }\n  });\n\n  // ===============================================\n  // Q&A GENERATOR DEMO QUESTIONS FUNCTION\n  // ===============================================\n\n  function generateDemoQuestions(jobTitle: string) {\n    const sanitizedJobTitle = jobTitle.toLowerCase();\n    const isNurse = sanitizedJobTitle.includes('nurse') || sanitizedJobTitle.includes('nursing');\n    const isDoctor = sanitizedJobTitle.includes('doctor') || sanitizedJobTitle.includes('physician') || sanitizedJobTitle.includes('consultant');\n    const isTherapist = sanitizedJobTitle.includes('therapist') || sanitizedJobTitle.includes('therapy');\n    const isAdmin = sanitizedJobTitle.includes('admin') || sanitizedJobTitle.includes('manager') || sanitizedJobTitle.includes('coordinator');\n\n    const baseQuestions = [\n      {\n        question: \"Tell me about yourself and why you're interested in working for the NHS.\",\n        model_answer: \"I am a dedicated healthcare professional with [X years] of experience in [specialty]. I'm passionate about the NHS's core values, particularly caring and compassion, and I believe in providing excellent patient care that's free at the point of delivery. I'm excited about this opportunity because it allows me to contribute to a service that truly makes a difference in people's lives while working alongside committed professionals who share these values.\",\n        category: \"General\"\n      },\n      {\n        question: \"How do you demonstrate the NHS value of compassion in your daily work?\",\n        model_answer: \"Compassion means understanding patients' needs and responding with kindness and empathy. In practice, I demonstrate this by actively listening to patients' concerns, explaining procedures clearly, and providing emotional support during difficult times. For example, I always ensure patients feel comfortable asking questions and take time to address their fears or worries, recognizing that healthcare can be a vulnerable experience for many people.\",\n        category: \"NHS Values\"\n      },\n      {\n        question: \"Describe a challenging situation you faced with a patient and how you handled it.\",\n        model_answer: \"I once cared for an elderly patient who was very anxious about a procedure. Using the STAR framework: Situation - Patient was extremely fearful and refusing treatment. Task - I needed to gain their trust and ensure they received necessary care. Action - I sat with them, listened to their concerns, explained the procedure in simple terms, and involved their family in discussions. I also coordinated with the medical team to adjust our approach. Result - The patient agreed to treatment, which was successful, and they thanked me for taking the time to understand their fears.\",\n        category: \"Clinical Care\"\n      },\n      {\n        question: \"How do you prioritize your workload when faced with multiple urgent tasks?\",\n        model_answer: \"I use a systematic approach to prioritization, considering patient safety first, followed by clinical urgency and time-sensitivity. I assess each situation quickly, delegate appropriate tasks to qualified team members, and communicate clearly about priorities. For example, I would address life-threatening situations immediately, followed by time-critical medications, then routine care. I also keep colleagues informed about my priorities and ask for support when needed to ensure no patient needs are overlooked.\",\n        category: \"Professional Skills\"\n      },\n      {\n        question: \"What does dignity mean to you in healthcare, and how do you ensure patients are treated with dignity?\",\n        model_answer: \"Dignity in healthcare means respecting patients as individuals, protecting their privacy, and maintaining their self-respect throughout their care journey. I ensure dignity by always knocking before entering rooms, explaining what I'm doing before touching patients, covering them appropriately during examinations, and speaking to them respectfully regardless of their condition or background. I also advocate for patients' rights and preferences, ensuring they're involved in decisions about their care.\",\n        category: \"NHS Values\"\n      }\n    ];\n\n    let roleSpecificQuestions = [];\n\n    if (isNurse) {\n      roleSpecificQuestions = [\n        {\n          question: \"How would you manage a situation where you disagreed with a doctor's treatment plan?\",\n          model_answer: \"As a nurse, I have a professional duty to advocate for patient safety. I would first discuss my concerns directly with the doctor in a respectful, professional manner, presenting evidence-based reasoning. If concerns persist, I would follow the escalation procedures outlined in trust policies, potentially involving senior nursing staff or the consultant. Throughout this process, I would document my concerns and ensure patient safety remains the priority while maintaining professional relationships.\",\n          category: \"Professional Practice\"\n        },\n        {\n          question: \"Describe your approach to patient education and health promotion.\",\n          model_answer: \"Patient education is crucial for better outcomes and self-management. I assess each patient's learning needs, preferred learning style, and health literacy level. I use clear, jargon-free language, visual aids when helpful, and check understanding by asking patients to explain back key points. I provide written materials for reference and connect patients with additional resources. I also tailor education to be culturally sensitive and involve family members when appropriate and with patient consent.\",\n          category: \"Patient Care\"\n        }\n      ];\n    } else if (isDoctor) {\n      roleSpecificQuestions = [\n        {\n          question: \"How do you approach clinical decision-making when evidence is unclear or conflicting?\",\n          model_answer: \"When facing clinical uncertainty, I gather all available information including patient history, examination findings, and relevant investigations. I consult current evidence-based guidelines and, when appropriate, seek senior colleague input. I discuss uncertainties honestly with patients, explaining different options and their risks/benefits. I also consider patient preferences and values in decision-making. I document my reasoning clearly and monitor outcomes closely, being prepared to modify my approach if new information emerges.\",\n          category: \"Clinical Excellence\"\n        },\n        {\n          question: \"Describe a time when you had to deliver difficult news to a patient or family.\",\n          model_answer: \"I had to inform a family that their relative's condition had deteriorated significantly. Using the SPIKES framework, I ensured we had privacy, assessed what they already understood, provided information clearly and compassionately, responded to their emotions with empathy, and discussed next steps. I allowed time for questions, provided written information, and arranged follow-up support including liaison with specialist nurses. I also ensured the team was aware of the family's emotional needs for ongoing care.\",\n          category: \"Communication\"\n        }\n      ];\n    } else if (isTherapist) {\n      roleSpecificQuestions = [\n        {\n          question: \"How do you motivate patients who are struggling to engage with their rehabilitation program?\",\n          model_answer: \"I start by understanding the barriers to engagement, whether they're physical, psychological, or social. I work with patients to set realistic, achievable goals that are meaningful to them. I use motivational interviewing techniques to explore their concerns and highlight their strengths. I adapt treatment approaches to suit their preferences and capabilities, celebrate small victories, and involve family support where appropriate. Regular reassessment and goal adjustment help maintain momentum and hope.\",\n          category: \"Patient Engagement\"\n        }\n      ];\n    } else if (isAdmin) {\n      roleSpecificQuestions = [\n        {\n          question: \"How would you improve team communication and efficiency in a busy healthcare environment?\",\n          model_answer: \"I would implement regular team briefings to share important information and identify priorities. I'd establish clear communication channels and protocols, potentially using digital tools for non-urgent communications. Regular team meetings would address ongoing issues and share good practice. I'd also create feedback mechanisms for team members to suggest improvements and ensure everyone understands their roles and responsibilities. Training in effective communication techniques would support these initiatives.\",\n          category: \"Leadership\"\n        }\n      ];\n    }\n\n    // Add more general questions to reach 25 total\n    const additionalQuestions = [\n      {\n        question: \"Why do you want to work in this particular department/specialty?\",\n        model_answer: \"I'm drawn to this specialty because it aligns with my passion for [specific aspect of care]. I've developed skills and experience in this area through [relevant experience], and I'm excited by the challenges and learning opportunities it offers. I particularly value the opportunity to make a meaningful difference in patients' lives at [specific situation related to specialty]. The department's reputation for excellence and innovation also attracts me, and I believe I can contribute positively to the team.\",\n        category: \"Motivation\"\n      },\n      {\n        question: \"How do you handle stress and maintain work-life balance in healthcare?\",\n        model_answer: \"I recognize that healthcare can be emotionally and physically demanding, so I've developed healthy coping strategies. I practice mindfulness and ensure I take regular breaks during shifts. I maintain physical fitness and have hobbies that help me unwind. I also seek support from colleagues when needed and participate in reflective practice sessions. I believe maintaining my own wellbeing is essential for providing quality patient care, so I prioritize sleep, nutrition, and time with family and friends.\",\n        category: \"Wellbeing\"\n      },\n      {\n        question: \"Describe a time when you worked effectively as part of a multidisciplinary team.\",\n        model_answer: \"I participated in weekly MDT meetings for complex patient cases. In one instance, we had a patient with multiple comorbidities requiring coordinated care. I contributed my [professional perspective], listened to colleagues' expertise, and helped develop a comprehensive care plan. I took responsibility for specific actions, communicated regularly with team members about progress, and adapted our approach based on patient response. This collaborative approach resulted in improved patient outcomes and discharge planning.\",\n        category: \"Teamwork\"\n      },\n      {\n        question: \"How do you stay updated with current best practices and evidence in your field?\",\n        model_answer: \"I'm committed to lifelong learning and maintaining current knowledge. I regularly read professional journals, attend conferences and training sessions, and participate in online learning modules. I'm part of professional networks where we share best practices and discuss emerging evidence. I also engage in reflective practice with colleagues and seek feedback on my performance. When new evidence emerges, I evaluate its relevance to my practice and implement changes appropriately.\",\n        category: \"Professional Development\"\n      },\n      {\n        question: \"What would you do if you witnessed a colleague making an error?\",\n        model_answer: \"Patient safety is paramount, so I would immediately assess if there's any immediate risk to the patient and take appropriate action to ensure their safety. I would then speak privately with my colleague about what I observed, giving them the opportunity to address the issue themselves. If the error had clinical implications, I would ensure it was properly reported through incident reporting systems. I would approach this with compassion, recognizing that errors can happen to anyone, while maintaining professional accountability.\",\n        category: \"Professional Standards\"\n      },\n      {\n        question: \"How do you ensure you provide culturally sensitive care?\",\n        model_answer: \"I recognize that effective healthcare must be culturally competent. I make an effort to understand patients' cultural backgrounds, beliefs, and preferences that might affect their care. I use professional interpreters when needed and avoid making assumptions about patients based on their appearance or background. I respect religious practices and dietary requirements, and I'm sensitive to different attitudes toward healthcare, family involvement, and decision-making. I continue to educate myself about different cultures and seek guidance when unsure.\",\n        category: \"Equality and Diversity\"\n      },\n      {\n        question: \"Describe a situation where you had to adapt quickly to unexpected changes.\",\n        model_answer: \"During a shift, we received multiple emergency admissions that stretched our resources. I quickly assessed the situation, reprioritized my workload, and communicated with the team about the changing demands. I delegated appropriate tasks, requested additional support, and ensured all patients received necessary care despite the increased pressure. I remained calm and focused, kept colleagues informed, and after the situation stabilized, we debriefed as a team to identify any learning points for future similar situations.\",\n        category: \"Adaptability\"\n      },\n      {\n        question: \"What do you think are the biggest challenges facing the NHS today?\",\n        model_answer: \"The NHS faces several significant challenges including increasing demand from an aging population, funding constraints, staff shortages, and the need for digital transformation. COVID-19 has highlighted both the resilience of NHS staff and the system's vulnerabilities. I believe addressing these challenges requires innovative approaches, better integration between services, investment in staff wellbeing and development, and leveraging technology to improve efficiency. As healthcare professionals, we all have a role in finding solutions and advocating for sustainable healthcare delivery.\",\n        category: \"NHS Awareness\"\n      },\n      {\n        question: \"How would you handle a complaint from a patient or their family?\",\n        model_answer: \"I would listen actively and empathetically to understand their concerns without becoming defensive. I would acknowledge their feelings and apologize for any distress caused, regardless of whether an error occurred. I would gather all relevant information, investigate the issue thoroughly, and provide a clear explanation of what happened. If an error was made, I would explain what steps are being taken to prevent recurrence. I would also inform them about formal complaints procedures if they wished to pursue the matter further.\",\n        category: \"Communication\"\n      },\n      {\n        question: \"What motivates you to provide excellent patient care?\",\n        model_answer: \"I'm motivated by the profound impact healthcare professionals can have on people during their most vulnerable moments. Seeing patients recover, helping families through difficult times, and being trusted with people's health and wellbeing is both humbling and inspiring. I believe everyone deserves compassionate, high-quality care regardless of their background or circumstances. The NHS values resonate deeply with me, particularly the commitment to providing care free at the point of delivery and treating everyone with dignity and respect.\",\n        category: \"Motivation\"\n      },\n      {\n        question: \"How do you approach continuous learning and professional development?\",\n        model_answer: \"I view learning as a continuous journey rather than a destination. I actively seek feedback from colleagues and supervisors to identify areas for improvement. I set specific learning goals aligned with my role and career aspirations, and I track my progress regularly. I participate in formal training programs, attend workshops and conferences, and engage in peer learning opportunities. I also reflect on challenging cases and experiences to extract learning points. I believe sharing knowledge with colleagues also enhances my own understanding.\",\n        category: \"Professional Development\"\n      },\n      {\n        question: \"Describe your understanding of confidentiality in healthcare.\",\n        model_answer: \"Confidentiality is fundamental to the trust between patients and healthcare providers. I understand that patient information should only be shared with those directly involved in their care and with appropriate consent. I'm familiar with Data Protection Act requirements and understand when information can be shared without consent, such as safeguarding situations or serious crime prevention. I ensure private conversations occur in appropriate settings, secure handling of records, and I'm aware of the consequences of confidentiality breaches for both patients and professionals.\",\n        category: \"Professional Standards\"\n      },\n      {\n        question: \"How would you contribute to infection prevention and control?\",\n        model_answer: \"Infection prevention is everyone's responsibility. I would adhere strictly to hand hygiene protocols, use PPE appropriately, and follow isolation procedures when required. I would ensure proper cleaning and decontamination of equipment, and I'd educate patients and families about infection control measures. I would promptly report any infections or outbreaks and participate in audits and training programs. I believe leading by example and encouraging colleagues to maintain high standards is crucial for protecting both patients and staff.\",\n        category: \"Safety\"\n      },\n      {\n        question: \"What are your career aspirations within the NHS?\",\n        model_answer: \"I'm committed to growing within the NHS and contributing to its mission of providing excellent healthcare. In the short term, I want to excel in this role, develop my clinical skills, and contribute positively to the team. Medium-term, I'm interested in [specific development opportunities related to the role], potentially including mentoring newer staff or taking on additional responsibilities. Long-term, I aspire to [relevant leadership or specialist goals] while always maintaining focus on patient care and the NHS values.\",\n        category: \"Career Development\"\n      },\n      {\n        question: \"How do you ensure patient safety in your daily practice?\",\n        model_answer: \"Patient safety is my top priority. I follow established protocols and guidelines, complete thorough assessments, and maintain accurate documentation. I practice the 'five rights' for medication administration, use proper identification procedures, and report incidents or near misses promptly. I participate in safety briefings and huddles, stay alert to potential risks, and speak up when I have concerns. I also believe in continuous learning from incidents and participating in quality improvement initiatives to enhance safety culture.\",\n        category: \"Safety\"\n      },\n      {\n        question: \"How would you handle working with limited resources while maintaining quality care?\",\n        model_answer: \"I would focus on efficient resource utilization while never compromising patient safety. I would prioritize care based on clinical need, look for opportunities to reduce waste, and ensure equipment is used appropriately. I would communicate openly with the team about resource constraints and collaborate to find creative solutions. I would also advocate appropriately for additional resources when patient care could be compromised, while being resourceful and innovative in my approach to delivering care within available means.\",\n        category: \"Resource Management\"\n      }\n    ];\n\n    // Combine questions to reach exactly 25\n    const allQuestions = [...baseQuestions, ...roleSpecificQuestions, ...additionalQuestions];\n    return allQuestions.slice(0, 25);\n  }\n\n  // ===============================================\n  // Q&A GENERATOR ENDPOINTS - FLASHCARD SYSTEM\n  // ===============================================\n\n  // Generate Q&A session from job description\n  app.post('/api/qa/generate', isAuthenticated, validateCSRFToken, checkUsageRestrictions('qa_generator'), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { jobDescription, jobTitle } = req.body;\n\n      if (!jobDescription || jobDescription.trim().length < 100) {\n        return res.status(400).json({ \n          error: \"Please provide a detailed job description (minimum 100 characters)\" \n        });\n      }\n\n      // Extract job title if not provided\n      const extractedJobTitle = jobTitle || jobDescription.split('\\n')[0].substring(0, 100);\n\n      // Create session first\n      const [session] = await db\n        .insert(qaSessions)\n        .values({\n          userId,\n          jobDescription: jobDescription.trim(),\n          jobTitle: extractedJobTitle,\n          totalQuestions: 25\n        })\n        .returning();\n\n      // Generate questions using Gemini AI\n      const geminiQuestions = await geminiService.generateQAFlashcards({\n        jobTitle: extractedJobTitle,\n        jobDescription: jobDescription.trim()\n      });\n      \n      // Fallback to demo if Gemini fails\n      const questionsToSave = geminiQuestions.length > 0 ? geminiQuestions : generateDemoQuestions(extractedJobTitle);\n      \n      // Save questions to database\n      const questionPromises = questionsToSave.map((q: any, index: number) =>\n        db.insert(qaQuestions)\n          .values({\n            sessionId: session.id,\n            questionText: q.question,\n            modelAnswer: q.modelAnswer || q.model_answer,\n            category: q.category,\n            questionOrder: index + 1\n          })\n          .returning()\n      );\n\n      const savedQuestions = await Promise.all(questionPromises);\n\n      res.json({\n        session_id: session.id,\n        questions: savedQuestions.map(([q], index) => ({\n          id: q.id,\n          question: q.questionText,\n          answer: q.modelAnswer,\n          category: q.category,\n          order: q.questionOrder\n        })),\n        total_questions: 25,\n        disclaimer: \"These questions are generated based on your job description and are designed to help you prepare. Actual interview questions may differ, but practicing with these will help you develop strong responses to common healthcare interview themes.\"\n      });\n\n    } catch (error) {\n      console.error(\"Error generating Q&A session:\", error);\n      res.status(500).json({ error: \"Failed to generate questions\" });\n    }\n  });\n\n  // Get user's Q&A sessions\n  app.get('/api/qa/sessions', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      const sessions = await db\n        .select()\n        .from(qaSessions)\n        .where(eq(qaSessions.userId, userId))\n        .orderBy(desc(qaSessions.createdAt))\n        .limit(10);\n\n      res.json(sessions);\n    } catch (error) {\n      console.error(\"Error fetching Q&A sessions:\", error);\n      res.status(500).json({ error: \"Failed to fetch sessions\" });\n    }\n  });\n\n  // Get session with questions and progress\n  app.get('/api/qa/session/:sessionId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const sessionId = req.params.sessionId;\n\n      // Get session\n      const [session] = await db\n        .select()\n        .from(qaSessions)\n        .where(and(eq(qaSessions.id, sessionId), eq(qaSessions.userId, userId)));\n\n      if (!session) {\n        return res.status(404).json({ error: \"Session not found\" });\n      }\n\n      // Get questions\n      const questions = await db\n        .select()\n        .from(qaQuestions)\n        .where(eq(qaQuestions.sessionId, sessionId))\n        .orderBy(qaQuestions.questionOrder);\n\n      // Get progress\n      const progress = await db\n        .select()\n        .from(qaProgress)\n        .where(eq(qaProgress.sessionId, sessionId));\n\n      res.json({\n        session,\n        questions,\n        progress\n      });\n    } catch (error) {\n      console.error(\"Error fetching session:\", error);\n      res.status(500).json({ error: \"Failed to fetch session\" });\n    }\n  });\n\n  // Update question progress (confidence level)\n  app.post('/api/qa/progress', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { session_id, question_id, confidence_level } = req.body;\n\n      if (!session_id || !question_id || !confidence_level) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      if (confidence_level < 1 || confidence_level > 3) {\n        return res.status(400).json({ error: \"Confidence level must be 1, 2, or 3\" });\n      }\n\n      // Verify session belongs to user\n      const [session] = await db\n        .select()\n        .from(qaSessions)\n        .where(and(eq(qaSessions.id, session_id), eq(qaSessions.userId, userId)));\n\n      if (!session) {\n        return res.status(404).json({ error: \"Session not found\" });\n      }\n\n      // Check if progress already exists\n      const [existingProgress] = await db\n        .select()\n        .from(qaProgress)\n        .where(and(\n          eq(qaProgress.sessionId, session_id),\n          eq(qaProgress.questionId, question_id)\n        ));\n\n      if (existingProgress) {\n        // Update existing progress\n        await db\n          .update(qaProgress)\n          .set({\n            confidenceLevel: confidence_level,\n            attempts: existingProgress.attempts + 1,\n            lastReviewed: new Date()\n          })\n          .where(eq(qaProgress.id, existingProgress.id));\n      } else {\n        // Create new progress record\n        await db\n          .insert(qaProgress)\n          .values({\n            sessionId: session_id,\n            questionId: question_id,\n            confidenceLevel: confidence_level,\n            attempts: 1\n          });\n      }\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error updating progress:\", error);\n      res.status(500).json({ error: \"Failed to update progress\" });\n    }\n  });\n\n  // Complete Q&A session\n  app.post('/api/qa/session/:sessionId/complete', isAuthenticated, validateCSRFToken, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const sessionId = req.params.sessionId;\n\n      // Verify session belongs to user\n      const [session] = await db\n        .select()\n        .from(qaSessions)\n        .where(and(eq(qaSessions.id, sessionId), eq(qaSessions.userId, userId)));\n\n      if (!session) {\n        return res.status(404).json({ error: \"Session not found\" });\n      }\n\n      // Mark session as completed\n      await db\n        .update(qaSessions)\n        .set({ completedAt: new Date() })\n        .where(eq(qaSessions.id, sessionId));\n\n      // Get completion stats\n      const progress = await db\n        .select()\n        .from(qaProgress)\n        .where(eq(qaProgress.sessionId, sessionId));\n\n      const stats = {\n        total_questions: session.totalQuestions,\n        total_attempts: progress.reduce((sum, p) => sum + p.attempts, 0),\n        final_mastery: {\n          confident: progress.filter(p => p.confidenceLevel === 3).length,\n          somewhat_confident: progress.filter(p => p.confidenceLevel === 2).length,\n          not_confident: progress.filter(p => p.confidenceLevel === 1).length\n        }\n      };\n\n      res.json({\n        success: true,\n        summary: stats\n      });\n    } catch (error) {\n      console.error(\"Error completing session:\", error);\n      res.status(500).json({ error: \"Failed to complete session\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":157985},"server/seed-jobs.ts":{"content":"import { storage } from \"./storage\";\n\nconst NHS_SAMPLE_JOBS = [\n  {\n    title: \"Staff Nurse - Emergency Department\",\n    employer: \"Guy's and St Thomas' NHS Foundation Trust\",\n    location: \"London, SE1\",\n    band: \"Band 5\",\n    salary: \"¬£28,407 - ¬£34,581 per annum\",\n    description: `We are seeking a dedicated Staff Nurse to join our busy Emergency Department. This is an excellent opportunity for a newly qualified nurse or experienced professional looking to develop their emergency care skills.\n\nKey Responsibilities:\n- Provide high-quality nursing care to patients in the Emergency Department\n- Work as part of a multidisciplinary team to deliver patient-centered care\n- Assess, plan, implement and evaluate nursing care\n- Maintain accurate patient records\n- Support junior staff and students\n\nPerson Specification:\nEssential:\n- Registered Nurse (RN) with valid NMC registration\n- Post-registration experience in acute care setting\n- Strong communication and interpersonal skills\n- Ability to work effectively under pressure\n- Commitment to NHS values\n\nDesirable:\n- Emergency care experience\n- Advanced life support training\n- Mentorship qualification`,\n    contractType: \"Permanent\",\n    hoursPerWeek: 37.5,\n    visaSponsorship: true,\n    specialty: \"Emergency Medicine\",\n    featured: true,\n    isActive: true,\n    requirements: [\n      \"NMC Registration\",\n      \"6 months acute care experience\",\n      \"Right to work in UK or visa sponsorship available\"\n    ],\n    benefits: [\n      \"NHS Pension Scheme\",\n      \"27 days annual leave plus bank holidays\",\n      \"Career development opportunities\",\n      \"Free parking\"\n    ]\n  },\n  {\n    title: \"Senior Physiotherapist - Musculoskeletal\",\n    employer: \"Sheffield Teaching Hospitals NHS Foundation Trust\",\n    location: \"Sheffield, S10\",\n    band: \"Band 6\",\n    salary: \"¬£35,392 - ¬£42,618 per annum\",\n    description: `Join our dynamic Musculoskeletal Physiotherapy team as a Senior Physiotherapist. You will work with patients with a range of musculoskeletal conditions in both outpatient and inpatient settings.\n\nKey Responsibilities:\n- Assess and treat patients with musculoskeletal conditions\n- Develop and implement treatment plans\n- Supervise junior physiotherapists and students\n- Participate in service development initiatives\n- Maintain clinical records and documentation\n\nPerson Specification:\nEssential:\n- BSc Physiotherapy or equivalent\n- HCPC registration\n- 2+ years post-qualification experience\n- Experience in musculoskeletal physiotherapy\n- Strong assessment and treatment skills\n\nDesirable:\n- Postgraduate qualification in musculoskeletal physiotherapy\n- Manual therapy skills\n- Research experience`,\n    contractType: \"Permanent\",\n    hoursPerWeek: 37.5,\n    visaSponsorship: false,\n    specialty: \"Physiotherapy\",\n    featured: true,\n    isActive: true,\n    requirements: [\n      \"HCPC Registration\",\n      \"BSc Physiotherapy\",\n      \"2+ years experience\"\n    ],\n    benefits: [\n      \"NHS Pension Scheme\",\n      \"Professional development budget\",\n      \"Study leave entitlement\",\n      \"Cycle to work scheme\"\n    ]\n  },\n  {\n    title: \"Clinical Pharmacist - Cardiology\",\n    employer: \"Imperial College Healthcare NHS Trust\",\n    location: \"London, W12\",\n    band: \"Band 7\",\n    salary: \"¬£44,606 - ¬£50,056 per annum\",\n    description: `We are looking for an experienced Clinical Pharmacist to join our Cardiology team. This role involves providing pharmaceutical care to cardiology patients and supporting the multidisciplinary team.\n\nKey Responsibilities:\n- Provide clinical pharmacy services to cardiology patients\n- Medicine reconciliation and optimization\n- Patient counseling and education\n- Drug monitoring and adverse event reporting\n- Training and supervision of junior pharmacists\n\nPerson Specification:\nEssential:\n- MPharm degree or equivalent\n- GPhC registration\n- 3+ years post-registration experience\n- Clinical pharmacy experience\n- Knowledge of cardiovascular medicines\n\nDesirable:\n- Postgraduate clinical pharmacy qualification\n- Cardiology experience\n- Independent prescribing qualification`,\n    contractType: \"Permanent\",\n    hoursPerWeek: 37.5,\n    visaSponsorship: true,\n    specialty: \"Pharmacy\",\n    featured: false,\n    isActive: true,\n    requirements: [\n      \"GPhC Registration\",\n      \"MPharm Degree\",\n      \"Clinical pharmacy experience\"\n    ],\n    benefits: [\n      \"NHS Pension Scheme\",\n      \"London Weighting\",\n      \"Professional development opportunities\",\n      \"Flexible working arrangements\"\n    ]\n  },\n  {\n    title: \"Biomedical Scientist - Haematology\",\n    employer: \"Leeds Teaching Hospitals NHS Trust\",\n    location: \"Leeds, LS1\",\n    band: \"Band 5\",\n    salary: \"¬£28,407 - ¬£34,581 per annum\",\n    description: `Join our Haematology laboratory team as a Biomedical Scientist. You will be responsible for performing routine and specialist haematology tests to support patient care.\n\nKey Responsibilities:\n- Perform haematology tests including FBC, blood films, and coagulation studies\n- Operate and maintain laboratory equipment\n- Quality control and quality assurance activities\n- Report results and liaise with clinical staff\n- Participate in laboratory development projects\n\nPerson Specification:\nEssential:\n- BSc Biomedical Science or equivalent\n- HCPC registration\n- Experience in haematology or related field\n- Knowledge of laboratory information systems\n- Attention to detail and accuracy\n\nDesirable:\n- MSc in relevant field\n- Experience with automated analyzers\n- Previous NHS experience`,\n    contractType: \"Permanent\",\n    hoursPerWeek: 37.5,\n    visaSponsorship: true,\n    specialty: \"Biomedical Science\",\n    featured: false,\n    isActive: true,\n    requirements: [\n      \"HCPC Registration\",\n      \"BSc Biomedical Science\",\n      \"Laboratory experience\"\n    ],\n    benefits: [\n      \"NHS Pension Scheme\",\n      \"Career progression opportunities\",\n      \"Training and development\",\n      \"Staff discount schemes\"\n    ]\n  },\n  {\n    title: \"Consultant Radiologist\",\n    employer: \"Oxford University Hospitals NHS Foundation Trust\",\n    location: \"Oxford, OX3\",\n    band: \"Consultant\",\n    salary: \"¬£93,666 - ¬£126,281 per annum\",\n    description: `We are seeking a Consultant Radiologist to join our busy radiology department. This is an excellent opportunity for an experienced radiologist to work in a leading teaching hospital.\n\nKey Responsibilities:\n- Provide comprehensive radiology services across all modalities\n- Supervise and train junior doctors and radiographers\n- Participate in multidisciplinary team meetings\n- Engage in research and teaching activities\n- Quality assurance and clinical governance\n\nPerson Specification:\nEssential:\n- MBBS or equivalent medical qualification\n- GMC registration with license to practice\n- CCT in Clinical Radiology or equivalent\n- At least 2 years post-CCT experience\n- Experience in cross-sectional imaging\n\nDesirable:\n- Subspecialty expertise (MSK, Neuro, Cardiac)\n- Research experience and publications\n- Teaching qualifications`,\n    contractType: \"Permanent\",\n    hoursPerWeek: 40,\n    visaSponsorship: true,\n    specialty: \"Radiology\",\n    featured: true,\n    isActive: true,\n    requirements: [\n      \"GMC Registration\",\n      \"CCT in Clinical Radiology\",\n      \"Post-CCT experience\"\n    ],\n    benefits: [\n      \"NHS Pension Scheme\",\n      \"Excellent research opportunities\",\n      \"Study leave and educational support\",\n      \"Competitive salary with increments\"\n    ]\n  }\n];\n\nexport async function seedNHSJobs() {\n  console.log('Seeding NHS jobs...');\n  \n  for (const jobData of NHS_SAMPLE_JOBS) {\n    try {\n      await storage.createNhsJob(jobData);\n      console.log(`‚úÖ Created job: ${jobData.title} at ${jobData.employer}`);\n    } catch (error) {\n      console.error(`‚ùå Error creating job ${jobData.title}:`, error);\n    }\n  }\n  \n  console.log('NHS jobs seeding complete!');\n}\n\n// Run the seeding\nseedNHSJobs()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error('Job seeding failed:', error);\n    process.exit(1);\n  });","size_bytes":8043},"server/seed-prompts.ts":{"content":"import { storage } from \"./storage\";\n\nconst HIDDEN_AI_PROMPTS = [\n  {\n    name: 'cv_generation',\n    category: 'document_generation',\n    prompt: `You are an expert NHS recruitment specialist and CV writer. Generate a professional 2-page CV for a healthcare professional applying to NHS roles.\n\nCRITICAL REQUIREMENTS:\n- Use UK spelling and NHS-specific terminology\n- Format with clear sections: Personal Statement, Key Skills, Professional Experience, Education, Certifications, Additional Information\n- Include measurable outcomes using STAR methodology (Situation, Task, Action, Result)\n- Match tone and content to experience level: {EXPERIENCE_LEVEL}\n- Target NHS band level: {TARGET_BAND}\n- Emphasize NHS values: compassion, respect, dignity, commitment, quality, integrity\n\nUSER PROFILE DATA:\n{USER_PROFILE}\n\nSTAR EXAMPLES TO INCORPORATE:\n{STAR_EXAMPLES}\n\nJOB REQUIREMENTS (if applying for specific role):\n{JOB_DESCRIPTION}\n\nFORMATTING RULES:\n- Professional, readable layout\n- Quantify achievements with specific numbers, percentages, outcomes\n- Use active voice and strong action verbs\n- Include relevant keywords from healthcare/NHS context\n- Maximum 2 pages\n- Include contact details placeholder\n\nRESPONSE FORMAT:\nReturn ONLY a JSON object with this structure:\n{\n  \"cv_content\": \"Full CV text with proper formatting and sections\"\n}`,\n    version: \"1.0\",\n    isActive: true,\n    metadata: { \n      target_length: \"2 pages\",\n      tone_options: [\"junior\", \"mid\", \"senior\"],\n      nhs_values_integration: true\n    }\n  },\n  {\n    name: 'supporting_info_generation',\n    category: 'document_generation',\n    prompt: `You are an NHS recruitment expert specializing in Supporting Information. Generate a compelling 900-1200 word Supporting Information document that directly addresses the person specification.\n\nCRITICAL REQUIREMENTS:\n- Word count: 900-1200 words exactly\n- Address ALL person specification criteria systematically\n- Map content to NHS values: compassion, respect, dignity, commitment, quality, integrity\n- Use STAR methodology for examples (Situation, Task, Action, Result)\n- Professional NHS tone and terminology\n- UK spelling throughout\n- Evidence-based responses with specific examples\n\nUSER PROFILE DATA:\n{USER_PROFILE}\n\nSTAR EXAMPLES TO USE:\n{STAR_EXAMPLES}\n\nJOB REQUIREMENTS & PERSON SPEC:\n{JOB_DESCRIPTION}\n\nSTRUCTURE:\n1. Opening statement (100-150 words) - Why you're suitable\n2. Essential criteria responses (600-800 words) - Address each systematically\n3. Desirable criteria responses (200-300 words) - Additional value\n4. Closing statement (50-100 words) - Commitment to NHS values\n\nNHS VALUES MAPPING:\n- Compassion: Patient-centered care examples\n- Respect: Dignity, diversity, inclusion examples  \n- Dignity: Treating all with respect examples\n- Commitment: Dedication to service excellence\n- Quality: Continuous improvement, evidence-based practice\n- Integrity: Honesty, professional standards\n\nRESPONSE FORMAT:\nReturn ONLY a JSON object:\n{\n  \"supporting_info_content\": \"Full Supporting Information text with clear paragraph structure\"\n}`,\n    version: \"1.0\",\n    isActive: true,\n    metadata: {\n      target_length: \"900-1200 words\",\n      nhs_values_required: true,\n      person_spec_mapping: true\n    }\n  },\n  {\n    name: 'interview_qa_generation',\n    category: 'interview_practice',\n    prompt: `Generate NHS-specific interview questions and model answers for the given role. Focus on competency-based questions that assess NHS values and clinical/professional skills.\n\nJOB DESCRIPTION:\n{JOB_DESCRIPTION}\n\nDIFFICULTY LEVEL:\n{DIFFICULTY_LEVEL}\n\nREQUIREMENTS:\n- Generate 8-10 interview questions\n- Mix of competency-based, clinical, and NHS values questions\n- Include STAR methodology in suggested answers\n- Vary difficulty based on role level\n- Include scenario-based questions\n- Focus on NHS priorities: patient safety, quality care, teamwork\n\nQUESTION CATEGORIES:\n1. NHS Values (2-3 questions)\n2. Clinical/Professional competency (3-4 questions)  \n3. Leadership and teamwork (2-3 questions)\n4. Challenging situations (1-2 questions)\n\nRESPONSE FORMAT:\nReturn ONLY a JSON object:\n{\n  \"questions\": [\n    {\n      \"question\": \"Tell me about a time when you demonstrated compassion in your role\",\n      \"suggestedAnswer\": \"Model STAR answer demonstrating compassion with specific example\",\n      \"category\": \"nhs_values\",\n      \"difficulty\": \"mid\"\n    }\n  ]\n}`,\n    version: \"1.0\",\n    isActive: true,\n    metadata: {\n      question_count: \"8-10\",\n      includes_nhs_values: true,\n      star_methodology: true\n    }\n  },\n  {\n    name: 'interview_scoring',\n    category: 'interview_practice',\n    prompt: `Score this interview response on a scale of 1-10 and provide constructive feedback focusing on NHS interview standards.\n\nQUESTION:\n{QUESTION}\n\nUSER RESPONSE:\n{USER_RESPONSE}\n\nSCORING CRITERIA:\n- STAR structure (Situation, Task, Action, Result) - 30%\n- NHS values demonstration - 25%\n- Specific examples and evidence - 20%\n- Communication clarity - 15%\n- Professional insight - 10%\n\nNHS VALUES TO ASSESS:\n- Compassion: Caring, empathy, putting patients first\n- Respect: Dignity, diversity, individual worth\n- Commitment: Service excellence, going extra mile\n- Quality: Best practice, continuous improvement\n- Integrity: Honesty, ethical practice\n- Teamwork: Collaboration, support\n\nFEEDBACK AREAS:\n1. What worked well\n2. STAR structure assessment\n3. NHS values demonstration\n4. Areas for improvement\n5. Specific suggestions\n\nRESPONSE FORMAT:\nReturn ONLY a JSON object:\n{\n  \"score\": 7,\n  \"feedback\": \"Detailed constructive feedback on the response\",\n  \"improvements\": [\"Specific improvement suggestion 1\", \"Suggestion 2\", \"Suggestion 3\"]\n}`,\n    version: \"1.0\",\n    isActive: true,\n    metadata: {\n      scoring_scale: \"1-10\",\n      nhs_values_focus: true,\n      star_assessment: true\n    }\n  },\n  {\n    name: 'job_fit_scoring',\n    category: 'job_matching',\n    prompt: `Analyze how well this user profile matches the NHS job requirements and provide a detailed fit score with breakdown.\n\nUSER PROFILE:\n{USER_PROFILE}\n\nJOB DESCRIPTION:\n{JOB_DESCRIPTION}\n\nSCORING FACTORS:\n- Professional qualifications match (25%)\n- Experience level alignment (20%)\n- Specialty/skills match (20%)\n- Band/career level fit (15%)\n- Location feasibility (10%)\n- Visa/eligibility requirements (10%)\n\nANALYSIS AREAS:\n1. Essential criteria match\n2. Desirable criteria match\n3. Career progression alignment\n4. Skills gap identification\n5. Development opportunities\n\nRESPONSE FORMAT:\nReturn ONLY a JSON object:\n{\n  \"score\": 85,\n  \"breakdown\": {\n    \"qualifications_match\": 90,\n    \"experience_level\": 85,\n    \"skills_alignment\": 80,\n    \"band_fit\": 90,\n    \"location_feasible\": 95,\n    \"eligibility_clear\": 100\n  },\n  \"strengths\": [\"Strong clinical background\", \"Excellent band match\"],\n  \"gaps\": [\"Limited leadership experience\", \"Additional training needed in X\"],\n  \"recommendations\": [\"Consider additional training\", \"Highlight specific skills\"]\n}`,\n    version: \"1.0\",\n    isActive: true,\n    metadata: {\n      scoring_factors: 6,\n      includes_recommendations: true,\n      gap_analysis: true\n    }\n  }\n];\n\nexport async function seedAIPrompts() {\n  console.log('Seeding AI prompts...');\n  \n  for (const promptData of HIDDEN_AI_PROMPTS) {\n    try {\n      // Check if prompt already exists\n      const existing = await storage.getActivePrompt(promptData.name);\n      \n      if (!existing) {\n        await storage.createAiPrompt(promptData);\n        console.log(`‚úÖ Created prompt: ${promptData.name}`);\n      } else {\n        console.log(`‚è≠Ô∏è  Prompt already exists: ${promptData.name}`);\n      }\n    } catch (error) {\n      console.error(`‚ùå Error creating prompt ${promptData.name}:`, error);\n    }\n  }\n  \n  console.log('AI prompts seeding complete!');\n}\n\n// Run the seeding\nseedAIPrompts()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error('Seeding failed:', error);\n    process.exit(1);\n  });","size_bytes":7936},"server/storage.ts":{"content":"import {\n  users,\n  profiles,\n  applications,\n  interviewSessions,\n  interviewAttempts,\n  documents,\n  starExamples,\n  nhsJobs,\n  jobMatches,\n  userFiles,\n  valuesAssessment,\n  interviewQuestions,\n  aiPrompts,\n  userActivity,\n  newsArticles,\n  gdprConsents,\n  dataSubjectRequests,\n  dataAccessLogs,\n  adminActivityLogs,\n  adminContent,\n  type User,\n  type UpsertUser,\n  type Profile,\n  type InsertProfile,\n  type Application,\n  type InsertApplication,\n  type InterviewSession,\n  type InsertInterviewSession,\n  type InterviewAttempt,\n  type InsertInterviewAttempt,\n  type Document,\n  type InsertDocument,\n  type StarExample,\n  type InsertStarExample,\n  type NhsJob,\n  type InsertNhsJob,\n  type JobMatch,\n  type InsertJobMatch,\n  type UserFile,\n  type InsertUserFile,\n  type ValuesAssessment,\n  type InsertValuesAssessment,\n  type InterviewQuestion,\n  type InsertInterviewQuestion,\n  type AiPrompt,\n  type InsertAiPrompt,\n  type UserActivity,\n  type InsertUserActivity,\n  type NewsArticle,\n  type InsertNewsArticle,\n  type GdprConsent,\n  type InsertGdprConsent,\n  type DataSubjectRequest,\n  type InsertDataSubjectRequest,\n  type DataAccessLog,\n  type InsertDataAccessLog,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, like, or, sql } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User operations - required for Replit Auth\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  updateUser(userId: string, updates: Partial<User>): Promise<User>;\n  updateUserLimits(userId: string, limits: any): Promise<void>;\n  upgradeUserToPaid(userId: string, stripeCustomerId: string): Promise<User>;\n  updateUserPremiumStatus(userId: string, isPremium: boolean): Promise<User>;\n  updateDashboardCardOrder(userId: string, cardOrder: string[]): Promise<void>;\n  \n  // Profile operations\n  getProfile(userId: string): Promise<Profile | undefined>;\n  upsertProfile(profile: InsertProfile): Promise<Profile>;\n  \n  // Application operations\n  getApplications(userId: string): Promise<Application[]>;\n  createApplication(application: InsertApplication): Promise<Application>;\n  updateApplication(id: string, updates: Partial<Application>): Promise<Application>;\n  updateApplicationNotes(id: string, userId: string, notes: string): Promise<Application>;\n  \n  // Interview session operations\n  getInterviewSessions(userId: string): Promise<InterviewSession[]>;\n  createInterviewSession(session: InsertInterviewSession): Promise<InterviewSession>;\n  getLatestInterviewScore(userId: string): Promise<number | undefined>;\n  \n  // Interview attempt operations\n  saveInterviewAttempt(attempt: InsertInterviewAttempt): Promise<InterviewAttempt>;\n  getLastInterviewAttempts(userId: string, limit?: number): Promise<InterviewAttempt[]>;\n  \n  // Document operations\n  getDocuments(userId: string): Promise<Document[]>;\n  createDocument(document: InsertDocument): Promise<Document>;\n  getLatestDocument(userId: string, type: string): Promise<Document | undefined>;\n\n  // STAR examples operations\n  getStarExamples(userId: string): Promise<StarExample[]>;\n  createStarExample(example: InsertStarExample): Promise<StarExample>;\n  updateStarExample(id: string, updates: Partial<StarExample>): Promise<StarExample>;\n  deleteStarExample(id: string): Promise<void>;\n\n  // NHS Jobs operations\n  getNhsJobs(filters?: any): Promise<NhsJob[]>;\n  createNhsJob(job: InsertNhsJob): Promise<NhsJob>;\n  updateNhsJob(id: string, updates: Partial<NhsJob>): Promise<NhsJob>;\n  getFeaturedJobs(): Promise<NhsJob[]>;\n  searchJobs(query: string, filters?: any): Promise<NhsJob[]>;\n\n  // Job matching operations\n  getJobMatches(userId: string): Promise<JobMatch[]>;\n  createJobMatch(match: InsertJobMatch): Promise<JobMatch>;\n  getJobMatchScore(userId: string, jobId: string): Promise<number | undefined>;\n\n  // File operations\n  getUserFiles(userId: string): Promise<UserFile[]>;\n  createUserFile(file: InsertUserFile): Promise<UserFile>;\n  deleteUserFile(id: string): Promise<void>;\n\n  // Values assessment operations\n  getValuesAssessment(userId: string): Promise<ValuesAssessment | undefined>;\n  createValuesAssessment(assessment: InsertValuesAssessment): Promise<ValuesAssessment>;\n\n  // Interview questions operations\n  getInterviewQuestions(category?: string, difficulty?: string): Promise<InterviewQuestion[]>;\n  createInterviewQuestion(question: InsertInterviewQuestion): Promise<InterviewQuestion>;\n\n  // AI prompts operations (admin only)\n  getActivePrompt(name: string): Promise<AiPrompt | undefined>;\n  createAiPrompt(prompt: InsertAiPrompt): Promise<AiPrompt>;\n  updateAiPrompt(id: string, updates: Partial<AiPrompt>): Promise<AiPrompt>;\n  getAllPrompts(): Promise<AiPrompt[]>;\n\n  // Admin operations\n  makeUserAdmin(userId: string, adminRole: string, createdBy?: string): Promise<User>;\n  getAllUsers(): Promise<User[]>;\n  getUserStats(): Promise<any>;\n  getSystemAnalytics(): Promise<any>;\n  createAdminActivityLog(log: any): Promise<any>;\n  \n  // Content management\n  getAdminContent(contentKey?: string): Promise<any>;\n  updateAdminContent(contentKey: string, content: any, editedBy: string): Promise<any>;\n  \n  // AI Prompt management  \n  getAiPrompts(category?: string): Promise<any>;\n  updateAiPrompt(promptKey: string, prompt: any, editedBy: string): Promise<any>;\n  createAiPrompt(prompt: any): Promise<any>;\n  \n  // User activity tracking\n  logUserActivity(activity: InsertUserActivity): Promise<UserActivity>;\n  getUserActivity(userId: string, limit?: number): Promise<UserActivity[]>;\n  getActivityStats(days?: number): Promise<any>;\n  \n  // News management\n  getNewsArticles(): Promise<NewsArticle[]>;\n  createNewsArticle(article: InsertNewsArticle): Promise<NewsArticle>;\n  updateNewsArticle(id: string, updates: Partial<NewsArticle>): Promise<NewsArticle>;\n  deleteNewsArticle(id: string): Promise<void>;\n\n  // GDPR Compliance operations\n  recordConsent(consent: InsertGdprConsent): Promise<GdprConsent>;\n  getUserConsents(userId: string): Promise<GdprConsent[]>;\n  updateConsent(userId: string, consentType: string, consentGiven: boolean, ipAddress?: string, userAgent?: string): Promise<GdprConsent>;\n  withdrawConsent(userId: string, consentType: string, ipAddress?: string, userAgent?: string): Promise<GdprConsent>;\n\n  // Data Subject Requests\n  createDataSubjectRequest(request: InsertDataSubjectRequest): Promise<DataSubjectRequest>;\n  getDataSubjectRequests(userId: string): Promise<DataSubjectRequest[]>;\n  updateDataSubjectRequest(id: string, updates: Partial<DataSubjectRequest>): Promise<DataSubjectRequest>;\n  getAllDataSubjectRequests(): Promise<DataSubjectRequest[]>;\n\n  // Data Access Logging\n  logDataAccess(log: InsertDataAccessLog): Promise<DataAccessLog>;\n  getDataAccessLogs(userId: string): Promise<DataAccessLog[]>;\n\n  // Data Export for GDPR requests\n  getUserDataExport(userId: string): Promise<any>;\n  anonymizeUserData(userId: string): Promise<void>;\n  deleteUserData(userId: string): Promise<void>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async updateUser(userId: string, updates: Partial<User>): Promise<User> {\n    const [user] = await db\n      .update(users)\n      .set({\n        ...updates,\n        updatedAt: new Date(),\n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return user;\n  }\n\n  async updateUserLimits(userId: string, limits: any): Promise<void> {\n    await db\n      .update(users)\n      .set({ \n        freeTierLimits: limits,\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, userId));\n  }\n\n  async upgradeUserToPaid(userId: string, stripeCustomerId: string): Promise<User> {\n    const [user] = await db\n      .update(users)\n      .set({ \n        subscriptionStatus: 'paid',\n        stripeCustomerId,\n        paymentDate: new Date(),\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return user;\n  }\n\n  async updateUserPremiumStatus(userId: string, isPremium: boolean): Promise<User> {\n    const [user] = await db\n      .update(users)\n      .set({ \n        subscriptionStatus: isPremium ? 'paid' : 'free',\n        paymentDate: isPremium ? new Date() : null,\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return user;\n  }\n\n  async updateDashboardCardOrder(userId: string, cardOrder: string[]): Promise<void> {\n    await db\n      .update(users)\n      .set({ \n        dashboardCardOrder: cardOrder,\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, userId));\n  }\n\n  async getProfile(userId: string): Promise<Profile | undefined> {\n    const [profile] = await db\n      .select()\n      .from(profiles)\n      .where(eq(profiles.userId, userId));\n    return profile;\n  }\n\n  async upsertProfile(profileData: InsertProfile): Promise<Profile> {\n    const existing = await this.getProfile(profileData.userId);\n    \n    // Calculate completion percentage based on filled fields\n    const completion = this.calculateProfileCompletion(profileData);\n    const dataWithCompletion = { ...profileData, completionPercentage: completion };\n    \n    if (existing) {\n      const [profile] = await db\n        .update(profiles)\n        .set({ ...dataWithCompletion, updatedAt: new Date() })\n        .where(eq(profiles.userId, profileData.userId))\n        .returning();\n      return profile;\n    } else {\n      const [profile] = await db\n        .insert(profiles)\n        .values(dataWithCompletion)\n        .returning();\n      return profile;\n    }\n  }\n\n  private calculateProfileCompletion(profileData: any): number {\n    // Core sections with different weights\n    const sections = {\n      // Basic Information (30% weight)\n      basicInfo: {\n        weight: 30,\n        fields: [\n          profileData.profession,\n          profileData.registrationNumber,\n          profileData.email,\n          profileData.phone,\n          profileData.city,\n          profileData.country,\n          profileData.yearsExperience,\n          profileData.visaStatus,\n        ]\n      },\n      // Skills (20% weight)\n      skills: {\n        weight: 20,\n        filled: profileData.skills && profileData.skills.length > 0,\n      },\n      // Work Experience (25% weight)\n      workExperience: {\n        weight: 25,\n        filled: profileData.workExperience && profileData.workExperience.length > 0,\n      },\n      // Education (15% weight)\n      education: {\n        weight: 15,\n        filled: profileData.education && profileData.education.length > 0,\n      },\n      // Courses (10% weight)\n      courses: {\n        weight: 10,\n        filled: profileData.courses && profileData.courses.length > 0,\n      }\n    };\n\n    let totalScore = 0;\n\n    // Calculate basic info score\n    const filledBasicFields = sections.basicInfo.fields.filter(\n      field => field !== null && field !== undefined && field !== ''\n    ).length;\n    const basicInfoScore = (filledBasicFields / sections.basicInfo.fields.length) * sections.basicInfo.weight;\n    totalScore += basicInfoScore;\n\n    // Add scores for other sections\n    if (sections.skills.filled) totalScore += sections.skills.weight;\n    if (sections.workExperience.filled) totalScore += sections.workExperience.weight;\n    if (sections.education.filled) totalScore += sections.education.weight;\n    if (sections.courses.filled) totalScore += sections.courses.weight;\n\n    return Math.round(totalScore);\n  }\n\n  async getApplications(userId: string): Promise<Application[]> {\n    return await db\n      .select()\n      .from(applications)\n      .where(eq(applications.userId, userId))\n      .orderBy(desc(applications.createdAt));\n  }\n\n  async createApplication(applicationData: InsertApplication): Promise<Application> {\n    const [application] = await db\n      .insert(applications)\n      .values(applicationData)\n      .returning();\n    return application;\n  }\n\n  async updateApplication(id: string, updates: Partial<Application>): Promise<Application> {\n    const [application] = await db\n      .update(applications)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(applications.id, id))\n      .returning();\n    return application;\n  }\n\n  async updateApplicationNotes(id: string, userId: string, notes: string): Promise<Application> {\n    const [application] = await db\n      .update(applications)\n      .set({ notes: notes || null, updatedAt: new Date() })\n      .where(and(eq(applications.id, id), eq(applications.userId, userId)))\n      .returning();\n    if (!application) {\n      throw new Error(\"Application not found or not authorized\");\n    }\n    return application;\n  }\n\n  async getInterviewSessions(userId: string): Promise<InterviewSession[]> {\n    return await db\n      .select()\n      .from(interviewSessions)\n      .where(eq(interviewSessions.userId, userId))\n      .orderBy(desc(interviewSessions.createdAt));\n  }\n\n  async createInterviewSession(sessionData: InsertInterviewSession): Promise<InterviewSession> {\n    const [session] = await db\n      .insert(interviewSessions)\n      .values(sessionData)\n      .returning();\n    return session;\n  }\n\n  async getLatestInterviewScore(userId: string): Promise<number | undefined> {\n    const [session] = await db\n      .select()\n      .from(interviewSessions)\n      .where(eq(interviewSessions.userId, userId))\n      .orderBy(desc(interviewSessions.createdAt))\n      .limit(1);\n    return session?.score || undefined;\n  }\n\n  async saveInterviewAttempt(attemptData: InsertInterviewAttempt): Promise<InterviewAttempt> {\n    const [attempt] = await db\n      .insert(interviewAttempts)\n      .values(attemptData)\n      .returning();\n    return attempt;\n  }\n\n  async getLastInterviewAttempts(userId: string, limit: number = 3): Promise<InterviewAttempt[]> {\n    return await db\n      .select()\n      .from(interviewAttempts)\n      .where(eq(interviewAttempts.userId, userId))\n      .orderBy(desc(interviewAttempts.createdAt))\n      .limit(limit);\n  }\n\n  async getDocuments(userId: string): Promise<Document[]> {\n    return await db\n      .select()\n      .from(documents)\n      .where(and(eq(documents.userId, userId), eq(documents.isActive, true)))\n      .orderBy(desc(documents.createdAt));\n  }\n\n  async createDocument(documentData: InsertDocument): Promise<Document> {\n    const [document] = await db\n      .insert(documents)\n      .values(documentData)\n      .returning();\n    return document;\n  }\n\n  async getLatestDocument(userId: string, type: string): Promise<Document | undefined> {\n    const [document] = await db\n      .select()\n      .from(documents)\n      .where(\n        and(\n          eq(documents.userId, userId),\n          eq(documents.type, type),\n          eq(documents.isActive, true)\n        )\n      )\n      .orderBy(desc(documents.createdAt))\n      .limit(1);\n    return document;\n  }\n\n  // STAR examples operations\n  async getStarExamples(userId: string): Promise<StarExample[]> {\n    return await db\n      .select()\n      .from(starExamples)\n      .where(eq(starExamples.userId, userId))\n      .orderBy(desc(starExamples.createdAt));\n  }\n\n  async createStarExample(exampleData: InsertStarExample): Promise<StarExample> {\n    const [example] = await db\n      .insert(starExamples)\n      .values(exampleData)\n      .returning();\n    return example;\n  }\n\n  async updateStarExample(id: string, updates: Partial<StarExample>): Promise<StarExample> {\n    const [example] = await db\n      .update(starExamples)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(starExamples.id, id))\n      .returning();\n    return example;\n  }\n\n  async deleteStarExample(id: string): Promise<void> {\n    await db.delete(starExamples).where(eq(starExamples.id, id));\n  }\n\n  // NHS Jobs operations\n  async getNhsJobs(filters?: any): Promise<NhsJob[]> {\n    const conditions = [eq(nhsJobs.isActive, true)];\n    \n    if (filters?.band) {\n      conditions.push(eq(nhsJobs.band, filters.band));\n    }\n    if (filters?.location) {\n      conditions.push(like(nhsJobs.location, `%${filters.location}%`));\n    }\n    if (filters?.visaSponsorship) {\n      conditions.push(eq(nhsJobs.visaSponsorship, true));\n    }\n    \n    return await db\n      .select()\n      .from(nhsJobs)\n      .where(and(...conditions))\n      .orderBy(desc(nhsJobs.createdAt))\n      .limit(50);\n  }\n\n  async createNhsJob(jobData: InsertNhsJob): Promise<NhsJob> {\n    const [job] = await db\n      .insert(nhsJobs)\n      .values(jobData)\n      .returning();\n    return job;\n  }\n\n  async updateNhsJob(id: string, updates: Partial<NhsJob>): Promise<NhsJob> {\n    const [job] = await db\n      .update(nhsJobs)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(nhsJobs.id, id))\n      .returning();\n    return job;\n  }\n\n  async getFeaturedJobs(): Promise<NhsJob[]> {\n    return await db\n      .select()\n      .from(nhsJobs)\n      .where(and(eq(nhsJobs.isActive, true), eq(nhsJobs.featured, true)))\n      .orderBy(desc(nhsJobs.createdAt))\n      .limit(10);\n  }\n\n  async searchJobs(query: string, filters?: any): Promise<NhsJob[]> {\n    const conditions = [\n      eq(nhsJobs.isActive, true),\n      or(\n        like(nhsJobs.title, `%${query}%`),\n        like(nhsJobs.description, `%${query}%`),\n        like(nhsJobs.employer, `%${query}%`)\n      )\n    ];\n\n    if (filters?.band) {\n      conditions.push(eq(nhsJobs.band, filters.band));\n    }\n\n    return await db\n      .select()\n      .from(nhsJobs)\n      .where(and(...conditions))\n      .orderBy(desc(nhsJobs.createdAt))\n      .limit(50);\n  }\n\n  // Job matching operations\n  async getJobMatches(userId: string): Promise<JobMatch[]> {\n    return await db\n      .select()\n      .from(jobMatches)\n      .where(eq(jobMatches.userId, userId))\n      .orderBy(desc(jobMatches.fitScore));\n  }\n\n  async createJobMatch(matchData: InsertJobMatch): Promise<JobMatch> {\n    const [match] = await db\n      .insert(jobMatches)\n      .values(matchData)\n      .returning();\n    return match;\n  }\n\n  async getJobMatchScore(userId: string, jobId: string): Promise<number | undefined> {\n    const [match] = await db\n      .select()\n      .from(jobMatches)\n      .where(and(eq(jobMatches.userId, userId), eq(jobMatches.jobId, jobId)))\n      .limit(1);\n    return match?.fitScore || undefined;\n  }\n\n  // File operations\n  async getUserFiles(userId: string): Promise<UserFile[]> {\n    return await db\n      .select()\n      .from(userFiles)\n      .where(eq(userFiles.userId, userId))\n      .orderBy(desc(userFiles.uploadedAt));\n  }\n\n  async createUserFile(fileData: InsertUserFile): Promise<UserFile> {\n    const [file] = await db\n      .insert(userFiles)\n      .values(fileData)\n      .returning();\n    return file;\n  }\n\n  async deleteUserFile(id: string): Promise<void> {\n    await db.delete(userFiles).where(eq(userFiles.id, id));\n  }\n\n  // Values assessment operations\n  async getValuesAssessment(userId: string): Promise<ValuesAssessment | undefined> {\n    const [assessment] = await db\n      .select()\n      .from(valuesAssessment)\n      .where(eq(valuesAssessment.userId, userId))\n      .orderBy(desc(valuesAssessment.completedAt))\n      .limit(1);\n    return assessment;\n  }\n\n  async createValuesAssessment(assessmentData: InsertValuesAssessment): Promise<ValuesAssessment> {\n    const [assessment] = await db\n      .insert(valuesAssessment)\n      .values(assessmentData)\n      .returning();\n    return assessment;\n  }\n\n  // Interview questions operations\n  async getInterviewQuestions(category?: string, difficulty?: string): Promise<InterviewQuestion[]> {\n    const conditions = [];\n    if (category) conditions.push(eq(interviewQuestions.category, category));\n    if (difficulty) conditions.push(eq(interviewQuestions.difficulty, difficulty));\n    \n    if (conditions.length > 0) {\n      return await db\n        .select()\n        .from(interviewQuestions)\n        .where(and(...conditions))\n        .orderBy(desc(interviewQuestions.createdAt));\n    } else {\n      return await db\n        .select()\n        .from(interviewQuestions)\n        .orderBy(desc(interviewQuestions.createdAt));\n    }\n  }\n\n  async createInterviewQuestion(questionData: InsertInterviewQuestion): Promise<InterviewQuestion> {\n    const [question] = await db\n      .insert(interviewQuestions)\n      .values(questionData)\n      .returning();\n    return question;\n  }\n\n  // AI prompts operations (admin only)\n  async getActivePrompt(name: string): Promise<AiPrompt | undefined> {\n    const [prompt] = await db\n      .select()\n      .from(aiPrompts)\n      .where(and(eq(aiPrompts.name, name), eq(aiPrompts.isActive, true)))\n      .orderBy(desc(aiPrompts.createdAt))\n      .limit(1);\n    return prompt;\n  }\n\n  async createAiPrompt(promptData: InsertAiPrompt): Promise<AiPrompt> {\n    const [prompt] = await db\n      .insert(aiPrompts)\n      .values(promptData)\n      .returning();\n    return prompt;\n  }\n\n  async updateAiPrompt(promptKey: string, updates: Partial<AiPrompt>, editedBy: string): Promise<AiPrompt> {\n    const [prompt] = await db\n      .update(aiPrompts)\n      .set({ ...updates, lastEditedBy: editedBy, updatedAt: new Date() })\n      .where(eq(aiPrompts.promptKey, promptKey))\n      .returning();\n    return prompt;\n  }\n\n  async getAllPrompts(): Promise<AiPrompt[]> {\n    return await db\n      .select()\n      .from(aiPrompts)\n      .orderBy(desc(aiPrompts.createdAt));\n  }\n\n  // Admin operations\n  async makeUserAdmin(userId: string, adminRole: string, createdBy?: string): Promise<User> {\n    const [user] = await db\n      .update(users)\n      .set({ \n        isAdmin: true,\n        adminRole,\n        adminCreatedBy: createdBy,\n        adminCreatedAt: new Date(),\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return user;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return await db\n      .select()\n      .from(users)\n      .orderBy(desc(users.createdAt));\n  }\n\n  async deleteUser(userId: string): Promise<void> {\n    // Delete user data in proper order to maintain referential integrity\n    await db.transaction(async (tx) => {\n      // Delete related records first\n      await tx.delete(userActivity).where(eq(userActivity.userId, userId));\n      await tx.delete(applications).where(eq(applications.userId, userId));\n      await tx.delete(documents).where(eq(documents.userId, userId));\n      await tx.delete(starExamples).where(eq(starExamples.userId, userId));\n      await tx.delete(interviewSessions).where(eq(interviewSessions.userId, userId));\n      await tx.delete(profiles).where(eq(profiles.userId, userId));\n      \n      // Finally delete the user\n      await tx.delete(users).where(eq(users.id, userId));\n    });\n  }\n\n  async suspendUser(userId: string, reason?: string, suspendedBy?: string): Promise<User> {\n    const [user] = await db\n      .update(users)\n      .set({ \n        subscriptionStatus: 'suspended',\n        suspendedBy,\n        suspendedAt: new Date(),\n        suspensionReason: reason,\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return user;\n  }\n\n  async updateUserByAdmin(userId: string, updates: Partial<User>, updatedBy: string): Promise<User> {\n    const [user] = await db\n      .update(users)\n      .set({ \n        ...updates,\n        adminUpdatedBy: updatedBy,\n        adminUpdatedAt: new Date(),\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return user;\n  }\n\n  async getSystemHealth(): Promise<any> {\n    try {\n      // Check database connectivity\n      const dbTest = await db.select({ count: sql`count(*)` }).from(users);\n      const dbStatus = dbTest ? 'healthy' : 'error';\n      \n      // Get error count from last 24 hours (if we had error logs table)\n      const errorCount = 0; // Placeholder\n      \n      // Calculate uptime (simplified)\n      const uptimeMs = process.uptime() * 1000;\n      const hours = Math.floor(uptimeMs / (1000 * 60 * 60));\n      const minutes = Math.floor((uptimeMs % (1000 * 60 * 60)) / (1000 * 60));\n      const uptime = `${hours}h ${minutes}m`;\n      \n      return {\n        dbStatus,\n        aiServiceStatus: 'healthy', // We'd check Gemini API if needed\n        paymentServiceStatus: 'healthy', // We'd check Stripe if needed  \n        errorCount,\n        avgResponseTime: 150, // Placeholder - would calculate from logs\n        uptime\n      };\n    } catch (error) {\n      console.error('System health check error:', error);\n      return {\n        dbStatus: 'error',\n        aiServiceStatus: 'unknown',\n        paymentServiceStatus: 'unknown',\n        errorCount: 1,\n        avgResponseTime: 0,\n        uptime: '0h 0m'\n      };\n    }\n  }\n\n  async getUserStats(): Promise<any> {\n    const totalUsers = await db\n      .select({ count: sql`count(*)` })\n      .from(users);\n    \n    const activeUsers = await db\n      .select({ count: sql`count(*)` })\n      .from(users);\n      \n    const paidUsers = await db\n      .select({ count: sql`count(*)` })\n      .from(users)\n      .where(eq(users.subscriptionStatus, 'paid'));\n\n    return {\n      totalUsers: totalUsers[0]?.count || 0,\n      activeUsers: activeUsers[0]?.count || 0,\n      paidUsers: paidUsers[0]?.count || 0,\n    };\n  }\n  \n  // User activity tracking\n  async logUserActivity(activity: InsertUserActivity): Promise<UserActivity> {\n    const [userActivityRecord] = await db\n      .insert(userActivity)\n      .values(activity)\n      .returning();\n    return userActivityRecord;\n  }\n\n  async getUserActivity(userId: string, limit: number = 50): Promise<UserActivity[]> {\n    return await db\n      .select()\n      .from(userActivity)\n      .where(eq(userActivity.userId, userId))\n      .orderBy(desc(userActivity.createdAt))\n      .limit(limit);\n  }\n\n  async getActivityStats(days: number = 7): Promise<any> {\n    const startDate = sql`NOW() - INTERVAL '${days} days'`;\n    \n    const loginCount = await db\n      .select({ count: sql`count(*)` })\n      .from(userActivity)\n      .where(and(\n        eq(userActivity.activityType, 'login'),\n        sql`created_at > ${startDate}`\n      ));\n      \n    const jobSearchCount = await db\n      .select({ count: sql`count(*)` })\n      .from(userActivity)\n      .where(and(\n        eq(userActivity.activityType, 'job_search'),\n        sql`created_at > ${startDate}`\n      ));\n      \n    const applicationsSent = await db\n      .select({ count: sql`count(*)` })\n      .from(userActivity)\n      .where(and(\n        eq(userActivity.activityType, 'application_sent'),\n        sql`created_at > ${startDate}`\n      ));\n\n    return {\n      logins: loginCount[0]?.count || 0,\n      jobSearches: jobSearchCount[0]?.count || 0,\n      applicationsSent: applicationsSent[0]?.count || 0,\n    };\n  }\n  \n  // News management\n  async getNewsArticles(): Promise<NewsArticle[]> {\n    return await db\n      .select()\n      .from(newsArticles)\n      .where(eq(newsArticles.isPublished, true))\n      .orderBy(desc(newsArticles.publishedAt));\n  }\n\n  async createNewsArticle(article: InsertNewsArticle): Promise<NewsArticle> {\n    const [newsArticle] = await db\n      .insert(newsArticles)\n      .values(article)\n      .returning();\n    return newsArticle;\n  }\n\n  async updateNewsArticle(id: string, updates: Partial<NewsArticle>): Promise<NewsArticle> {\n    const [newsArticle] = await db\n      .update(newsArticles)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(newsArticles.id, id))\n      .returning();\n    return newsArticle;\n  }\n\n  async deleteNewsArticle(id: string): Promise<void> {\n    await db\n      .delete(newsArticles)\n      .where(eq(newsArticles.id, id));\n  }\n\n  // GDPR Compliance implementations\n  async recordConsent(consent: InsertGdprConsent): Promise<GdprConsent> {\n    const [gdprConsent] = await db\n      .insert(gdprConsents)\n      .values(consent)\n      .returning();\n    return gdprConsent;\n  }\n\n  async getUserConsents(userId: string): Promise<GdprConsent[]> {\n    return await db\n      .select()\n      .from(gdprConsents)\n      .where(eq(gdprConsents.userId, userId))\n      .orderBy(desc(gdprConsents.consentDate));\n  }\n\n  async updateConsent(userId: string, consentType: string, consentGiven: boolean, ipAddress?: string, userAgent?: string): Promise<GdprConsent> {\n    // First, mark the previous consent as withdrawn if consent is being withdrawn\n    if (!consentGiven) {\n      await db\n        .update(gdprConsents)\n        .set({ consentWithdrawnDate: new Date() })\n        .where(and(\n          eq(gdprConsents.userId, userId),\n          eq(gdprConsents.consentType, consentType),\n          eq(gdprConsents.consentGiven, true)\n        ));\n    }\n\n    // Create new consent record\n    const [consent] = await db\n      .insert(gdprConsents)\n      .values({\n        userId,\n        consentType,\n        consentGiven,\n        legalBasis: consentGiven ? 'consent' : 'consent',\n        ipAddress,\n        userAgent,\n        consentVersion: '1.0'\n      })\n      .returning();\n    \n    return consent;\n  }\n\n  async withdrawConsent(userId: string, consentType: string, ipAddress?: string, userAgent?: string): Promise<GdprConsent> {\n    return this.updateConsent(userId, consentType, false, ipAddress, userAgent);\n  }\n\n  async createDataSubjectRequest(request: InsertDataSubjectRequest): Promise<DataSubjectRequest> {\n    const [dataRequest] = await db\n      .insert(dataSubjectRequests)\n      .values(request)\n      .returning();\n    return dataRequest;\n  }\n\n  async getDataSubjectRequests(userId: string): Promise<DataSubjectRequest[]> {\n    return await db\n      .select()\n      .from(dataSubjectRequests)\n      .where(eq(dataSubjectRequests.userId, userId))\n      .orderBy(desc(dataSubjectRequests.submittedDate));\n  }\n\n  async getAllDataSubjectRequests(): Promise<any[]> {\n    return await db\n      .select({\n        id: dataSubjectRequests.id,\n        userId: dataSubjectRequests.userId,\n        userEmail: users.email,\n        userName: sql<string>`COALESCE(${users.firstName} || ' ' || ${users.lastName}, 'Unknown User')`,\n        requestType: dataSubjectRequests.requestType,\n        requestDetails: dataSubjectRequests.requestDetails,\n        status: dataSubjectRequests.status,\n        submittedDate: dataSubjectRequests.submittedDate,\n        completedDate: dataSubjectRequests.completedDate,\n        adminNotes: dataSubjectRequests.adminNotes,\n        referenceId: dataSubjectRequests.referenceId,\n        verificationMethod: dataSubjectRequests.verificationMethod\n      })\n      .from(dataSubjectRequests)\n      .leftJoin(users, eq(dataSubjectRequests.userId, users.id))\n      .orderBy(desc(dataSubjectRequests.submittedDate));\n  }\n\n  async updateDataSubjectRequestStatus(\n    requestId: string, \n    status: string, \n    adminNotes?: string, \n    adminUserId?: string\n  ): Promise<DataSubjectRequest> {\n    const [updated] = await db\n      .update(dataSubjectRequests)\n      .set({\n        status,\n        adminNotes,\n        completedDate: status === 'completed' ? new Date() : undefined,\n        adminUpdatedBy: adminUserId,\n        adminUpdatedAt: new Date()\n      })\n      .where(eq(dataSubjectRequests.id, requestId))\n      .returning();\n    return updated;\n  }\n\n  async updateDataSubjectRequest(id: string, updates: Partial<DataSubjectRequest>): Promise<DataSubjectRequest> {\n    const [request] = await db\n      .update(dataSubjectRequests)\n      .set(updates)\n      .where(eq(dataSubjectRequests.id, id))\n      .returning();\n    return request;\n  }\n\n  async getAllDataSubjectRequests(): Promise<DataSubjectRequest[]> {\n    return await db\n      .select()\n      .from(dataSubjectRequests)\n      .orderBy(desc(dataSubjectRequests.submittedDate));\n  }\n\n  async logDataAccess(log: InsertDataAccessLog): Promise<DataAccessLog> {\n    const [accessLog] = await db\n      .insert(dataAccessLogs)\n      .values(log)\n      .returning();\n    return accessLog;\n  }\n\n  async getDataAccessLogs(userId: string): Promise<DataAccessLog[]> {\n    return await db\n      .select()\n      .from(dataAccessLogs)\n      .where(eq(dataAccessLogs.userId, userId))\n      .orderBy(desc(dataAccessLogs.timestamp));\n  }\n\n  async getUserDataExport(userId: string): Promise<any> {\n    // Comprehensive data export for GDPR requests - optimized with parallel queries\n    const [\n      user,\n      profile, \n      applications,\n      documents,\n      starExamples,\n      interviewSessions,\n      consents,\n      dataRequests,\n      accessLogs,\n      userFiles,\n      activity\n    ] = await Promise.all([\n      this.getUser(userId),\n      this.getProfile(userId),\n      this.getApplications(userId),\n      this.getDocuments(userId),\n      this.getStarExamples(userId),\n      this.getInterviewSessions(userId),\n      this.getUserConsents(userId),\n      this.getDataSubjectRequests(userId),\n      this.getDataAccessLogs(userId),\n      this.getUserFiles(userId),\n      this.getUserActivity(userId)\n    ]);\n\n    return {\n      exportDate: new Date().toISOString(),\n      personalInformation: {\n        user,\n        profile,\n        consents: consents.map(c => ({\n          consentType: c.consentType,\n          consentGiven: c.consentGiven,\n          consentDate: c.consentDate,\n          consentWithdrawnDate: c.consentWithdrawnDate,\n          legalBasis: c.legalBasis\n        }))\n      },\n      applicationData: applications,\n      documents: documents.map(d => ({\n        type: d.type,\n        title: d.title,\n        version: d.version,\n        createdAt: d.createdAt,\n        updatedAt: d.updatedAt\n      })),\n      starExamples,\n      interviewData: interviewSessions,\n      userFiles: userFiles.map(f => ({\n        fileName: f.fileName,\n        fileType: f.fileType,\n        uploadedAt: f.uploadedAt\n      })),\n      gdprRequests: dataRequests,\n      accessHistory: accessLogs,\n      activityHistory: activity,\n      dataProcessingInfo: {\n        purposes: ['Job matching', 'CV generation', 'Interview practice', 'Application tracking'],\n        legalBasis: 'Consent and legitimate interest',\n        retention: 'Data retained for 7 years or until account deletion',\n        thirdPartySharing: 'No data shared with third parties without consent'\n      }\n    };\n  }\n\n  async anonymizeUserData(userId: string): Promise<void> {\n    // Anonymize sensitive data while preserving statistical data\n    await db.transaction(async (tx) => {\n      // Anonymize user record\n      await tx\n        .update(users)\n        .set({\n          email: `anonymized_${userId}@deleted.local`,\n          firstName: 'Deleted',\n          lastName: 'User',\n          profileImageUrl: null,\n          updatedAt: new Date()\n        })\n        .where(eq(users.id, userId));\n\n      // Anonymize profile\n      await tx\n        .update(profiles)\n        .set({\n          email: `anonymized_${userId}@deleted.local`,\n          phone: null,\n          registrationNumber: null,\n          updatedAt: new Date()\n        })\n        .where(eq(profiles.userId, userId));\n\n      // Remove documents content but keep metadata for statistics\n      await tx\n        .update(documents)\n        .set({\n          content: null,\n          title: 'Deleted Document',\n          updatedAt: new Date()\n        })\n        .where(eq(documents.userId, userId));\n\n      // Remove STAR examples content\n      await tx\n        .update(starExamples)\n        .set({\n          title: 'Deleted Example',\n          situation: 'Content deleted',\n          task: 'Content deleted',\n          action: 'Content deleted',\n          result: 'Content deleted',\n          updatedAt: new Date()\n        })\n        .where(eq(starExamples.userId, userId));\n    });\n  }\n\n  async deleteUserData(userId: string): Promise<void> {\n    // Complete data deletion for erasure requests\n    await db.transaction(async (tx) => {\n      // Delete in order to respect foreign key constraints\n      await tx.delete(dataAccessLogs).where(eq(dataAccessLogs.userId, userId));\n      await tx.delete(dataSubjectRequests).where(eq(dataSubjectRequests.userId, userId));\n      await tx.delete(gdprConsents).where(eq(gdprConsents.userId, userId));\n      await tx.delete(userActivity).where(eq(userActivity.userId, userId));\n      await tx.delete(userFiles).where(eq(userFiles.userId, userId));\n      await tx.delete(jobMatches).where(eq(jobMatches.userId, userId));\n      await tx.delete(starExamples).where(eq(starExamples.userId, userId));\n      await tx.delete(documents).where(eq(documents.userId, userId));\n      await tx.delete(interviewSessions).where(eq(interviewSessions.userId, userId));\n      await tx.delete(applications).where(eq(applications.userId, userId));\n      await tx.delete(profiles).where(eq(profiles.userId, userId));\n      await tx.delete(users).where(eq(users.id, userId));\n    });\n  }\n\n  // Additional Admin Methods\n  async getSystemAnalytics(): Promise<any> {\n    const today = new Date();\n    const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);\n    \n    const totalUsers = await db.select({ count: sql`count(*)` }).from(users);\n    const paidUsers = await db.select({ count: sql`count(*)` }).from(users).where(eq(users.subscriptionStatus, 'paid'));\n    const freeUsers = await db.select({ count: sql`count(*)` }).from(users).where(eq(users.subscriptionStatus, 'free'));\n    const recentUsers = await db.select({ count: sql`count(*)` }).from(users).where(sql`created_at > ${thirtyDaysAgo}`);\n    const totalApplications = await db.select({ count: sql`count(*)` }).from(applications);\n    const totalInterviews = await db.select({ count: sql`count(*)` }).from(interviewSessions);\n    \n    return {\n      totalUsers: totalUsers[0]?.count || 0,\n      freeUsers: freeUsers[0]?.count || 0,  \n      premiumUsers: paidUsers[0]?.count || 0,\n      newSignups: recentUsers[0]?.count || 0,\n      totalApplications: totalApplications[0]?.count || 0,\n      totalInterviewSessions: totalInterviews[0]?.count || 0,\n      lastUpdated: new Date()\n    };\n  }\n\n  async createAdminActivityLog(logData: any): Promise<any> {\n    const [log] = await db.insert(adminActivityLogs).values(logData).returning();\n    return log;\n  }\n\n  async getAdminContent(contentKey?: string): Promise<any> {\n    if (contentKey) {\n      const [content] = await db.select().from(adminContent).where(eq(adminContent.contentKey, contentKey));\n      return content;\n    }\n    return await db.select().from(adminContent).orderBy(adminContent.title);\n  }\n\n  async updateAdminContent(contentKey: string, contentData: any, editedBy: string): Promise<any> {\n    const [content] = await db\n      .update(adminContent)\n      .set({ ...contentData, lastEditedBy: editedBy, updatedAt: new Date() })\n      .where(eq(adminContent.contentKey, contentKey))\n      .returning();\n    return content;\n  }\n\n  async getAiPrompts(category?: string): Promise<any> {\n    const query = db.select().from(aiPrompts);\n    if (category && category !== 'all') {\n      return await query.where(eq(aiPrompts.category, category)).orderBy(aiPrompts.name);\n    }\n    return await query.orderBy(aiPrompts.category, aiPrompts.name);\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":39312},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"shared/schema.ts":{"content":"import { sql } from 'drizzle-orm';\nimport {\n  index,\n  jsonb,\n  pgTable,\n  text,\n  timestamp,\n  varchar,\n  integer,\n  boolean,\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table - required for Replit Auth\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// User storage table - required for Replit Auth\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  // Payment-related columns\n  subscriptionStatus: varchar(\"subscription_status\").default(\"free\"), // 'free' | 'paid'\n  stripeCustomerId: varchar(\"stripe_customer_id\"),\n  paymentDate: timestamp(\"payment_date\"),\n  freeTierLimits: jsonb(\"free_tier_limits\").default(sql`'{\"jobs_viewed_today\": 0, \"last_reset\": \"2024-01-01\"}'`),\n  // Dashboard customization\n  dashboardCardOrder: text(\"dashboard_card_order\").array().default(sql`'{\"profile\",\"jobs\",\"documents\",\"resources\",\"practice\",\"qa\",\"tracker\",\"news\"}'`),\n  // Admin role - Two-tier system\n  isAdmin: boolean(\"is_admin\").default(false),\n  adminRole: varchar(\"admin_role\"), // 'master_admin', 'secondary_admin'\n  adminCreatedBy: varchar(\"admin_created_by\"), // Reference to who created this admin\n  adminCreatedAt: timestamp(\"admin_created_at\"),\n  // Onboarding tracking\n  hasCompletedOnboarding: boolean(\"has_completed_onboarding\").default(false),\n  hasCompletedPremiumOnboarding: boolean(\"has_completed_premium_onboarding\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Healthcare professional profiles\nexport const profiles = pgTable(\"profiles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  // Basic Information\n  profession: text(\"profession\"), // Free text input for any profession\n  registrationNumber: varchar(\"registration_number\"), // GMC/NMC/HCPC numbers\n  specialties: text(\"specialties\").array(), // areas of expertise\n  yearsExperience: integer(\"years_experience\"),\n  visaStatus: varchar(\"visa_status\"),\n  // Contact Information\n  email: varchar(\"email\"),\n  phone: varchar(\"phone\"),\n  city: varchar(\"city\"),\n  country: varchar(\"country\"),\n  // Skills (7 main skills)\n  skills: text(\"skills\").array(),\n  // Work Experience (JSON array of experience objects)\n  workExperience: jsonb(\"work_experience\"),\n  // Education (JSON array of education objects) \n  education: jsonb(\"education\"),\n  // Courses & Certifications (JSON array of course objects)\n  courses: jsonb(\"courses\"),\n  // Completion tracking\n  completionPercentage: integer(\"completion_percentage\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Job applications tracking\nexport const applications = pgTable(\"applications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  jobTitle: varchar(\"job_title\").notNull(),\n  employer: varchar(\"employer\").notNull(),\n  location: varchar(\"location\"),\n  salary: varchar(\"salary\"),\n  status: varchar(\"status\").notNull().default(\"draft\"), // draft, applied, interview, offered, rejected\n  appliedAt: timestamp(\"applied_at\"),\n  interviewDate: timestamp(\"interview_date\"),\n  notes: text(\"notes\"), // Personal notes for this application\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Interview practice sessions (keeping original structure)\nexport const interviewSessions = pgTable(\"interview_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  score: integer(\"score\"), // out of 10\n  duration: integer(\"duration\"), // in minutes\n  feedback: text(\"feedback\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Individual interview responses within sessions (new table)\nexport const interviewResponses = pgTable(\"interview_responses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sessionId: varchar(\"session_id\").references(() => interviewSessions.id).notNull(),\n  questionId: varchar(\"question_id\").references(() => interviewQuestions.id).notNull(),\n  response: text(\"response\"), // user's written response\n  score: integer(\"score\"), // out of 10\n  feedback: text(\"feedback\"), // Henry's feedback on this specific response\n  timeSpent: integer(\"time_spent\"), // seconds spent on this question\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// User documents (CVs, Supporting Information)\nexport const documents = pgTable(\"documents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  type: varchar(\"type\").notNull(), // cv, supporting_info, cover_letter\n  title: varchar(\"title\").notNull(),\n  content: text(\"content\"),\n  version: varchar(\"version\").default(\"1.0\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// STAR examples for reusable content\nexport const starExamples = pgTable(\"star_examples\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  title: varchar(\"title\").notNull(),\n  situation: text(\"situation\").notNull(),\n  task: text(\"task\").notNull(),\n  action: text(\"action\").notNull(),\n  result: text(\"result\").notNull(),\n  category: varchar(\"category\"), // e.g., \"leadership\", \"clinical_care\", \"teamwork\"\n  nhsValue: varchar(\"nhs_value\"), // which NHS value this demonstrates\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// NHS Jobs for discovery and matching\nexport const nhsJobs = pgTable(\"nhs_jobs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  externalId: varchar(\"external_id\").unique(), // from NHS Jobs API\n  title: varchar(\"title\").notNull(),\n  employer: varchar(\"employer\").notNull(),\n  location: varchar(\"location\"),\n  band: varchar(\"band\"), // NHS pay band\n  salaryMin: integer(\"salary_min\"),\n  salaryMax: integer(\"salary_max\"),\n  description: text(\"description\"),\n  personSpec: text(\"person_spec\"),\n  closingDate: timestamp(\"closing_date\"),\n  isActive: boolean(\"is_active\").default(true),\n  featured: boolean(\"featured\").default(false),\n  visaSponsorship: boolean(\"visa_sponsorship\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Job matches and scoring\nexport const jobMatches = pgTable(\"job_matches\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  jobId: varchar(\"job_id\").references(() => nhsJobs.id).notNull(),\n  fitScore: integer(\"fit_score\"), // 0-100 match percentage\n  skillsMatch: jsonb(\"skills_match\"), // detailed breakdown\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// File uploads for certificates, existing CVs, etc.\nexport const userFiles = pgTable(\"user_files\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  fileName: varchar(\"file_name\").notNull(),\n  fileType: varchar(\"file_type\").notNull(), // cv, certificate, qualification\n  filePath: varchar(\"file_path\").notNull(),\n  fileSize: integer(\"file_size\"),\n  uploadedAt: timestamp(\"uploaded_at\").defaultNow(),\n});\n\n// NHS Values Assessment\nexport const valuesAssessment = pgTable(\"values_assessment\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  compassionScore: integer(\"compassion_score\"),\n  respectScore: integer(\"respect_score\"),\n  dignityScore: integer(\"dignity_score\"),\n  commitmentScore: integer(\"commitment_score\"),\n  qualityScore: integer(\"quality_score\"),\n  integrityScore: integer(\"integrity_score\"),\n  overallScore: integer(\"overall_score\"),\n  completedAt: timestamp(\"completed_at\").defaultNow(),\n});\n\n// Enhanced Interview Q&A Bank\nexport const interviewQuestions = pgTable(\"interview_questions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  category: varchar(\"category\").notNull(), // clinical, behavioral, nhs_values, general\n  difficulty: varchar(\"difficulty\").notNull(), // junior, senior, specialist\n  question: text(\"question\").notNull(),\n  suggestedAnswer: text(\"suggested_answer\"),\n  tags: text(\"tags\").array(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Q&A Generator Sessions - Flashcard-style study system\nexport const qaSessions = pgTable(\"qa_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  jobDescription: text(\"job_description\").notNull(),\n  jobTitle: varchar(\"job_title\", { length: 255 }),\n  totalQuestions: integer(\"total_questions\").default(25),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\n// Generated Q&A Questions for flashcard sessions\nexport const qaQuestions = pgTable(\"qa_questions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sessionId: varchar(\"session_id\").references(() => qaSessions.id, { onDelete: 'cascade' }).notNull(),\n  questionText: text(\"question_text\").notNull(),\n  modelAnswer: text(\"model_answer\").notNull(),\n  category: varchar(\"category\", { length: 100 }),\n  questionOrder: integer(\"question_order\").notNull(),\n});\n\n// User Progress Tracking for Q&A sessions - spaced repetition\nexport const qaProgress = pgTable(\"qa_progress\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sessionId: varchar(\"session_id\").references(() => qaSessions.id, { onDelete: 'cascade' }).notNull(),\n  questionId: varchar(\"question_id\").references(() => qaQuestions.id, { onDelete: 'cascade' }).notNull(),\n  confidenceLevel: integer(\"confidence_level\").notNull(), // 1=not confident, 2=somewhat confident, 3=confident\n  attempts: integer(\"attempts\").default(1),\n  lastReviewed: timestamp(\"last_reviewed\").defaultNow(),\n});\n\n// Interview practice attempts - stores individual attempts for history\nexport const interviewAttempts = pgTable(\"interview_attempts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  question: text(\"question\").notNull(),\n  answer: text(\"answer\").notNull(),\n  feedback: text(\"feedback\").notNull(),\n  timeSpent: integer(\"time_spent\"), // time in seconds\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Admin users for platform management\nexport const adminUsers = pgTable(\"admin_users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique().notNull(),\n  role: varchar(\"role\").notNull(), // super_admin, content_admin, support_admin\n  permissions: jsonb(\"permissions\"), // detailed permissions object\n  lastLogin: timestamp(\"last_login\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Hidden AI prompts (not exposed to users)\n// AI Prompt Management (Enhanced for Admin)\nexport const aiPrompts = pgTable(\"ai_prompts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  promptKey: varchar(\"prompt_key\").notNull().unique(), // 'cv_generation', 'interview_feedback', etc.\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  systemPrompt: text(\"system_prompt\").notNull(),\n  userPromptTemplate: text(\"user_prompt_template\"),\n  isActive: boolean(\"is_active\").default(true),\n  category: varchar(\"category\").notNull(), // document_generation, henry_responses, interview_practice\n  temperature: integer(\"temperature\").default(70), // 0-100, will be divided by 100\n  maxTokens: integer(\"max_tokens\").default(1000),\n  lastEditedBy: varchar(\"last_edited_by\").references(() => users.id).notNull(),\n  version: varchar(\"version\").default(\"1.0\"),\n  metadata: jsonb(\"metadata\"), // additional settings\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Admin activity logs\nexport const adminLogs = pgTable(\"admin_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  adminId: varchar(\"admin_id\").references(() => adminUsers.id).notNull(),\n  action: varchar(\"action\").notNull(),\n  targetType: varchar(\"target_type\"), // user, prompt, job, etc.\n  targetId: varchar(\"target_id\"),\n  details: jsonb(\"details\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// User activity tracking\nexport const userActivity = pgTable(\"user_activity\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  activityType: varchar(\"activity_type\").notNull(), // 'login', 'job_search', 'application_sent', 'document_generated', 'interview_practiced'\n  details: jsonb(\"details\"), // additional activity data\n  ipAddress: varchar(\"ip_address\"),\n  userAgent: varchar(\"user_agent\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// News and announcements management\nexport const newsArticles = pgTable(\"news_articles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: varchar(\"title\").notNull(),\n  content: text(\"content\").notNull(),\n  excerpt: text(\"excerpt\"),\n  category: varchar(\"category\").notNull(), // 'nhs_updates', 'platform_news', 'policy_changes'\n  priority: varchar(\"priority\").default(\"normal\"), // 'urgent', 'high', 'normal', 'low'\n  isPublished: boolean(\"is_published\").default(false),\n  publishedAt: timestamp(\"published_at\"),\n  authorId: varchar(\"author_id\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Type definitions\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\n\n// Admin Content Management System\nexport const adminContent = pgTable(\"admin_content\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentKey: varchar(\"content_key\").notNull().unique(), // 'homepage_hero', 'homepage_description', etc.\n  title: varchar(\"title\").notNull(),\n  content: text(\"content\").notNull(),\n  contentType: varchar(\"content_type\").notNull().default(\"text\"), // 'text', 'html', 'markdown'\n  isActive: boolean(\"is_active\").default(true),\n  lastEditedBy: varchar(\"last_edited_by\").references(() => users.id).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n\n// System Analytics Tracking\nexport const systemAnalytics = pgTable(\"system_analytics\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  date: timestamp(\"date\").notNull().defaultNow(),\n  totalUsers: integer(\"total_users\").default(0),\n  freeUsers: integer(\"free_users\").default(0),\n  premiumUsers: integer(\"premium_users\").default(0),\n  dailyActiveUsers: integer(\"daily_active_users\").default(0),\n  newSignups: integer(\"new_signups\").default(0),\n  premiumConversions: integer(\"premium_conversions\").default(0),\n  totalApplications: integer(\"total_applications\").default(0),\n  totalInterviewSessions: integer(\"total_interview_sessions\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Admin Activity Logs\nexport const adminActivityLogs = pgTable(\"admin_activity_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  adminId: varchar(\"admin_id\").references(() => users.id).notNull(),\n  action: varchar(\"action\").notNull(), // 'user_created', 'content_updated', 'prompt_modified', etc.\n  targetType: varchar(\"target_type\"), // 'user', 'content', 'prompt', 'system'\n  targetId: varchar(\"target_id\"),\n  description: text(\"description\"),\n  metadata: jsonb(\"metadata\"), // Additional data about the action\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Admin Insert/Select Types\nexport type AdminContent = typeof adminContent.$inferSelect;\nexport type InsertAdminContent = typeof adminContent.$inferInsert;\nexport type AiPrompt = typeof aiPrompts.$inferSelect;\nexport type InsertAiPrompt = typeof aiPrompts.$inferInsert;\nexport type SystemAnalytics = typeof systemAnalytics.$inferSelect;\nexport type InsertSystemAnalytics = typeof systemAnalytics.$inferInsert;\nexport type AdminActivityLog = typeof adminActivityLogs.$inferSelect;\nexport type InsertAdminActivityLog = typeof adminActivityLogs.$inferInsert;\nexport type InsertProfile = typeof profiles.$inferInsert;\nexport type Profile = typeof profiles.$inferSelect;\nexport type InsertApplication = typeof applications.$inferInsert;\nexport type Application = typeof applications.$inferSelect;\nexport type InsertInterviewSession = typeof interviewSessions.$inferInsert;\nexport type InterviewQuestion = typeof interviewQuestions.$inferSelect;\nexport type InterviewSession = typeof interviewSessions.$inferSelect;\nexport type InterviewResponse = typeof interviewResponses.$inferSelect;\nexport type InsertInterviewQuestion = typeof interviewQuestions.$inferInsert;\nexport type InsertInterviewResponse = typeof interviewResponses.$inferInsert;\nexport type InsertDocument = typeof documents.$inferInsert;\nexport type Document = typeof documents.$inferSelect;\n\n// New type definitions\nexport type InsertStarExample = typeof starExamples.$inferInsert;\nexport type StarExample = typeof starExamples.$inferSelect;\nexport type InsertNhsJob = typeof nhsJobs.$inferInsert;\nexport type NhsJob = typeof nhsJobs.$inferSelect;\nexport type InsertJobMatch = typeof jobMatches.$inferInsert;\nexport type JobMatch = typeof jobMatches.$inferSelect;\nexport type InsertUserFile = typeof userFiles.$inferInsert;\nexport type UserFile = typeof userFiles.$inferSelect;\nexport type InsertValuesAssessment = typeof valuesAssessment.$inferInsert;\nexport type ValuesAssessment = typeof valuesAssessment.$inferSelect;\nexport type InsertAdminUser = typeof adminUsers.$inferInsert;\nexport type AdminUser = typeof adminUsers.$inferSelect;\nexport type InsertAdminLog = typeof adminLogs.$inferInsert;\nexport type AdminLog = typeof adminLogs.$inferSelect;\nexport type InsertUserActivity = typeof userActivity.$inferInsert;\nexport type UserActivity = typeof userActivity.$inferSelect;\nexport type InsertNewsArticle = typeof newsArticles.$inferInsert;\nexport type NewsArticle = typeof newsArticles.$inferSelect;\n\n// Q&A Generator types\nexport type InsertQaSession = typeof qaSessions.$inferInsert;\nexport type QaSession = typeof qaSessions.$inferSelect;\nexport type InsertQaQuestion = typeof qaQuestions.$inferInsert;\nexport type QaQuestion = typeof qaQuestions.$inferSelect;\nexport type InsertQaProgress = typeof qaProgress.$inferInsert;\nexport type QaProgress = typeof qaProgress.$inferSelect;\n\n// Interview Attempts types\nexport type InsertInterviewAttempt = typeof interviewAttempts.$inferInsert;\nexport type InterviewAttempt = typeof interviewAttempts.$inferSelect;\n\n// Zod schemas\nexport type InsertInterviewSessionType = z.infer<typeof insertInterviewSessionSchema>;\nexport type InsertDocumentType = z.infer<typeof insertDocumentSchema>;\nexport type InsertProfileType = z.infer<typeof insertProfileSchema>;\nexport type InsertStarExampleType = z.infer<typeof insertStarExampleSchema>;\nexport type InsertNhsJobType = z.infer<typeof insertNhsJobSchema>;\nexport type InsertQaSessionType = z.infer<typeof insertQaSessionSchema>;\nexport type InsertQaQuestionType = z.infer<typeof insertQaQuestionSchema>;\nexport type InsertQaProgressType = z.infer<typeof insertQaProgressSchema>;\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  email: true,\n  firstName: true,\n  lastName: true,\n  profileImageUrl: true,\n});\n\nexport const insertProfileSchema = createInsertSchema(profiles).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertApplicationSchema = createInsertSchema(applications).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertDocumentSchema = createInsertSchema(documents).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertInterviewSessionSchema = createInsertSchema(interviewSessions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertInterviewResponseSchema = createInsertSchema(interviewResponses).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertStarExampleSchema = createInsertSchema(starExamples).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertNhsJobSchema = createInsertSchema(nhsJobs).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertJobMatchSchema = createInsertSchema(jobMatches).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserFileSchema = createInsertSchema(userFiles).omit({\n  id: true,\n  uploadedAt: true,\n});\n\nexport const insertValuesAssessmentSchema = createInsertSchema(valuesAssessment).omit({\n  id: true,\n  completedAt: true,\n});\n\nexport const insertAiPromptSchema = createInsertSchema(aiPrompts).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertUserActivitySchema = createInsertSchema(userActivity).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertNewsArticleSchema = createInsertSchema(newsArticles).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Q&A Generator schemas\nexport const insertQaSessionSchema = createInsertSchema(qaSessions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertQaQuestionSchema = createInsertSchema(qaQuestions).omit({\n  id: true,\n});\n\nexport const insertQaProgressSchema = createInsertSchema(qaProgress).omit({\n  id: true,\n  lastReviewed: true,\n});\n\nexport const insertInterviewAttemptSchema = createInsertSchema(interviewAttempts).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Dashboard data interface\nexport interface DashboardData {\n  profileCompletion: number;\n  newJobMatches: number;\n  applicationsInProgress: number;\n  totalApplications: number;\n  latestInterviewScore: number;\n  interviewsThisWeek: number;\n  successRate: number;\n  recentApplications: Application[];\n  latestDocument: Document | null;\n}\n\n// Extended user type with dashboard data\nexport interface UserWithProfile extends User {\n  profile?: Profile;\n  profileCompletionPercentage?: number;\n  totalApplications?: number;\n  interviewsScheduled?: number;\n  profession?: string;\n}\n\n// Feature gates for subscription tiers\nexport type SubscriptionStatus = 'free' | 'paid';\n\nexport interface FreeTierLimits {\n  jobs_viewed_today: number;\n  last_reset: string;\n}\n\n// Feature access control\nexport const FEATURES = {\n  AI_GENERATION: 'ai_generation',\n  INTERVIEW_PRACTICE: 'interview_practice', \n  JOB_TRACKING: 'job_tracking',\n  UNLIMITED_SEARCH: 'unlimited_search',\n  QA_GENERATOR: 'qa_generator',\n  BASIC_PROFILE: 'basic_profile',\n  LIMITED_JOB_VIEW: 'limited_job_view',\n} as const;\n\nexport type Feature = typeof FEATURES[keyof typeof FEATURES];\n\nexport const FEATURE_ACCESS: Record<Feature, SubscriptionStatus[]> = {\n  [FEATURES.AI_GENERATION]: ['paid'],\n  [FEATURES.INTERVIEW_PRACTICE]: ['paid'],\n  [FEATURES.JOB_TRACKING]: ['paid'],\n  [FEATURES.UNLIMITED_SEARCH]: ['paid'],\n  [FEATURES.QA_GENERATOR]: ['paid'],\n  [FEATURES.BASIC_PROFILE]: ['free', 'paid'],\n  [FEATURES.LIMITED_JOB_VIEW]: ['free', 'paid'],\n};\n\n// AI Usage Monitoring Tables\nexport const aiUsageTracking = pgTable(\"ai_usage_tracking\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  featureType: varchar(\"feature_type\").notNull(), // 'interview_practice', 'qa_generator', 'henry_feedback', 'document_generation'\n  usageDate: varchar(\"usage_date\").notNull(), // YYYY-MM-DD format\n  hourlyCount: integer(\"hourly_count\").default(0),\n  dailyCount: integer(\"daily_count\").default(0),\n  weeklyCount: integer(\"weekly_count\").default(0),\n  monthlyCount: integer(\"monthly_count\").default(0),\n  lastHour: integer(\"last_hour\").default(0), // Hour of last request (0-23)\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_usage_user_feature_date\").on(table.userId, table.featureType, table.usageDate),\n]);\n\nexport const usageViolations = pgTable(\"usage_violations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  violationType: varchar(\"violation_type\").notNull(), // 'excessive_usage', 'rapid_requests', 'suspicious_pattern'\n  featureType: varchar(\"feature_type\").notNull(),\n  violationDetails: jsonb(\"violation_details\"),\n  warningSent: boolean(\"warning_sent\").default(false),\n  restrictionApplied: boolean(\"restriction_applied\").default(false),\n  resolved: boolean(\"resolved\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_violations_user_feature\").on(table.userId, table.featureType),\n]);\n\nexport const userRestrictions = pgTable(\"user_restrictions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  featureType: varchar(\"feature_type\").notNull(),\n  restrictionType: varchar(\"restriction_type\").notNull(), // 'rate_limit', 'temporary_ban', 'under_review'\n  startTime: timestamp(\"start_time\").defaultNow(),\n  endTime: timestamp(\"end_time\"),\n  reason: text(\"reason\"),\n  canAppeal: boolean(\"can_appeal\").default(true),\n  appealSubmitted: boolean(\"appeal_submitted\").default(false),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_restrictions_user_active\").on(table.userId, table.isActive),\n]);\n\nexport const usageAppeals = pgTable(\"usage_appeals\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  restrictionId: varchar(\"restriction_id\").references(() => userRestrictions.id).notNull(),\n  appealReason: text(\"appeal_reason\"),\n  status: varchar(\"status\").default(\"pending\"), // 'pending', 'approved', 'rejected'\n  adminResponse: text(\"admin_response\"),\n  reviewedBy: varchar(\"reviewed_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  reviewedAt: timestamp(\"reviewed_at\"),\n});\n\n// AI Usage Monitoring Types\nexport type AiUsageTracking = typeof aiUsageTracking.$inferSelect;\nexport type InsertAiUsageTracking = typeof aiUsageTracking.$inferInsert;\n\nexport type UsageViolation = typeof usageViolations.$inferSelect;\nexport type InsertUsageViolation = typeof usageViolations.$inferInsert;\n\nexport type UserRestriction = typeof userRestrictions.$inferSelect;\nexport type InsertUserRestriction = typeof userRestrictions.$inferInsert;\n\nexport type UsageAppeal = typeof usageAppeals.$inferSelect;\nexport type InsertUsageAppeal = typeof usageAppeals.$inferInsert;\n\n// Insert schemas for AI usage monitoring\nexport const insertAiUsageTrackingSchema = createInsertSchema(aiUsageTracking).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertUsageViolationSchema = createInsertSchema(usageViolations).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserRestrictionSchema = createInsertSchema(userRestrictions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUsageAppealSchema = createInsertSchema(usageAppeals).omit({\n  id: true,\n  createdAt: true,\n});\n\n// GDPR Compliance Tables\nexport const gdprConsents = pgTable(\"gdpr_consents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  consentType: varchar(\"consent_type\").notNull(), // 'marketing', 'analytics', 'ai_processing', 'essential'\n  legalBasis: varchar(\"legal_basis\").notNull(), // 'consent', 'legitimate_interest', 'contract', 'legal_obligation'\n  consentGiven: boolean(\"consent_given\").notNull(),\n  consentDate: timestamp(\"consent_date\").defaultNow(),\n  consentWithdrawnDate: timestamp(\"consent_withdrawn_date\"),\n  consentVersion: varchar(\"consent_version\").default(\"1.0\"), // Track policy version\n  ipAddress: varchar(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_consent_user_type\").on(table.userId, table.consentType),\n]);\n\nexport const processingActivities = pgTable(\"processing_activities\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  activityName: varchar(\"activity_name\").notNull(),\n  purpose: text(\"purpose\").notNull(),\n  legalBasis: varchar(\"legal_basis\").notNull(),\n  dataCategories: text(\"data_categories\").array(), // ['personal_data', 'special_category', 'criminal']\n  dataSubjects: text(\"data_subjects\").array(), // ['users', 'job_seekers', 'healthcare_professionals']\n  recipients: text(\"recipients\").array(), // Who data is shared with\n  retentionPeriod: integer(\"retention_period\"), // In days\n  securityMeasures: text(\"security_measures\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const dataSubjectRequests = pgTable(\"data_subject_requests\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  requestType: varchar(\"request_type\").notNull(), // 'access', 'rectification', 'erasure', 'portability', 'restriction', 'objection'\n  requestDetails: text(\"request_details\"),\n  status: varchar(\"status\").default(\"pending\"), // 'pending', 'in_progress', 'completed', 'rejected'\n  submittedDate: timestamp(\"submitted_date\").defaultNow(),\n  completedDate: timestamp(\"completed_date\"),\n  adminNotes: text(\"admin_notes\"),\n  verificationMethod: varchar(\"verification_method\"),\n  responseData: jsonb(\"response_data\"), // Store the response for audit\n  referenceId: varchar(\"reference_id\").unique().default(sql`'DSR-' || EXTRACT(YEAR FROM NOW()) || '-' || LPAD(EXTRACT(DOY FROM NOW())::text, 3, '0') || '-' || LPAD(EXTRACT(HOUR FROM NOW())::text, 2, '0') || LPAD(EXTRACT(MINUTE FROM NOW())::text, 2, '0') || '-' || LPAD((RANDOM() * 999)::int::text, 3, '0')`),\n  adminUpdatedBy: varchar(\"admin_updated_by\"),\n  adminUpdatedAt: timestamp(\"admin_updated_at\"),\n}, (table) => [\n  index(\"idx_dsr_user_status\").on(table.userId, table.status),\n]);\n\nexport const dataBreaches = pgTable(\"data_breaches\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  breachType: varchar(\"breach_type\").notNull(),\n  description: text(\"description\").notNull(),\n  affectedUsers: integer(\"affected_users\"),\n  dataCategories: text(\"data_categories\").array(),\n  riskLevel: varchar(\"risk_level\").notNull(), // 'low', 'medium', 'high'\n  discoveredDate: timestamp(\"discovered_date\").defaultNow(),\n  containedDate: timestamp(\"contained_date\"),\n  authorityNotified: boolean(\"authority_notified\").default(false),\n  authorityNotificationDate: timestamp(\"authority_notification_date\"),\n  usersNotified: boolean(\"users_notified\").default(false),\n  userNotificationDate: timestamp(\"user_notification_date\"),\n  remedialActions: text(\"remedial_actions\"),\n  status: varchar(\"status\").default(\"open\"), // 'open', 'investigating', 'contained', 'closed'\n  reportedBy: varchar(\"reported_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const dataAccessLogs = pgTable(\"data_access_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  accessedBy: varchar(\"accessed_by\").references(() => users.id), // Staff member who accessed data\n  accessType: varchar(\"access_type\").notNull(), // 'view', 'edit', 'delete', 'export'\n  dataType: varchar(\"data_type\").notNull(), // 'profile', 'cv', 'applications', 'interview_data'\n  ipAddress: varchar(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  purpose: text(\"purpose\"),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n}, (table) => [\n  index(\"idx_access_logs_user_date\").on(table.userId, table.timestamp),\n  index(\"idx_access_logs_accessed_by\").on(table.accessedBy),\n]);\n\n// GDPR Types\nexport type GdprConsent = typeof gdprConsents.$inferSelect;\nexport type InsertGdprConsent = typeof gdprConsents.$inferInsert;\n\nexport type ProcessingActivity = typeof processingActivities.$inferSelect;\nexport type InsertProcessingActivity = typeof processingActivities.$inferInsert;\n\nexport type DataSubjectRequest = typeof dataSubjectRequests.$inferSelect;\nexport type InsertDataSubjectRequest = typeof dataSubjectRequests.$inferInsert;\n\nexport type DataBreach = typeof dataBreaches.$inferSelect;\nexport type InsertDataBreach = typeof dataBreaches.$inferInsert;\n\nexport type DataAccessLog = typeof dataAccessLogs.$inferSelect;\nexport type InsertDataAccessLog = typeof dataAccessLogs.$inferInsert;\n\n// GDPR Schemas\nexport const insertGdprConsentSchema = createInsertSchema(gdprConsents).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertProcessingActivitySchema = createInsertSchema(processingActivities).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertDataSubjectRequestSchema = createInsertSchema(dataSubjectRequests).omit({\n  id: true,\n  submittedDate: true,\n  referenceId: true,\n});\n\nexport const insertDataBreachSchema = createInsertSchema(dataBreaches).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertDataAccessLogSchema = createInsertSchema(dataAccessLogs).omit({\n  id: true,\n  timestamp: true,\n});\n","size_bytes":34026},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/contexts/theme-context\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/landing\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Pricing from \"@/pages/pricing\";\nimport Documents from \"@/pages/documents\";\nimport InterviewPractice from \"@/pages/interview-practice\";\nimport QAGenerator from \"@/pages/qa-generator\";\nimport QASession from \"@/pages/qa-session\";\nimport ApplicationTracker from \"@/pages/tracker\";\nimport PaymentSuccess from \"@/pages/payment-success\";\nimport Profile from \"@/pages/profile\";\nimport JobFinder from \"@/pages/job-finder\";\nimport Resources from \"@/pages/resources\";\nimport NewsAndUpdates from \"@/pages/news\";\nimport AdminDashboard from \"@/pages/admin\";\nimport Checkout from \"@/pages/checkout\";\nimport DocumentGeneration from \"@/pages/ai-documents\";\nimport DocumentsEnhanced from \"@/pages/documents-enhanced\";\nimport JobDetail from \"@/pages/job-detail\";\nimport CVViewer from \"@/pages/cv-viewer\";\nimport PrivacySettings from \"@/pages/privacy-settings\";\nimport PrivacyNotice from \"@/pages/privacy-notice\";\nimport TermsOfUse from \"@/pages/terms-of-use\";\nimport CookiePolicy from \"@/pages/cookie-policy\";\nimport Support from \"@/pages/support\";\nimport Referrals from \"@/pages/referrals\";\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  return (\n    <Switch>\n      {/* Public routes */}\n      <Route path=\"/landing\" component={Landing} />\n      <Route path=\"/pricing\" component={Pricing} />\n      <Route path=\"/payment-success\" component={PaymentSuccess} />\n      <Route path=\"/checkout\" component={Checkout} />\n      <Route path=\"/support\" component={Support} />\n      <Route path=\"/privacy-notice\" component={PrivacyNotice} />\n      <Route path=\"/terms-of-use\" component={TermsOfUse} />\n      <Route path=\"/cookie-policy\" component={CookiePolicy} />\n      \n      {/* Admin route - accessible before auth check */}\n      <Route path=\"/admin\" component={AdminDashboard} />\n      \n      {isLoading || !isAuthenticated ? (\n        <Route path=\"/\" component={Landing} />\n      ) : (\n        <>\n          {/* Protected routes */}\n          <Route path=\"/\" component={Dashboard} />\n          <Route path=\"/profile\" component={Profile} />\n          <Route path=\"/jobs\" component={JobFinder} />\n          <Route path=\"/jobs/:id\" component={JobDetail} />\n          <Route path=\"/documents\" component={DocumentsEnhanced} />\n          <Route path=\"/resources\" component={Resources} />\n          <Route path=\"/interview-practice\" component={InterviewPractice} />\n          <Route path=\"/qa-generator\" component={QAGenerator} />\n          <Route path=\"/tracker\" component={ApplicationTracker} />\n          <Route path=\"/news\" component={NewsAndUpdates} />\n          <Route path=\"/practice\" component={InterviewPractice} />\n          <Route path=\"/qa\" component={QAGenerator} />\n          <Route path=\"/qa/session/:sessionId\" component={QASession} />\n          <Route path=\"/ai-documents\" component={DocumentGeneration} />\n          <Route path=\"/cv-viewer\" component={CVViewer} />\n          <Route path=\"/cv\" component={CVViewer} />\n          <Route path=\"/privacy\" component={PrivacySettings} />\n          <Route path=\"/privacy-settings\" component={PrivacySettings} />\n          <Route path=\"/referrals\" component={Referrals} />\n        </>\n      )}\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <ThemeProvider defaultTheme=\"light\" storageKey=\"healthhire-ui-theme\">\n      <QueryClientProvider client={queryClient}>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </QueryClientProvider>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","size_bytes":4027},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0 0% 100%);\n  --foreground: hsl(222 16% 13%);\n  --card: hsl(0 0% 100%);\n  --card-foreground: hsl(222 16% 13%);\n  --popover: hsl(0 0% 100%);\n  --popover-foreground: hsl(222 16% 13%);\n  --primary: hsl(186 66% 41%);\n  --primary-foreground: hsl(0 0% 100%);\n  --secondary: hsl(186 56% 50%);\n  --secondary-foreground: hsl(0 0% 100%);\n  --muted: hsl(210 20% 95%);\n  --muted-foreground: hsl(215 15% 50%);\n  --accent: hsl(142 70% 45%);\n  --accent-foreground: hsl(0 0% 100%);\n  --destructive: hsl(0 70% 50%);\n  --destructive-foreground: hsl(0 0% 100%);\n  --border: hsl(215 15% 88%);\n  --input: hsl(215 15% 88%);\n  --ring: hsl(186 66% 41%);\n  --chart-1: hsl(186 66% 41%);\n  --chart-2: hsl(142 70% 45%);\n  --chart-3: hsl(42 92% 56%);\n  --chart-4: hsl(147 78% 42%);\n  --chart-5: hsl(341 75% 51%);\n  --sidebar: hsl(210 20% 95%);\n  --sidebar-foreground: hsl(222 16% 13%);\n  --sidebar-primary: hsl(186 66% 41%);\n  --sidebar-primary-foreground: hsl(0 0% 100%);\n  --sidebar-accent: hsl(210 20% 92%);\n  --sidebar-accent-foreground: hsl(186 66% 41%);\n  --sidebar-border: hsl(215 15% 88%);\n  --sidebar-ring: hsl(186 66% 41%);\n  --font-sans: 'Inter', system-ui, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: 12px;\n  --shadow-2xs: 0px 1px 2px 0px hsl(215 25% 27% / 0.05);\n  --shadow-xs: 0px 1px 3px 0px hsl(215 25% 27% / 0.1), 0px 1px 2px -1px hsl(215 25% 27% / 0.1);\n  --shadow-sm: 0px 4px 6px -1px hsl(215 25% 27% / 0.1), 0px 2px 4px -2px hsl(215 25% 27% / 0.1);\n  --shadow: 0px 10px 15px -3px hsl(215 25% 27% / 0.1), 0px 4px 6px -4px hsl(215 25% 27% / 0.1);\n  --shadow-md: 0px 20px 25px -5px hsl(215 25% 27% / 0.1), 0px 8px 10px -6px hsl(215 25% 27% / 0.1);\n  --shadow-lg: 0px 25px 50px -12px hsl(215 25% 27% / 0.25);\n  --shadow-xl: 0px 35px 60px -12px hsl(215 25% 27% / 0.25);\n  --shadow-2xl: 0px 50px 100px -20px hsl(215 25% 27% / 0.25);\n  --shadow-3xl: 0px 60px 120px -15px hsl(215 25% 27% / 0.3);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n  \n  /* Enhanced visual effects */\n  --gradient-primary: linear-gradient(135deg, hsl(186 66% 41%) 0%, hsl(186 56% 50%) 100%);\n  --gradient-accent: linear-gradient(135deg, hsl(142 70% 45%) 0%, hsl(147 78% 42%) 100%);\n  --gradient-surface: linear-gradient(145deg, hsl(0 0% 100% / 0.8) 0%, hsl(0 0% 100% / 0.4) 100%);\n  --gradient-glass: linear-gradient(145deg, hsl(0 0% 100% / 0.1) 0%, hsl(0 0% 100% / 0.05) 100%);\n  --gradient-glow: linear-gradient(135deg, hsl(186 66% 41% / 0.2) 0%, hsl(142 70% 45% / 0.1) 50%, hsl(186 66% 41% / 0.2) 100%);\n}\n\n.dark {\n  --background: hsl(222 47% 6%);\n  --foreground: hsl(215 25% 88%);\n  --card: hsl(222 47% 9%);\n  --card-foreground: hsl(215 25% 88%);\n  --popover: hsl(222 47% 9%);\n  --popover-foreground: hsl(215 25% 88%);\n  --primary: hsl(186 66% 50%);\n  --primary-foreground: hsl(222 47% 6%);\n  --secondary: hsl(186 20% 20%);\n  --secondary-foreground: hsl(215 25% 88%);\n  --muted: hsl(222 47% 12%);\n  --muted-foreground: hsl(215 15% 65%);\n  --accent: hsl(142 70% 50%);\n  --accent-foreground: hsl(222 47% 6%);\n  --destructive: hsl(0 70% 55%);\n  --destructive-foreground: hsl(0 0% 100%);\n  --border: hsl(222 30% 18%);\n  --input: hsl(222 30% 18%);\n  --ring: hsl(186 66% 50%);\n  --chart-1: hsl(186 66% 50%);\n  --chart-2: hsl(142 70% 50%);\n  --chart-3: hsl(42 92% 60%);\n  --chart-4: hsl(147 78% 50%);\n  --chart-5: hsl(341 75% 60%);\n  --sidebar: hsl(222 47% 9%);\n  --sidebar-foreground: hsl(215 25% 88%);\n  --sidebar-primary: hsl(186 66% 50%);\n  --sidebar-primary-foreground: hsl(222 47% 6%);\n  --sidebar-accent: hsl(222 47% 12%);\n  --sidebar-accent-foreground: hsl(186 66% 50%);\n  --sidebar-border: hsl(222 30% 18%);\n  --sidebar-ring: hsl(186 66% 50%);\n  --font-sans: 'Inter', system-ui, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: 12px;\n  --shadow-2xs: 0px 1px 2px 0px hsl(0 0% 0% / 0.15);\n  --shadow-xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.2), 0px 1px 2px -1px hsl(0 0% 0% / 0.2);\n  --shadow-sm: 0px 4px 6px -1px hsl(0 0% 0% / 0.2), 0px 2px 4px -2px hsl(0 0% 0% / 0.2);\n  --shadow: 0px 10px 15px -3px hsl(0 0% 0% / 0.25), 0px 4px 6px -4px hsl(0 0% 0% / 0.2);\n  --shadow-md: 0px 20px 25px -5px hsl(0 0% 0% / 0.25), 0px 8px 10px -6px hsl(0 0% 0% / 0.2);\n  --shadow-lg: 0px 25px 50px -12px hsl(0 0% 0% / 0.4);\n  --shadow-xl: 0px 35px 60px -12px hsl(0 0% 0% / 0.4);\n  --shadow-2xl: 0px 50px 100px -20px hsl(0 0% 0% / 0.4);\n  --shadow-3xl: 0px 60px 120px -15px hsl(0 0% 0% / 0.5);\n  \n  /* Dark mode gradient adjustments */\n  --gradient-primary: linear-gradient(135deg, hsl(186 66% 50%) 0%, hsl(186 56% 60%) 100%);\n  --gradient-accent: linear-gradient(135deg, hsl(142 70% 50%) 0%, hsl(147 78% 50%) 100%);\n  --gradient-surface: linear-gradient(145deg, hsl(222 47% 9% / 0.8) 0%, hsl(222 47% 6% / 0.4) 100%);\n  --gradient-glass: linear-gradient(145deg, hsl(0 0% 100% / 0.03) 0%, hsl(0 0% 100% / 0.01) 100%);\n  --gradient-glow: linear-gradient(135deg, hsl(186 66% 50% / 0.3) 0%, hsl(142 70% 50% / 0.15) 50%, hsl(186 66% 50% / 0.3) 100%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/* Enhanced visual effects and animations */\n@keyframes float-gentle {\n  0%, 100% { transform: translateY(0px) rotate(0deg); }\n  33% { transform: translateY(-6px) rotate(1deg); }\n  66% { transform: translateY(-2px) rotate(-1deg); }\n}\n\n@keyframes pulse-glow {\n  0%, 100% { box-shadow: 0 0 5px var(--primary), 0 0 10px var(--primary), 0 0 15px var(--primary); }\n  50% { box-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary), 0 0 30px var(--primary); }\n}\n\n@keyframes shimmer {\n  0% { transform: translateX(-100%); }\n  100% { transform: translateX(100%); }\n}\n\n@keyframes gradient-shift {\n  0%, 100% { background-position: 0% 50%; }\n  50% { background-position: 100% 50%; }\n}\n\n/* Enhanced card hover effects */\n.card-hover {\n  transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n}\n\n.card-hover:hover {\n  transform: translateY(-8px) scale(1.02);\n  box-shadow: var(--shadow-2xl);\n}\n\n.card-hover:hover::before {\n  content: \"\";\n  position: absolute;\n  inset: 0;\n  background: var(--gradient-glow);\n  border-radius: inherit;\n  opacity: 0.1;\n  z-index: -1;\n  animation: pulse-glow 2s ease-in-out infinite;\n}\n\n/* Floating animation for background elements */\n.float-animation {\n  animation: float-gentle 8s ease-in-out infinite;\n}\n\n/* Shimmer effect for interactive elements */\n.shimmer-effect {\n  position: relative;\n  overflow: hidden;\n}\n\n.shimmer-effect::after {\n  content: \"\";\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(\n    90deg,\n    transparent,\n    rgba(255, 255, 255, 0.2),\n    transparent\n  );\n  transform: translateX(-100%);\n  transition: transform 0.6s;\n}\n\n.shimmer-effect:hover::after {\n  animation: shimmer 1.5s ease-in-out;\n}\n\n/* Gradient animation for special elements */\n.gradient-animate {\n  background: linear-gradient(-45deg, var(--primary), var(--secondary), var(--accent), var(--primary));\n  background-size: 400% 400%;\n  animation: gradient-shift 4s ease infinite;\n}\n\n/* Glass morphism effect */\n.glass-morphism {\n  background: var(--gradient-glass);\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n/* Enhanced focus states */\n.focus-ring:focus-visible {\n  outline: none;\n  box-shadow: 0 0 0 2px var(--background), 0 0 0 4px var(--primary);\n}\n\n/* Smooth transitions for all interactive elements */\nbutton, [role=\"button\"], .interactive {\n  transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);\n}\n\nbutton:hover, [role=\"button\"]:hover, .interactive:hover {\n  transform: translateY(-2px);\n  box-shadow: var(--shadow-lg);\n}\n","size_bytes":7887},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"server/lib/featureGates.ts":{"content":"import { FEATURES, FEATURE_ACCESS, type Feature, type SubscriptionStatus, type FreeTierLimits } from \"@shared/schema\";\nimport { storage } from \"../storage\";\n\nexport class FeatureGates {\n  static canAccessFeature(subscriptionStatus: SubscriptionStatus, feature: Feature): boolean {\n    return FEATURE_ACCESS[feature].includes(subscriptionStatus);\n  }\n\n  static async canViewJob(userId: string): Promise<{ canView: boolean; remaining: number }> {\n    const user = await storage.getUser(userId);\n    \n    if (!user) {\n      return { canView: false, remaining: 0 };\n    }\n\n    // Paid users have unlimited access\n    if (user.subscriptionStatus === 'paid') {\n      return { canView: true, remaining: -1 }; // -1 indicates unlimited\n    }\n\n    const limits = user.freeTierLimits as FreeTierLimits || { jobs_viewed_today: 0, last_reset: '2024-01-01' };\n    const today = new Date().toDateString();\n    const lastReset = new Date(limits.last_reset).toDateString();\n\n    // Reset counter if it's a new day\n    if (today !== lastReset) {\n      const newLimits: FreeTierLimits = {\n        jobs_viewed_today: 0,\n        last_reset: today\n      };\n      \n      await storage.updateUserLimits(userId, newLimits);\n      return { canView: true, remaining: 4 }; // 5 - 1 for current view\n    }\n\n    const remaining = Math.max(0, 5 - limits.jobs_viewed_today);\n    return { \n      canView: limits.jobs_viewed_today < 5, \n      remaining: remaining - 1 \n    };\n  }\n\n  static async recordJobView(userId: string): Promise<void> {\n    const user = await storage.getUser(userId);\n    \n    if (!user || user.subscriptionStatus === 'paid') {\n      return; // No tracking needed for paid users\n    }\n\n    const limits = user.freeTierLimits as FreeTierLimits || { jobs_viewed_today: 0, last_reset: '2024-01-01' };\n    const today = new Date().toDateString();\n    const lastReset = new Date(limits.last_reset).toDateString();\n\n    let newJobsViewedToday = limits.jobs_viewed_today;\n    \n    if (today !== lastReset) {\n      // Reset counter for new day\n      newJobsViewedToday = 1;\n    } else {\n      // Increment counter for same day\n      newJobsViewedToday += 1;\n    }\n\n    const newLimits: FreeTierLimits = {\n      jobs_viewed_today: newJobsViewedToday,\n      last_reset: today\n    };\n\n    await storage.updateUserLimits(userId, newLimits);\n  }\n\n  static getUpgradeMessage(feature: Feature): string {\n    const messages: Record<Feature, string> = {\n      [FEATURES.AI_GENERATION]: \"Unlock professional CV and Supporting Information generation for ¬£70 one-time\",\n      [FEATURES.INTERVIEW_PRACTICE]: \"Get unlimited interview practice with expert feedback for ¬£70 one-time\", \n      [FEATURES.JOB_TRACKING]: \"Track all your NHS job applications with our comprehensive dashboard for ¬£70 one-time\",\n      [FEATURES.UNLIMITED_SEARCH]: \"Search unlimited NHS jobs and get personalized matches for ¬£70 one-time\",\n      [FEATURES.QA_GENERATOR]: \"Generate tailored interview Q&As for any NHS role for ¬£70 one-time\",\n      [FEATURES.BASIC_PROFILE]: \"\",\n      [FEATURES.LIMITED_JOB_VIEW]: \"\"\n    };\n\n    return messages[feature];\n  }\n}","size_bytes":3105},"server/lib/stripe.ts":{"content":"import Stripe from 'stripe';\n\nif (!process.env.STRIPE_SECRET_KEY) {\n  throw new Error('Missing required Stripe secret: STRIPE_SECRET_KEY');\n}\n\n// Initialize Stripe for production  \nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {\n  apiVersion: '2025-08-27.basil',\n});\n\nexport { stripe };\n\n// Stripe configuration constants\nexport const STRIPE_CONFIG = {\n  // ¬£70.00 one-time payment in pence\n  PRICE_AMOUNT: 7000,\n  CURRENCY: 'gbp',\n  PRODUCT_NAME: 'HealthHire Portal',\n  PRODUCT_DESCRIPTION: 'HealthHire Portal is a product created by HealthHire UK. Everything for your job application in one place: Build a reusable profile that powers your CV ‚Ä¢ Find and save jobs, track every application ‚Ä¢ Tailor Supporting Information and cover letters with Henry the Helper ‚Ä¢ Practise interviews and role-specific questions with feedback and model answers ‚Ä¢ Access expert resources ‚Ä¢ Earn rewards via our referral programme.',\n} as const;","size_bytes":949},"server/routes/payments.ts":{"content":"import type { Express } from \"express\";\nimport { stripe, STRIPE_CONFIG } from \"../lib/stripe\";\nimport { storage } from \"../storage\";\nimport { isAuthenticated } from \"../replitAuth\";\n\nexport function registerPaymentRoutes(app: Express) {\n  // Create Stripe Checkout session\n  app.post('/api/payments/create-checkout', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Check if user is already paid\n      const user = await storage.getUser(userId);\n      if (user?.subscriptionStatus === 'paid') {\n        return res.status(400).json({ message: \"User already has paid access\" });\n      }\n\n      // Create Stripe checkout session\n      const session = await stripe.checkout.sessions.create({\n        mode: 'payment',\n        payment_method_types: ['card'],\n        line_items: [\n          {\n            price_data: {\n              currency: STRIPE_CONFIG.CURRENCY,\n              product_data: {\n                name: STRIPE_CONFIG.PRODUCT_NAME,\n                description: STRIPE_CONFIG.PRODUCT_DESCRIPTION,\n              },\n              unit_amount: STRIPE_CONFIG.PRICE_AMOUNT,\n            },\n            quantity: 1,\n          },\n        ],\n        success_url: `${req.protocol}://${req.get('host')}/payment-success?session_id={CHECKOUT_SESSION_ID}`,\n        cancel_url: `${req.protocol}://${req.get('host')}/pricing`,\n        metadata: {\n          userId: userId,\n        },\n      });\n\n      res.json({ checkout_url: session.url });\n    } catch (error) {\n      console.error('Error creating checkout session:', error);\n      res.status(500).json({ message: \"Failed to create checkout session\" });\n    }\n  });\n\n  // Check user's job viewing limits\n  app.get('/api/user/job-limits', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { FeatureGates } = await import(\"../lib/featureGates\");\n      const limits = await FeatureGates.canViewJob(userId);\n      \n      res.json(limits);\n    } catch (error) {\n      console.error('Error checking job limits:', error);\n      res.status(500).json({ message: \"Failed to check job limits\" });\n    }\n  });\n\n  // Record a job view (for free tier tracking)\n  app.post('/api/user/record-job-view', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { FeatureGates } = await import(\"../lib/featureGates\");\n      await FeatureGates.recordJobView(userId);\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error('Error recording job view:', error);\n      res.status(500).json({ message: \"Failed to record job view\" });\n    }\n  });\n\n  // Stripe webhook endpoint\n  app.post('/api/webhooks/stripe', async (req, res) => {\n    const sig = req.headers['stripe-signature'] as string;\n    const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET;\n\n    if (!webhookSecret) {\n      console.error('Missing STRIPE_WEBHOOK_SECRET');\n      return res.status(400).send('Webhook secret not configured');\n    }\n\n    let event;\n\n    try {\n      event = stripe.webhooks.constructEvent(req.body, sig, webhookSecret);\n    } catch (err: any) {\n      console.error(`Webhook signature verification failed: ${err.message}`);\n      return res.status(400).send(`Webhook Error: ${err.message}`);\n    }\n\n    // Handle successful payment\n    if (event.type === 'checkout.session.completed') {\n      const session = event.data.object as any;\n      const userId = session.metadata?.userId;\n\n      if (userId) {\n        try {\n          // Upgrade user to paid status\n          await storage.upgradeUserToPaid(userId, session.customer as string);\n          console.log(`User ${userId} upgraded to paid status`);\n        } catch (error) {\n          console.error(`Error upgrading user ${userId}:`, error);\n        }\n      }\n    }\n\n    res.json({ received: true });\n  });\n}","size_bytes":3872},"client/src/components/dashboard-card.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface DashboardCardProps {\n  title: string;\n  description: string;\n  icon: LucideIcon;\n  iconColor: string;\n  onClick: () => void;\n  rightContent?: React.ReactNode;\n  bottomContent?: React.ReactNode;\n  children?: React.ReactNode;\n}\n\nexport function DashboardCard({\n  title,\n  description,\n  icon: Icon,\n  iconColor,\n  onClick,\n  rightContent,\n  bottomContent,\n  children,\n}: DashboardCardProps) {\n  return (\n    <Card \n      className=\"card-hover cursor-pointer h-full\" \n      onClick={onClick}\n      data-testid={`card-${title.toLowerCase().replace(/\\s+/g, '-')}`}\n    >\n      <CardContent className=\"p-8 h-full flex flex-col\">\n        <div className=\"flex items-start justify-between mb-6\">\n          <div className={`w-12 h-12 ${iconColor} rounded-lg flex items-center justify-center`}>\n            <Icon className=\"w-6 h-6\" />\n          </div>\n          {rightContent}\n        </div>\n        \n        <h3 className=\"text-xl font-semibold text-foreground mb-3\">{title}</h3>\n        <p className=\"text-muted-foreground mb-4\">{description}</p>\n        \n        <div className=\"flex-grow\"></div>\n        \n        {bottomContent && (\n          <div className=\"bg-muted rounded-md p-3 mt-4\">\n            {bottomContent}\n          </div>\n        )}\n        \n        {children && (\n          <div className=\"mt-4\">\n            {children}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":1508},"client/src/components/footer.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport type { DashboardData } from \"@shared/schema\";\n\nexport function Footer() {\n  const { data: dashboardData } = useQuery<DashboardData>({\n    queryKey: [\"/api/dashboard\"],\n  });\n\n  return (\n    <footer className=\"border-t border-border bg-card/50 backdrop-blur-sm\">\n      <div className=\"max-w-7xl mx-auto px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8\">\n          {/* Quick Stats */}\n          <div className=\"space-y-4\">\n            <h4 className=\"font-semibold text-foreground\">Your Progress</h4>\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Applications sent:</span>\n                <span className=\"font-medium text-foreground\" data-testid=\"text-total-applications\">\n                  {dashboardData?.totalApplications || 0}\n                </span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Interviews scheduled:</span>\n                <span className=\"font-medium text-foreground\" data-testid=\"text-interviews-scheduled\">\n                  {dashboardData?.interviewsThisWeek || 0}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          {/* Portal Features */}\n          <div className=\"space-y-4\">\n            <h4 className=\"font-semibold text-foreground\">Features</h4>\n            <div className=\"space-y-2\">\n              <a \n                href=\"/profile\" \n                className=\"block text-sm text-muted-foreground hover:text-foreground\"\n                data-testid=\"link-profile\"\n              >\n                Candidate Profile\n              </a>\n              <a \n                href=\"/jobs\" \n                className=\"block text-sm text-muted-foreground hover:text-foreground\"\n                data-testid=\"link-jobs\"\n              >\n                Job Search\n              </a>\n              <a \n                href=\"/documents\" \n                className=\"block text-sm text-muted-foreground hover:text-foreground\"\n                data-testid=\"link-documents\"\n              >\n                Documents\n              </a>\n              <a \n                href=\"/applications\" \n                className=\"block text-sm text-muted-foreground hover:text-foreground\"\n                data-testid=\"link-applications\"\n              >\n                Applications\n              </a>\n            </div>\n          </div>\n\n          {/* More Features */}\n          <div className=\"space-y-4\">\n            <h4 className=\"font-semibold text-foreground\">More Tools</h4>\n            <div className=\"space-y-2\">\n              <a \n                href=\"/interview-practice\" \n                className=\"block text-sm text-muted-foreground hover:text-foreground\"\n                data-testid=\"link-interview\"\n              >\n                Interview Practice\n              </a>\n              <a \n                href=\"/resources\" \n                className=\"block text-sm text-muted-foreground hover:text-foreground\"\n                data-testid=\"link-resources\"\n              >\n                Resources\n              </a>\n              <a \n                href=\"/news\" \n                className=\"block text-sm text-muted-foreground hover:text-foreground\"\n                data-testid=\"link-news\"\n              >\n                News & Updates\n              </a>\n              <a \n                href=\"/support\" \n                className=\"block text-sm text-muted-foreground hover:text-foreground\"\n                data-testid=\"link-support\"\n              >\n                Support\n              </a>\n            </div>\n          </div>\n\n          {/* Legal Notices */}\n          <div className=\"space-y-4\">\n            <h4 className=\"font-semibold text-foreground\">Legal Notices</h4>\n            <div className=\"space-y-2\">\n              <a \n                href=\"/privacy-notice\" \n                className=\"block text-sm text-muted-foreground hover:text-foreground\"\n                data-testid=\"link-privacy-notice\"\n              >\n                Privacy Notice\n              </a>\n              <a \n                href=\"/terms-of-use\" \n                className=\"block text-sm text-muted-foreground hover:text-foreground\"\n                data-testid=\"link-terms-of-use\"\n              >\n                Terms of Use\n              </a>\n              <a \n                href=\"/cookie-policy\" \n                className=\"block text-sm text-muted-foreground hover:text-foreground\"\n                data-testid=\"link-cookie-policy\"\n              >\n                Cookie Policy\n              </a>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"border-t border-border mt-8 pt-6 text-center\">\n          <p className=\"text-xs text-muted-foreground\">\n            ¬© 2024 HealthHire Portal. Empowering healthcare careers across the NHS.\n          </p>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","size_bytes":5064},"client/src/components/header.tsx":{"content":"import ProgressRing from \"./dashboard/progress-ring\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Star, User, HelpCircle } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport type { UserWithProfile, DashboardData } from \"@shared/schema\";\nimport logoHealthhire from \"@assets/Portal_1756483081930.png\";\n\nexport function Header() {\n  const [location, setLocation] = useLocation();\n  const { data: user } = useQuery<UserWithProfile>({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  const { data: dashboardData } = useQuery<DashboardData>({\n    queryKey: [\"/api/dashboard\"],\n  });\n\n  return (\n    <header className=\"border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n      <div className=\"max-w-7xl mx-auto px-6 lg:px-8\">\n        <div className=\"flex items-center justify-between h-16\">\n          {/* Logo */}\n          <div className=\"flex items-center space-x-3\" data-testid=\"header-logo\">\n            <div className=\"w-10 h-10 flex items-center justify-center\">\n              <img \n                src={logoHealthhire} \n                alt=\"HealthHire Portal\" \n                className=\"w-10 h-10 object-contain\"\n                data-testid=\"img-logo\"\n              />\n            </div>\n            <div>\n              <h1 className=\"text-xl font-semibold text-foreground\">HealthHire Portal</h1>\n              <p className=\"text-xs text-muted-foreground hidden sm:block\">Helping You in Your Career Journey</p>\n            </div>\n          </div>\n\n          {/* Progress Ring & User Avatar */}\n          <div className=\"flex items-center space-x-4\">\n            {/* Support Link */}\n            <Button \n              variant=\"ghost\" \n              size=\"sm\"\n              onClick={() => setLocation(\"/support\")}\n              className=\"hidden sm:flex items-center gap-2 text-muted-foreground hover:text-foreground\"\n              data-testid=\"button-support\"\n            >\n              <HelpCircle className=\"h-4 w-4\" />\n              Support\n            </Button>\n            \n\n            {/* User Avatar */}\n            <div className=\"flex items-center space-x-3\" data-testid=\"header-user\">\n              <Avatar className=\"w-10 h-10 border-2 border-border\">\n                <AvatarImage \n                  src={user?.profileImageUrl || undefined} \n                  alt=\"User profile photo\" \n                />\n                <AvatarFallback>\n                  <User className=\"w-5 h-5\" />\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"hidden md:block\">\n                <p className=\"text-sm font-medium text-foreground\" data-testid=\"text-user-name\">\n                  {user?.firstName && user?.lastName ? \n                    `${user.firstName} ${user.lastName}` : \n                    'User'\n                  }\n                </p>\n                <p className=\"text-xs text-muted-foreground\" data-testid=\"text-user-profession\">\n                  {user?.profile?.profession || 'Healthcare Professional'}\n                </p>\n              </div>\n              <button \n                onClick={() => window.location.href = \"/api/logout\"}\n                className=\"text-xs text-muted-foreground hover:text-foreground ml-2\"\n                data-testid=\"button-logout\"\n              >\n                Logout\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n}\n","size_bytes":3539},"client/src/components/henry-chat.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { X, Send, MessageCircle, Mail } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nconst henryAvatar = \"/henry-avatar.png\";\n\ninterface Message {\n  id: string;\n  text: string;\n  sender: 'user' | 'henry';\n  timestamp: Date;\n}\n\ninterface HenryChatProps {\n  triggerMessage?: string;\n  onClose?: () => void;\n  isModal?: boolean;\n}\n\nconst henryKnowledge: { [key: string]: string } = {\n  // Account & Payment\n  'cost': 'HealthHire Portal is ¬£70 for lifetime access. No monthly fees!',\n  'price': 'HealthHire Portal is ¬£70 for lifetime access. No monthly fees!',\n  'payment': 'We accept all major cards, Google Pay, and Apple Pay via Stripe.',\n  'refund': 'If you\\'re having issues, I can help you troubleshoot or submit a support ticket.',\n  \n  // Features & Usage  \n  'cv': 'Go to Application Documents ‚Üí CV Generator. I\\'ll guide you through it!',\n  'interview': 'Visit the Interview Practice section. You can do mock interviews and get expert feedback!',\n  'jobs': 'Our Job Finder uses intelligent scoring to match roles with your profile. Higher scores = better fits!',\n  'documents': 'You can generate CVs and Supporting Information in the Documents section.',\n  \n  // NHS Specific\n  'visa': 'Look for roles marked with visa sponsorship. We also have guides in Resources Hub!',\n  'nhs values': 'NHS values are: compassion, respect, dignity, commitment, quality, integrity. I help weave these into your applications!',\n  'band': 'NHS bands range from 1-9, with Band 5-7 being most common for healthcare professionals.',\n  \n  // General\n  'help': 'I\\'m here to help! Ask me about features, pricing, NHS guidance, or technical issues.',\n  'hello': 'Hello! I\\'m Henry, your NHS career helper. How can I assist you today?',\n  'hi': 'Hi there! I\\'m Henry. What can I help you with on your NHS career journey?'\n};\n\nconst henryTriggers = {\n  'profile_incomplete': 'I notice your profile is 60% complete. Shall I help you finish it?',\n  'first_job_search': 'Ready to find your perfect NHS role? I can show you the best filters!',\n  'document_generation': 'Creating your first Supporting Information? I have some tips!',\n  'interview_prep': 'Nervous about interviews? Let me help you practice NHS-style questions!',\n  'payment_hesitation': 'Questions about upgrading? I can explain what you\\'ll unlock!'\n};\n\nexport function HenryChat({ triggerMessage, onClose, isModal = false }: HenryChatProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [inputValue, setInputValue] = useState('');\n  const [showEscalation, setShowEscalation] = useState(false);\n  const [attemptCount, setAttemptCount] = useState(0);\n\n  // Auto-show Henry with trigger message\n  useEffect(() => {\n    if (triggerMessage) {\n      setIsOpen(true);\n      addHenryMessage(triggerMessage);\n    }\n  }, [triggerMessage]);\n\n  // Initialize with welcome message\n  useEffect(() => {\n    if (isOpen && messages.length === 0 && !triggerMessage) {\n      addHenryMessage(\"Hello! I'm Henry, your NHS career helper. How can I assist you today?\");\n    }\n  }, [isOpen, messages.length, triggerMessage]);\n\n  const addHenryMessage = (text: string) => {\n    setMessages(prev => [...prev, {\n      id: Date.now().toString(),\n      text,\n      sender: 'henry',\n      timestamp: new Date()\n    }]);\n  };\n\n  const addUserMessage = (text: string) => {\n    setMessages(prev => [...prev, {\n      id: Date.now().toString(),\n      text,\n      sender: 'user',\n      timestamp: new Date()\n    }]);\n  };\n\n  const findBestResponse = (userInput: string): string => {\n    const input = userInput.toLowerCase();\n    \n    // Exact matches first\n    for (const [key, response] of Object.entries(henryKnowledge)) {\n      if (input.includes(key)) {\n        return response;\n      }\n    }\n\n    // Fuzzy matches\n    if (input.includes('expensive') || input.includes('cheap')) {\n      return henryKnowledge['cost'];\n    }\n    if (input.includes('generate') || input.includes('create')) {\n      return henryKnowledge['cv'];\n    }\n    if (input.includes('practice') || input.includes('mock')) {\n      return henryKnowledge['interview'];\n    }\n    if (input.includes('find') || input.includes('search')) {\n      return henryKnowledge['jobs'];\n    }\n\n    return \"I'm not sure about that specific question. Let me connect you with our support team who can help!\";\n  };\n\n  const shouldEscalateToHuman = (userMessage: string, attempts: number): boolean => {\n    return (\n      attempts >= 3 ||\n      userMessage.toLowerCase().includes('urgent') ||\n      userMessage.toLowerCase().includes('angry') ||\n      userMessage.toLowerCase().includes('refund') ||\n      userMessage.toLowerCase().includes('cancel') ||\n      userMessage.toLowerCase().includes('bug') ||\n      userMessage.toLowerCase().includes('broken') ||\n      userMessage.toLowerCase().includes('error') ||\n      userMessage.toLowerCase().includes('not working') ||\n      userMessage.length > 200\n    );\n  };\n\n  const handleSendMessage = () => {\n    if (!inputValue.trim()) return;\n\n    const userMessage = inputValue.trim();\n    addUserMessage(userMessage);\n    setInputValue('');\n\n    const newAttemptCount = attemptCount + 1;\n    setAttemptCount(newAttemptCount);\n\n    // Check if we should escalate\n    if (shouldEscalateToHuman(userMessage, newAttemptCount)) {\n      setShowEscalation(true);\n      addHenryMessage(\"This seems like a complex question. I'd recommend contacting our human support team for the best help!\");\n      return;\n    }\n\n    // Generate Henry's response\n    setTimeout(() => {\n      const response = findBestResponse(userMessage);\n      addHenryMessage(response);\n    }, 500);\n  };\n\n  const handleEscalateToEmail = () => {\n    // In a real app, this would send the conversation to support\n    addHenryMessage(\"I've notified our support team about your question. You'll hear back within 24 hours at your registered email address!\");\n    setShowEscalation(false);\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const handleClose = () => {\n    setIsOpen(false);\n    onClose?.();\n  };\n\n  // When used in modal mode, always show the chat content\n  useEffect(() => {\n    if (isModal) {\n      setIsOpen(true);\n    }\n  }, [isModal]);\n\n  // Modal mode renders just the chat content without floating wrapper\n  if (isModal) {\n    return (\n      <div className=\"flex flex-col h-full\">\n        {/* Messages */}\n        <div className=\"flex-1 overflow-y-auto p-4 space-y-3\" data-testid=\"henry-messages\">\n          {messages.map((message) => (\n            <div\n              key={message.id}\n              className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}\n            >\n              <div\n                className={`max-w-[80%] p-2 rounded-lg text-sm ${\n                  message.sender === 'user'\n                    ? 'bg-primary text-primary-foreground'\n                    : 'bg-muted text-foreground'\n                }`}\n              >\n                {message.text}\n              </div>\n            </div>\n          ))}\n        </div>\n\n        {/* Escalation Button */}\n        {showEscalation && (\n          <div className=\"p-4 border-t\">\n            <Button \n              onClick={handleEscalateToEmail}\n              variant=\"outline\"\n              className=\"w-full\"\n              size=\"sm\"\n              data-testid=\"button-escalate\"\n            >\n              <Mail className=\"w-4 h-4 mr-2\" />\n              Contact Human Support\n            </Button>\n          </div>\n        )}\n\n        {/* Input */}\n        <div className=\"p-4 border-t\">\n          <div className=\"flex space-x-2\">\n            <input\n              type=\"text\"\n              value={inputValue}\n              onChange={(e) => setInputValue(e.target.value)}\n              onKeyPress={handleKeyPress}\n              placeholder=\"Ask Henry anything...\"\n              className=\"flex-1 px-3 py-2 border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary\"\n              data-testid=\"input-henry\"\n            />\n            <Button \n              onClick={handleSendMessage}\n              size=\"sm\"\n              disabled={!inputValue.trim()}\n              data-testid=\"button-send\"\n            >\n              <Send className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Default floating widget mode\n  return (\n    <div className=\"fixed bottom-4 right-4 z-50\" data-testid=\"henry-chat\">\n      {/* Henry Avatar Button */}\n      {!isOpen && (\n        <Button\n          onClick={() => setIsOpen(true)}\n          className=\"w-16 h-16 rounded-full bg-primary hover:bg-primary/90 p-0 shadow-lg animate-bounce\"\n          data-testid=\"button-henry-open\"\n        >\n          <img \n            src={henryAvatar} \n            alt=\"Henry Helper\" \n            className=\"w-12 h-12 rounded-full object-cover\"\n          />\n        </Button>\n      )}\n\n      {/* Chat Window */}\n      {isOpen && (\n        <Card className=\"w-80 h-96 shadow-xl\">\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2 bg-primary text-primary-foreground rounded-t-lg\">\n            <div className=\"flex items-center space-x-2\">\n              <img \n                src={henryAvatar} \n                alt=\"Henry\" \n                className=\"w-8 h-8 rounded-full object-cover\"\n              />\n              <div>\n                <h3 className=\"font-semibold text-sm\">Henry the Helper</h3>\n                <p className=\"text-xs opacity-90\">NHS Career Assistant</p>\n              </div>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleClose}\n              className=\"h-auto p-1 text-primary-foreground hover:bg-primary-foreground/20\"\n              data-testid=\"button-henry-close\"\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </CardHeader>\n\n          <CardContent className=\"flex flex-col h-80 p-0\">\n            {/* Messages */}\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-3\" data-testid=\"henry-messages\">\n              {messages.map((message) => (\n                <div\n                  key={message.id}\n                  className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}\n                >\n                  <div\n                    className={`max-w-[80%] p-2 rounded-lg text-sm ${\n                      message.sender === 'user'\n                        ? 'bg-primary text-primary-foreground'\n                        : 'bg-muted text-foreground'\n                    }`}\n                  >\n                    {message.text}\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* Escalation Button */}\n            {showEscalation && (\n              <div className=\"p-4 border-t\">\n                <Button \n                  onClick={handleEscalateToEmail}\n                  variant=\"outline\"\n                  className=\"w-full\"\n                  size=\"sm\"\n                  data-testid=\"button-escalate\"\n                >\n                  <Mail className=\"w-4 h-4 mr-2\" />\n                  Contact Human Support\n                </Button>\n              </div>\n            )}\n\n            {/* Input */}\n            <div className=\"p-4 border-t\">\n              <div className=\"flex space-x-2\">\n                <input\n                  type=\"text\"\n                  value={inputValue}\n                  onChange={(e) => setInputValue(e.target.value)}\n                  onKeyPress={handleKeyPress}\n                  placeholder=\"Ask Henry anything...\"\n                  className=\"flex-1 px-3 py-2 border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary\"\n                  data-testid=\"input-henry\"\n                />\n                <Button \n                  onClick={handleSendMessage}\n                  size=\"sm\"\n                  disabled={!inputValue.trim()}\n                  data-testid=\"button-send\"\n                >\n                  <Send className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":12461},"client/src/components/henry-trigger.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { HenryChat } from \"./henry-chat\";\nimport { useSubscription } from \"@/hooks/useSubscription\";\n\ninterface HenryTriggerProps {\n  context?: 'profile' | 'jobs' | 'documents' | 'interview' | 'payment' | 'stuck';\n  profileCompletion?: number;\n  isFirstVisit?: boolean;\n}\n\nexport function HenryTrigger({ context, profileCompletion, isFirstVisit }: HenryTriggerProps) {\n  const [triggerMessage, setTriggerMessage] = useState<string | undefined>();\n  const [showHenry, setShowHenry] = useState(false);\n  const { isPaid } = useSubscription();\n\n  useEffect(() => {\n    // Don't show Henry immediately on first page load\n    const timer = setTimeout(() => {\n      let message: string | undefined;\n\n      switch (context) {\n        case 'profile':\n          if (profileCompletion && profileCompletion < 70) {\n            message = `I notice your profile is ${profileCompletion}% complete. Shall I help you finish it?`;\n          }\n          break;\n          \n        case 'jobs':\n          if (isFirstVisit) {\n            message = 'Ready to find your perfect NHS role? I can show you the best filters!';\n          }\n          break;\n          \n        case 'documents':\n          if (!isPaid) {\n            message = 'Creating your first Supporting Information? I have some tips!';\n          }\n          break;\n          \n        case 'interview':\n          message = 'Nervous about interviews? Let me help you practice NHS-style questions!';\n          break;\n          \n        case 'payment':\n          if (!isPaid) {\n            message = 'Questions about upgrading? I can explain what you\\'ll unlock!';\n          }\n          break;\n          \n        case 'stuck':\n          message = 'Need help? I\\'m here to guide you!';\n          break;\n      }\n\n      if (message) {\n        setTriggerMessage(message);\n        setShowHenry(true);\n      }\n    }, 3000); // Show after 3 seconds\n\n    return () => clearTimeout(timer);\n  }, [context, profileCompletion, isFirstVisit, isPaid]);\n\n  if (!showHenry) return null;\n\n  return (\n    <HenryChat \n      triggerMessage={triggerMessage}\n      onClose={() => setShowHenry(false)}\n    />\n  );\n}","size_bytes":2174},"client/src/components/progress-ring.tsx":{"content":"interface ProgressRingProps {\n  percentage: number;\n  size?: number;\n  strokeWidth?: number;\n}\n\nexport function ProgressRing({ \n  percentage, \n  size = 48, \n  strokeWidth = 3 \n}: ProgressRingProps) {\n  const radius = (size - strokeWidth) / 2;\n  const circumference = 2 * Math.PI * radius;\n  const offset = circumference - (percentage / 100) * circumference;\n\n  return (\n    <div className=\"relative\" style={{ width: size, height: size }}>\n      <svg \n        className=\"progress-ring\" \n        width={size} \n        height={size} \n        viewBox={`0 0 ${size} ${size}`}\n        data-testid=\"progress-ring\"\n      >\n        <circle\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          fill=\"none\"\n          stroke=\"var(--border)\"\n          strokeWidth={strokeWidth}\n        />\n        <circle\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          fill=\"none\"\n          stroke=\"var(--accent)\"\n          strokeWidth={strokeWidth}\n          strokeDasharray={circumference}\n          strokeDashoffset={offset}\n          strokeLinecap=\"round\"\n        />\n      </svg>\n      <div className=\"absolute inset-0 flex items-center justify-center\">\n        <span \n          className=\"text-xs font-medium text-accent\"\n          data-testid=\"text-progress-percentage\"\n        >\n          {percentage}%\n        </span>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1385},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}\n","size_bytes":257},"client/src/hooks/useSubscription.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"./useAuth\";\nimport type { SubscriptionStatus, Feature } from \"@shared/schema\";\nimport { FEATURE_ACCESS } from \"@shared/schema\";\n\nexport function useSubscription() {\n  const { user, isAuthenticated } = useAuth();\n\n  const subscriptionStatus: SubscriptionStatus = 'paid'; // Set to paid to show premium experience\n  const isPaid = subscriptionStatus === 'paid';\n  \n  const canAccessFeature = (feature: Feature): boolean => {\n    return FEATURE_ACCESS[feature].includes(subscriptionStatus);\n  };\n\n  const { data: jobLimits } = useQuery({\n    queryKey: ['/api/user/job-limits'],\n    enabled: isAuthenticated && !isPaid,\n    refetchOnWindowFocus: false,\n  });\n\n  return {\n    subscriptionStatus,\n    isPaid,\n    canAccessFeature,\n    jobViewsRemaining: jobLimits?.remaining || 0,\n    hasJobViewsLeft: (jobLimits?.remaining || 0) > 0,\n  };\n}","size_bytes":910},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}","size_bytes":115},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\n// CSRF token management\nlet cachedCSRFToken: string | null = null;\n\nasync function getCSRFToken(): Promise<string> {\n  if (!cachedCSRFToken) {\n    const response = await fetch('/api/csrf-token', {\n      credentials: 'include',\n    });\n    if (!response.ok) {\n      throw new Error('Failed to get CSRF token');\n    }\n    const data = await response.json();\n    cachedCSRFToken = data.csrfToken;\n  }\n  return cachedCSRFToken;\n}\n\nfunction clearCSRFToken() {\n  cachedCSRFToken = null;\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const headers: Record<string, string> = data ? { \"Content-Type\": \"application/json\" } : {};\n  \n  // Add CSRF token for state-changing requests\n  const stateChangingMethods = ['POST', 'PUT', 'PATCH', 'DELETE'];\n  if (stateChangingMethods.includes(method.toUpperCase())) {\n    try {\n      const csrfToken = await getCSRFToken();\n      headers['x-csrf-token'] = csrfToken;\n    } catch (error) {\n      console.error('Failed to get CSRF token:', error);\n      // Continue without CSRF token - let the server handle the error\n    }\n  }\n\n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  // If CSRF token is invalid, clear cache and retry once\n  if (res.status === 403 && stateChangingMethods.includes(method.toUpperCase())) {\n    const errorText = await res.text();\n    if (errorText.includes('CSRF')) {\n      clearCSRFToken();\n      \n      // Retry with fresh token\n      const newToken = await getCSRFToken();\n      headers['x-csrf-token'] = newToken;\n      \n      const retryRes = await fetch(url, {\n        method,\n        headers,\n        body: data ? JSON.stringify(data) : undefined,\n        credentials: \"include\",\n      });\n      \n      await throwIfResNotOk(retryRes);\n      return retryRes;\n    }\n    \n    // Re-throw the original error if not CSRF related\n    throw new Error(`${res.status}: ${errorText}`);\n  }\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":3089},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/dashboard.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useSubscription } from \"@/hooks/useSubscription\";\nimport { UpgradePrompt } from \"@/components/ui/upgrade-prompt\";\nimport Header from \"@/components/dashboard/header\";\nimport SectionCard from \"@/components/dashboard/section-card\";\nimport RecentActivity from \"@/components/dashboard/recent-activity\";\nimport { Footer } from \"@/components/footer\";\nimport { HenryChat } from \"@/components/henry-chat\";\nimport { MarketingConsentWidget } from \"@/components/marketing-consent-widget\";\nimport { AnalyticsConsentWidget } from \"@/components/analytics-consent-widget\";\nimport { HenryOnboarding } from \"@/components/henry-onboarding\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  User, \n  Search, \n  FileText, \n  BookOpen, \n  Mic, \n  MessageCircleQuestion,\n  BarChart3,\n  Settings,\n  GripVertical,\n  Newspaper,\n  Crown,\n  HelpCircle,\n  Users\n} from \"lucide-react\";\nimport type { DashboardData, UserWithProfile } from \"@shared/schema\";\nimport { FEATURES } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { getPersonalizedGreeting, getGreetingSubtext } from \"@/lib/greeting-utils\";\nimport { RotatingStatsBar } from \"@/components/rotating-stats-bar\";\nimport { RotatingTip } from \"@/components/rotating-tip\";\n\nimport {\n  DndContext,\n  closestCenter,\n  KeyboardSensor,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  DragEndEvent,\n} from \"@dnd-kit/core\";\nimport {\n  arrayMove,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  verticalListSortingStrategy,\n} from \"@dnd-kit/sortable\";\nimport {\n  useSortable,\n} from \"@dnd-kit/sortable\";\nimport { CSS } from \"@dnd-kit/utilities\";\n\n// Sortable Card Component\nfunction SortableCard({ card, isCustomizing }: { card: any; isCustomizing: boolean }) {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({ id: card.id });\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1,\n  };\n\n  return (\n    <div\n      ref={setNodeRef}\n      style={style}\n      className={`relative h-full ${isDragging ? 'z-50' : ''}`}\n      data-testid={`sortable-card-${card.id}`}\n    >\n      {isCustomizing && (\n        <div\n          {...attributes}\n          {...listeners}\n          className=\"absolute top-2 right-2 z-10 p-1 bg-white rounded shadow-md cursor-move hover:bg-gray-50\"\n          data-testid={`drag-handle-${card.id}`}\n        >\n          <GripVertical className=\"h-4 w-4 text-gray-400\" />\n        </div>\n      )}\n      <SectionCard {...card} />\n    </div>\n  );\n}\n\nexport default function Dashboard() {\n  const { toast } = useToast();\n  const { isAuthenticated, isLoading } = useAuth();\n  const { isPaid, jobViewsRemaining, hasJobViewsLeft, canAccessFeature } = useSubscription();\n  const [isCustomizing, setIsCustomizing] = useState(false);\n  const [localCardOrder, setLocalCardOrder] = useState<string[]>([]);\n  const [showOnboarding, setShowOnboarding] = useState(false);\n  const [hasCompletedOnboardingThisSession, setHasCompletedOnboardingThisSession] = useState(false);\n  const queryClient = useQueryClient();\n\n  // Redirect to login if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  const { data: dashboardData, isLoading: isDashboardLoading } = useQuery<DashboardData>({\n    queryKey: [\"/api/dashboard\"],\n    retry: false,\n    enabled: isAuthenticated,\n  });\n\n  const { data: user } = useQuery<UserWithProfile>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n    enabled: isAuthenticated,\n  });\n\n  // Fetch onboarding status\n  const { data: onboardingStatus } = useQuery<{hasCompletedOnboarding: boolean, hasCompletedPremiumOnboarding: boolean, subscriptionStatus: string}>({\n    queryKey: [\"/api/onboarding/status\"],\n    retry: false,\n    enabled: isAuthenticated,\n  });\n\n  // Fetch dashboard card order\n  const { data: cardOrder } = useQuery<string[]>({\n    queryKey: [\"/api/dashboard/card-order\"],\n    retry: false,\n    enabled: isAuthenticated,\n  });\n\n  // Update card order mutation\n  const updateCardOrder = useMutation({\n    mutationFn: async (newOrder: string[]) => {\n      const response = await apiRequest('PUT', '/api/dashboard/card-order', { cardOrder: newOrder });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/card-order\"] });\n      toast({\n        title: \"Dashboard Updated\",\n        description: \"Your dashboard layout has been saved.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to save dashboard layout.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Initialize local card order when data loads\n  useEffect(() => {\n    if (cardOrder && cardOrder.length > 0) {\n      setLocalCardOrder(cardOrder);\n    }\n  }, [cardOrder]);\n\n  // Complete onboarding mutation\n  const completeOnboardingMutation = useMutation({\n    mutationFn: async (type: 'free' | 'premium') => {\n      const response = await apiRequest('POST', '/api/onboarding/complete', { type });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/onboarding/status\"] });\n      toast({\n        title: \"Welcome to HealthHire Portal!\",\n        description: \"You're all set to accelerate your NHS career journey.\",\n      });\n    },\n  });\n\n  // Check if user needs onboarding\n  useEffect(() => {\n    if (!onboardingStatus || !user) return;\n    \n    // If user has already completed onboarding, never show it again\n    if (onboardingStatus.hasCompletedOnboarding) {\n      setShowOnboarding(false);\n      return;\n    }\n    \n    // If user has already seen onboarding this session, don't show it again\n    if (hasCompletedOnboardingThisSession) return;\n    \n    const needsOnboarding = (\n      // First time user (free) - only if they haven't completed onboarding\n      (!onboardingStatus.hasCompletedOnboarding) ||\n      // Premium user who hasn't done premium onboarding\n      (isPaid && !onboardingStatus.hasCompletedPremiumOnboarding)\n    );\n    \n    if (needsOnboarding && !showOnboarding) {\n      // Small delay to let dashboard load first\n      setTimeout(() => {\n        setShowOnboarding(true);\n      }, 1000);\n    }\n  }, [onboardingStatus, user, isPaid, showOnboarding, hasCompletedOnboardingThisSession]);\n\n  // Drag sensors\n  const sensors = useSensors(\n    useSensor(PointerSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    })\n  );\n\n  // Handle drag end\n  function handleDragEnd(event: DragEndEvent) {\n    const { active, over } = event;\n\n    if (over && active.id !== over.id) {\n      const oldIndex = localCardOrder.indexOf(active.id as string);\n      const newIndex = localCardOrder.indexOf(over.id as string);\n      const newOrder = arrayMove(localCardOrder, oldIndex, newIndex);\n      setLocalCardOrder(newOrder);\n    }\n  }\n\n  // Save customization\n  const saveCustomization = () => {\n    updateCardOrder.mutate(localCardOrder);\n    setIsCustomizing(false);\n  };\n\n  // Cancel customization\n  const cancelCustomization = () => {\n    setLocalCardOrder(cardOrder || []);\n    setIsCustomizing(false);\n  };\n\n  if (isLoading || isDashboardLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading your dashboard...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const sectionCards = [\n    {\n      id: \"profile\",\n      title: \"Candidate Profile\",\n      description: \"Build your comprehensive healthcare professional profile with NHS-specific expertise\",\n      icon: User,\n      iconColor: \"text-blue-600\",\n      iconBg: \"bg-blue-100 dark:bg-blue-900\",\n      value: null,\n      label: null,\n      valueColor: \"text-accent\",\n      actionText: \"Complete your profile\",\n      actionSubtext: \"Add your qualifications and experience\",\n      href: \"/profile\",\n      isPremium: false,\n      feature: null\n    },\n    {\n      id: \"jobs\",\n      title: \"Job Finder\",\n      description: \"Intelligent NHS job matching with role fit scoring and eligibility filtering\",\n      icon: Search,\n      iconColor: \"text-emerald-600\",\n      iconBg: \"bg-emerald-100 dark:bg-emerald-900\",\n      value: null,\n      label: null,\n      valueColor: \"text-secondary\",\n      actionText: isPaid ? \"NHS healthcare roles available\" : \"Preview job matching features\",\n      actionSubtext: isPaid ? \"Find your perfect NHS position\" : \"Upgrade to unlock full search\",\n      href: \"/jobs\",\n      isPremium: true,\n      feature: FEATURES.UNLIMITED_SEARCH\n    },\n    {\n      id: \"documents\",\n      title: \"Application Documents\",\n      description: \"Generate tailored Supporting Information for NHS applications and view your master CV\",\n      icon: FileText,\n      iconColor: \"text-amber-600\",\n      iconBg: \"bg-amber-100 dark:bg-amber-900\",\n      value: null,\n      label: null,\n      valueColor: null,\n      actionText: isPaid ? (dashboardData?.latestDocument ? `Latest: ${dashboardData.latestDocument.title}` : \"No Supporting Information yet\") : \"Preview document generation\",\n      actionSubtext: isPaid ? (dashboardData?.latestDocument ? \"Ready for job applications\" : \"Generate job-specific Supporting Information\") : \"Upgrade to unlock document generation\",\n      href: \"/ai-documents\",\n      isPremium: true,\n      feature: FEATURES.AI_GENERATION\n    },\n    {\n      id: \"resources\",\n      title: \"Resources Hub\",\n      description: \"NHS guides, checklists, mini-courses and CPD tracking for career development\",\n      icon: BookOpen,\n      iconColor: \"text-indigo-600\",\n      iconBg: \"bg-indigo-100 dark:bg-indigo-900\",\n      value: null,\n      label: null,\n      valueColor: null,\n      actionText: isPaid ? \"Interview Success Guide\" : \"Preview resource library\",\n      actionSubtext: isPaid ? \"Master NHS values-based interviews\" : \"Upgrade to download resources\",\n      href: \"/resources\",\n      isPremium: true,\n      feature: \"resources_hub\"\n    },\n    {\n      id: \"practice\",\n      title: \"Interview Practice\",\n      description: \"Get realistic NHS interview questions and harsh but constructive feedback from Henry the Helper\",\n      icon: Mic,\n      iconColor: \"text-rose-600\",\n      iconBg: \"bg-rose-100 dark:bg-rose-900\",\n      value: null,\n      label: null,\n      valueColor: \"text-accent\",\n      actionText: isPaid ? \"Practice with Henry\" : \"Preview interview practice\",\n      actionSubtext: isPaid ? \"Get honest feedback to improve your skills\" : \"Upgrade to unlock interview practice\",\n      href: \"/interview-practice\",\n      isPremium: true,\n      feature: FEATURES.INTERVIEW_PRACTICE\n    },\n    {\n      id: \"qa\",\n      title: \"Q&A Generator\",\n      description: \"Role-specific interview questions with model answers and practice planning\",\n      icon: MessageCircleQuestion,\n      iconColor: \"text-cyan-600\",\n      iconBg: \"bg-cyan-100 dark:bg-cyan-900\",\n      value: null,\n      label: null,\n      valueColor: null,\n      actionText: isPaid ? \"Generate practice questions\" : \"Preview question generation\",\n      actionSubtext: isPaid ? \"Tailored to your target roles\" : \"Upgrade to generate custom Q&As\",\n      href: \"/qa\",\n      isPremium: true,\n      feature: FEATURES.QA_GENERATOR\n    },\n    {\n      id: \"tracker\",\n      title: \"Job Tracker & Analytics\",\n      description: \"Kanban board for applications with KPIs and motivational dashboard\",\n      icon: BarChart3,\n      iconColor: \"text-violet-600\",\n      iconBg: \"bg-violet-100 dark:bg-violet-900\",\n      value: null,\n      label: null,\n      valueColor: \"text-primary\",\n      actionText: isPaid ? `${dashboardData?.successRate || 0}% success rate` : \"Preview application tracking\",\n      actionSubtext: isPaid ? `${dashboardData?.interviewsThisWeek || 0} interviews scheduled` : \"Upgrade to track applications\",\n      href: \"/tracker\",\n      isPremium: true,\n      feature: FEATURES.JOB_TRACKING\n    },\n    {\n      id: \"news\",\n      title: \"News & Updates\",\n      description: \"Latest NHS updates, policy changes, and platform announcements to keep you informed\",\n      icon: Newspaper,\n      iconColor: \"text-teal-600\",\n      iconBg: \"bg-teal-100 dark:bg-teal-900\",\n      value: null,\n      label: null,\n      valueColor: null,\n      actionText: \"Latest: New NHS Pay Framework\",\n      actionSubtext: \"Stay updated with important changes\",\n      href: \"/news\",\n      isPremium: false,\n      feature: null\n    },\n    {\n      id: \"referrals\",\n      title: \"Referral Program\",\n      description: \"Earn rewards by referring healthcare professionals to HealthHire Portal\",\n      icon: Users,\n      iconColor: \"text-purple-600\",\n      iconBg: \"bg-purple-100 dark:bg-purple-900\",\n      value: null,\n      label: null,\n      valueColor: null,\n      actionText: \"Coming Soon\",\n      actionSubtext: \"Refer friends and earn rewards\",\n      href: \"/referrals\",\n      isPremium: true,\n      feature: \"referral_program\"\n    },\n    {\n      id: \"support\",\n      title: \"Support Center\",\n      description: \"Get help from Henry the Helper, browse common issues, or submit a support ticket\",\n      icon: HelpCircle,\n      iconColor: \"text-green-600\",\n      iconBg: \"bg-green-100 dark:bg-green-900\",\n      value: null,\n      label: null,\n      valueColor: null,\n      actionText: \"Chat with Henry the Helper\",\n      actionSubtext: \"Get instant answers to common questions\",\n      href: \"/support\",\n      isPremium: false,\n      feature: null\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\" data-testid=\"dashboard-page\">\n      <Header \n        user={user ? {\n          firstName: user.firstName || undefined,\n          lastName: user.lastName || undefined,\n          profileImageUrl: user.profileImageUrl || undefined\n        } : undefined} \n        profileCompletion={dashboardData?.profileCompletion || 0} \n      />\n      \n      <main className=\"max-w-7xl mx-auto px-6 lg:px-8 py-12\">\n        {/* Enhanced Welcome Section */}\n        <div className=\"relative mb-16\">\n          {/* Enhanced Background decoration with more dynamic elements */}\n          <div className=\"absolute inset-0 -top-8 -bottom-8 opacity-40\">\n            <div className=\"absolute top-0 right-20 w-32 h-32 bg-gradient-to-br from-primary/20 to-secondary/10 rounded-full blur-2xl animate-pulse\"></div>\n            <div className=\"absolute bottom-0 left-20 w-24 h-24 bg-gradient-to-tr from-accent/15 to-primary/10 rounded-full blur-xl animate-pulse delay-1000\"></div>\n            <div className=\"absolute top-1/2 right-1/3 w-16 h-16 bg-gradient-to-bl from-secondary/10 to-accent/5 rounded-full blur-lg animate-pulse delay-500\"></div>\n            <div className=\"absolute bottom-1/3 left-1/4 w-20 h-20 bg-gradient-to-tl from-primary/5 to-secondary/15 rounded-full blur-xl animate-pulse delay-1500\"></div>\n          </div>\n          \n          <div className=\"relative bg-gradient-to-br from-card via-card/98 to-card/95 backdrop-blur-md border border-border/40 rounded-3xl p-10 shadow-2xl hover:shadow-3xl transition-all duration-700 hover:scale-[1.02] group\">\n            {/* Animated border glow effect */}\n            <div className=\"absolute inset-0 rounded-3xl bg-gradient-to-r from-primary/20 via-transparent to-accent/20 opacity-0 group-hover:opacity-100 transition-opacity duration-700 -z-10 blur-xl\"></div>\n            \n            <div className=\"flex items-start gap-6\">\n              <div className=\"flex-shrink-0\">\n                <div className=\"w-16 h-16 bg-gradient-to-br from-primary/20 to-accent/20 rounded-2xl flex items-center justify-center shadow-lg\">\n                  <div className=\"w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-full animate-pulse shadow-md\"></div>\n                </div>\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <h2 className=\"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-foreground via-primary/80 to-foreground bg-clip-text text-transparent mb-3 leading-tight\" data-testid=\"text-greeting\">\n                  {getPersonalizedGreeting(user)}\n                </h2>\n                <p className=\"text-muted-foreground text-lg lg:text-xl leading-relaxed font-medium\">\n                  {getGreetingSubtext()}\n                </p>\n              </div>\n            </div>\n            \n            {/* Enhanced accent elements */}\n            <div className=\"absolute bottom-0 left-10 right-10 h-1 bg-gradient-to-r from-transparent via-primary/30 through-accent/20 to-transparent rounded-full\"></div>\n            <div className=\"absolute -bottom-2 left-1/2 transform -translate-x-1/2 w-32 h-2 bg-gradient-to-r from-transparent via-primary/20 to-transparent rounded-full blur-sm\"></div>\n          </div>\n        </div>\n\n        {/* Free Tier Status Banner */}\n        {!isPaid && (\n          <UpgradePrompt \n            title=\"Limited Access - Upgrade to Unlock All Features\"\n            description=\"Get unlimited job searching, AI document generation, interview practice, and more for ¬£70 one-time\"\n            variant=\"banner\"\n            className=\"mb-8\"\n          />\n        )}\n\n        {/* Marketing Consent Widget */}\n        <div className=\"mb-6\">\n          <MarketingConsentWidget />\n        </div>\n\n        {/* NHS Career Tips */}\n        <RotatingTip />\n\n        {/* Weekly Activity Stats Bar */}\n        <RotatingStatsBar />\n\n        {/* Enhanced Dashboard Customization Controls */}\n        <div className=\"flex justify-between items-center mb-12\">\n          <div className=\"relative\">\n            <div className=\"flex items-center gap-3 mb-2\">\n              <div className=\"w-8 h-8 bg-gradient-to-br from-primary/20 to-accent/20 rounded-lg flex items-center justify-center\">\n                <div className=\"w-3 h-3 bg-primary rounded-full animate-pulse\"></div>\n              </div>\n              <h3 className=\"text-2xl font-bold text-foreground\">Your Dashboard</h3>\n            </div>\n            <p className=\"text-muted-foreground leading-relaxed\">Drag and drop cards to customize your layout</p>\n          </div>\n          <div className=\"flex gap-3\">\n            {!isCustomizing ? (\n              <Button\n                variant=\"outline\"\n                onClick={() => setIsCustomizing(true)}\n                className=\"flex items-center gap-2 border-2 hover:border-primary/30 transition-all duration-300 shadow-lg hover:shadow-xl\"\n                data-testid=\"customize-dashboard-button\"\n              >\n                <Settings className=\"h-4 w-4\" />\n                Customize Layout\n              </Button>\n            ) : (\n              <>\n                <Button\n                  variant=\"outline\"\n                  onClick={cancelCustomization}\n                  className=\"shadow-lg hover:shadow-xl transition-all duration-300\"\n                  data-testid=\"cancel-customization-button\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  onClick={saveCustomization}\n                  disabled={updateCardOrder.isPending}\n                  className=\"bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 shadow-lg hover:shadow-xl transition-all duration-300\"\n                  data-testid=\"save-customization-button\"\n                >\n                  {updateCardOrder.isPending ? \"Saving...\" : \"Save Layout\"}\n                </Button>\n              </>\n            )}\n          </div>\n        </div>\n\n        {/* 7 Core Section Cards Grid - Now Sortable */}\n        <DndContext\n          sensors={sensors}\n          collisionDetection={closestCenter}\n          onDragEnd={handleDragEnd}\n        >\n          <SortableContext\n            items={localCardOrder}\n            strategy={verticalListSortingStrategy}\n          >\n            <div className={`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16 items-stretch transition-all duration-500 ${isCustomizing ? 'bg-gradient-to-br from-blue-50/80 via-primary/5 to-accent/5 dark:from-blue-900/20 dark:via-primary/10 dark:to-accent/10 p-8 rounded-3xl border-2 border-dashed border-blue-300/60 dark:border-blue-600/40 shadow-2xl backdrop-blur-sm' : ''}`} data-testid=\"section-cards-grid\">\n              {(localCardOrder.length > 0 ? localCardOrder : [\"profile\", \"jobs\", \"documents\", \"resources\", \"practice\", \"qa\", \"tracker\", \"news\", \"referrals\", \"support\"]).map((cardId) => {\n                const card = sectionCards.find(c => c.id === cardId);\n                return card ? (\n                  <SortableCard key={card.id} card={card} isCustomizing={isCustomizing} />\n                ) : null;\n              })}\n            </div>\n          </SortableContext>\n        </DndContext>\n\n        {/* Recent Activity */}\n        <RecentActivity applications={dashboardData?.recentApplications || []} />\n      </main>\n\n      <Footer />\n\n      {/* Analytics Consent Widget - shows randomly once per day */}\n      <AnalyticsConsentWidget />\n\n      {/* Henry Onboarding */}\n      {showOnboarding && (\n        <HenryOnboarding\n          isPremium={isPaid}\n          onComplete={() => {\n            setShowOnboarding(false);\n            setHasCompletedOnboardingThisSession(true);\n            completeOnboardingMutation.mutate(isPaid ? 'premium' : 'free');\n          }}\n          onSkip={() => {\n            setShowOnboarding(false);\n            setHasCompletedOnboardingThisSession(true);\n            completeOnboardingMutation.mutate(isPaid ? 'premium' : 'free');\n          }}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":22218},"client/src/pages/documents.tsx":{"content":"import { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { HenryTrigger } from \"@/components/henry-trigger\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ArrowLeft, FileText, Download, Eye } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { Document } from \"@shared/schema\";\nimport { useSubscription } from \"@/hooks/useSubscription\";\nimport { UpgradePrompt } from \"@/components/ui/upgrade-prompt\";\nimport { FEATURES } from \"@shared/schema\";\n\nexport default function Documents() {\n  const [, setLocation] = useLocation();\n  const { canAccessFeature } = useSubscription();\n\n  const { data: documents } = useQuery<Document[]>({\n    queryKey: [\"/api/documents\"],\n  });\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"max-w-7xl mx-auto px-6 lg:px-8 py-12\">\n        {/* Breadcrumb */}\n        <div className=\"flex items-center space-x-2 mb-8\">\n          <Button \n            variant=\"ghost\" \n            size=\"sm\"\n            onClick={() => setLocation(\"/\")}\n            data-testid=\"button-back-to-dashboard\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Dashboard\n          </Button>\n        </div>\n\n        {/* Page Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-foreground mb-2\">Application Documents</h1>\n          <p className=\"text-muted-foreground text-lg\">\n            Generate tailored CVs and Supporting Information with NHS values alignment\n          </p>\n        </div>\n\n        {/* Document Generation Tools */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <FileText className=\"w-5 h-5\" />\n                <span>CV Generator</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground mb-4\">\n                Create NHS-compliant CVs with STAR methodology and evidence-based outcomes\n              </p>\n              <Button \n                className=\"w-full\" \n                data-testid=\"button-generate-cv\"\n                disabled={!canAccessFeature(FEATURES.AI_GENERATION)}\n              >\n                {canAccessFeature(FEATURES.AI_GENERATION) ? 'Generate New CV' : 'üîí Premium Feature'}\n              </Button>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <FileText className=\"w-5 h-5\" />\n                <span>Supporting Information</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground mb-4\">\n                Generate 900-1200 word Supporting Information with NHS values mapping\n              </p>\n              <Button \n                className=\"w-full\" \n                data-testid=\"button-generate-supporting-info\"\n                disabled={!canAccessFeature(FEATURES.AI_GENERATION)}\n              >\n                {canAccessFeature(FEATURES.AI_GENERATION) ? 'Generate Supporting Info' : 'üîí Premium Feature'}\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Generated Documents List */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Your Generated Documents</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {documents?.length ? (\n              <div className=\"space-y-4\">\n                {documents.map((doc) => (\n                  <div key={doc.id} className=\"flex items-center justify-between p-4 border border-border rounded-lg\">\n                    <div className=\"flex items-center space-x-3\">\n                      <FileText className=\"w-5 h-5 text-muted-foreground\" />\n                      <div>\n                        <p className=\"font-medium text-foreground\">\n                          {doc.type === 'cv' ? 'CV' : \n                           doc.type === 'supporting_info' ? 'Supporting Information' : \n                           'Cover Letter'} v{doc.version}\n                        </p>\n                        <p className=\"text-sm text-muted-foreground\">\n                          Created {doc.createdAt ? new Date(doc.createdAt).toLocaleDateString() : 'Unknown'}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"flex space-x-2\">\n                      <Button variant=\"outline\" size=\"sm\" data-testid={`button-view-document-${doc.id}`}>\n                        <Eye className=\"w-4 h-4 mr-2\" />\n                        View\n                      </Button>\n                      <Button variant=\"outline\" size=\"sm\" data-testid={`button-download-document-${doc.id}`}>\n                        <Download className=\"w-4 h-4 mr-2\" />\n                        Download\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              !canAccessFeature(FEATURES.AI_GENERATION) ? (\n                <UpgradePrompt \n                  title=\"AI Document Generation Locked\" \n                  description=\"Generate NHS-specific CVs and Supporting Information with AI for ¬£70 one-time\"\n                  variant=\"card\"\n                />\n              ) : (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <FileText className=\"w-16 h-16 mx-auto mb-4 text-muted-foreground/50\" />\n                  <h3 className=\"text-lg font-medium mb-2\">No Documents Yet</h3>\n                  <p className=\"mb-4\">Generate your first NHS-optimized CV or Supporting Information</p>\n                  <Button data-testid=\"button-create-first-document\">Create Your First Document</Button>\n                </div>\n              )\n            )}\n          </CardContent>\n        </Card>\n      </main>\n      \n      <Footer />\n      \n      {/* Henry the Helper - Documents Context */}\n      <HenryTrigger context=\"documents\" />\n    </div>\n  );\n}\n","size_bytes":6328},"client/src/pages/interview-practice.tsx":{"content":"import { HenryInterviewPractice } from \"@/components/HenryInterviewPractice\";\nimport Header from \"@/components/dashboard/header\";\nimport { Footer } from \"@/components/footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft } from \"lucide-react\";\n\nexport default function InterviewPracticePage() {\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <Header />\n      <main className=\"flex-1 container mx-auto px-4 py-8 max-w-4xl\">\n        <Button \n          variant=\"outline\" \n          onClick={() => window.location.href = '/'}\n          className=\"mb-6\"\n          data-testid=\"button-back-dashboard\"\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Dashboard\n        </Button>\n        \n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-foreground mb-3\">Interview Practice</h1>\n          <p className=\"text-muted-foreground max-w-2xl\">\n            Practice NHS interviews with Henry's help. Get realistic questions and constructive feedback to improve your performance and land your dream healthcare job.\n          </p>\n        </div>\n        \n        <HenryInterviewPractice />\n      </main>\n      <Footer />\n    </div>\n  );\n}","size_bytes":1235},"client/src/pages/job-finder.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Search, Filter, MapPin, Clock, Briefcase, Heart, ArrowLeft, AlertTriangle, CheckCircle, Lightbulb, Info } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { useLocation } from \"wouter\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useSubscription } from \"@/hooks/useSubscription\";\nimport { UpgradePrompt } from \"@/components/UpgradePrompt\";\nimport { Crown, Lock } from \"lucide-react\";\n\ninterface NhsJob {\n  id: string;\n  title: string;\n  employer: string;\n  location: string;\n  band: string;\n  salaryMin?: number;\n  salaryMax?: number;\n  description: string;\n  personSpec?: string;\n  visaSponsorship: boolean;\n  featured: boolean;\n  closingDate?: string;\n  externalId?: string;\n}\n\ninterface JobMatch {\n  id: string;\n  userId: string;\n  jobId: string;\n  fitScore: number;\n  matchData: any;\n}\n\nexport default function JobFinder() {\n  const { isAuthenticated, isLoading } = useAuth();\n  const { isPaid, canAccessFeature } = useSubscription();\n  const [, setLocation] = useLocation();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [filters, setFilters] = useState({\n    band: \"\",\n    location: \"\"\n  });\n  const [selectedJob, setSelectedJob] = useState<NhsJob | null>(null);\n  \n  const canAccessSearch = canAccessFeature('unlimited_search');\n  \n  // Sample jobs for preview mode\n  const sampleJobs: NhsJob[] = [\n    {\n      id: \"sample-1\",\n      title: \"Band 6 Staff Nurse - Acute Medicine\",\n      employer: \"London NHS Foundation Trust\",\n      location: \"London, Greater London\",\n      band: \"Band 6\",\n      salaryMin: 35392,\n      salaryMax: 42618,\n      description: \"Join our dynamic acute medicine team. We're looking for a compassionate and skilled nurse to provide high-quality patient care...\",\n      visaSponsorship: true,\n      featured: true,\n      closingDate: \"2024-01-15\"\n    },\n    {\n      id: \"sample-2\", \n      title: \"Senior Physiotherapist\",\n      employer: \"Birmingham Community Healthcare\",\n      location: \"Birmingham, West Midlands\",\n      band: \"Band 7\",\n      salaryMin: 40057,\n      salaryMax: 45839,\n      description: \"Exciting opportunity for an experienced physiotherapist to lead our community rehabilitation services...\",\n      visaSponsorship: false,\n      featured: false,\n      closingDate: \"2024-01-20\"\n    },\n    {\n      id: \"sample-3\",\n      title: \"Healthcare Assistant\",\n      employer: \"Manchester Royal Infirmary\",\n      location: \"Manchester, Greater Manchester\", \n      band: \"Band 3\",\n      salaryMin: 22383,\n      salaryMax: 24336,\n      description: \"Support our nursing team in providing excellent patient care. Full training provided for the right candidate...\",\n      visaSponsorship: true,\n      featured: false,\n      closingDate: \"2024-01-18\"\n    }\n  ];\n  \n  const queryClient = useQueryClient();\n\n  // Fetch jobs with search and filters\n  const { data: jobs, isLoading: jobsLoading, error: jobsError } = useQuery({\n    queryKey: ['/api/jobs', searchQuery, filters],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (searchQuery) params.append('search', searchQuery);\n      if (filters.band && filters.band !== 'all-bands') params.append('band', filters.band);\n      if (filters.location) params.append('location', filters.location);\n      \n      const response = await apiRequest('GET', `/api/jobs?${params}`);\n      return response.json();\n    },\n    retry: false,\n  });\n\n\n  const handleSearch = (e: React.FormEvent) => {\n    e.preventDefault();\n    // Query will auto-refetch due to dependency on searchQuery\n  };\n\n  const resetFilters = () => {\n    setSearchQuery(\"\");\n    setFilters({\n      band: \"\",\n      location: \"\"\n    });\n  };\n\n  const JobCard = ({ job, isBlurred = false, index = 0 }: { job: NhsJob; isBlurred?: boolean; index?: number }) => {\n    const handleViewDetails = (e: React.MouseEvent) => {\n      e.stopPropagation();\n      setLocation(`/jobs/${job.id}`);\n    };\n\n    return (\n      <div className=\"relative\">\n        <Card \n          className={`transition-all hover:shadow-lg ${isBlurred ? 'overflow-hidden' : ''}`}\n          data-testid={`job-card-${job.id}`}\n        >\n        <CardHeader className={`pb-3 ${isBlurred ? 'filter blur-sm' : ''}`}>\n          <div className=\"flex items-start justify-between\">\n            <div className=\"flex-1\">\n              <CardTitle className=\"text-lg font-semibold text-gray-900 mb-1\" data-testid={`job-title-${job.id}`}>\n                {job.title}\n              </CardTitle>\n              <p className=\"text-blue-600 font-medium\" data-testid={`job-employer-${job.id}`}>{job.employer}</p>\n            </div>\n          </div>\n        </CardHeader>\n        \n        <CardContent className={isBlurred ? 'filter blur-sm' : ''}>\n          <div className=\"space-y-3\">\n            {/* Job Details */}\n            <div className=\"flex flex-wrap gap-4 text-sm text-gray-600\">\n              <div className=\"flex items-center gap-1\">\n                <MapPin className=\"h-4 w-4\" />\n                <span data-testid={`job-location-${job.id}`}>{job.location}</span>\n              </div>\n              <div className=\"flex items-center gap-1\">\n                <Briefcase className=\"h-4 w-4\" />\n                <span data-testid={`job-band-${job.id}`}>{job.band}</span>\n              </div>\n              {job.closingDate && (\n                <div className=\"flex items-center gap-1\">\n                  <Clock className=\"h-4 w-4\" />\n                  <span>Closes: {new Date(job.closingDate).toLocaleDateString()}</span>\n                </div>\n              )}\n            </div>\n\n            {/* Salary */}\n            {(job.salaryMin || job.salaryMax) && (\n              <div className=\"font-medium text-green-600\" data-testid={`job-salary-${job.id}`}>\n                {job.salaryMin && job.salaryMax \n                  ? `¬£${job.salaryMin.toLocaleString()} - ¬£${job.salaryMax.toLocaleString()}`\n                  : job.salaryMin \n                    ? `From ¬£${job.salaryMin.toLocaleString()}`\n                    : `Up to ¬£${job.salaryMax?.toLocaleString()}`\n                } per annum\n              </div>\n            )}\n\n            {/* Tags */}\n            <div className=\"flex flex-wrap gap-2\">\n              <Badge variant=\"secondary\" data-testid={`job-band-${job.id}`}>{job.band}</Badge>\n            </div>\n\n            {/* Description Preview */}\n            <p className=\"text-sm text-gray-600 line-clamp-2\">\n              {job.description.substring(0, 150)}...\n            </p>\n\n            {/* Actions */}\n            <div className=\"flex gap-2 pt-2\">\n              <Button \n                size=\"sm\" \n                className=\"w-full\" \n                onClick={canAccessSearch ? handleViewDetails : undefined}\n                disabled={!canAccessSearch}\n                data-testid={`view-details-${job.id}`}\n              >\n                {canAccessSearch ? \"View Details\" : \"View Details (Locked)\"}\n                {!canAccessSearch && <Lock className=\"inline h-3 w-3 ml-1\" />}\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n      {isBlurred && (\n        <div className=\"absolute inset-0 bg-gradient-to-b from-transparent via-white/20 to-white/90 flex items-center justify-center backdrop-blur-[1px] z-10\">\n          <div className=\"text-center bg-white rounded-lg border-2 border-yellow-300 shadow-lg p-6 max-w-sm mx-4\">\n            <Crown className=\"h-8 w-8 text-yellow-600 mx-auto mb-3\" />\n            <h3 className=\"font-semibold text-lg mb-2\">Unlock More Jobs</h3>\n            <p className=\"text-sm text-gray-600 mb-4\">\n              {index === 2 \n                ? 'See this job and hundreds more with Premium access' \n                : `View ${index > 2 ? 'remaining' : 'this'} job with Premium access`\n              }\n            </p>\n            <Button \n              onClick={() => setLocation('/pricing')}\n              className=\"bg-yellow-600 hover:bg-yellow-700 text-white font-medium\"\n              size=\"sm\"\n              data-testid=\"button-upgrade-job-card\"\n            >\n              Upgrade Now - ¬£70\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n    );\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <div className=\"flex items-center justify-center py-32\">\n          <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" aria-label=\"Loading\"/>\n        </div>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <div className=\"max-w-4xl mx-auto px-6 py-12 text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Sign In Required</h1>\n          <p className=\"text-muted-foreground mb-6\">Please sign in to access job search</p>\n          <Button onClick={() => window.location.href = \"/api/login\"}>\n            Sign In\n          </Button>\n        </div>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"max-w-7xl mx-auto px-6 lg:px-8 py-12\">\n        {/* Helpful Tips Section */}\n        <div className=\"bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 mb-8\">\n          <div className=\"flex items-start gap-4\">\n            <div className=\"bg-blue-100 p-2 rounded-lg\">\n              <Lightbulb className=\"h-5 w-5 text-blue-600\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-blue-900 mb-2\">üí° Smart Job Search Tips</h3>\n              <div className=\"text-blue-800 space-y-2\">\n                <p>‚Ä¢ <strong>Expand your search:</strong> Use multiple job boards alongside HealthHire for maximum opportunities</p>\n                <p>‚Ä¢ <strong>Use Henry the Helper:</strong> Generate tailored Supporting Information for any application</p>\n                <p>‚Ä¢ <strong>Stay organised:</strong> Track all your applications using our Application Tracker page</p>\n                <p>‚Ä¢ <strong>Apply Smart - Save Time:</strong> Only apply to roles where you meet the essential criteria. NHS panels automatically reject applications missing basic requirements.</p>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        {/* Breadcrumb */}\n        <div className=\"flex items-center space-x-2 mb-8\">\n          <Button \n            variant=\"ghost\" \n            size=\"sm\"\n            onClick={() => setLocation(\"/\")}\n            data-testid=\"button-back-to-dashboard\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Dashboard\n          </Button>\n        </div>\n\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\" data-testid=\"page-title\">\n            üîç NHS Job Finder {!isPaid && \"(Preview Mode)\"}\n            {!isPaid && <Crown className=\"inline h-6 w-6 text-yellow-600 ml-2\" />}\n          </h1>\n          <p className=\"text-gray-600\">\n            {isPaid ? \n              \"Discover your perfect NHS role with intelligent role fit scoring\" :\n              \"Preview intelligent job matching features - upgrade to unlock full access\"\n            }\n          </p>\n        </div>\n\n        {/* Preview Mode Notice */}\n        {!isPaid && (\n          <div className=\"bg-gradient-to-br from-yellow-50 to-amber-50 border border-yellow-200 rounded-xl p-6 mb-6\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"bg-yellow-100 p-2 rounded-lg\">\n                <Crown className=\"h-5 w-5 text-yellow-600\" />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"font-semibold text-yellow-900 mb-2\">üîç Smart Job Matching (Premium Feature)</h3>\n                <div className=\"text-yellow-800\">\n                  <p>Unlock intelligent role fit scoring, advanced filters, and unlimited job searching.</p>\n                  <p className=\"mt-2\"><strong>Upgrade now to access the full NHS job matching experience.</strong></p>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Search and Filters */}\n        {canAccessSearch ? (\n          <div className=\"bg-white rounded-lg shadow-sm border p-6 mb-6\">\n            <form onSubmit={handleSearch} className=\"space-y-4\">\n              <div className=\"flex gap-4\">\n                <div className=\"flex-1\">\n                  <Input\n                    type=\"text\"\n                    placeholder=\"Search jobs by title, employer, or keywords...\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className=\"w-full\"\n                    data-testid=\"search-input\"\n                  />\n                </div>\n                <Button type=\"submit\" data-testid=\"search-button\">\n                  <Search className=\"h-4 w-4 mr-2\" />\n                  Search\n                </Button>\n              </div>\n\n              <div className=\"flex flex-wrap gap-4\">\n                <Select \n                  value={filters.band} \n                  onValueChange={(value) => setFilters(prev => ({ ...prev, band: value }))}\n                >\n                  <SelectTrigger className=\"w-40\" data-testid=\"band-filter\">\n                    <SelectValue placeholder=\"NHS Band\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all-bands\">All Bands</SelectItem>\n                    <SelectItem value=\"Band 3\">Band 3</SelectItem>\n                    <SelectItem value=\"Band 4\">Band 4</SelectItem>\n                    <SelectItem value=\"Band 5\">Band 5</SelectItem>\n                  <SelectItem value=\"Band 6\">Band 6</SelectItem>\n                  <SelectItem value=\"Band 7\">Band 7</SelectItem>\n                  <SelectItem value=\"Band 8\">Band 8+</SelectItem>\n                  <SelectItem value=\"Consultant\">Consultant</SelectItem>\n                </SelectContent>\n              </Select>\n\n\n              <Input\n                type=\"text\"\n                placeholder=\"Location...\"\n                value={filters.location}\n                onChange={(e) => setFilters(prev => ({ ...prev, location: e.target.value }))}\n                className=\"w-40\"\n                data-testid=\"location-filter\"\n              />\n\n\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={resetFilters}\n                data-testid=\"reset-filters\"\n              >\n                <Filter className=\"h-4 w-4 mr-2\" />\n                Reset\n              </Button>\n            </div>\n          </form>\n        </div>\n        ) : (\n          <div className=\"bg-white rounded-lg shadow-sm border p-6 mb-6\">\n            <div className=\"space-y-4\">\n              <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n                <AlertTriangle className=\"h-5 w-5 text-yellow-500\" />\n                Limited Access Mode\n              </h3>\n              \n              <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n                <p className=\"text-sm text-yellow-800 mb-3\">\n                  Your free account includes limited job search capabilities. \n                  Upgrade to unlock advanced filters, unlimited searches, and personalized job matching.\n                </p>\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <Button disabled variant=\"outline\">\n                    <Search className=\"h-4 w-4 mr-2\" />\n                    Advanced Search\n                  </Button>\n                  <Button disabled variant=\"outline\">\n                    <Filter className=\"h-4 w-4 mr-2\" />\n                    Reset\n                  </Button>\n                </div>\n              </div>\n              \n              <UpgradePrompt feature=\"Job Search\" compact={true} />\n            </div>\n          </div>\n        )}\n\n        {/* Search Results */}\n        <div>\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-xl font-semibold\">\n              {searchQuery ? `Search Results` : 'All NHS Jobs'}\n            </h2>\n            <div className=\"text-sm text-gray-500\" data-testid=\"results-count\">\n              {jobs ? `${jobs.length} jobs found` : ''}\n            </div>\n          </div>\n\n          {jobsError ? (\n            <div className=\"text-center py-12\">\n              <div className=\"bg-red-50 border border-red-200 rounded-lg p-6\">\n                <h3 className=\"text-lg font-medium text-red-900 mb-2\">Unable to load jobs</h3>\n                <p className=\"text-red-700 mb-4\">\n                  {jobsError instanceof Error && jobsError.message.includes('401') \n                    ? \"Please log in to view NHS job listings.\"\n                    : \"There was an error loading job listings. Please try again later.\"}\n                </p>\n                <Button \n                  onClick={() => window.location.href = '/api/login'}\n                  data-testid=\"login-button\"\n                >\n                  Log In\n                </Button>\n              </div>\n            </div>\n          ) : !canAccessSearch ? (\n            <>\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 opacity-60 mb-6\">\n                {sampleJobs.map((job: NhsJob) => (\n                  <JobCard key={job.id} job={job} />\n                ))}\n              </div>\n              <UpgradePrompt feature=\"Job Finder\" />\n            </>\n          ) : jobsLoading ? (\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              {[...Array(6)].map((_, i) => (\n                <Card key={i}>\n                  <CardHeader>\n                    <Skeleton className=\"h-6 w-3/4\" />\n                    <Skeleton className=\"h-4 w-1/2\" />\n                  </CardHeader>\n                  <CardContent>\n                    <Skeleton className=\"h-20 w-full\" />\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : jobs && jobs.length > 0 ? (\n            <>\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {jobs.map((job: NhsJob, index: number) => (\n                  <JobCard \n                    key={job.id} \n                    job={job} \n                    isBlurred={!isPaid && index >= 2}\n                    index={index}\n                  />\n                ))}\n              </div>\n              {!isPaid && jobs.length > 2 && (\n                <div className=\"mt-8 text-center\">\n                  <Card className=\"border-yellow-200 bg-gradient-to-br from-yellow-50 to-orange-50 p-6\">\n                    <Crown className=\"h-8 w-8 text-yellow-600 mx-auto mb-4\" />\n                    <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\n                      See {jobs.length - 2} More Jobs\n                    </h3>\n                    <p className=\"text-gray-600 mb-4\">\n                      Unlock full access to all NHS job listings with intelligent role fit scoring and unlimited searches.\n                    </p>\n                    <Button \n                      onClick={() => setLocation('/pricing')}\n                      className=\"bg-yellow-600 hover:bg-yellow-700 text-white font-semibold px-8 py-3\"\n                      data-testid=\"button-upgrade-job-results\"\n                    >\n                      Upgrade Now - ¬£70 One-Time\n                    </Button>\n                  </Card>\n                </div>\n              )}\n            </>\n          ) : (\n            <div className=\"text-center py-12\">\n              <Heart className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No jobs found</h3>\n              <p className=\"text-gray-500\">\n                Try adjusting your search criteria or filters\n              </p>\n            </div>\n          )}\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}\n","size_bytes":20881},"client/src/pages/landing.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ThemeToggle } from \"@/components/ui/theme-toggle\";\nimport { \n  User, \n  Search, \n  BarChart3, \n  FileText, \n  Mic, \n  MessageCircleQuestion,\n  BookOpen,\n  Users,\n  ArrowRight,\n  Check,\n  Play,\n  Clock,\n  Target,\n  Shield,\n  X,\n  Zap,\n  Building,\n  Bell,\n  Sparkles,\n  Wrench,\n  ChartLine,\n  HelpCircle,\n  DollarSign,\n  Bot,\n  Globe,\n  Briefcase,\n  Lock\n} from \"lucide-react\";\nimport logoHealthhire from \"@assets/Portal (1)_1757252217793.png\";\nimport henryAvatar from \"@assets/Green Simple Woman Doctor Avatar_1757246695018.png\";\n\nexport default function Landing() {\n  const handleLogin = () => {\n    window.location.href = \"/api/login\";\n  };\n\n  const handleGetStarted = () => {\n    window.location.href = \"/api/login\";\n  };\n\n  const handleGetFullAccess = () => {\n    window.location.href = \"/pricing\";\n  };\n\n  // Announcement bar state and rotation\n  const [currentAnnouncement, setCurrentAnnouncement] = useState(0);\n  const [showAnnouncement, setShowAnnouncement] = useState(true);\n\n  const announcements = [\n    {\n      text: \"New: Timed interview practice with feedback.\",\n      cta: \"Try it\",\n      action: () => window.location.href = \"/api/login\"\n    },\n    {\n      text: \"New: Job Tracker‚Äîkeep every application organised.\",\n      cta: \"Open tracker\", \n      action: () => window.location.href = \"/api/login\"\n    },\n    {\n      text: \"See everything in one place‚Äîupgrade when ready.\",\n      cta: \"See plans\",\n      action: () => window.location.href = \"/pricing\"\n    },\n    {\n      text: \"Fast-track your application journey today.\",\n      cta: \"Unlock Full Access\",\n      action: () => window.location.href = \"/pricing\"\n    }\n  ];\n\n  // Auto-rotate announcements every 5 seconds\n  useEffect(() => {\n    if (!showAnnouncement) return;\n    \n    const interval = setInterval(() => {\n      setCurrentAnnouncement((prev) => (prev + 1) % announcements.length);\n    }, 5000);\n\n    return () => clearInterval(interval);\n  }, [showAnnouncement, announcements.length]);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"max-w-7xl mx-auto px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center space-x-3\">\n              <img src={logoHealthhire} alt=\"HealthHire Portal\" className=\"w-8 h-8\" />\n              <div>\n                <h1 className=\"text-xl font-semibold text-foreground\">HealthHire Portal</h1>\n                <p className=\"text-xs text-muted-foreground hidden sm:block\">Your Complete Career Toolkit</p>\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-3\">\n              <ThemeToggle />\n              <Button onClick={handleLogin} data-testid=\"button-login\">\n                Sign In\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Announcement Bar */}\n      {showAnnouncement && (\n        <div className=\"bg-primary text-primary-foreground py-2 px-4 relative\">\n          <div className=\"max-w-7xl mx-auto flex items-center justify-center text-center\">\n            <div className=\"flex items-center gap-4\">\n              <span className=\"text-sm font-medium\">\n                {announcements[currentAnnouncement].text}\n              </span>\n              <button\n                onClick={announcements[currentAnnouncement].action}\n                className=\"text-sm font-semibold underline hover:no-underline transition-all\"\n              >\n                {announcements[currentAnnouncement].cta}\n              </button>\n            </div>\n            <button\n              onClick={() => setShowAnnouncement(false)}\n              className=\"absolute right-4 top-1/2 transform -translate-y-1/2 p-1 hover:bg-primary-foreground/20 rounded transition-colors\"\n            >\n              <X className=\"h-4 w-4\" />\n            </button>\n          </div>\n        </div>\n      )}\n\n      <main>\n        {/* Hero Section */}\n        <section className=\"relative overflow-hidden\">\n          {/* Background Pattern */}\n          <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-background to-primary/10\"></div>\n          <div className=\"absolute inset-0 opacity-30\">\n            <div className=\"absolute top-10 left-10 w-20 h-20 bg-primary/20 rounded-full blur-xl\"></div>\n            <div className=\"absolute top-32 right-20 w-32 h-32 bg-primary/15 rounded-full blur-2xl\"></div>\n            <div className=\"absolute bottom-20 left-1/4 w-24 h-24 bg-primary/10 rounded-full blur-xl\"></div>\n            <div className=\"absolute bottom-40 right-1/3 w-16 h-16 bg-primary/25 rounded-full blur-lg\"></div>\n          </div>\n          \n          <div className=\"relative max-w-7xl mx-auto px-6 lg:px-8 py-20 lg:py-32\">\n            <div className=\"text-center\">\n              <div className=\"inline-flex items-center gap-2 bg-primary/10 text-primary px-4 py-2 rounded-full text-sm font-medium mb-8 border border-primary/20\">\n                <div className=\"w-2 h-2 bg-primary rounded-full animate-pulse\"></div>\n                Trusted by applicants across the UK\n              </div>\n              \n              <h1 className=\"text-5xl lg:text-7xl font-bold text-foreground mb-8 leading-tight\">\n                Your job journey\n                <span className=\"block text-primary\">in one place.</span>\n              </h1>\n              \n              <p className=\"text-xl lg:text-2xl text-muted-foreground mb-12 max-w-4xl mx-auto leading-relaxed\">\n                Build your profile, find roles, craft supporting information with Henry the Helper, track applications, and get interview-ready ‚Äî \n                <span className=\"font-semibold text-foreground\">all in one portal.</span>\n              </p>\n              \n              <div className=\"flex flex-col sm:flex-row gap-4 justify-center items-center mb-16\">\n                <Button \n                  onClick={handleGetStarted} \n                  size=\"lg\" \n                  className=\"text-lg px-10 py-4 shadow-lg hover:shadow-xl transition-shadow\" \n                  data-testid=\"button-create-account\"\n                >\n                  Create free account\n                  <ArrowRight className=\"ml-2 h-5 w-5\" />\n                </Button>\n                <Button \n                  onClick={handleGetFullAccess} \n                  variant=\"outline\" \n                  size=\"lg\" \n                  className=\"text-lg px-10 py-4 border-2 hover:bg-primary/5\" \n                  data-testid=\"button-get-full-access\"\n                >\n                  Get Full Access\n                </Button>\n              </div>\n\n              {/* Trust Indicators */}\n              <div className=\"flex flex-wrap justify-center items-center gap-12 lg:gap-16 mt-8\">\n                <div className=\"flex flex-col items-center text-center max-w-[200px]\">\n                  <div className=\"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mb-3\">\n                    <Sparkles className=\"h-6 w-6 text-green-600 dark:text-green-400\" />\n                  </div>\n                  <span className=\"text-sm font-semibold text-foreground\">Start Free</span>\n                </div>\n                <div className=\"flex flex-col items-center text-center max-w-[200px]\">\n                  <div className=\"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mb-3\">\n                    <Wrench className=\"h-6 w-6 text-blue-600 dark:text-blue-400\" />\n                  </div>\n                  <span className=\"text-sm font-semibold text-foreground\">Stronger Applications, Faster</span>\n                </div>\n                <div className=\"flex flex-col items-center text-center max-w-[200px]\">\n                  <div className=\"w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center mb-3\">\n                    <ChartLine className=\"h-6 w-6 text-purple-600 dark:text-purple-400\" />\n                  </div>\n                  <span className=\"text-sm font-semibold text-foreground\">Built in Job Tracker</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Value Grid - The One-Stop Shop */}\n        <section className=\"max-w-7xl mx-auto px-6 lg:px-8 pb-16 lg:pb-24\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl lg:text-4xl font-bold text-foreground mb-4\">\n              The one-stop shop\n            </h2>\n            <p className=\"text-xl text-muted-foreground\">\n              Everything you need for your NHS career journey\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12\">\n            {/* Top Row - Core Features */}\n            <Card className=\"group hover:shadow-xl hover:scale-105 transition-all duration-300 border-0 bg-gradient-to-br from-blue-50 to-blue-100/50 dark:from-blue-950/30 dark:to-blue-900/20\">\n              <CardHeader className=\"text-center pb-4\">\n                <div className=\"w-16 h-16 bg-blue-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform\">\n                  <User className=\"h-8 w-8 text-blue-600 dark:text-blue-400\" />\n                </div>\n                <CardTitle className=\"text-lg font-bold\">Candidate Profile</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center\">\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  Keep a clean, reusable profile that powers your CV and applications.\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card className=\"group hover:shadow-xl hover:scale-105 transition-all duration-300 border-0 bg-gradient-to-br from-emerald-50 to-emerald-100/50 dark:from-emerald-950/30 dark:to-emerald-900/20\">\n              <CardHeader className=\"text-center pb-4\">\n                <div className=\"w-16 h-16 bg-emerald-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform\">\n                  <Search className=\"h-8 w-8 text-emerald-600 dark:text-emerald-400\" />\n                </div>\n                <CardTitle className=\"text-lg font-bold\">Find & Save Jobs</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center\">\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  Search NHS roles, save favourites, and apply with confidence.\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card className=\"group hover:shadow-xl hover:scale-105 transition-all duration-300 border-0 bg-gradient-to-br from-purple-50 to-purple-100/50 dark:from-purple-950/30 dark:to-purple-900/20\">\n              <CardHeader className=\"text-center pb-4\">\n                <div className=\"w-16 h-16 bg-purple-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform\">\n                  <BarChart3 className=\"h-8 w-8 text-purple-600 dark:text-purple-400\" />\n                </div>\n                <CardTitle className=\"text-lg font-bold\">Job Tracker</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center\">\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  Track every application, interview, and outcome - all in one view.\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card className=\"group hover:shadow-xl hover:scale-105 transition-all duration-300 border-0 bg-gradient-to-br from-amber-50 to-amber-100/50 dark:from-amber-950/30 dark:to-amber-900/20\">\n              <CardHeader className=\"text-center pb-4\">\n                <div className=\"w-16 h-16 bg-amber-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform\">\n                  <FileText className=\"h-8 w-8 text-amber-600 dark:text-amber-500\" />\n                </div>\n                <CardTitle className=\"text-lg font-bold\">Supporting Information</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center\">\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  Use Henry the Helper to generate strong, role-matched documents.\n                </p>\n              </CardContent>\n            </Card>\n\n            {/* Bottom Row - Enhanced Features */}\n            <Card className=\"group hover:shadow-xl hover:scale-105 transition-all duration-300 border-0 bg-gradient-to-br from-rose-50 to-rose-100/50 dark:from-rose-950/30 dark:to-rose-900/20\">\n              <CardHeader className=\"text-center pb-4\">\n                <div className=\"w-16 h-16 bg-rose-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform\">\n                  <Mic className=\"h-8 w-8 text-rose-600 dark:text-rose-400\" />\n                </div>\n                <CardTitle className=\"text-lg font-bold\">Interview Practice</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center\">\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  Timed Q&A with structured feedback and model answers.\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card className=\"group hover:shadow-xl hover:scale-105 transition-all duration-300 border-0 bg-gradient-to-br from-cyan-50 to-cyan-100/50 dark:from-cyan-950/30 dark:to-cyan-900/20\">\n              <CardHeader className=\"text-center pb-4\">\n                <div className=\"w-16 h-16 bg-cyan-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform\">\n                  <MessageCircleQuestion className=\"h-8 w-8 text-cyan-600 dark:text-cyan-400\" />\n                </div>\n                <CardTitle className=\"text-lg font-bold\">Role-Specific Questions</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center\">\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  Ask Henry for likely questions by role and see example responses.\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card className=\"group hover:shadow-xl hover:scale-105 transition-all duration-300 border-0 bg-gradient-to-br from-indigo-50 to-indigo-100/50 dark:from-indigo-950/30 dark:to-indigo-900/20\">\n              <CardHeader className=\"text-center pb-4\">\n                <div className=\"w-16 h-16 bg-indigo-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform\">\n                  <BookOpen className=\"h-8 w-8 text-indigo-600 dark:text-indigo-400\" />\n                </div>\n                <CardTitle className=\"text-lg font-bold\">Resource Library</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center\">\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  Guides, templates, and checklists built by NHS-experienced experts.\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card className=\"group hover:shadow-xl hover:scale-105 transition-all duration-300 border-0 bg-gradient-to-br from-teal-50 to-teal-100/50 dark:from-teal-950/30 dark:to-teal-900/20\">\n              <CardHeader className=\"text-center pb-4\">\n                <div className=\"w-16 h-16 bg-teal-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform\">\n                  <Users className=\"h-8 w-8 text-teal-600 dark:text-teal-400\" />\n                </div>\n                <CardTitle className=\"text-lg font-bold\">Referral Programme</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center\">\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  Invite friends, support each other, and earn rewards.\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div className=\"text-center space-x-4\">\n            <Button onClick={handleGetFullAccess} size=\"lg\" data-testid=\"button-get-started\">\n              Get started\n            </Button>\n            <Button variant=\"outline\" size=\"lg\" onClick={() => document.getElementById('how-it-works')?.scrollIntoView({ behavior: 'smooth' })}>\n              See how it works\n            </Button>\n          </div>\n        </section>\n\n        {/* Henry Intro Banner */}\n        <section className=\"max-w-7xl mx-auto px-6 lg:px-8 py-16\">\n          <div className=\"bg-gradient-to-r from-primary/10 to-primary/5 rounded-2xl p-8 border border-primary/20\">\n            <div className=\"flex items-center justify-center gap-6 max-w-4xl mx-auto\">\n              <img src={henryAvatar} alt=\"Henry the Helper\" className=\"w-20 h-20 rounded-full shadow-lg flex-shrink-0\" />\n              <div className=\"text-center\">\n                <h3 className=\"text-2xl font-bold text-foreground mb-2\">\n                  Meet Henry, your smart career assistant\n                </h3>\n                <p className=\"text-lg text-muted-foreground mb-4\">\n                  From tailoring supporting information to practice interviews - Henry guides you through every step of your NHS application\n                </p>\n                <div className=\"flex flex-wrap gap-3 justify-center\">\n                  <Badge variant=\"secondary\" className=\"text-sm\">\n                    Personalised guidance\n                  </Badge>\n                  <Badge variant=\"secondary\" className=\"text-sm\">\n                    NHS-specific expertise\n                  </Badge>\n                  <Badge variant=\"secondary\" className=\"text-sm\">\n                    24/7 available\n                  </Badge>\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* How It Works */}\n        <section id=\"how-it-works\" className=\"bg-gradient-to-b from-muted/20 to-muted/40 py-16 lg:py-24 relative overflow-hidden\">\n          {/* Background decoration */}\n          <div className=\"absolute inset-0 opacity-20\">\n            <div className=\"absolute top-20 left-10 w-32 h-32 bg-primary/10 rounded-full blur-2xl\"></div>\n            <div className=\"absolute bottom-20 right-10 w-24 h-24 bg-primary/15 rounded-full blur-xl\"></div>\n          </div>\n          \n          <div className=\"max-w-7xl mx-auto px-6 lg:px-8 relative\">\n            <div className=\"text-center mb-16\">\n              <h2 className=\"text-3xl lg:text-4xl font-bold text-foreground mb-4\">\n                How it works\n              </h2>\n              <p className=\"text-xl text-muted-foreground\">\n                Three simple steps to transform your NHS career journey\n              </p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 lg:gap-12 relative\">\n              {/* Connecting lines */}\n              <div className=\"hidden md:block absolute top-24 left-1/3 right-1/3 h-0.5 bg-gradient-to-r from-primary/30 via-primary/50 to-primary/30 transform -translate-y-1/2\"></div>\n              \n              {/* Step 1 */}\n              <div className=\"text-center relative\">\n                <div className=\"relative inline-block mb-8\">\n                  <div className=\"w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-2xl flex items-center justify-center mx-auto shadow-lg\">\n                    <User className=\"h-8 w-8\" />\n                  </div>\n                  <div className=\"absolute -top-2 -right-2 w-8 h-8 bg-blue-100 dark:bg-blue-900/50 rounded-full flex items-center justify-center\">\n                    <span className=\"text-sm font-bold text-blue-600 dark:text-blue-400\">1</span>\n                  </div>\n                </div>\n                <h3 className=\"text-xl lg:text-2xl font-bold mb-4 text-foreground\">Build your profile</h3>\n                <p className=\"text-muted-foreground leading-relaxed max-w-sm mx-auto\">\n                  Add your experience, education, and key skills once. Create a comprehensive professional foundation.\n                </p>\n              </div>\n\n              {/* Step 2 */}\n              <div className=\"text-center relative\">\n                <div className=\"relative inline-block mb-8\">\n                  <div className=\"w-20 h-20 bg-gradient-to-br from-emerald-500 to-emerald-600 text-white rounded-2xl flex items-center justify-center mx-auto shadow-lg\">\n                    <FileText className=\"h-8 w-8\" />\n                  </div>\n                  <div className=\"absolute -top-2 -right-2 w-8 h-8 bg-emerald-100 dark:bg-emerald-900/50 rounded-full flex items-center justify-center\">\n                    <span className=\"text-sm font-bold text-emerald-600 dark:text-emerald-400\">2</span>\n                  </div>\n                </div>\n                <h3 className=\"text-xl lg:text-2xl font-bold mb-4 text-foreground\">Find roles & tailor documents</h3>\n                <p className=\"text-muted-foreground leading-relaxed max-w-sm mx-auto\">\n                  Search jobs, then let Henry the Helper shape supporting information to the person specification.\n                </p>\n              </div>\n\n              {/* Step 3 */}\n              <div className=\"text-center relative\">\n                <div className=\"relative inline-block mb-8\">\n                  <div className=\"w-20 h-20 bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-2xl flex items-center justify-center mx-auto shadow-lg\">\n                    <Target className=\"h-8 w-8\" />\n                  </div>\n                  <div className=\"absolute -top-2 -right-2 w-8 h-8 bg-purple-100 dark:bg-purple-900/50 rounded-full flex items-center justify-center\">\n                    <span className=\"text-sm font-bold text-purple-600 dark:text-purple-400\">3</span>\n                  </div>\n                </div>\n                <h3 className=\"text-xl lg:text-2xl font-bold mb-4 text-foreground\">Apply, track, and prepare</h3>\n                <p className=\"text-muted-foreground leading-relaxed max-w-sm mx-auto\">\n                  Use the job tracker and interview practice to stay organised and confident throughout your journey.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"text-center mt-16\">\n              <Button onClick={handleGetStarted} size=\"lg\" className=\"shadow-lg hover:shadow-xl transition-shadow\">\n                Start in 2 minutes\n                <ArrowRight className=\"ml-2 h-5 w-5\" />\n              </Button>\n            </div>\n          </div>\n        </section>\n\n        {/* Henry the Helper Spotlight */}\n        <section className=\"relative overflow-hidden bg-gradient-to-br from-primary/5 via-background to-primary/10 py-16 lg:py-24\">\n          {/* Background decoration */}\n          <div className=\"absolute inset-0 opacity-30\">\n            <div className=\"absolute top-20 left-10 w-32 h-32 bg-blue-300/20 rounded-full blur-2xl\"></div>\n            <div className=\"absolute bottom-20 right-20 w-40 h-40 bg-purple-300/20 rounded-full blur-3xl\"></div>\n            <div className=\"absolute top-1/2 left-1/3 w-24 h-24 bg-emerald-300/20 rounded-full blur-xl\"></div>\n          </div>\n\n          <div className=\"max-w-7xl mx-auto px-6 lg:px-8 relative\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center\">\n              <div>\n                <div className=\"inline-flex items-center gap-2 bg-primary/10 text-primary px-4 py-2 rounded-full text-sm font-medium mb-6 border border-primary/20\">\n                  <Bot className=\"h-4 w-4\" />\n                  Your Smart Career Assistant\n                </div>\n\n                <h2 className=\"text-3xl lg:text-5xl font-bold text-foreground mb-6 leading-tight\">\n                  Meet Henry the Helper ‚Äî your\n                  <span className=\"text-primary block\">smart assistant</span>\n                </h2>\n                \n                <p className=\"text-xl text-muted-foreground mb-10 leading-relaxed\">\n                  Henry helps you turn your profile and the job's criteria into clear, tailored documents and interview prep. No jargon, just practical guidance when you need it.\n                </p>\n\n                {/* Example prompts */}\n                <div className=\"space-y-4 mb-10\">\n                  <div className=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border border-border/50 rounded-xl p-4 hover:shadow-lg transition-all duration-300 hover:scale-[1.02]\">\n                    <div className=\"flex items-start gap-3\">\n                      <div className=\"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center flex-shrink-0\">\n                        <FileText className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                      </div>\n                      <p className=\"text-foreground font-medium text-sm leading-relaxed\">\n                        \"Tailor my supporting information for Band 5 Radiographer in Leeds.\"\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border border-border/50 rounded-xl p-4 hover:shadow-lg transition-all duration-300 hover:scale-[1.02]\">\n                    <div className=\"flex items-start gap-3\">\n                      <div className=\"w-8 h-8 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg flex items-center justify-center flex-shrink-0\">\n                        <MessageCircleQuestion className=\"h-4 w-4 text-emerald-600 dark:text-emerald-400\" />\n                      </div>\n                      <p className=\"text-foreground font-medium text-sm leading-relaxed\">\n                        \"Give me likely interview questions for an HCA role in London.\"\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border border-border/50 rounded-xl p-4 hover:shadow-lg transition-all duration-300 hover:scale-[1.02]\">\n                    <div className=\"flex items-start gap-3\">\n                      <div className=\"w-8 h-8 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center flex-shrink-0\">\n                        <Wrench className=\"h-4 w-4 text-purple-600 dark:text-purple-400\" />\n                      </div>\n                      <p className=\"text-foreground font-medium text-sm leading-relaxed\">\n                        \"Turn these bullet points into a concise cover letter.\"\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                <Button onClick={handleGetStarted} size=\"lg\" className=\"shadow-lg hover:shadow-xl transition-shadow\">\n                  Try Henry the Helper\n                  <ArrowRight className=\"ml-2 h-5 w-5\" />\n                </Button>\n              </div>\n\n              {/* Henry Avatar with enhanced styling */}\n              <div className=\"flex justify-center lg:justify-end relative\">\n                <div className=\"relative\">\n                  {/* Background glow */}\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-primary/20 to-blue-400/20 rounded-full blur-2xl scale-110\"></div>\n                  \n                  {/* Main avatar */}\n                  <div className=\"relative w-80 h-80 bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 rounded-full p-4 shadow-2xl\">\n                    <img \n                      src={henryAvatar} \n                      alt=\"Henry the Helper\" \n                      className=\"w-full h-full rounded-full object-cover\"\n                    />\n                  </div>\n\n                  {/* Floating elements */}\n                  <div className=\"absolute -top-4 -right-4 w-12 h-12 bg-primary/20 rounded-full animate-bounce delay-100\"></div>\n                  <div className=\"absolute -bottom-6 -left-6 w-8 h-8 bg-blue-400/30 rounded-full animate-pulse\"></div>\n                  <div className=\"absolute top-1/4 -left-8 w-6 h-6 bg-emerald-400/40 rounded-full animate-ping delay-300\"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* FAQ Section */}\n        <section className=\"bg-gradient-to-b from-muted/10 to-muted/30 py-16 lg:py-24 relative\">\n          {/* Background decoration */}\n          <div className=\"absolute inset-0 opacity-10\">\n            <div className=\"absolute top-10 right-20 w-40 h-40 bg-primary/20 rounded-full blur-3xl\"></div>\n            <div className=\"absolute bottom-20 left-20 w-32 h-32 bg-primary/15 rounded-full blur-2xl\"></div>\n          </div>\n          \n          <div className=\"max-w-5xl mx-auto px-6 lg:px-8 relative\">\n            <div className=\"text-center mb-16\">\n              <div className=\"inline-flex items-center gap-2 bg-primary/10 text-primary px-4 py-2 rounded-full text-sm font-medium mb-6 border border-primary/20\">\n                <HelpCircle className=\"h-4 w-4\" />\n                Got questions? We've got answers\n              </div>\n              <h2 className=\"text-3xl lg:text-4xl font-bold text-foreground mb-4\">\n                Frequently Asked Questions\n              </h2>\n              <p className=\"text-xl text-muted-foreground\">\n                Everything you need to know about HealthHire Portal\n              </p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n              {/* FAQ Item 1 */}\n              <div className=\"bg-background/80 backdrop-blur-sm border border-border rounded-2xl p-6 hover:shadow-lg transition-shadow\">\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center flex-shrink-0\">\n                    <DollarSign className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-lg font-bold text-foreground mb-3\">\n                      Is HealthHire Portal free to use?\n                    </h3>\n                    <p className=\"text-muted-foreground leading-relaxed\">\n                      Yes, you can create a free account and access basic features. Premium features are available with our paid plans.\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* FAQ Item 2 */}\n              <div className=\"bg-background/80 backdrop-blur-sm border border-border rounded-2xl p-6 hover:shadow-lg transition-shadow\">\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center flex-shrink-0\">\n                    <Bot className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-lg font-bold text-foreground mb-3\">\n                      How does Henry the Helper work?\n                    </h3>\n                    <p className=\"text-muted-foreground leading-relaxed\">\n                      Henry analyzes your profile and job requirements to provide tailored supporting information, interview questions, and career guidance specific to NHS roles.\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* FAQ Item 3 */}\n              <div className=\"bg-background/80 backdrop-blur-sm border border-border rounded-2xl p-6 hover:shadow-lg transition-shadow\">\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center flex-shrink-0\">\n                    <Globe className=\"h-5 w-5 text-purple-600 dark:text-purple-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-lg font-bold text-foreground mb-3\">\n                      Is this suitable for overseas healthcare professionals?\n                    </h3>\n                    <p className=\"text-muted-foreground leading-relaxed\">\n                      Absolutely. HealthHire Portal includes specific guidance for IMGs (International Medical Graduates) and overseas professionals transitioning to NHS roles.\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* FAQ Item 4 */}\n              <div className=\"bg-background/80 backdrop-blur-sm border border-border rounded-2xl p-6 hover:shadow-lg transition-shadow\">\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center flex-shrink-0\">\n                    <Briefcase className=\"h-5 w-5 text-amber-600 dark:text-amber-500\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-lg font-bold text-foreground mb-3\">\n                      What types of NHS roles does this support?\n                    </h3>\n                    <p className=\"text-muted-foreground leading-relaxed\">\n                      We support all NHS roles including doctors, nurses, HCAs, radiographers, biomedical scientists, and many other healthcare positions across all bands.\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* FAQ Item 5 */}\n              <div className=\"bg-background/80 backdrop-blur-sm border border-border rounded-2xl p-6 hover:shadow-lg transition-shadow\">\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"w-10 h-10 bg-rose-100 dark:bg-rose-900/30 rounded-lg flex items-center justify-center flex-shrink-0\">\n                    <BarChart3 className=\"h-5 w-5 text-rose-600 dark:text-rose-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-lg font-bold text-foreground mb-3\">\n                      Can I track multiple job applications?\n                    </h3>\n                    <p className=\"text-muted-foreground leading-relaxed\">\n                      Yes, our job tracker lets you monitor multiple applications, interviews, and outcomes all in one place with notes and deadlines.\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* FAQ Item 6 */}\n              <div className=\"bg-background/80 backdrop-blur-sm border border-border rounded-2xl p-6 hover:shadow-lg transition-shadow\">\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"w-10 h-10 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg flex items-center justify-center flex-shrink-0\">\n                    <Lock className=\"h-5 w-5 text-emerald-600 dark:text-emerald-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-lg font-bold text-foreground mb-3\">\n                      Is my data secure and private?\n                    </h3>\n                    <p className=\"text-muted-foreground leading-relaxed\">\n                      Yes, we follow strict data protection standards and your personal information is encrypted and secure. We never share your data with third parties.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Contact CTA */}\n            <div className=\"text-center mt-12 p-6 bg-primary/5 rounded-2xl border border-primary/20\">\n              <h3 className=\"text-lg font-semibold text-foreground mb-2\">Still have questions?</h3>\n              <p className=\"text-muted-foreground mb-4\">We're here to help you get started with your NHS career journey.</p>\n              <Button variant=\"outline\" onClick={() => window.location.href = \"/support\"}>\n                Visit Support Center\n                <ArrowRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </section>\n\n      </main>\n\n      {/* Footer */}\n      <footer className=\"bg-muted/50 border-t\">\n        <div className=\"max-w-7xl mx-auto px-6 lg:px-8 py-12\">\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8\">\n            <div>\n              <div className=\"flex items-center space-x-3 mb-4\">\n                <img src={logoHealthhire} alt=\"HealthHire Portal\" className=\"w-8 h-8\" />\n                <h3 className=\"font-semibold\">HealthHire Portal</h3>\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                Your NHS Career Journey\n              </p>\n            </div>\n\n            <div>\n              <h4 className=\"font-semibold mb-4\">Company</h4>\n              <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                <li><a href=\"#\" className=\"hover:text-foreground\">About</a></li>\n                <li><a href=\"#\" className=\"hover:text-foreground\">Contact</a></li>\n                <li><a href=\"#\" className=\"hover:text-foreground\">Partners</a></li>\n              </ul>\n            </div>\n\n            <div>\n              <h4 className=\"font-semibold mb-4\">Support</h4>\n              <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                <li><a href=\"/support\" className=\"hover:text-foreground\">Help Centre</a></li>\n                <li><a href=\"/privacy-notice\" className=\"hover:text-foreground\">Privacy Notice</a></li>\n                <li><a href=\"/terms-of-use\" className=\"hover:text-foreground\">Terms of Use</a></li>\n                <li><a href=\"/cookie-policy\" className=\"hover:text-foreground\">Cookie Policy</a></li>\n              </ul>\n            </div>\n\n            <div>\n              <h4 className=\"font-semibold mb-4\">Get Started</h4>\n              <Button onClick={handleGetStarted} className=\"w-full\">\n                Create Account\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"border-t mt-12 pt-8\">\n            <p className=\"text-sm text-muted-foreground text-center\">\n              Guidance authored by NHS-experienced experts. Always follow your employer's policies.\n            </p>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n}","size_bytes":38847},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/pages/payment-success.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { CheckCircle, ArrowRight, Sparkles } from \"lucide-react\";\n\nexport default function PaymentSuccess() {\n  const [, setLocation] = useLocation();\n  const [sessionId, setSessionId] = useState<string | null>(null);\n\n  useEffect(() => {\n    // Get session ID from URL\n    const urlParams = new URLSearchParams(window.location.search);\n    const sessionId = urlParams.get('session_id');\n    setSessionId(sessionId);\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"max-w-4xl mx-auto px-6 lg:px-8 py-12\">\n        <Card className=\"max-w-2xl mx-auto text-center\">\n          <CardContent className=\"p-12\">\n            <div className=\"w-16 h-16 mx-auto mb-6 bg-green-100 rounded-full flex items-center justify-center\">\n              <CheckCircle className=\"w-8 h-8 text-green-600\" />\n            </div>\n            \n            <h1 className=\"text-3xl font-bold text-foreground mb-4\">\n              Payment Successful! üéâ\n            </h1>\n            \n            <p className=\"text-lg text-muted-foreground mb-6\">\n              Welcome to HealthHire Portal Premium! You now have lifetime access to all professional NHS career tools.\n            </p>\n\n            <div className=\"bg-muted rounded-lg p-6 mb-8\">\n              <h3 className=\"font-semibold mb-4 flex items-center justify-center\">\n                <Sparkles className=\"w-5 h-5 mr-2 text-primary\" />\n                You've unlocked:\n              </h3>\n              <ul className=\"text-sm space-y-2 text-left max-w-md mx-auto\">\n                <li>‚úÖ Unlimited NHS job searching</li>\n                <li>‚úÖ Professional CV generation</li>\n                <li>‚úÖ Professional Supporting Information creation</li>\n                <li>‚úÖ Comprehensive interview practice</li>\n                <li>‚úÖ Job application tracking</li>\n                <li>‚úÖ Q&A generator for NHS roles</li>\n                <li>‚úÖ All future features included</li>\n              </ul>\n            </div>\n\n            {sessionId && (\n              <p className=\"text-xs text-muted-foreground mb-6\">\n                Session ID: {sessionId}\n              </p>\n            )}\n\n            <div className=\"space-y-4\">\n              <Button \n                onClick={() => setLocation(\"/\")}\n                size=\"lg\"\n                className=\"w-full\"\n              >\n                Start Using Premium Features\n                <ArrowRight className=\"w-4 h-4 ml-2\" />\n              </Button>\n              \n              <Button \n                variant=\"outline\"\n                onClick={() => setLocation(\"/documents\")}\n                size=\"sm\"\n              >\n                Generate Your First AI Document\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}","size_bytes":3133},"client/src/pages/pricing.tsx":{"content":"import { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Check, X, Sparkles, ArrowRight, ArrowLeft, User, Search, ClipboardList, FileText, MessageSquare, HelpCircle, BookOpen, Users } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useSubscription } from \"@/hooks/useSubscription\";\nimport { Link } from \"wouter\";\nimport henryHelperImage from \"@assets/Henry Helper (1)_1757337880712.png\";\n\nexport default function Pricing() {\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n  const { isPaid } = useSubscription();\n\n  const handleUpgrade = async () => {\n    setIsLoading(true);\n    try {\n      const response = await apiRequest('POST', '/api/payments/create-checkout', {});\n      const data = await response.json();\n      if (data.checkout_url) {\n        window.location.href = data.checkout_url;\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to start checkout. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const freeFeatures = [\n    \"Complete Candidate Profile management\",\n    \"Full access to NHS News & Updates\",\n    \"Basic dashboard overview\",\n    \"Account creation and profile setup\"\n  ];\n\n  const paidFeatures = [\n    \"Unlimited NHS job searching with intelligent matching\",\n    \"Complete Application Documents with CV and Supporting Information generation\",\n    \"Full Interview Practice with expert feedback and scoring\",\n    \"Advanced Q&A Generator for specific NHS roles and bands\",\n    \"Comprehensive Job Application Tracker with analytics\",\n    \"Complete Resources Hub with downloadable guides and courses\",\n    \"All premium features unlocked forever\",\n    \"Lifetime access - no recurring fees\"\n  ];\n\n  const blockedFeatures = [\n    \"Job Finder (preview only)\",\n    \"Application Documents (limited preview)\", \n    \"Interview Practice (preview mode only)\",\n    \"Q&A Generator (sample questions only)\",\n    \"Job Tracker (preview interface only)\",\n    \"Resources Hub (no downloads)\"\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"max-w-6xl mx-auto px-6 lg:px-8 py-12\">\n        {/* Back to Dashboard Button */}\n        <div className=\"mb-8\">\n          <Link href=\"/\">\n            <Button \n              variant=\"ghost\" \n              size=\"sm\"\n              className=\"flex items-center gap-2 text-muted-foreground hover:text-foreground\"\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n              Back to Dashboard\n            </Button>\n          </Link>\n        </div>\n\n        {/* Page Header */}\n        <div className=\"text-center mb-12\">\n          <Badge variant=\"secondary\" className=\"mb-4\">\n            <Sparkles className=\"w-4 h-4 mr-2\" />\n            Simple, Fair Pricing\n          </Badge>\n          <h1 className=\"text-4xl font-bold text-foreground mb-4\">\n            Accelerate Your NHS Career\n          </h1>\n          <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n            Choose between our free starter plan or unlock all professional features with a single payment\n          </p>\n        </div>\n\n        {/* Pricing Cards */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12\">\n          {/* Free Plan */}\n          <Card className=\"relative\">\n            <CardHeader>\n              <CardTitle className=\"text-2xl\">Free Starter</CardTitle>\n              <div className=\"text-3xl font-bold\">¬£0</div>\n              <p className=\"text-muted-foreground\">Perfect for exploring NHS opportunities</p>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-3\">\n                {freeFeatures.map((feature, index) => (\n                  <div key={index} className=\"flex items-start space-x-3\">\n                    <Check className=\"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5\" />\n                    <span className=\"text-sm\">{feature}</span>\n                  </div>\n                ))}\n                {blockedFeatures.map((feature, index) => (\n                  <div key={index} className=\"flex items-start space-x-3 opacity-60\">\n                    <X className=\"w-5 h-5 text-muted-foreground flex-shrink-0 mt-0.5\" />\n                    <span className=\"text-sm text-muted-foreground\">{feature}</span>\n                  </div>\n                ))}\n              </div>\n              <Button variant=\"outline\" className=\"w-full\" disabled>\n                Current Plan\n              </Button>\n            </CardContent>\n          </Card>\n\n          {/* Paid Plan */}\n          <Card className=\"relative border-primary shadow-lg\">\n            <Badge className=\"absolute -top-3 left-1/2 transform -translate-x-1/2\">\n              Most Popular\n            </Badge>\n            <CardHeader>\n              <CardTitle className=\"text-2xl\">Full Access</CardTitle>\n              <div className=\"text-3xl font-bold\">\n                ¬£70\n                <span className=\"text-lg font-normal text-muted-foreground ml-2\">one-time</span>\n              </div>\n              <p className=\"text-muted-foreground\">Lifetime access to all professional tools</p>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-3\">\n                {paidFeatures.map((feature, index) => (\n                  <div key={index} className=\"flex items-start space-x-3\">\n                    <Check className=\"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5\" />\n                    <span className=\"text-sm\">{feature}</span>\n                  </div>\n                ))}\n              </div>\n              {isPaid ? (\n                <Button className=\"w-full\" disabled>\n                  <Check className=\"w-4 h-4 mr-2\" />\n                  Activated\n                </Button>\n              ) : (\n                <Button \n                  className=\"w-full\" \n                  onClick={handleUpgrade}\n                  disabled={isLoading}\n                >\n                  {isLoading ? \"Loading...\" : \"Upgrade Now\"}\n                  <ArrowRight className=\"w-4 h-4 ml-2\" />\n                </Button>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Still Unsure Button */}\n        <div className=\"text-center mb-16\">\n          <Button \n            variant=\"outline\" \n            size=\"lg\" \n            onClick={() => document.getElementById('features-showcase')?.scrollIntoView({ behavior: 'smooth' })}\n            className=\"text-lg px-8 py-6 border-2 hover:bg-primary hover:text-primary-foreground transition-all duration-300\"\n          >\n            Still unsure? See what's included ‚Üì\n          </Button>\n        </div>\n\n        {/* Features Showcase Section */}\n        <div id=\"features-showcase\" className=\"mb-16\">\n          <div className=\"text-center mb-12\">\n            <Badge variant=\"secondary\" className=\"mb-4\">\n              <Sparkles className=\"w-4 h-4 mr-2\" />\n              Everything Included\n            </Badge>\n            <h2 className=\"text-4xl font-bold text-foreground mb-4\">\n              Your Complete NHS Career Toolkit\n            </h2>\n            <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto\">\n              8 powerful tools designed specifically for healthcare professionals. One payment, lifetime access.\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n            {/* Candidate Profile */}\n            <Card className=\"group p-8 hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 hover:border-primary/50\">\n              <div className=\"flex items-start gap-6\">\n                <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n                  <User className=\"w-8 h-8 text-white\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-2xl font-bold mb-3 group-hover:text-primary transition-colors\">Candidate Profile</h3>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    Keep a clean, reusable profile that powers your CV and applications.\n                  </p>\n                </div>\n              </div>\n            </Card>\n\n            {/* Find & Save Jobs */}\n            <Card className=\"group p-8 hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 hover:border-primary/50\">\n              <div className=\"flex items-start gap-6\">\n                <div className=\"w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n                  <Search className=\"w-8 h-8 text-white\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-2xl font-bold mb-3 group-hover:text-primary transition-colors\">Find & Save Jobs</h3>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    Search NHS roles, save favourites, and apply with confidence.\n                  </p>\n                </div>\n              </div>\n            </Card>\n\n            {/* Job Tracker */}\n            <Card className=\"group p-8 hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 hover:border-primary/50\">\n              <div className=\"flex items-start gap-6\">\n                <div className=\"w-16 h-16 bg-gradient-to-br from-orange-500 to-red-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n                  <ClipboardList className=\"w-8 h-8 text-white\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-2xl font-bold mb-3 group-hover:text-primary transition-colors\">Job Tracker</h3>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    Track every application, interview, and outcome ‚Äî all in one view.\n                  </p>\n                </div>\n              </div>\n            </Card>\n\n            {/* Supporting Information & Cover Letters */}\n            <Card className=\"group p-8 hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 hover:border-primary/50\">\n              <div className=\"flex items-start gap-6\">\n                <div className=\"w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n                  <FileText className=\"w-8 h-8 text-white\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-2xl font-bold mb-3 group-hover:text-primary transition-colors\">Supporting Information & Cover Letters</h3>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    Use Henry the Helper to tailor strong, role-matched documents.\n                  </p>\n                </div>\n              </div>\n            </Card>\n\n            {/* Interview Practice */}\n            <Card className=\"group p-8 hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 hover:border-primary/50\">\n              <div className=\"flex items-start gap-6\">\n                <div className=\"w-16 h-16 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n                  <MessageSquare className=\"w-8 h-8 text-white\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-2xl font-bold mb-3 group-hover:text-primary transition-colors\">Interview Practice</h3>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    Timed Q&A with structured feedback and model answers.\n                  </p>\n                </div>\n              </div>\n            </Card>\n\n            {/* Role-Specific Questions */}\n            <Card className=\"group p-8 hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 hover:border-primary/50\">\n              <div className=\"flex items-start gap-6\">\n                <div className=\"w-16 h-16 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n                  <HelpCircle className=\"w-8 h-8 text-white\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-2xl font-bold mb-3 group-hover:text-primary transition-colors\">Role-Specific Questions</h3>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    Ask Henry for likely questions by role and see example responses.\n                  </p>\n                </div>\n              </div>\n            </Card>\n\n            {/* Resource Library */}\n            <Card className=\"group p-8 hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 hover:border-primary/50\">\n              <div className=\"flex items-start gap-6\">\n                <div className=\"w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n                  <BookOpen className=\"w-8 h-8 text-white\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-2xl font-bold mb-3 group-hover:text-primary transition-colors\">Resource Library</h3>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    Guides, templates, and checklists built by NHS-experienced experts.\n                  </p>\n                </div>\n              </div>\n            </Card>\n\n            {/* Referral Programme */}\n            <Card className=\"group p-8 hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 hover:border-primary/50\">\n              <div className=\"flex items-start gap-6\">\n                <div className=\"w-16 h-16 bg-gradient-to-br from-teal-500 to-green-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n                  <Users className=\"w-8 h-8 text-white\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-2xl font-bold mb-3 group-hover:text-primary transition-colors\">Referral Programme</h3>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    Invite friends, support each other, and earn rewards.\n                  </p>\n                </div>\n              </div>\n            </Card>\n          </div>\n\n          {/* Support Section with Henry */}\n          <div className=\"mt-12 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20 rounded-3xl border border-blue-200/50 dark:border-blue-800/50 overflow-hidden\">\n            <div className=\"relative p-8 md:p-12\">\n              <div className=\"flex flex-col items-center gap-8 max-w-lg mx-auto text-center\">\n                {/* Henry Image */}\n                <div className=\"relative\">\n                  <div className=\"w-32 h-32 md:w-40 md:h-40 bg-gradient-to-br from-white to-blue-50 dark:from-gray-800 dark:to-blue-900/20 rounded-full p-6 shadow-2xl border-4 border-white dark:border-gray-700\">\n                    <img \n                      src={henryHelperImage} \n                      alt=\"Henry the Helper\"\n                      className=\"w-full h-full object-contain\"\n                    />\n                  </div>\n                  <div className=\"absolute -bottom-2 -right-2 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center\">\n                    <div className=\"w-3 h-3 bg-white rounded-full animate-pulse\"></div>\n                  </div>\n                </div>\n\n                {/* Action Buttons */}\n                <div className=\"flex flex-col sm:flex-row gap-4\">\n                  <a \n                    href=\"/support\" \n                    className=\"inline-flex items-center gap-2 bg-primary text-primary-foreground hover:bg-primary/90 px-6 py-3 rounded-xl font-medium transition-all duration-300 hover:scale-105 hover:shadow-lg\"\n                  >\n                    <HelpCircle className=\"w-4 h-4\" />\n                    Get Help Now\n                  </a>\n                  <Button \n                    variant=\"outline\" \n                    className=\"border-2 hover:bg-primary/5 px-6 py-3 rounded-xl font-medium h-auto\"\n                    onClick={() => window.open('mailto:hello@healthhireportal.com', '_blank')}\n                  >\n                    <MessageSquare className=\"w-4 h-4 mr-2\" />\n                    Email Support\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n\n      </main>\n\n      <Footer />\n    </div>\n  );\n}","size_bytes":17432},"client/src/pages/profile.tsx":{"content":"import { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { HenryHelper } from \"@/components/HenryHelper\";\nimport { ProfilePhotoUpload } from \"@/components/profile-photo-upload\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ArrowLeft, User, Award, Star, Plus, Trash2, Briefcase, GraduationCap, BookOpen, Check, Circle, Edit, ChevronRight } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport React from \"react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport type { UserWithProfile, DashboardData } from \"@shared/schema\";\n\nconst workExperienceSchema = z.object({\n  jobTitle: z.string().min(1, \"Job title is required\"),\n  employer: z.string().min(1, \"Employer is required\"),\n  location: z.string().optional(),\n  startDate: z.string().min(1, \"Start date is required\"),\n  endDate: z.string().optional(),\n  current: z.boolean().default(false),\n  duties: z.array(z.string()).optional(),\n});\n\nconst educationSchema = z.object({\n  qualification: z.string().min(1, \"Qualification is required\"),\n  institution: z.string().min(1, \"Institution is required\"),\n  location: z.string().optional(),\n  year: z.string().optional(),\n  grade: z.string().optional(),\n});\n\nconst courseSchema = z.object({\n  name: z.string().min(1, \"Course name is required\"),\n  provider: z.string().min(1, \"Provider is required\"),\n  completionDate: z.string().min(1, \"Completion date is required\"),\n  certificateUrl: z.string().optional(),\n});\n\nconst profileSchema = z.object({\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  profession: z.string().min(1, \"Profession is required\"),\n  registrationNumber: z.string().optional(),\n  email: z.string().email(\"Valid email is required\").optional(),\n  phone: z.string().optional(),\n  city: z.string().optional(),\n  country: z.string().optional(),\n  yearsExperience: z.coerce.number().optional(),\n  visaStatus: z.string().optional(),\n  skills: z.array(z.string()).max(7, \"Maximum 7 skills allowed\").optional(),\n  workExperience: z.array(workExperienceSchema).optional(),\n  education: z.array(educationSchema).optional(),\n  courses: z.array(courseSchema).optional(),\n});\n\ntype ProfileFormData = z.infer<typeof profileSchema>;\n\nexport default function Profile() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  const { data: user, isLoading } = useQuery<UserWithProfile>({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  const { data: dashboardData } = useQuery<DashboardData>({\n    queryKey: [\"/api/dashboard\"],\n  });\n\n  const form = useForm<ProfileFormData>({\n    resolver: zodResolver(profileSchema),\n    defaultValues: {\n      firstName: \"\",\n      lastName: \"\",\n      profession: \"\",\n      registrationNumber: \"\",\n      email: \"\",\n      phone: \"\",\n      city: \"\",\n      country: \"\",\n      yearsExperience: undefined,\n      visaStatus: \"\",\n      skills: [],\n      workExperience: [],\n      education: [],\n      courses: [],\n    },\n  });\n\n  const { fields: skillsFields, append: appendSkill, remove: removeSkill } = useFieldArray({\n    control: form.control,\n    name: \"skills\"\n  });\n\n  const { fields: workFields, append: appendWork, remove: removeWork } = useFieldArray({\n    control: form.control,\n    name: \"workExperience\"\n  });\n\n  const { fields: educationFields, append: appendEducation, remove: removeEducation } = useFieldArray({\n    control: form.control,\n    name: \"education\"\n  });\n\n  const { fields: coursesFields, append: appendCourse, remove: removeCourse } = useFieldArray({\n    control: form.control,\n    name: \"courses\"\n  });\n\n  // Update form values when user data loads\n  React.useEffect(() => {\n    if (user) {\n      form.reset({\n        firstName: user.firstName || \"\",\n        lastName: user.lastName || \"\",\n        profession: user.profile?.profession || \"\",\n        registrationNumber: user.profile?.registrationNumber || \"\",\n        email: user.profile?.email || user.email || \"\",\n        phone: user.profile?.phone || \"\",\n        city: user.profile?.city || \"\",\n        country: user.profile?.country || \"\",\n        yearsExperience: user.profile?.yearsExperience || undefined,\n        visaStatus: user.profile?.visaStatus || \"\",\n        skills: (user.profile?.skills as string[]) || [],\n        workExperience: (user.profile?.workExperience as any[])?.map((exp: any) => ({\n          ...exp,\n          duties: exp.duties || (exp.description ? exp.description.split('\\n').filter((d: string) => d.trim()) : [])\n        })) || [],\n        education: (user.profile?.education as any[])?.map((edu: any) => ({\n          qualification: edu.qualification || edu.degree || '',\n          institution: edu.institution || '',\n          location: edu.location || '',\n          year: edu.year || (edu.endDate && edu.endDate.substring(0, 4)) || '',\n          grade: edu.grade || ''\n        })) || [],\n        courses: (user.profile?.courses as any[]) || [],\n      });\n    }\n  }, [user, form]);\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: ProfileFormData) => {\n      return await apiRequest(\"PATCH\", \"/api/auth/user\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Profile updated\",\n        description: \"Your profile has been successfully updated.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard\"] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update profile. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ProfileFormData) => {\n    updateProfileMutation.mutate(data);\n  };\n\n  if (isLoading) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"max-w-7xl mx-auto px-6 lg:px-8 py-12\">\n        {/* Breadcrumb */}\n        <div className=\"flex items-center space-x-2 mb-8\">\n          <Button \n            variant=\"ghost\" \n            size=\"sm\"\n            onClick={() => setLocation(\"/\")}\n            data-testid=\"button-back-to-dashboard\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Dashboard\n          </Button>\n        </div>\n\n        {/* Page Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-foreground mb-2\">Candidate Profile</h1>\n          <p className=\"text-muted-foreground text-lg\">\n            Build your comprehensive healthcare professional profile\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Profile Form */}\n          <div className=\"lg:col-span-2 space-y-8\">\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-8\">\n                {/* Personal Information */}\n                <Card id=\"personal-info\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <User className=\"w-5 h-5\" />\n                      <span>Personal Information</span>\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-6\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <FormField\n                        control={form.control}\n                        name=\"firstName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>First Name</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-first-name\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      \n                      <FormField\n                        control={form.control}\n                        name=\"lastName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Last Name</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-last-name\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <FormField\n                      control={form.control}\n                      name=\"profession\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Profession</FormLabel>\n                          <FormControl>\n                            <Input {...field} placeholder=\"e.g., Registered Nurse, Doctor, Healthcare Assistant\" data-testid=\"input-profession\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"registrationNumber\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Registration Number (GMC/NMC/HCPC)</FormLabel>\n                          <FormControl>\n                            <Input {...field} placeholder=\"e.g., 12AB345C\" data-testid=\"input-registration-number\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    {/* Contact Information */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <FormField\n                        control={form.control}\n                        name=\"email\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Email</FormLabel>\n                            <FormControl>\n                              <Input {...field} type=\"email\" placeholder=\"your.email@example.com\" data-testid=\"input-email\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      \n                      <FormField\n                        control={form.control}\n                        name=\"phone\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Phone Number</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"+44 7xxx xxx xxx\" data-testid=\"input-phone\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <FormField\n                        control={form.control}\n                        name=\"city\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>City</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"e.g., London, Manchester\" data-testid=\"input-city\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      \n                      <FormField\n                        control={form.control}\n                        name=\"country\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Country</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"e.g., United Kingdom\" data-testid=\"input-country\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                  </CardContent>\n                </Card>\n\n                {/* Skills Section */}\n                <Card id=\"skills\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <Star className=\"w-5 h-5\" />\n                      <span>Key Skills</span>\n                    </CardTitle>\n                    <p className=\"text-sm text-muted-foreground\">Add up to 7 key skills relevant to your profession</p>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    {skillsFields.map((field, index) => (\n                      <div key={field.id} className=\"flex gap-2\">\n                        <FormField\n                          control={form.control}\n                          name={`skills.${index}`}\n                          render={({ field }) => (\n                            <FormItem className=\"flex-1\">\n                              <FormControl>\n                                <Input {...field} placeholder=\"e.g., Patient Care, Medication Administration\" data-testid={`input-skill-${index}`} />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          size=\"icon\"\n                          onClick={() => removeSkill(index)}\n                          data-testid={`button-remove-skill-${index}`}\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                    ))}\n                    {skillsFields.length < 7 && (\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        onClick={() => appendSkill(\"\" as any)}\n                        className=\"w-full\"\n                        data-testid=\"button-add-skill\"\n                      >\n                        <Plus className=\"w-4 h-4 mr-2\" />\n                        Add Skill\n                      </Button>\n                    )}\n                  </CardContent>\n                </Card>\n\n                {/* Work Experience Section */}\n                <Card id=\"work-experience\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <Briefcase className=\"w-5 h-5\" />\n                      <span>Work Experience</span>\n                    </CardTitle>\n                    <p className=\"text-sm text-muted-foreground mt-2\">\n                      Recommend only 3 relevant roles (recent only). Include more if relevant, otherwise risk CV being too long.\n                    </p>\n                  </CardHeader>\n                  <CardContent className=\"space-y-6\">\n                    {workFields.map((field, index) => (\n                      <div key={field.id} className=\"border rounded-lg p-4 space-y-4\">\n                        <div className=\"flex justify-between items-center\">\n                          <h4 className=\"font-medium\">Experience {index + 1}</h4>\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => removeWork(index)}\n                            data-testid={`button-remove-work-${index}`}\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                          <FormField\n                            control={form.control}\n                            name={`workExperience.${index}.jobTitle`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Job Title</FormLabel>\n                                <FormControl>\n                                  <Input {...field} placeholder=\"e.g., Staff Nurse\" data-testid={`input-work-title-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                          \n                          <FormField\n                            control={form.control}\n                            name={`workExperience.${index}.employer`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Employer</FormLabel>\n                                <FormControl>\n                                  <Input {...field} placeholder=\"e.g., NHS Foundation Trust\" data-testid={`input-work-employer-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                        </div>\n\n                        <FormField\n                          control={form.control}\n                          name={`workExperience.${index}.location`}\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Location</FormLabel>\n                              <FormControl>\n                                <Input {...field} placeholder=\"e.g., London, UK\" data-testid={`input-work-location-${index}`} />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                          <FormField\n                            control={form.control}\n                            name={`workExperience.${index}.startDate`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Start Date</FormLabel>\n                                <FormControl>\n                                  <Input {...field} type=\"month\" data-testid={`input-work-start-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                          \n                          <FormField\n                            control={form.control}\n                            name={`workExperience.${index}.endDate`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>End Date</FormLabel>\n                                <FormControl>\n                                  <Input {...field} type=\"month\" data-testid={`input-work-end-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                        </div>\n\n                        {/* Duties Section */}\n                        <div className=\"space-y-3\">\n                          <FormLabel>Key Duties & Responsibilities</FormLabel>\n                          \n                          {/* Henry Helper Integration */}\n                          <HenryHelper\n                            jobTitle={form.watch(`workExperience.${index}.jobTitle`) || \"\"}\n                            onAcceptDuties={(duties) => {\n                              // Set the duties in the form\n                              form.setValue(`workExperience.${index}.duties`, duties);\n                            }}\n                            disabled={!form.watch(`workExperience.${index}.jobTitle`)?.trim()}\n                          />\n                          \n                          {(form.watch(`workExperience.${index}.duties`) || []).map((_, dutyIndex) => (\n                            <div key={dutyIndex} className=\"flex gap-2\">\n                              <FormField\n                                control={form.control}\n                                name={`workExperience.${index}.duties.${dutyIndex}`}\n                                render={({ field }) => (\n                                  <FormItem className=\"flex-1\">\n                                    <FormControl>\n                                      <Input {...field} placeholder=\"e.g., Provide compassionate patient care in acute medical settings\" data-testid={`input-work-duty-${index}-${dutyIndex}`} />\n                                    </FormControl>\n                                  </FormItem>\n                                )}\n                              />\n                              <Button\n                                type=\"button\"\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  const currentDuties = form.getValues(`workExperience.${index}.duties`) || [];\n                                  const newDuties = currentDuties.filter((_, i) => i !== dutyIndex);\n                                  form.setValue(`workExperience.${index}.duties`, newDuties);\n                                }}\n                                data-testid={`button-remove-duty-${index}-${dutyIndex}`}\n                              >\n                                <Trash2 className=\"w-4 h-4\" />\n                              </Button>\n                            </div>\n                          ))}\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => {\n                              const currentDuties = form.getValues(`workExperience.${index}.duties`) || [];\n                              form.setValue(`workExperience.${index}.duties`, [...currentDuties, \"\"]);\n                            }}\n                            className=\"w-full\"\n                            data-testid={`button-add-duty-${index}`}\n                          >\n                            <Plus className=\"w-4 h-4 mr-2\" />\n                            Add Duty\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                    \n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => appendWork({\n                        jobTitle: \"\",\n                        employer: \"\",\n                        location: \"\",\n                        startDate: \"\",\n                        endDate: \"\",\n                        current: false,\n                        duties: [\"\"],\n                      })}\n                      className=\"w-full\"\n                      data-testid=\"button-add-work\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-2\" />\n                      Add Work Experience\n                    </Button>\n                  </CardContent>\n                </Card>\n\n                {/* Education Section */}\n                <Card id=\"education\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <GraduationCap className=\"w-5 h-5\" />\n                      <span>Education</span>\n                    </CardTitle>\n                    <p className=\"text-sm text-muted-foreground mt-2\">\n                      You don't need to include all, just relevant ones. Include your highest level of education.\n                    </p>\n                  </CardHeader>\n                  <CardContent className=\"space-y-6\">\n                    {educationFields.map((field, index) => (\n                      <div key={field.id} className=\"border rounded-lg p-4 space-y-4\">\n                        <div className=\"flex justify-between items-center\">\n                          <h4 className=\"font-medium\">Education {index + 1}</h4>\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => removeEducation(index)}\n                            data-testid={`button-remove-education-${index}`}\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                          <FormField\n                            control={form.control}\n                            name={`education.${index}.qualification`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Degree/Qualification</FormLabel>\n                                <FormControl>\n                                  <Input {...field} placeholder=\"e.g., BSc Nursing\" data-testid={`input-education-qualification-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                          \n                          <FormField\n                            control={form.control}\n                            name={`education.${index}.institution`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Institution</FormLabel>\n                                <FormControl>\n                                  <Input {...field} placeholder=\"e.g., University of Manchester\" data-testid={`input-education-institution-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                        </div>\n\n                        <FormField\n                          control={form.control}\n                          name={`education.${index}.location`}\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Location</FormLabel>\n                              <FormControl>\n                                <Input {...field} placeholder=\"e.g., Manchester, UK\" data-testid={`input-education-location-${index}`} />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                          <FormField\n                            control={form.control}\n                            name={`education.${index}.year`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Year Completed</FormLabel>\n                                <FormControl>\n                                  <Input {...field} placeholder=\"e.g., 2021\" data-testid={`input-education-year-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                          \n                          <FormField\n                            control={form.control}\n                            name={`education.${index}.grade`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Grade/Classification</FormLabel>\n                                <FormControl>\n                                  <Input {...field} placeholder=\"e.g., First Class Honours\" data-testid={`input-education-grade-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n\n                          <FormField\n                            control={form.control}\n                            name={`education.${index}.grade`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Grade/Result</FormLabel>\n                                <FormControl>\n                                  <Input {...field} placeholder=\"e.g., First Class Honours\" data-testid={`input-education-grade-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                        </div>\n                      </div>\n                    ))}\n                    \n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => appendEducation({\n                        qualification: \"\",\n                        institution: \"\",\n                        location: \"\",\n                        year: \"\",\n                        grade: \"\",\n                      })}\n                      className=\"w-full\"\n                      data-testid=\"button-add-education\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-2\" />\n                      Add Education\n                    </Button>\n                  </CardContent>\n                </Card>\n\n                {/* Courses Section */}\n                <Card id=\"courses\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <BookOpen className=\"w-5 h-5\" />\n                      <span>Courses & Certifications</span>\n                    </CardTitle>\n                    <p className=\"text-sm text-muted-foreground mt-2\">\n                      Only include max of 5 relevant courses and certifications.\n                    </p>\n                  </CardHeader>\n                  <CardContent className=\"space-y-6\">\n                    {coursesFields.map((field, index) => (\n                      <div key={field.id} className=\"border rounded-lg p-4 space-y-4\">\n                        <div className=\"flex justify-between items-center\">\n                          <h4 className=\"font-medium\">Course {index + 1}</h4>\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => removeCourse(index)}\n                            data-testid={`button-remove-course-${index}`}\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                          <FormField\n                            control={form.control}\n                            name={`courses.${index}.name`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Course Name</FormLabel>\n                                <FormControl>\n                                  <Input {...field} placeholder=\"e.g., Advanced Life Support\" data-testid={`input-course-name-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                          \n                          <FormField\n                            control={form.control}\n                            name={`courses.${index}.provider`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Provider</FormLabel>\n                                <FormControl>\n                                  <Input {...field} placeholder=\"e.g., Resuscitation Council UK\" data-testid={`input-course-provider-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                        </div>\n\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                          <FormField\n                            control={form.control}\n                            name={`courses.${index}.completionDate`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Completion Date</FormLabel>\n                                <FormControl>\n                                  <Input {...field} type=\"month\" data-testid={`input-course-completion-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n\n                          <FormField\n                            control={form.control}\n                            name={`courses.${index}.certificateUrl`}\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Certificate URL (Optional)</FormLabel>\n                                <FormControl>\n                                  <Input {...field} placeholder=\"https://...\" data-testid={`input-course-url-${index}`} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                        </div>\n                      </div>\n                    ))}\n                    \n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => appendCourse({\n                        name: \"\",\n                        provider: \"\",\n                        completionDate: \"\",\n                        certificateUrl: \"\",\n                      })}\n                      className=\"w-full\"\n                      data-testid=\"button-add-course\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-2\" />\n                      Add Course/Certification\n                    </Button>\n                  </CardContent>\n                </Card>\n\n                <Button \n                  type=\"submit\" \n                  className=\"w-full\"\n                  disabled={updateProfileMutation.isPending}\n                  data-testid=\"button-save-profile\"\n                >\n                  {updateProfileMutation.isPending ? \"Saving...\" : \"Save Profile\"}\n                </Button>\n              </form>\n            </Form>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"space-y-6\">\n            {/* Profile Photo Upload */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">Profile Photo</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ProfilePhotoUpload user={user} />\n              </CardContent>\n            </Card>\n            \n            {/* Profile Overview */}\n            <Card>\n              <CardHeader className=\"pb-4\">\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-lg\">Profile Overview</CardTitle>\n                  <Badge variant=\"secondary\" className=\"text-xs\" data-testid=\"badge-completion-count\">\n                    {(() => {\n                      const sections = [\n                        form.watch(\"firstName\") && form.watch(\"lastName\") && form.watch(\"profession\") && form.watch(\"email\") && form.watch(\"phone\"),\n                        skillsFields.length > 0,\n                        workFields.length > 0,\n                        educationFields.length > 0,\n                        coursesFields.length > 0\n                      ];\n                      const completed = sections.filter(Boolean).length;\n                      return `${completed} of 5 sections complete`;\n                    })()}\n                  </Badge>\n                </div>\n                <p className=\"text-xs text-muted-foreground mt-2\">\n                  Complete the sections below to improve matches and recruiter visibility.\n                </p>\n                {(() => {\n                  const sections = [\n                    { name: \"Personal Information\", completed: form.watch(\"firstName\") && form.watch(\"lastName\") && form.watch(\"profession\") && form.watch(\"email\") && form.watch(\"phone\"), anchor: \"personal-info\" },\n                    { name: \"Key Skills\", completed: skillsFields.length > 0, anchor: \"skills\" },\n                    { name: \"Work Experience\", completed: workFields.length > 0, anchor: \"work-experience\" },\n                    { name: \"Education\", completed: educationFields.length > 0, anchor: \"education\" },\n                    { name: \"Courses & Certifications\", completed: coursesFields.length > 0, anchor: \"courses\" }\n                  ];\n                  const firstIncomplete = sections.find(section => !section.completed);\n                  return firstIncomplete ? (\n                    <Button \n                      variant=\"default\" \n                      size=\"sm\" \n                      className=\"w-full mt-3\"\n                      onClick={() => {\n                        const element = document.getElementById(firstIncomplete.anchor);\n                        element?.scrollIntoView({ behavior: 'smooth' });\n                      }}\n                      data-testid=\"button-continue-profile\"\n                    >\n                      Continue profile\n                      <ChevronRight className=\"h-4 w-4 ml-1\" />\n                    </Button>\n                  ) : null;\n                })()}\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {/* Personal Information */}\n                  <div className=\"flex items-center justify-between group\">\n                    <div className=\"flex items-center gap-3\">\n                      {form.watch(\"firstName\") && form.watch(\"lastName\") && form.watch(\"profession\") && form.watch(\"email\") && form.watch(\"phone\") ? (\n                        <Check className=\"h-4 w-4 text-green-600\" aria-label=\"Complete\" />\n                      ) : (\n                        <Circle className=\"h-4 w-4 text-muted-foreground\" aria-label=\"Needs attention\" />\n                      )}\n                      <span className=\"text-sm font-medium\">Personal Information</span>\n                    </div>\n                    <Button \n                      variant=\"ghost\" \n                      size=\"sm\"\n                      onClick={() => {\n                        document.getElementById('personal-info')?.scrollIntoView({ behavior: 'smooth' });\n                      }}\n                      className=\"opacity-0 group-hover:opacity-100 transition-opacity\"\n                      data-testid=\"button-edit-personal-info\"\n                      aria-label={form.watch(\"firstName\") && form.watch(\"lastName\") && form.watch(\"profession\") && form.watch(\"email\") && form.watch(\"phone\") ? \"Edit Personal Information\" : \"Add Personal Information\"}\n                    >\n                      {form.watch(\"firstName\") && form.watch(\"lastName\") && form.watch(\"profession\") && form.watch(\"email\") && form.watch(\"phone\") ? (\n                        <>\n                          <Edit className=\"h-3 w-3 mr-1\" />\n                          Edit\n                        </>\n                      ) : (\n                        <>\n                          <Plus className=\"h-3 w-3 mr-1\" />\n                          Add\n                        </>\n                      )}\n                    </Button>\n                  </div>\n\n                  {/* Key Skills */}\n                  <div className=\"flex items-center justify-between group\">\n                    <div className=\"flex items-center gap-3\">\n                      {skillsFields.length > 0 ? (\n                        <Check className=\"h-4 w-4 text-green-600\" aria-label=\"Complete\" />\n                      ) : (\n                        <Circle className=\"h-4 w-4 text-muted-foreground\" aria-label=\"Needs attention\" />\n                      )}\n                      <span className=\"text-sm font-medium\">Key Skills</span>\n                    </div>\n                    <Button \n                      variant=\"ghost\" \n                      size=\"sm\"\n                      onClick={() => {\n                        document.getElementById('skills')?.scrollIntoView({ behavior: 'smooth' });\n                      }}\n                      className=\"opacity-0 group-hover:opacity-100 transition-opacity\"\n                      data-testid=\"button-edit-skills\"\n                      aria-label={skillsFields.length > 0 ? \"Edit Key Skills\" : \"Add Key Skills\"}\n                    >\n                      {skillsFields.length > 0 ? (\n                        <>\n                          <Edit className=\"h-3 w-3 mr-1\" />\n                          Edit\n                        </>\n                      ) : (\n                        <>\n                          <Plus className=\"h-3 w-3 mr-1\" />\n                          Add\n                        </>\n                      )}\n                    </Button>\n                  </div>\n\n                  {/* Work Experience */}\n                  <div className=\"flex items-center justify-between group\">\n                    <div className=\"flex items-center gap-3\">\n                      {workFields.length > 0 ? (\n                        <Check className=\"h-4 w-4 text-green-600\" aria-label=\"Complete\" />\n                      ) : (\n                        <Circle className=\"h-4 w-4 text-muted-foreground\" aria-label=\"Needs attention\" />\n                      )}\n                      <span className=\"text-sm font-medium\">Work Experience</span>\n                    </div>\n                    <Button \n                      variant=\"ghost\" \n                      size=\"sm\"\n                      onClick={() => {\n                        document.getElementById('work-experience')?.scrollIntoView({ behavior: 'smooth' });\n                      }}\n                      className=\"opacity-0 group-hover:opacity-100 transition-opacity\"\n                      data-testid=\"button-edit-work-experience\"\n                      aria-label={workFields.length > 0 ? \"Edit Work Experience\" : \"Add Work Experience\"}\n                    >\n                      {workFields.length > 0 ? (\n                        <>\n                          <Edit className=\"h-3 w-3 mr-1\" />\n                          Edit\n                        </>\n                      ) : (\n                        <>\n                          <Plus className=\"h-3 w-3 mr-1\" />\n                          Add\n                        </>\n                      )}\n                    </Button>\n                  </div>\n\n                  {/* Education */}\n                  <div className=\"flex items-center justify-between group\">\n                    <div className=\"flex items-center gap-3\">\n                      {educationFields.length > 0 ? (\n                        <Check className=\"h-4 w-4 text-green-600\" aria-label=\"Complete\" />\n                      ) : (\n                        <Circle className=\"h-4 w-4 text-muted-foreground\" aria-label=\"Needs attention\" />\n                      )}\n                      <span className=\"text-sm font-medium\">Education</span>\n                    </div>\n                    <Button \n                      variant=\"ghost\" \n                      size=\"sm\"\n                      onClick={() => {\n                        document.getElementById('education')?.scrollIntoView({ behavior: 'smooth' });\n                      }}\n                      className=\"opacity-0 group-hover:opacity-100 transition-opacity\"\n                      data-testid=\"button-edit-education\"\n                      aria-label={educationFields.length > 0 ? \"Edit Education\" : \"Add Education\"}\n                    >\n                      {educationFields.length > 0 ? (\n                        <>\n                          <Edit className=\"h-3 w-3 mr-1\" />\n                          Edit\n                        </>\n                      ) : (\n                        <>\n                          <Plus className=\"h-3 w-3 mr-1\" />\n                          Add\n                        </>\n                      )}\n                    </Button>\n                  </div>\n\n                  {/* Courses & Certifications */}\n                  <div className=\"flex items-center justify-between group\">\n                    <div className=\"flex items-center gap-3\">\n                      {coursesFields.length > 0 ? (\n                        <Check className=\"h-4 w-4 text-green-600\" aria-label=\"Complete\" />\n                      ) : (\n                        <Circle className=\"h-4 w-4 text-muted-foreground\" aria-label=\"Needs attention\" />\n                      )}\n                      <span className=\"text-sm font-medium\">Courses & Certifications</span>\n                    </div>\n                    <Button \n                      variant=\"ghost\" \n                      size=\"sm\"\n                      onClick={() => {\n                        document.getElementById('courses')?.scrollIntoView({ behavior: 'smooth' });\n                      }}\n                      className=\"opacity-0 group-hover:opacity-100 transition-opacity\"\n                      data-testid=\"button-edit-courses\"\n                      aria-label={coursesFields.length > 0 ? \"Edit Courses & Certifications\" : \"Add Courses & Certifications\"}\n                    >\n                      {coursesFields.length > 0 ? (\n                        <>\n                          <Edit className=\"h-3 w-3 mr-1\" />\n                          Edit\n                        </>\n                      ) : (\n                        <>\n                          <Plus className=\"h-3 w-3 mr-1\" />\n                          Add\n                        </>\n                      )}\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}","size_bytes":48427},"client/src/pages/qa-generator.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useSubscription } from \"@/hooks/useSubscription\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { AiConsentWidget } from \"@/components/ai-consent-widget\";\nimport Header from \"@/components/dashboard/header\";\nimport { Footer } from \"@/components/footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  MessageCircleQuestion, \n  ArrowLeft, \n  BookOpen,\n  Clock,\n  Target,\n  TrendingUp,\n  AlertCircle\n} from \"lucide-react\";\nimport henryImage from \"@assets/Henry Helper_1756820773886.png\";\nimport { UpgradePrompt } from \"@/components/ui/upgrade-prompt\";\n\ninterface QaSession {\n  id: string;\n  jobTitle: string;\n  totalQuestions: number;\n  createdAt: string;\n  completedAt: string | null;\n}\n\nexport default function QAGenerator() {\n  const { toast } = useToast();\n  const { isAuthenticated, isLoading } = useAuth();\n  const { isPaid, canAccessFeature } = useSubscription();\n  const [jobDescription, setJobDescription] = useState('');\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [showAiConsent, setShowAiConsent] = useState(false);\n  const queryClient = useQueryClient();\n\n  // Redirect to login if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  // Fetch user's Q&A sessions\n  const { data: sessions = [] } = useQuery<QaSession[]>({\n    queryKey: [\"/api/qa/sessions\"],\n    retry: false,\n    enabled: isAuthenticated && isPaid,\n  });\n\n  // Get current consents\n  const { data: consentsData } = useQuery({\n    queryKey: [\"/api/gdpr/consents\"],\n  });\n\n  // Generate Q&A session mutation\n  const generateMutation = useMutation({\n    mutationFn: async ({ jobDescription }: { jobDescription: string }) => {\n      const response = await apiRequest('POST', '/api/qa/generate', { jobDescription });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/qa/sessions\"] });\n      toast({\n        title: \"Questions Generated!\",\n        description: \"Your 25 practice questions are ready. Starting your flashcard session...\",\n      });\n      // Navigate to the session\n      window.location.href = `/qa/session/${data.session_id}`;\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      console.error(\"Error generating questions:\", error);\n      toast({\n        title: \"Generation Failed\",\n        description: \"Failed to generate questions. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleGenerate = async () => {\n    if (!isPaid) {\n      toast({\n        title: \"Premium Feature\",\n        description: \"Q&A Generator requires a premium subscription.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (jobDescription.trim().length < 100) {\n      toast({\n        title: \"More Details Needed\",\n        description: \"Please provide a more detailed job description (minimum 100 characters).\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check for AI consent before proceeding\n    const aiConsent = consentsData?.consents?.find((c: any) => c.type === 'ai_processing');\n    if (!aiConsent?.given) {\n      setShowAiConsent(true);\n      return;\n    }\n\n    setIsGenerating(true);\n    try {\n      await generateMutation.mutateAsync({ jobDescription });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const handleConsentGiven = () => {\n    setShowAiConsent(false);\n    // Now proceed with generation\n    handleGenerateAfterConsent();\n  };\n\n  const handleGenerateAfterConsent = async () => {\n    setIsGenerating(true);\n    try {\n      await generateMutation.mutateAsync({ jobDescription });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading Q&A Generator...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* AI Consent Widget */}\n      {showAiConsent && (\n        <AiConsentWidget \n          onConsentGiven={handleConsentGiven}\n          onDismiss={() => setShowAiConsent(false)}\n          isVisible={showAiConsent}\n        />\n      )}\n      <Header />\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n        {/* Back to Dashboard Button */}\n        <Button \n          variant=\"outline\" \n          onClick={() => window.location.href = '/'}\n          className=\"mb-4\"\n          data-testid=\"button-back-dashboard\"\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Dashboard\n        </Button>\n\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"flex justify-center mb-4\">\n            <div className=\"bg-gradient-to-br from-blue-100 to-purple-100 p-3 rounded-full\">\n              <img src={henryImage} alt=\"Henry the Helper\" className=\"h-8 w-8 rounded-full\" />\n            </div>\n          </div>\n          <h1 className=\"text-3xl font-bold mb-2\">Henry's Q&A Generator</h1>\n          <p className=\"text-muted-foreground\">\n            Let Henry generate 25 tailored interview questions with model answers for any NHS role\n          </p>\n        </div>\n\n        {/* Free Tier Limitation */}\n        {!isPaid && (\n          <UpgradePrompt \n            title=\"Premium Feature - Q&A Generator\"\n            description=\"Generate unlimited job-specific flashcard questions with model answers. Upgrade to unlock this powerful interview preparation tool.\"\n            variant=\"card\"\n            className=\"mb-8\"\n          />\n        )}\n\n        {/* Disclaimer */}\n        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6\">\n          <div className=\"flex items-start\">\n            <AlertCircle className=\"h-5 w-5 text-blue-600 mr-3 mt-0.5 flex-shrink-0\" />\n            <div className=\"text-blue-800 text-sm\">\n              <strong>Disclaimer:</strong> We cannot predict the exact questions you'll be asked in your interview. \n              However, these questions generated by Henry based on your job description will help you practice \n              common healthcare interview themes and develop strong responses. Model answers may contain errors \n              so be sure to do research on top.\n            </div>\n          </div>\n        </div>\n\n        {/* Main Generator */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className=\"w-10 h-10 bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg flex items-center justify-center\">\n                <img src={henryImage} alt=\"Henry the Helper\" className=\"w-6 h-6 rounded-full\" />\n              </div>\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <BookOpen className=\"h-5 w-5\" />\n                  Generate Your Practice Questions\n                </CardTitle>\n                <CardDescription>\n                  Let Henry analyze your job description and create 25 tailored interview questions\n                </CardDescription>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">\n                Job Description *\n              </label>\n              <textarea\n                className=\"w-full h-64 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n                placeholder=\"Paste the full job description here. Include key responsibilities, requirements, qualifications, and any specific skills mentioned. The more detailed the description, the better your tailored questions will be...\"\n                value={jobDescription}\n                onChange={(e) => setJobDescription(e.target.value)}\n                disabled={!isPaid}\n                data-testid=\"input-job-description\"\n              />\n              <div className=\"text-sm text-gray-600 mt-1\">\n                {jobDescription.length} characters (minimum 100 required)\n              </div>\n            </div>\n\n            <Button\n              onClick={handleGenerate}\n              disabled={!isPaid || isGenerating || jobDescription.trim().length < 100}\n              className=\"w-full\"\n              data-testid=\"button-generate-questions\"\n            >\n              {isGenerating ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                  Generating 25 Questions...\n                </>\n              ) : (\n                <>\n                  <MessageCircleQuestion className=\"h-4 w-4 mr-2\" />\n                  Generate Q&A Flashcards\n                </>\n              )}\n            </Button>\n          </CardContent>\n        </Card>\n\n        {/* Previous Sessions */}\n        {isPaid && sessions.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <TrendingUp className=\"h-5 w-5\" />\n                Your Q&A Sessions\n              </CardTitle>\n              <CardDescription>\n                Resume practicing with your previous flashcard sessions\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {sessions.map((session) => (\n                  <div key={session.id} className=\"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50\">\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"bg-secondary/10 p-2 rounded-full\">\n                        <BookOpen className=\"h-4 w-4 text-secondary\" />\n                      </div>\n                      <div>\n                        <div className=\"font-medium\">{session.jobTitle}</div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          {session.totalQuestions} questions ‚Ä¢ Created {new Date(session.createdAt).toLocaleDateString()}\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-3\">\n                      {session.completedAt ? (\n                        <Badge variant=\"secondary\">\n                          <Target className=\"h-3 w-3 mr-1\" />\n                          Completed\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"outline\">\n                          <Clock className=\"h-3 w-3 mr-1\" />\n                          In Progress\n                        </Badge>\n                      )}\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        onClick={() => window.location.href = `/qa/session/${session.id}`}\n                        data-testid={`button-resume-session-${session.id}`}\n                      >\n                        {session.completedAt ? \"Review\" : \"Resume\"}\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n      <Footer />\n    </div>\n  );\n}","size_bytes":12456},"client/src/pages/resources.tsx":{"content":"import { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ArrowLeft, BookOpen, CheckCircle, PlayCircle, FileText, Crown, Lock, Download, Search } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useSubscription } from \"@/hooks/useSubscription\";\nimport { UpgradePrompt } from \"@/components/UpgradePrompt\";\n\nexport default function Resources() {\n  const [, setLocation] = useLocation();\n  const { isPaid } = useSubscription();\n\n  const resources = [\n    {\n      title: \"NHS Values & Competency Framework\",\n      description: \"Comprehensive guide to NHS values and how to demonstrate them\",\n      type: \"Guide\",\n      duration: \"15 min read\",\n      icon: BookOpen,\n    },\n    {\n      title: \"Supporting Information Masterclass\",\n      description: \"Step-by-step video course on writing winning Supporting Information\",\n      type: \"Course\",\n      duration: \"45 min\",\n      icon: PlayCircle,\n    },\n    {\n      title: \"Interview Success Checklist\",\n      description: \"Pre-interview checklist to ensure you're fully prepared\",\n      type: \"Checklist\",\n      duration: \"5 min\",\n      icon: CheckCircle,\n    },\n    {\n      title: \"NHS Pay Bands Explained\",\n      description: \"Understanding pay progression and career advancement paths\",\n      type: \"Guide\",\n      duration: \"10 min read\",\n      icon: FileText,\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"max-w-7xl mx-auto px-6 lg:px-8 py-12\">\n        {/* Breadcrumb */}\n        <div className=\"flex items-center space-x-2 mb-8\">\n          <Button \n            variant=\"ghost\" \n            size=\"sm\"\n            onClick={() => setLocation(\"/\")}\n            data-testid=\"button-back-to-dashboard\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Dashboard\n          </Button>\n        </div>\n\n        {/* Page Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-foreground mb-2\">\n            üìö Resources Hub {!isPaid && \"(Preview Mode)\"}\n            {!isPaid && <Crown className=\"inline h-6 w-6 text-yellow-600 ml-2\" />}\n          </h1>\n          <p className=\"text-muted-foreground text-lg\">\n            {isPaid ? \n              \"NHS guides, checklists, and courses for career development\" :\n              \"Preview resources - upgrade to unlock downloads and access\"\n            }\n          </p>\n          {!isPaid && (\n            <div className=\"mt-2\">\n              <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm bg-yellow-50 text-yellow-700 border border-yellow-200\">\n                <Crown className=\"h-4 w-4 mr-1\" />\n                Free Tier: 3 resources available\n              </span>\n            </div>\n          )}\n        </div>\n\n        {/* Featured Resource */}\n        <Card className={`mb-8 bg-gradient-to-r from-primary/5 to-secondary/5 border-primary/20 ${!isPaid ? 'opacity-60' : ''}`}>\n          <CardContent className=\"p-8\">\n            <div className=\"flex items-start space-x-4\">\n              <div className=\"w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center\">\n                <PlayCircle className=\"w-8 h-8 text-primary\" />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"text-xl font-semibold text-foreground mb-2\">\n                  üåü Featured: Interview Success Masterclass\n                  {!isPaid && <Lock className=\"inline h-5 w-5 text-muted-foreground ml-2\" />}\n                </h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  Complete video course covering NHS values-based interviews, STAR methodology, \n                  and common healthcare scenarios with expert feedback.\n                </p>\n                <Button \n                  disabled={!isPaid}\n                  data-testid=\"button-start-masterclass\"\n                >\n                  {isPaid ? \"Start Masterclass\" : \"Start Masterclass (Locked)\"}\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Resources Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          {resources.map((resource, index) => {\n            const isAccessible = isPaid || index < 3; // Free users get first 3 resources\n            const isBlurred = !isPaid && index >= 3;\n            \n            return (\n              <div key={index} className=\"relative\">\n                <Card className={`hover:shadow-md transition-shadow ${isBlurred ? 'overflow-hidden' : ''}`}>\n                  <CardHeader className={isBlurred ? 'filter blur-sm' : ''}>\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"w-10 h-10 bg-muted rounded-lg flex items-center justify-center\">\n                          <resource.icon className=\"w-5 h-5 text-muted-foreground\" />\n                        </div>\n                        <div>\n                          <CardTitle className=\"text-lg\">\n                            {resource.title}\n                            {!isAccessible && <Lock className=\"inline h-4 w-4 text-muted-foreground ml-2\" />}\n                          </CardTitle>\n                          <div className=\"flex items-center space-x-2 mt-1\">\n                            <span className=\"text-xs bg-primary/10 text-primary px-2 py-1 rounded\">\n                              {resource.type}\n                            </span>\n                            <span className=\"text-xs text-muted-foreground\">\n                              {resource.duration}\n                            </span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  <CardContent className={isBlurred ? 'filter blur-sm' : ''}>\n                    <p className=\"text-muted-foreground mb-4\">\n                      {resource.description}\n                    </p>\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full\" \n                      disabled={!isAccessible}\n                      data-testid={`button-access-resource-${index}`}\n                    >\n                      {isAccessible ? \"Access Resource\" : \"Access Resource (Locked)\"}\n                    </Button>\n                  </CardContent>\n                </Card>\n                \n                {/* Upgrade overlay for blurred resources */}\n                {isBlurred && (\n                  <div className=\"absolute inset-0 bg-gradient-to-b from-transparent via-white/20 to-white/90 flex items-center justify-center backdrop-blur-[1px] z-10\">\n                    <div className=\"text-center bg-white rounded-lg border-2 border-yellow-300 shadow-lg p-6 max-w-sm mx-4\">\n                      <Crown className=\"h-8 w-8 text-yellow-600 mx-auto mb-3\" />\n                      <h3 className=\"font-semibold text-lg mb-2\">Unlock Premium Resources</h3>\n                      <p className=\"text-sm text-gray-600 mb-4\">\n                        Access all career development resources and downloadable materials\n                      </p>\n                      <Button \n                        onClick={() => setLocation('/pricing')}\n                        className=\"bg-yellow-600 hover:bg-yellow-700 text-white font-medium\"\n                        size=\"sm\"\n                        data-testid=\"button-upgrade-resource\"\n                      >\n                        Upgrade Now - ¬£70\n                      </Button>\n                    </div>\n                  </div>\n                )}\n              </div>\n            );\n          })}\n        </div>\n\n        {/* Quick Actions - Premium Only */}\n        {isPaid ? (\n          <div className=\"mt-12 bg-muted/50 rounded-lg p-8\">\n            <h3 className=\"text-xl font-semibold text-foreground mb-4\">\n              Quick Actions\n            </h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <Button \n                variant=\"outline\" \n                className=\"justify-start\" \n                onClick={() => setLocation('/cv-viewer')}\n                data-testid=\"button-view-cv\"\n              >\n                <FileText className=\"w-4 h-4 mr-2\" />\n                View Your CV\n              </Button>\n              <Button \n                variant=\"outline\" \n                className=\"justify-start\" \n                onClick={() => window.open('/api/cv/download-pdf', '_blank')}\n                data-testid=\"button-download-cv-pdf\"\n              >\n                <Download className=\"w-4 h-4 mr-2\" />\n                Download CV as PDF\n              </Button>\n              <Button \n                variant=\"outline\" \n                className=\"justify-start\" \n                onClick={() => setLocation('/jobs')}\n                data-testid=\"button-find-jobs\"\n              >\n                <Search className=\"w-4 h-4 mr-2\" />\n                Find NHS Jobs\n              </Button>\n            </div>\n          </div>\n        ) : (\n          <div className=\"mt-12 relative\">\n            <div className=\"bg-muted/30 rounded-lg p-8 filter blur-[1px]\">\n              <h3 className=\"text-xl font-semibold text-foreground mb-4\">\n                Quick Actions\n              </h3>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div className=\"bg-white/50 rounded border p-3\">\n                  <FileText className=\"w-4 h-4 mr-2 inline\" />\n                  View Your CV\n                </div>\n                <div className=\"bg-white/50 rounded border p-3\">\n                  <Download className=\"w-4 h-4 mr-2 inline\" />\n                  Download CV as PDF\n                </div>\n                <div className=\"bg-white/50 rounded border p-3\">\n                  <Search className=\"w-4 h-4 mr-2 inline\" />\n                  Find NHS Jobs\n                </div>\n              </div>\n            </div>\n            \n            <div className=\"absolute inset-0 bg-gradient-to-b from-transparent to-white/80 flex items-center justify-center\">\n              <div className=\"text-center bg-white rounded-lg border-2 border-yellow-300 shadow-lg p-6 max-w-sm\">\n                <Crown className=\"h-8 w-8 text-yellow-600 mx-auto mb-3\" />\n                <h3 className=\"font-semibold text-lg mb-2\">Premium Downloads</h3>\n                <p className=\"text-sm text-gray-600 mb-4\">\n                  Access professional templates and tools\n                </p>\n                <Button \n                  onClick={() => setLocation('/pricing')}\n                  className=\"bg-yellow-600 hover:bg-yellow-700 text-white font-medium\"\n                  size=\"sm\"\n                  data-testid=\"button-upgrade-quick-actions\"\n                >\n                  Upgrade Now - ¬£70\n                </Button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Upgrade Prompt for Free Users */}\n        {!isPaid && (\n          <div className=\"mt-8\">\n            <UpgradePrompt feature=\"Resources Hub\" />\n          </div>\n        )}\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}\n","size_bytes":11438},"client/src/components/dashboard/footer.tsx":{"content":"import { useLocation } from \"wouter\";\n\ninterface FooterProps {\n  profileCompletion: number;\n  totalApplications: number;\n  interviewsScheduled: number;\n}\n\nexport default function Footer({ \n  profileCompletion, \n  totalApplications, \n  interviewsScheduled \n}: FooterProps) {\n  const [, setLocation] = useLocation();\n  \n  const handleAction = (action: string) => {\n    // Execute action logic would go here\n  };\n\n  return (\n    <footer className=\"border-t border-border bg-card/50 backdrop-blur-sm\" data-testid=\"footer\">\n      <div className=\"max-w-7xl mx-auto px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8\">\n          {/* Quick Stats */}\n          <div className=\"space-y-4\">\n            <h4 className=\"font-semibold text-foreground\">Your Progress</h4>\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Applications sent:</span>\n                <span className=\"font-medium text-foreground\" data-testid=\"text-total-applications\">\n                  {totalApplications}\n                </span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Interviews scheduled:</span>\n                <span className=\"font-medium text-foreground\" data-testid=\"text-interviews-scheduled\">\n                  {interviewsScheduled}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          {/* Portal Features */}\n          <div className=\"space-y-4\">\n            <h4 className=\"font-semibold text-foreground\">Features</h4>\n            <div className=\"space-y-2\">\n              <button \n                onClick={() => setLocation('/profile')}\n                className=\"block text-sm text-muted-foreground hover:text-foreground text-left\"\n                data-testid=\"link-profile\"\n              >\n                Candidate Profile\n              </button>\n              <button \n                onClick={() => setLocation('/jobs')}\n                className=\"block text-sm text-muted-foreground hover:text-foreground text-left\"\n                data-testid=\"link-jobs\"\n              >\n                Job Search\n              </button>\n              <button \n                onClick={() => setLocation('/documents')}\n                className=\"block text-sm text-muted-foreground hover:text-foreground text-left\"\n                data-testid=\"link-documents\"\n              >\n                Documents\n              </button>\n              <button \n                onClick={() => setLocation('/tracker')}\n                className=\"block text-sm text-muted-foreground hover:text-foreground text-left\"\n                data-testid=\"link-applications\"\n              >\n                Applications\n              </button>\n            </div>\n          </div>\n\n          {/* More Features */}\n          <div className=\"space-y-4\">\n            <h4 className=\"font-semibold text-foreground\">More Tools</h4>\n            <div className=\"space-y-2\">\n              <button \n                onClick={() => setLocation('/interview-practice')}\n                className=\"block text-sm text-muted-foreground hover:text-foreground text-left\"\n                data-testid=\"link-interview\"\n              >\n                Interview Practice\n              </button>\n              <button \n                onClick={() => setLocation('/resources')}\n                className=\"block text-sm text-muted-foreground hover:text-foreground text-left\"\n                data-testid=\"link-resources\"\n              >\n                Resources\n              </button>\n              <button \n                onClick={() => setLocation('/news')}\n                className=\"block text-sm text-muted-foreground hover:text-foreground text-left\"\n                data-testid=\"link-news\"\n              >\n                News & Updates\n              </button>\n              <button \n                onClick={() => setLocation('/support')}\n                className=\"block text-sm text-muted-foreground hover:text-foreground text-left\"\n                data-testid=\"link-support\"\n              >\n                Support\n              </button>\n            </div>\n          </div>\n\n          {/* Legal Notices */}\n          <div className=\"space-y-4\">\n            <h4 className=\"font-semibold text-foreground\">Legal Notices</h4>\n            <div className=\"space-y-2\">\n              <button \n                onClick={() => setLocation('/privacy-notice')}\n                className=\"block text-sm text-muted-foreground hover:text-foreground text-left\"\n                data-testid=\"link-privacy-notice\"\n              >\n                Privacy Notice\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"border-t border-border mt-8 pt-6 text-center\">\n          <p className=\"text-xs text-muted-foreground\">\n            ¬© 2024 HealthHire Portal. Empowering healthcare careers across the NHS.\n          </p>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","size_bytes":5096},"client/src/components/dashboard/header.tsx":{"content":"import ProgressRing from \"@/components/dashboard/progress-ring\";\nimport logoHealthhire from \"@assets/Portal_1756483081930.png\";\nimport { ThemeToggle } from \"@/components/ui/theme-toggle\";\n\ninterface User {\n  firstName?: string;\n  lastName?: string;\n  profileImageUrl?: string;\n}\n\ninterface HeaderProps {\n  user?: User;\n  profileCompletion: number;\n}\n\nexport default function Header({ user, profileCompletion }: HeaderProps) {\n  const handleLogout = () => {\n    window.location.href = \"/api/logout\";\n  };\n\n  return (\n    <header className=\"border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50\" data-testid=\"header\">\n      <div className=\"max-w-7xl mx-auto px-6 lg:px-8\">\n        <div className=\"flex items-center justify-between h-16\">\n          {/* Logo */}\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-10 h-10 flex items-center justify-center\">\n              <img \n                src={logoHealthhire} \n                alt=\"HealthHire Portal\" \n                className=\"w-10 h-10 object-contain\"\n                data-testid=\"img-logo\"\n              />\n            </div>\n            <div>\n              <h1 className=\"text-xl font-semibold text-foreground\" data-testid=\"text-logo\">HealthHire Portal</h1>\n              <p className=\"text-xs text-muted-foreground hidden sm:block\">Helping You in Your Career Journey</p>\n            </div>\n          </div>\n\n          {/* Theme Toggle, Progress Ring & User Avatar */}\n          <div className=\"flex items-center space-x-4\">\n            {/* Theme Toggle */}\n            <ThemeToggle />\n            \n            {/* Progress Ring */}\n\n            {/* User Avatar */}\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-10 h-10 rounded-full border-2 border-border overflow-hidden bg-muted\">\n                {user?.profileImageUrl ? (\n                  <img \n                    src={user.profileImageUrl} \n                    alt=\"User profile photo\" \n                    className=\"w-full h-full object-cover\"\n                    data-testid=\"img-avatar\"\n                  />\n                ) : (\n                  <div className=\"w-full h-full flex items-center justify-center bg-primary/10\">\n                    <span className=\"text-primary font-medium\">\n                      {user?.firstName?.[0] || user?.lastName?.[0] || 'U'}\n                    </span>\n                  </div>\n                )}\n              </div>\n              <div className=\"hidden md:block\">\n                <p className=\"text-sm font-medium text-foreground\" data-testid=\"text-username\">\n                  {user?.firstName || user?.lastName \n                    ? `${user.firstName || ''} ${user.lastName || ''}`.trim()\n                    : 'User'\n                  }\n                </p>\n                <button \n                  onClick={handleLogout}\n                  className=\"text-xs text-muted-foreground hover:text-foreground\"\n                  data-testid=\"button-logout\"\n                >\n                  Sign out\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n}\n","size_bytes":3186},"client/src/components/dashboard/progress-ring.tsx":{"content":"interface ProgressRingProps {\n  percentage: number;\n}\n\nexport default function ProgressRing({ percentage }: ProgressRingProps) {\n  const radius = 18;\n  const circumference = 2 * Math.PI * radius;\n  const offset = circumference - (percentage / 100) * circumference;\n\n  return (\n    <div className=\"relative w-12 h-12\" data-testid=\"progress-ring\">\n      <svg className=\"w-12 h-12 transform -rotate-90\" viewBox=\"0 0 42 42\">\n        {/* Background circle */}\n        <circle \n          cx=\"21\" \n          cy=\"21\" \n          r={radius} \n          fill=\"none\" \n          stroke=\"hsl(var(--border))\" \n          strokeWidth=\"3\"\n        />\n        {/* Progress circle */}\n        <circle \n          cx=\"21\" \n          cy=\"21\" \n          r={radius} \n          fill=\"none\" \n          stroke=\"hsl(var(--accent))\" \n          strokeWidth=\"3\" \n          strokeDasharray={circumference}\n          strokeDashoffset={offset}\n          strokeLinecap=\"round\"\n          className=\"transition-all duration-300 ease-in-out\"\n        />\n      </svg>\n      <div className=\"absolute inset-0 flex items-center justify-center\">\n        <span className=\"text-xs font-medium text-accent\" data-testid=\"text-progress-percentage\">\n          {percentage}%\n        </span>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1268},"client/src/components/dashboard/recent-activity.tsx":{"content":"import { formatDistanceToNow } from \"date-fns\";\nimport type { Application } from \"@shared/schema\";\n\ninterface RecentActivityProps {\n  applications: Application[];\n}\n\nconst statusColors: Record<string, string> = {\n  draft: \"bg-muted/50 text-muted-foreground\",\n  applied: \"bg-secondary/10 text-secondary\",\n  interview: \"bg-accent/10 text-accent\", \n  offered: \"bg-green-100 text-green-800\",\n  rejected: \"bg-destructive/10 text-destructive\"\n};\n\nconst statusLabels: Record<string, string> = {\n  draft: \"Draft\",\n  applied: \"Applied\", \n  interview: \"Interview\",\n  offered: \"Offered\",\n  rejected: \"Rejected\"\n};\n\nexport default function RecentActivity({ applications }: RecentActivityProps) {\n  if (!applications || applications.length === 0) {\n    return (\n      <div className=\"bg-card border border-border rounded-lg p-8\" data-testid=\"recent-activity\">\n        <h3 className=\"text-xl font-semibold text-foreground mb-6\">Recent Activity</h3>\n        <div className=\"text-center py-8\">\n          <p className=\"text-muted-foreground\">No recent activity yet</p>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            Start by completing your profile or applying to your first job\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-card border border-border rounded-lg p-8 mb-8\" data-testid=\"recent-activity\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-xl font-semibold text-foreground\">Recent Activity</h3>\n        <button \n          className=\"text-sm text-muted-foreground hover:text-foreground\"\n          onClick={() => {/* View all activity logic would go here */}}\n          data-testid=\"button-view-all\"\n        >\n          View all\n        </button>\n      </div>\n      \n      <div className=\"space-y-4\">\n        {applications.slice(0, 3).map((application) => (\n          <div key={application.id} className=\"flex items-center space-x-4\" data-testid={`activity-${application.id}`}>\n            {/* NHS-themed icon placeholder */}\n            <div className=\"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center\">\n              <svg className=\"w-6 h-6 text-primary\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\n              </svg>\n            </div>\n            <div className=\"flex-1\">\n              <p className=\"text-sm font-medium text-foreground\" data-testid={`text-job-title-${application.id}`}>\n                Applied to {application.jobTitle}\n              </p>\n              <p className=\"text-xs text-muted-foreground\" data-testid={`text-employer-${application.id}`}>\n                {application.employer} ‚Ä¢ {formatDistanceToNow(new Date(application.createdAt || new Date()), { addSuffix: true })}\n              </p>\n            </div>\n            <div \n              className={`px-3 py-1 text-xs rounded-full ${statusColors[application.status] || statusColors.draft}`}\n              data-testid={`status-${application.id}`}\n            >\n              {statusLabels[application.status] || 'Unknown'}\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n","size_bytes":3348},"client/src/components/dashboard/section-card.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { LucideIcon, Crown } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useSubscription } from \"@/hooks/useSubscription\";\nimport { UpgradePrompt } from \"@/components/ui/upgrade-prompt\";\n\ninterface SectionCardProps {\n  id: string;\n  title: string;\n  description: string;\n  icon: LucideIcon;\n  iconColor: string;\n  iconBg: string;\n  value?: number | string | null;\n  label?: string | null;\n  valueColor?: string | null;\n  actionText: string;\n  actionSubtext: string;\n  href: string;\n  isPremium?: boolean;\n  feature?: string | null;\n}\n\nexport default function SectionCard({\n  id,\n  title,\n  description,\n  icon: Icon,\n  iconColor,\n  iconBg,\n  value,\n  valueColor,\n  actionText,\n  actionSubtext,\n  href,\n  isPremium = false,\n  feature = null\n}: SectionCardProps) {\n  const [, setLocation] = useLocation();\n  const { isPaid } = useSubscription();\n  \n  const isLocked = isPremium && !isPaid;\n  \n  const handleCardClick = () => {\n    // Allow navigation to all pages - locked features will show preview modes\n    const routeMap: { [key: string]: string } = {\n      '/profile': '/profile',\n      '/jobs': '/jobs', \n      '/documents': '/documents',\n      '/resources': '/resources',\n      '/practice': '/interview-practice',\n      '/qa': '/qa-generator',\n      '/tracker': '/tracker',\n      '/news': '/news'\n    };\n    \n    const actualRoute = routeMap[href] || href;\n    setLocation(actualRoute);\n  };\n\n  const handleButtonClick = (e: React.MouseEvent, action: string) => {\n    e.stopPropagation();\n    // Execute action logic would go here\n  };\n\n  return (\n    <div \n      className={`group relative cursor-pointer transform transition-all duration-300 hover:scale-[1.02] hover:shadow-xl h-full ${\n        isLocked ? 'opacity-75' : ''\n      }`}\n      onClick={handleCardClick}\n      data-testid={`card-${id}`}\n    >\n      {/* Background with gradient and glass effect */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-white/80 to-white/40 dark:from-gray-800/80 dark:to-gray-900/40 backdrop-blur-sm border border-white/20 dark:border-gray-700/30 rounded-2xl shadow-lg group-hover:shadow-2xl transition-all duration-300\"></div>\n      \n      {/* Animated background glow on hover */}\n      <div className=\"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-accent/5 rounded-2xl\"></div>\n      </div>\n      \n      {/* Card content */}\n      <div className=\"relative p-8 h-full flex flex-col\">\n        {/* Premium Badge */}\n        {isPremium && (\n          <div className=\"absolute top-6 right-6\">\n            <div className={`flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-semibold shadow-lg backdrop-blur-sm transition-all duration-300 ${\n              isPaid \n                ? 'bg-emerald-100/80 text-emerald-700 dark:bg-emerald-900/50 dark:text-emerald-300 border border-emerald-200 dark:border-emerald-700' \n                : 'bg-gradient-to-r from-amber-100 to-orange-100 text-amber-700 dark:from-amber-900/50 dark:to-orange-900/50 dark:text-amber-300 border border-amber-200 dark:border-amber-700'\n            }`}>\n              <Crown className=\"w-3 h-3\" />\n              {isPaid ? 'Premium' : 'Unlock'}\n            </div>\n          </div>\n        )}\n        \n        {/* Icon with enhanced styling */}\n        <div className=\"flex items-start justify-between mb-8\">\n          <div className={`relative w-16 h-16 ${iconBg} rounded-2xl flex items-center justify-center shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-110`}>\n            {/* Subtle glow effect behind icon */}\n            <div className={`absolute inset-0 ${iconBg} rounded-2xl blur-lg opacity-50 group-hover:opacity-75 transition-opacity duration-300`}></div>\n            <Icon className={`relative w-8 h-8 ${iconColor} group-hover:scale-110 transition-transform duration-300`} />\n          </div>\n        </div>\n        \n        {/* Title with better typography */}\n        <h3 className=\"text-2xl font-bold text-foreground mb-4 group-hover:text-primary transition-colors duration-300\" data-testid={`text-${id}-title`}>\n          {title}\n        </h3>\n        \n        {/* Description with improved spacing */}\n        <p className=\"text-muted-foreground mb-6 leading-relaxed\" data-testid={`text-${id}-description`}>\n          {description}\n        </p>\n        \n        {/* Enhanced action area */}\n        <div className=\"relative mt-auto\">\n          <div className=\"bg-gradient-to-r from-muted/80 to-muted/60 backdrop-blur-sm rounded-xl p-4 border border-border/50 group-hover:border-primary/20 transition-all duration-300\">\n            {/* Action text with improved styling */}\n            <div className=\"flex items-start justify-between mb-2\">\n              <p className=\"text-sm font-semibold text-foreground group-hover:text-primary transition-colors duration-300\" data-testid={`text-${id}-action`}>\n                {actionText}\n              </p>\n              {!isLocked && (\n                <div className=\"ml-2 opacity-0 group-hover:opacity-100 transform translate-x-2 group-hover:translate-x-0 transition-all duration-300\">\n                  <div className=\"w-5 h-5 rounded-full bg-primary/20 flex items-center justify-center\">\n                    <div className=\"w-2 h-2 rounded-full bg-primary animate-pulse\"></div>\n                  </div>\n                </div>\n              )}\n            </div>\n            \n            <p className=\"text-xs text-muted-foreground leading-relaxed\" data-testid={`text-${id}-subtext`}>\n              {actionSubtext}\n            </p>\n            \n            {/* Upgrade Button for Locked Features with better styling */}\n            {isLocked && (\n              <Button \n                size=\"sm\" \n                className=\"w-full mt-4 bg-gradient-to-r from-accent to-accent/80 hover:from-accent/90 hover:to-accent/70 shadow-lg hover:shadow-xl transition-all duration-300 font-semibold\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  setLocation('/upgrade');\n                }}\n                data-testid={`button-upgrade-${id}`}\n              >\n                <Crown className=\"w-4 h-4 mr-2\" />\n                Upgrade to Unlock\n              </Button>\n            )}\n          </div>\n          \n          {/* Subtle bottom accent line */}\n          <div className=\"absolute bottom-0 left-4 right-4 h-0.5 bg-gradient-to-r from-transparent via-primary/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\"></div>\n        </div>\n      </div>\n      \n      {/* Corner accent decoration */}\n      <div className=\"absolute top-0 left-0 w-8 h-8 opacity-0 group-hover:opacity-100 transition-opacity duration-500\">\n        <div className=\"absolute top-4 left-4 w-1 h-1 bg-primary rounded-full animate-ping\"></div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6993},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/upgrade-prompt.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Lock, Sparkles, ArrowRight } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface UpgradePromptProps {\n  title: string;\n  description: string;\n  feature?: string;\n  className?: string;\n  variant?: 'overlay' | 'card' | 'banner';\n}\n\nexport function UpgradePrompt({ \n  title, \n  description, \n  feature,\n  className = \"\",\n  variant = 'overlay'\n}: UpgradePromptProps) {\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n\n  const handleUpgrade = async () => {\n    setIsLoading(true);\n    try {\n      const response = await apiRequest('POST', '/api/payments/create-checkout', {});\n      const data = await response.json();\n      if (data.checkout_url) {\n        window.location.href = data.checkout_url;\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to start checkout. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (variant === 'overlay') {\n    return (\n      <div className={`absolute inset-0 bg-background/95 backdrop-blur-sm flex items-center justify-center z-10 ${className}`}>\n        <Card className=\"max-w-md mx-4\">\n          <CardContent className=\"p-6 text-center\">\n            <div className=\"w-12 h-12 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center\">\n              <Lock className=\"w-6 h-6 text-primary\" />\n            </div>\n            <h3 className=\"text-lg font-semibold mb-2\">{title}</h3>\n            <p className=\"text-muted-foreground mb-4 text-sm\">{description}</p>\n            <div className=\"space-y-3\">\n              <Badge variant=\"secondary\" className=\"mb-2\">\n                <Sparkles className=\"w-3 h-3 mr-1\" />\n                ¬£70 one-time payment\n              </Badge>\n              <Button \n                onClick={handleUpgrade}\n                disabled={isLoading}\n                className=\"w-full\"\n                size=\"sm\"\n              >\n                {isLoading ? \"Loading...\" : \"Unlock Now\"}\n                <ArrowRight className=\"w-4 h-4 ml-2\" />\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (variant === 'banner') {\n    return (\n      <div className={`bg-gradient-to-r from-primary/5 to-accent/5 border border-primary/20 rounded-lg p-4 mb-6 ${className}`}>\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex-1\">\n            <h4 className=\"font-medium text-sm\">{title}</h4>\n            <p className=\"text-xs text-muted-foreground mt-1\">{description}</p>\n          </div>\n          <Button \n            onClick={handleUpgrade}\n            disabled={isLoading}\n            size=\"sm\"\n            variant=\"default\"\n          >\n            {isLoading ? \"...\" : \"Upgrade\"}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  // Card variant\n  return (\n    <Card className={`${className}`}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start space-x-4\">\n          <div className=\"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0\">\n            <Lock className=\"w-5 h-5 text-primary\" />\n          </div>\n          <div className=\"flex-1\">\n            <h3 className=\"font-medium mb-1\">{title}</h3>\n            <p className=\"text-sm text-muted-foreground mb-3\">{description}</p>\n            <div className=\"flex items-center justify-between\">\n              <Badge variant=\"outline\" className=\"text-xs\">\n                ¬£70 lifetime access\n              </Badge>\n              <Button \n                onClick={handleUpgrade}\n                disabled={isLoading}\n                size=\"sm\"\n              >\n                {isLoading ? \"Loading...\" : \"Upgrade Now\"}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":4140},"client/src/pages/news.tsx":{"content":"import { useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Newspaper, \n  Calendar, \n  ArrowRight, \n  AlertCircle,\n  TrendingUp,\n  FileText,\n  Users,\n  ArrowLeft\n} from \"lucide-react\";\n\nconst newsItems = [\n  {\n    id: \"1\",\n    title: \"New NHS Pay Framework 2024-2025\",\n    category: \"Pay & Benefits\",\n    date: \"2024-03-15\",\n    summary: \"Updated pay scales for all NHS bands with 5% increase across clinical roles. New framework includes enhanced overtime rates and additional leave entitlements.\",\n    type: \"policy\",\n    priority: \"high\",\n    readTime: \"3 min read\"\n  },\n  {\n    id: \"2\", \n    title: \"HealthHire Portal: Enhanced Interview Practice\",\n    category: \"Platform Update\",\n    date: \"2024-03-10\",\n    summary: \"We've enhanced our interview practice system with advanced feedback and role-specific coaching for NHS values-based interviews.\",\n    type: \"feature\",\n    priority: \"medium\",\n    readTime: \"2 min read\"\n  },\n  {\n    id: \"3\",\n    title: \"NHS Visa Sponsorship Expansion\",\n    category: \"Immigration\",\n    date: \"2024-03-08\", \n    summary: \"More NHS trusts now offering visa sponsorship for international nurses and allied health professionals. Streamlined application process for Health and Care Worker visas.\",\n    type: \"policy\",\n    priority: \"high\",\n    readTime: \"4 min read\"\n  },\n  {\n    id: \"4\",\n    title: \"Winter Pressures: Additional Recruitment Drive\",\n    category: \"Recruitment\",\n    date: \"2024-03-05\",\n    summary: \"NHS England announces emergency recruitment initiatives for critical care and emergency departments. Fast-track applications and enhanced benefits packages available.\",\n    type: \"opportunity\",\n    priority: \"medium\",\n    readTime: \"3 min read\"\n  },\n  {\n    id: \"5\",\n    title: \"Professional Development: New CPD Requirements\",\n    category: \"Education\",\n    date: \"2024-03-01\",\n    summary: \"Updated continuing professional development requirements for all registered healthcare professionals. New online training modules and portfolio tracking systems.\",\n    type: \"policy\",\n    priority: \"medium\",\n    readTime: \"5 min read\"\n  }\n];\n\nconst categoryColors: Record<string, string> = {\n  \"Pay & Benefits\": \"bg-green-100 text-green-800\",\n  \"Platform Update\": \"bg-blue-100 text-blue-800\", \n  \"Immigration\": \"bg-purple-100 text-purple-800\",\n  \"Recruitment\": \"bg-orange-100 text-orange-800\",\n  \"Education\": \"bg-indigo-100 text-indigo-800\"\n};\n\nconst typeIcons: Record<string, any> = {\n  policy: AlertCircle,\n  feature: TrendingUp,\n  opportunity: Users\n};\n\nexport default function NewsAndUpdates() {\n  const { toast } = useToast();\n  const { isAuthenticated, isLoading } = useAuth();\n\n  // Redirect to login if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString(\"en-GB\", {\n      day: \"numeric\",\n      month: \"long\", \n      year: \"numeric\"\n    });\n  };\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case \"high\": return \"border-l-red-500\";\n      case \"medium\": return \"border-l-yellow-500\";\n      case \"low\": return \"border-l-green-500\";\n      default: return \"border-l-gray-300\";\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading news and updates...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\" data-testid=\"news-page\">\n      <div className=\"max-w-4xl mx-auto px-6 lg:px-8 py-8\">\n        {/* Back to Dashboard Button */}\n        <div className=\"mb-8\">\n          <Button \n            variant=\"ghost\" \n            onClick={() => window.location.href = \"/\"}\n            className=\"flex items-center gap-2 text-muted-foreground hover:text-foreground\"\n            data-testid=\"button-back-dashboard\"\n          >\n            <ArrowLeft className=\"h-4 w-4\" />\n            Back to Dashboard\n          </Button>\n        </div>\n        \n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center gap-3 mb-4\">\n            <div className=\"p-2 bg-primary/10 rounded-lg\">\n              <Newspaper className=\"h-6 w-6 text-primary\" />\n            </div>\n            <div>\n              <h1 className=\"text-3xl font-bold text-foreground\">News & Updates</h1>\n              <p className=\"text-muted-foreground\">\n                Stay informed with the latest NHS policy changes, platform updates, and career opportunities.\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* News Feed */}\n        <div className=\"space-y-6\">\n          {newsItems.map((item) => {\n            const IconComponent = typeIcons[item.type] || FileText;\n            \n            return (\n              <Card \n                key={item.id} \n                className={`border-l-4 ${getPriorityColor(item.priority)} hover:shadow-md transition-shadow`}\n                data-testid={`news-item-${item.id}`}\n              >\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-start justify-between gap-4\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <IconComponent className=\"h-4 w-4 text-primary\" />\n                        <Badge \n                          variant=\"secondary\" \n                          className={categoryColors[item.category] || \"bg-gray-100 text-gray-800\"}\n                        >\n                          {item.category}\n                        </Badge>\n                        <span className=\"text-sm text-muted-foreground\">‚Ä¢</span>\n                        <span className=\"text-sm text-muted-foreground\">{item.readTime}</span>\n                      </div>\n                      <CardTitle className=\"text-xl mb-2\" data-testid={`news-title-${item.id}`}>\n                        {item.title}\n                      </CardTitle>\n                      <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                        <Calendar className=\"h-4 w-4\" />\n                        <span>{formatDate(item.date)}</span>\n                      </div>\n                    </div>\n                  </div>\n                </CardHeader>\n                \n                <CardContent className=\"pt-0\">\n                  <p className=\"text-muted-foreground mb-4 leading-relaxed\">\n                    {item.summary}\n                  </p>\n                  \n                  <div className=\"flex items-center justify-between\">\n                    <Button variant=\"outline\" size=\"sm\" className=\"group\" data-testid={`read-more-${item.id}`}>\n                      Read Full Article\n                      <ArrowRight className=\"h-4 w-4 ml-2 group-hover:translate-x-1 transition-transform\" />\n                    </Button>\n                    \n                    {item.priority === \"high\" && (\n                      <Badge variant=\"destructive\" className=\"text-xs\">\n                        Important\n                      </Badge>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n\n        {/* Load More Section */}\n        <div className=\"text-center mt-12\">\n          <Button variant=\"outline\" size=\"lg\" data-testid=\"load-more-news\">\n            Load More Updates\n          </Button>\n          <p className=\"text-sm text-muted-foreground mt-2\">\n            Stay updated with weekly newsletters and real-time notifications\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":8365},"client/src/pages/tracker.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { \n  Plus, \n  Building2, \n  MapPin, \n  Calendar, \n  DollarSign,\n  TrendingUp,\n  Target,\n  Clock,\n  Trophy,\n  BarChart3,\n  Crown,\n  Lock,\n  ArrowLeft,\n  Edit3,\n  Save,\n  X\n} from \"lucide-react\";\nimport type { Application } from \"@shared/schema\";\nimport { RotatingStatsBar } from \"@/components/rotating-stats-bar\";\nimport { useSubscription } from \"@/hooks/useSubscription\";\nimport { UpgradePrompt } from \"@/components/UpgradePrompt\";\nimport { FEATURES } from \"@shared/schema\";\nimport { useLocation } from \"wouter\";\n\nimport {\n  DndContext,\n  closestCenter,\n  KeyboardSensor,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  DragEndEvent,\n  useDroppable,\n} from \"@dnd-kit/core\";\nimport {\n  SortableContext,\n  sortableKeyboardCoordinates,\n  horizontalListSortingStrategy,\n} from \"@dnd-kit/sortable\";\nimport {\n  useSortable,\n} from \"@dnd-kit/sortable\";\nimport { CSS } from \"@dnd-kit/utilities\";\n\nconst APPLICATION_STATUSES = [\n  { id: \"draft\", label: \"Draft\", color: \"bg-gray-100 text-gray-800\", count: 0 },\n  { id: \"applied\", label: \"Applied\", color: \"bg-blue-100 text-blue-800\", count: 0 },\n  { id: \"interview\", label: \"Interview\", color: \"bg-yellow-100 text-yellow-800\", count: 0 },\n  { id: \"offered\", label: \"Offered\", color: \"bg-green-100 text-green-800\", count: 0 },\n  { id: \"rejected\", label: \"Rejected\", color: \"bg-red-100 text-red-800\", count: 0 },\n];\n\n// Sortable Application Card Component with Notes\nfunction SortableApplicationCard({ application }: { application: Application }) {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({ id: application.id });\n  \n  const [isEditingNotes, setIsEditingNotes] = useState(false);\n  const [notesValue, setNotesValue] = useState(application.notes || \"\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1,\n  };\n\n  const formatDate = (date: Date | null) => {\n    if (!date) return \"\";\n    return new Date(date).toLocaleDateString(\"en-GB\", {\n      day: \"numeric\",\n      month: \"short\",\n      year: \"numeric\"\n    });\n  };\n\n  // Mutation to update notes\n  const updateNotesMutation = useMutation({\n    mutationFn: async ({ notes }: { notes: string }) => {\n      const response = await apiRequest('PATCH', `/api/applications/${application.id}/notes`, { notes });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/applications\"] });\n      toast({\n        title: \"Notes Updated\",\n        description: \"Your application notes have been saved.\",\n      });\n      setIsEditingNotes(false);\n    },\n    onError: (error) => {\n      console.error(\"Error updating notes:\", error);\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update notes. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSaveNotes = () => {\n    updateNotesMutation.mutate({ notes: notesValue });\n  };\n\n  const handleCancelNotes = () => {\n    setNotesValue(application.notes || \"\");\n    setIsEditingNotes(false);\n  };\n\n  return (\n    <div\n      ref={setNodeRef}\n      style={style}\n      {...attributes}\n      className={`bg-white rounded-lg border p-4 mb-3 hover:shadow-md transition-shadow ${isDragging ? 'shadow-lg z-50' : ''}`}\n      data-testid={`application-card-${application.id}`}\n    >\n      {/* Drag handle */}\n      <div {...listeners} className=\"cursor-move mb-2\">\n        <div className=\"text-xs text-muted-foreground text-center\">‚ãÆ‚ãÆ</div>\n      </div>\n      \n      <div className=\"space-y-2\">\n        <h4 className=\"font-semibold text-foreground truncate\" data-testid={`text-job-title-${application.id}`}>\n          {application.jobTitle}\n        </h4>\n        \n        <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n          <Building2 className=\"h-3 w-3\" />\n          <span className=\"truncate\">{application.employer}</span>\n        </div>\n\n        {application.location && (\n          <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n            <MapPin className=\"h-3 w-3\" />\n            <span className=\"truncate\">{application.location}</span>\n          </div>\n        )}\n\n        {application.salary && (\n          <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n            <DollarSign className=\"h-3 w-3\" />\n            <span>{application.salary}</span>\n          </div>\n        )}\n\n        {/* Notes Section */}\n        <div className=\"pt-2 border-t border-gray-100\">\n          <div className=\"flex items-center justify-between mb-1\">\n            <div className=\"flex items-center gap-1\">\n              <Edit3 className=\"h-3 w-3 text-muted-foreground\" />\n              <span className=\"text-xs text-muted-foreground\">Notes</span>\n            </div>\n            {!isEditingNotes && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsEditingNotes(true)}\n                className=\"h-6 px-2 text-xs\"\n                data-testid={`button-edit-notes-${application.id}`}\n              >\n                {application.notes ? \"Edit\" : \"Add\"}\n              </Button>\n            )}\n          </div>\n          \n          {isEditingNotes ? (\n            <div className=\"space-y-2\">\n              <textarea\n                value={notesValue}\n                onChange={(e) => setNotesValue(e.target.value)}\n                placeholder=\"Add personal notes about this application...\"\n                className=\"w-full h-16 text-xs p-2 border border-gray-200 rounded resize-none focus:outline-none focus:ring-1 focus:ring-primary\"\n                data-testid={`textarea-notes-${application.id}`}\n              />\n              <div className=\"flex gap-1\">\n                <Button\n                  size=\"sm\"\n                  onClick={handleSaveNotes}\n                  disabled={updateNotesMutation.isPending}\n                  className=\"h-6 px-2 text-xs\"\n                  data-testid={`button-save-notes-${application.id}`}\n                >\n                  <Save className=\"h-3 w-3 mr-1\" />\n                  Save\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleCancelNotes}\n                  className=\"h-6 px-2 text-xs\"\n                  data-testid={`button-cancel-notes-${application.id}`}\n                >\n                  <X className=\"h-3 w-3 mr-1\" />\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          ) : (\n            <div className=\"min-h-[16px]\">\n              {application.notes ? (\n                <p className=\"text-xs text-gray-600 whitespace-pre-wrap break-words\">\n                  {application.notes}\n                </p>\n              ) : (\n                <p className=\"text-xs text-muted-foreground italic\">\n                  Click \"Add\" to add notes...\n                </p>\n              )}\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex items-center justify-between pt-2\">\n          {application.appliedAt && (\n            <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n              <Calendar className=\"h-3 w-3\" />\n              <span>{formatDate(application.appliedAt)}</span>\n            </div>\n          )}\n          \n          {application.interviewDate && (\n            <div className=\"flex items-center gap-1 text-xs text-primary\">\n              <Clock className=\"h-3 w-3\" />\n              <span>Interview: {formatDate(application.interviewDate)}</span>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Droppable Column Component\nfunction DroppableColumn({ status, applications }: { status: typeof APPLICATION_STATUSES[0], applications: Application[] }) {\n  const filteredApplications = applications?.filter((app: Application) => app?.status === status?.id) || [];\n  \n  const { isOver, setNodeRef } = useDroppable({\n    id: `droppable-${status.id}`,\n  });\n\n  const style = {\n    backgroundColor: isOver ? 'rgba(59, 130, 246, 0.1)' : undefined,\n    borderColor: isOver ? 'rgb(59, 130, 246)' : undefined,\n  };\n  \n  return (\n    <div \n      ref={setNodeRef}\n      style={style}\n      className={`min-h-[500px] bg-muted/30 rounded-lg p-4 border-2 border-dashed transition-colors ${\n        isOver ? 'border-blue-500' : 'border-transparent'\n      }`} \n      data-testid={`column-${status.id}`}\n    >\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center gap-2\">\n          <h3 className=\"font-semibold text-foreground\">{status.label}</h3>\n          <Badge variant=\"secondary\" data-testid={`badge-count-${status.id}`}>\n            {filteredApplications.length}\n          </Badge>\n        </div>\n      </div>\n      \n      <SortableContext items={filteredApplications.map(app => app.id)} strategy={horizontalListSortingStrategy}>\n        <div className=\"space-y-3\">\n          {filteredApplications.map((application) => (\n            <SortableApplicationCard key={application.id} application={application} />\n          ))}\n          {filteredApplications.length === 0 && (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <p className=\"text-sm\">No applications</p>\n            </div>\n          )}\n        </div>\n      </SortableContext>\n    </div>\n  );\n}\n\n// Add Application Form Component\nfunction AddApplicationForm({ open, onOpenChange, isPaid, currentApplicationCount }: { open: boolean; onOpenChange: (open: boolean) => void; isPaid: boolean; currentApplicationCount: number }) {\n  const [formData, setFormData] = useState({\n    jobTitle: \"\",\n    employer: \"\",\n    location: \"\",\n    salary: \"\",\n    status: \"draft\" as const,\n  });\n\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const addApplication = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await apiRequest('POST', '/api/applications', data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/applications'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/user/weekly-stats'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      toast({\n        title: \"Application Added\",\n        description: \"Your job application has been added to the tracker.\",\n      });\n      setFormData({\n        jobTitle: \"\",\n        employer: \"\",\n        location: \"\",\n        salary: \"\",\n        status: \"draft\",\n      });\n      onOpenChange(false);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add application. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Check free tier limit\n    if (!isPaid && currentApplicationCount >= 3) {\n      toast({\n        title: \"Limit Reached\",\n        description: \"Free users can track up to 3 applications. Upgrade to track unlimited applications.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (!formData.jobTitle || !formData.employer) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please fill in job title and employer.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    addApplication.mutate(formData);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent data-testid=\"add-application-dialog\">\n        <DialogHeader>\n          <DialogTitle>Add New Application</DialogTitle>\n          <DialogDescription>\n            Track a new job application in your kanban board.\n          </DialogDescription>\n        </DialogHeader>\n        \n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"jobTitle\">Job Title *</Label>\n            <Input\n              id=\"jobTitle\"\n              value={formData.jobTitle}\n              onChange={(e) => setFormData(prev => ({ ...prev, jobTitle: e.target.value }))}\n              placeholder=\"e.g., Band 6 Staff Nurse\"\n              data-testid=\"input-job-title\"\n              required\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"employer\">Employer *</Label>\n            <Input\n              id=\"employer\"\n              value={formData.employer}\n              onChange={(e) => setFormData(prev => ({ ...prev, employer: e.target.value }))}\n              placeholder=\"e.g., London NHS Foundation Trust\"\n              data-testid=\"input-employer\"\n              required\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"location\">Location</Label>\n            <Input\n              id=\"location\"\n              value={formData.location}\n              onChange={(e) => setFormData(prev => ({ ...prev, location: e.target.value }))}\n              placeholder=\"e.g., London, UK\"\n              data-testid=\"input-location\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"salary\">Salary Range</Label>\n            <Input\n              id=\"salary\"\n              value={formData.salary}\n              onChange={(e) => setFormData(prev => ({ ...prev, salary: e.target.value }))}\n              placeholder=\"e.g., ¬£28,407 - ¬£34,581\"\n              data-testid=\"input-salary\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"status\">Initial Status</Label>\n            <Select value={formData.status} onValueChange={(value: any) => setFormData(prev => ({ ...prev, status: value }))}>\n              <SelectTrigger data-testid=\"select-status\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"draft\">Draft</SelectItem>\n                <SelectItem value=\"applied\">Applied</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <DialogFooter>\n            <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={addApplication.isPending} data-testid=\"button-add-application\">\n              {addApplication.isPending ? \"Adding...\" : \"Add Application\"}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport default function ApplicationTracker() {\n  const { toast } = useToast();\n  const { isAuthenticated, isLoading } = useAuth();\n  const { canAccessFeature, isPaid } = useSubscription();\n  const [, setLocation] = useLocation();\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const queryClient = useQueryClient();\n\n  // Redirect to login if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  const { data: applications = [], isLoading: isApplicationsLoading, error } = useQuery<Application[]>({\n    queryKey: ['/api/applications'],\n    retry: false,\n    enabled: isAuthenticated,\n  });\n\n  // Handle errors with useEffect\n  useEffect(() => {\n    if (error) {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to load applications.\",\n        variant: \"destructive\",\n      });\n    }\n  }, [error, toast]);\n\n  // Update application status mutation\n  const updateApplicationStatus = useMutation({\n    mutationFn: async ({ id, status }: { id: string; status: string }) => {\n      const response = await apiRequest('PUT', `/api/applications/${id}`, { status });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/applications'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/user/weekly-stats'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update application status.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Drag sensors\n  const sensors = useSensors(\n    useSensor(PointerSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    })\n  );\n\n  // Handle drag end\n  function handleDragEnd(event: DragEndEvent) {\n    const { active, over } = event;\n\n    if (over && active.id !== over.id) {\n      // Check if dropped on a droppable column\n      if (over.id.toString().startsWith('droppable-')) {\n        const statusId = over.id.toString().replace('droppable-', '');\n        const targetStatus = APPLICATION_STATUSES.find(status => status.id === statusId);\n        \n        if (targetStatus) {\n          updateApplicationStatus.mutate({\n            id: active.id as string,\n            status: targetStatus.id\n          });\n        }\n      }\n      // Check if dropped on another application (for reordering within same column)\n      else {\n        const targetApp = applications?.find((app: Application) => app.id === over.id);\n        if (targetApp) {\n          const sourceApp = applications?.find((app: Application) => app.id === active.id);\n          // Only update if moving to different status\n          if (sourceApp && sourceApp.status !== targetApp.status) {\n            updateApplicationStatus.mutate({\n              id: active.id as string,\n              status: targetApp.status\n            });\n          }\n        }\n      }\n    }\n  }\n\n  // Calculate statistics\n  const stats = {\n    total: applications?.length || 0,\n    applied: applications?.filter((app: Application) => app.status === 'applied').length || 0,\n    interviews: applications?.filter((app: Application) => app.status === 'interview').length || 0,\n    offers: applications?.filter((app: Application) => app.status === 'offered').length || 0,\n    successRate: applications?.length > 0 ? Math.round(((applications?.filter((app: Application) => app.status === 'offered').length || 0) / applications.length) * 100) : 0,\n  };\n  \n  // Check if user has reached the free tier limit\n  const hasReachedFreeLimit = !isPaid && stats.total >= 3;\n\n  if (isLoading || isApplicationsLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading your application tracker...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\" data-testid=\"tracker-page\">\n      <div className=\"max-w-7xl mx-auto px-6 lg:px-8 py-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Button \n                variant=\"ghost\" \n                size=\"sm\"\n                onClick={() => setLocation(\"/\")}\n                data-testid=\"button-back-to-dashboard\"\n              >\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back to Dashboard\n              </Button>\n            </div>\n            <h1 className=\"text-3xl font-bold text-foreground mb-2\">\n              üìã Job Tracker {!isPaid && \"(Limited Access)\"}\n              {!isPaid && <Crown className=\"inline h-6 w-6 text-yellow-600 ml-2\" />}\n            </h1>\n            <p className=\"text-muted-foreground\">\n              {isPaid ? \n                \"Manage your NHS job applications with our kanban board and analytics dashboard.\" :\n                \"Track up to 3 job applications - upgrade for unlimited tracking\"\n              }\n            </p>\n            {!isPaid && (\n              <div className=\"mt-2\">\n                <Badge variant=\"outline\" className=\"text-yellow-700 border-yellow-300 bg-yellow-50\">\n                  Free Tier: {stats.total}/3 applications used\n                </Badge>\n              </div>\n            )}\n          </div>\n          <Button \n            onClick={!hasReachedFreeLimit ? () => setIsAddDialogOpen(true) : undefined}\n            disabled={hasReachedFreeLimit}\n            className=\"flex items-center gap-2\"\n            data-testid=\"button-add-new-application\"\n          >\n            <Plus className=\"h-4 w-4\" />\n            {hasReachedFreeLimit \n              ? \"Add Application (Limit Reached)\" \n              : \"Add Application\"}\n            {hasReachedFreeLimit && <Lock className=\"inline h-3 w-3 ml-1\" />}\n          </Button>\n        </div>\n\n        {/* Weekly Activity Stats Bar */}\n        <RotatingStatsBar />\n\n        {/* KPI Dashboard */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Applications</CardTitle>\n              <Target className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-primary\" data-testid=\"stat-total-applications\">\n                {stats.total}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Applied</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-blue-600\" data-testid=\"stat-applied\">\n                {stats.applied}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Interviews</CardTitle>\n              <Clock className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-yellow-600\" data-testid=\"stat-interviews\">\n                {stats.interviews}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Offers</CardTitle>\n              <Trophy className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600\" data-testid=\"stat-offers\">\n                {stats.offers}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Success Rate</CardTitle>\n              <BarChart3 className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-accent\" data-testid=\"stat-success-rate\">\n                {`${stats.successRate}%`}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Kanban Board */}\n        {true ? (\n          <DndContext\n            sensors={sensors}\n            collisionDetection={closestCenter}\n            onDragEnd={handleDragEnd}\n          >\n            <div className=\"grid grid-cols-1 lg:grid-cols-5 gap-6\" data-testid=\"kanban-board\">\n              {APPLICATION_STATUSES.map((status) => (\n                <DroppableColumn \n                  key={status.id} \n                  status={status} \n                  applications={applications || []} \n                />\n              ))}\n            </div>\n          </DndContext>\n        ) : (\n          <>\n            {/* Preview Kanban Board */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-5 gap-6 opacity-60 mb-6\" data-testid=\"kanban-board-preview\">\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-sm font-medium\">Draft</CardTitle>\n                    <Badge variant=\"secondary\" className=\"bg-gray-100 text-gray-800\">2</Badge>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  <div className=\"bg-white rounded-lg border p-3 cursor-not-allowed\">\n                    <h4 className=\"font-semibold text-sm\">Band 6 Staff Nurse</h4>\n                    <p className=\"text-xs text-muted-foreground\">London NHS Trust</p>\n                  </div>\n                  <div className=\"bg-white rounded-lg border p-3 cursor-not-allowed\">\n                    <h4 className=\"font-semibold text-sm\">Clinical Specialist</h4>\n                    <p className=\"text-xs text-muted-foreground\">Birmingham Hospital</p>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-sm font-medium\">Applied</CardTitle>\n                    <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-800\">3</Badge>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  <div className=\"bg-white rounded-lg border p-3 cursor-not-allowed\">\n                    <h4 className=\"font-semibold text-sm\">Senior Nurse</h4>\n                    <p className=\"text-xs text-muted-foreground\">Manchester Trust</p>\n                  </div>\n                  <div className=\"bg-white rounded-lg border p-3 cursor-not-allowed\">\n                    <h4 className=\"font-semibold text-sm\">Ward Manager</h4>\n                    <p className=\"text-xs text-muted-foreground\">Leeds Teaching</p>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-sm font-medium\">Interview</CardTitle>\n                    <Badge variant=\"secondary\" className=\"bg-yellow-100 text-yellow-800\">2</Badge>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  <div className=\"bg-white rounded-lg border p-3 cursor-not-allowed\">\n                    <h4 className=\"font-semibold text-sm\">Band 7 Charge Nurse</h4>\n                    <p className=\"text-xs text-muted-foreground\">Oxford Health</p>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-sm font-medium\">Offered</CardTitle>\n                    <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800\">1</Badge>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  <div className=\"bg-white rounded-lg border p-3 cursor-not-allowed\">\n                    <h4 className=\"font-semibold text-sm\">Staff Nurse</h4>\n                    <p className=\"text-xs text-muted-foreground\">Cambridge Trust</p>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-sm font-medium\">Rejected</CardTitle>\n                    <Badge variant=\"secondary\" className=\"bg-red-100 text-red-800\">0</Badge>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <p className=\"text-sm\">No applications</p>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n            \n            {/* Upgrade Prompt */}\n            <UpgradePrompt feature=\"Job Tracker\" />\n          </>\n        )}\n\n        {/* Add Application Dialog */}\n        <AddApplicationForm \n          open={isAddDialogOpen} \n          onOpenChange={setIsAddDialogOpen}\n          isPaid={isPaid}\n          currentApplicationCount={stats.total} \n        />\n        \n        {/* Free Tier Limit Warning */}\n        {hasReachedFreeLimit && (\n          <div className=\"mb-6\">\n            <Card className=\"border-yellow-200 bg-gradient-to-br from-yellow-50 to-orange-50\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-start gap-4\">\n                  <Crown className=\"h-8 w-8 text-yellow-600 flex-shrink-0 mt-1\" />\n                  <div className=\"flex-1\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                      Free Tier Limit Reached\n                    </h3>\n                    <p className=\"text-gray-600 mb-4\">\n                      You're tracking 3/3 applications on the free tier. Upgrade to track unlimited job applications with advanced analytics and features.\n                    </p>\n                    <Button \n                      onClick={() => setLocation('/pricing')}\n                      className=\"bg-yellow-600 hover:bg-yellow-700 text-white font-medium\"\n                      data-testid=\"button-upgrade-tracker-limit\"\n                    >\n                      Upgrade Now - ¬£70 One-Time\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":31654},"client/src/components/rotating-stats-bar.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { TrendingUp, TrendingDown, Calendar, Search, Send, Target, Clock, CheckCircle, BarChart3 } from \"lucide-react\";\n\ninterface WeeklyStats {\n  applicationsThisWeek: number;\n  applicationsLastWeek: number;\n  jobSearchesThisWeek: number;\n  jobSearchesLastWeek: number;\n  interviewsThisWeek: number;\n  interviewsLastWeek: number;\n  documentsCreatedThisWeek: number;\n  documentsCreatedLastWeek: number;\n  practiceSessionsThisWeek: number;\n  practiceSessionsLastWeek: number;\n}\n\ninterface StatItem {\n  id: string;\n  text: string;\n  value: number;\n  previousValue: number;\n  icon: React.ElementType;\n  color: string;\n  changeType: 'increase' | 'decrease' | 'same';\n}\n\nexport function RotatingStatsBar() {\n  const [currentStatIndex, setCurrentStatIndex] = useState(0);\n\n  // Fetch weekly stats - refetch when applications change\n  const { data: stats } = useQuery<WeeklyStats>({\n    queryKey: [\"/api/user/weekly-stats\"],\n    refetchInterval: 30000, // Refresh every 30 seconds\n    staleTime: 10000, // Consider data stale after 10 seconds\n  });\n\n  // Generate stat items from API data\n  const statItems: StatItem[] = [\n    {\n      id: \"applications\",\n      text: stats?.applicationsThisWeek === 1 ? \"application sent this week\" : \"applications sent this week\",\n      value: stats?.applicationsThisWeek || 0,\n      previousValue: stats?.applicationsLastWeek || 0,\n      icon: Send,\n      color: \"text-primary\",\n      changeType: getChangeType(stats?.applicationsThisWeek || 0, stats?.applicationsLastWeek || 0)\n    },\n    {\n      id: \"job_searches\",\n      text: stats?.jobSearchesThisWeek === 1 ? \"job searched this week\" : \"jobs searched this week\",\n      value: stats?.jobSearchesThisWeek || 0,\n      previousValue: stats?.jobSearchesLastWeek || 0,\n      icon: Search,\n      color: \"text-secondary\",\n      changeType: getChangeType(stats?.jobSearchesThisWeek || 0, stats?.jobSearchesLastWeek || 0)\n    },\n    {\n      id: \"interviews\",\n      text: stats?.interviewsThisWeek === 1 ? \"interview scheduled this week\" : \"interviews scheduled this week\",\n      value: stats?.interviewsThisWeek || 0,\n      previousValue: stats?.interviewsLastWeek || 0,\n      icon: Calendar,\n      color: \"text-accent\",\n      changeType: getChangeType(stats?.interviewsThisWeek || 0, stats?.interviewsLastWeek || 0)\n    },\n    {\n      id: \"documents\",\n      text: stats?.documentsCreatedThisWeek === 1 ? \"document created this week\" : \"documents created this week\",\n      value: stats?.documentsCreatedThisWeek || 0,\n      previousValue: stats?.documentsCreatedLastWeek || 0,\n      icon: Target,\n      color: \"text-primary\",\n      changeType: getChangeType(stats?.documentsCreatedThisWeek || 0, stats?.documentsCreatedLastWeek || 0)\n    },\n    {\n      id: \"practice\",\n      text: stats?.practiceSessionsThisWeek === 1 ? \"practice session this week\" : \"practice sessions this week\",\n      value: stats?.practiceSessionsThisWeek || 0,\n      previousValue: stats?.practiceSessionsLastWeek || 0,\n      icon: CheckCircle,\n      color: \"text-secondary\",\n      changeType: getChangeType(stats?.practiceSessionsThisWeek || 0, stats?.practiceSessionsLastWeek || 0)\n    }\n  ];\n\n  // Filter out stats with zero values for a cleaner display\n  const activeStats = statItems.filter(stat => stat.value > 0 || stat.previousValue > 0);\n  \n  // Rotate through stats every 3 seconds - always call this hook\n  useEffect(() => {\n    if (activeStats.length <= 1) return;\n    \n    const interval = setInterval(() => {\n      setCurrentStatIndex((prev) => (prev + 1) % activeStats.length);\n    }, 3000);\n\n    return () => clearInterval(interval);\n  }, [activeStats.length]);\n\n  // If no activity, show encouraging message\n  if (activeStats.length === 0) {\n    return (\n      <div className=\"bg-gradient-to-r from-primary/10 via-secondary/10 to-accent/10 p-4 rounded-lg mb-6\" data-testid=\"stats-bar-empty\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2 text-muted-foreground\">\n            <Clock className=\"h-4 w-4\" />\n            <span className=\"text-sm\">Start your job search journey - your weekly stats will appear here!</span>\n          </div>\n          <Button \n            variant=\"outline\" \n            size=\"sm\" \n            onClick={() => window.location.href = '/tracker'}\n            className=\"flex items-center gap-1\"\n            data-testid=\"button-go-to-tracker\"\n          >\n            <BarChart3 className=\"h-3 w-3\" />\n            Go to Tracker\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  const currentStat = activeStats[currentStatIndex];\n\n  if (!currentStat) return null;\n\n  const Icon = currentStat.icon;\n  const hasChange = currentStat.previousValue !== currentStat.value;\n  const changeAmount = Math.abs(currentStat.value - currentStat.previousValue);\n\n  return (\n    <div className=\"bg-gradient-to-r from-primary/10 via-secondary/10 to-accent/10 p-4 rounded-lg mb-6 transition-all duration-500\" data-testid=\"rotating-stats-bar\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <div className={`p-2 rounded-full bg-background/50 ${currentStat.color}`}>\n            <Icon className=\"h-4 w-4\" />\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-2xl font-bold\">{currentStat.value}</span>\n            <span className=\"text-sm text-muted-foreground\">{currentStat.text}</span>\n          </div>\n        </div>\n        \n        <div className=\"flex items-center gap-3\">\n          {hasChange && (\n            <div className=\"flex items-center gap-1\">\n              {currentStat.changeType === 'increase' && (\n                <>\n                  <TrendingUp className=\"h-3 w-3 text-green-500\" />\n                  <Badge variant=\"secondary\" className=\"text-xs bg-green-100 text-green-700\">\n                    +{changeAmount} vs last week\n                  </Badge>\n                </>\n              )}\n              {currentStat.changeType === 'decrease' && (\n                <>\n                  <TrendingDown className=\"h-3 w-3 text-orange-500\" />\n                  <Badge variant=\"secondary\" className=\"text-xs bg-orange-100 text-orange-700\">\n                    -{changeAmount} vs last week\n                  </Badge>\n                </>\n              )}\n              {currentStat.changeType === 'same' && currentStat.previousValue > 0 && (\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Same as last week\n                </Badge>\n              )}\n            </div>\n          )}\n          \n          <div className=\"flex items-center gap-2\">\n            {activeStats.length > 1 && (\n              <div className=\"flex gap-1\">\n                {activeStats.map((_, index) => (\n                  <div\n                    key={index}\n                    className={`w-2 h-2 rounded-full transition-all duration-300 ${\n                      index === currentStatIndex ? 'bg-primary' : 'bg-muted'\n                    }`}\n                    data-testid={`stat-indicator-${index}`}\n                  />\n                ))}\n              </div>\n            )}\n            \n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              onClick={() => window.location.href = '/tracker'}\n              className=\"flex items-center gap-1\"\n              data-testid=\"button-view-tracker\"\n            >\n              <BarChart3 className=\"h-3 w-3\" />\n              View Tracker\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction getChangeType(current: number, previous: number): 'increase' | 'decrease' | 'same' {\n  if (current > previous) return 'increase';\n  if (current < previous) return 'decrease';\n  return 'same';\n}","size_bytes":7994},"client/src/pages/admin.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Header } from \"@/components/header\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { \n  Users, BarChart3, FileText, Settings, Shield, TrendingUp, \n  UserCheck, Calendar, Search, Filter, Download,\n  Edit, Trash2, Plus, Save, Eye, EyeOff, Lock, Unlock,\n  Crown, Star, AlertTriangle, Database, Activity,\n  UserX, RotateCcw, Mail, Ban, Check, X\n} from \"lucide-react\";\n\n// Types\ninterface AdminDashboardStats {\n  totalUsers: string;\n  freeUsers: string;\n  premiumUsers: string;\n  activeUsers: string;\n  adminInfo?: {\n    role: string;\n    isMasterAdmin: boolean;\n    isSecondaryAdmin: boolean;\n  };\n}\n\ninterface User {\n  id: string;\n  email: string;\n  firstName?: string;\n  lastName?: string;\n  isAdmin: boolean;\n  adminRole?: string;\n  subscriptionStatus: string;\n  createdAt: string;\n  lastLoginAt?: string;\n  profileCompletion?: number;\n}\n\ninterface UserActivity {\n  id: string;\n  userId: string;\n  action: string;\n  timestamp: string;\n  details?: string;\n}\n\ninterface SystemHealth {\n  dbStatus: string;\n  aiServiceStatus: string;\n  paymentServiceStatus: string;\n  errorCount: number;\n  avgResponseTime: number;\n  uptime: string;\n}\n\ninterface AdminAnalytics {\n  totalUsers: number;\n  activeUsers: number;\n  premiumUsers: number;\n  totalApplications: number;\n  documentsGenerated: number;\n  interviewsCompleted: number;\n  avgProfileCompletion: number;\n  revenueThisMonth: number;\n}\n\nexport default function AdminDashboard() {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Filter states\n  const [userFilter, setUserFilter] = useState(\"\");\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n  const [userAction, setUserAction] = useState<string | null>(null);\n\n  // Check if user is admin\n  const { data: currentUser } = useQuery({\n    queryKey: [\"/api/auth/user\"],\n    enabled: isAuthenticated\n  });\n\n  const isUserAdmin = currentUser && typeof currentUser === 'object' && 'isAdmin' in currentUser && currentUser.isAdmin;\n\n  // Admin data queries\n  const { data: dashboardStats } = useQuery<AdminDashboardStats>({\n    queryKey: [\"/api/admin/dashboard\"],\n    enabled: !!isUserAdmin\n  });\n\n  const { data: users } = useQuery<User[]>({\n    queryKey: [\"/api/admin/users\"],\n    enabled: !!isUserAdmin\n  });\n\n  const { data: systemHealth } = useQuery<SystemHealth>({\n    queryKey: [\"/api/admin/system-health\"],\n    enabled: !!isUserAdmin\n  });\n\n  const { data: gdprRequests } = useQuery<{ requests: any[] }>({\n    queryKey: [\"/api/admin/gdpr-requests\"],\n    enabled: !!isUserAdmin\n  });\n\n  const { data: analytics } = useQuery<AdminAnalytics>({\n    queryKey: [\"/api/admin/analytics\"],\n    enabled: !!isUserAdmin\n  });\n\n  // User management mutations\n  const makeAdminMutation = useMutation({\n    mutationFn: async ({ userId, adminRole }: { userId: string; adminRole: string }) => {\n      await apiRequest(\"POST\", `/api/admin/users/${userId}/make-admin`, { adminRole });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({ title: \"Success\", description: \"User admin status updated successfully\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const suspendUserMutation = useMutation({\n    mutationFn: async ({ userId, reason }: { userId: string; reason?: string }) => {\n      await apiRequest(\"POST\", `/api/admin/users/${userId}/suspend`, { reason });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({ title: \"Success\", description: \"User suspended successfully\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteUserMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      await apiRequest(\"DELETE\", `/api/admin/users/${userId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({ title: \"Success\", description: \"User deleted successfully\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateUserMutation = useMutation({\n    mutationFn: async ({ userId, updates }: { userId: string; updates: any }) => {\n      await apiRequest(\"PATCH\", `/api/admin/users/${userId}`, updates);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      setSelectedUser(null);\n      toast({ title: \"Success\", description: \"User updated successfully\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateGdprRequestMutation = useMutation({\n    mutationFn: async ({ requestId, status, adminNotes }: { requestId: string; status: string; adminNotes?: string }) => {\n      await apiRequest(\"PATCH\", `/api/admin/gdpr-requests/${requestId}`, { status, adminNotes });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/gdpr-requests\"] });\n      toast({ title: \"Success\", description: \"GDPR request updated successfully\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n\n  // Filter functions\n  const filteredUsers = users?.filter(user => \n    user.email.toLowerCase().includes(userFilter.toLowerCase()) ||\n    user.firstName?.toLowerCase().includes(userFilter.toLowerCase()) ||\n    user.lastName?.toLowerCase().includes(userFilter.toLowerCase())\n  ) || [];\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Card className=\"max-w-md\">\n          <CardHeader>\n            <CardTitle>Access Denied</CardTitle>\n            <CardDescription>Please log in to access the admin dashboard</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Button \n              onClick={() => { window.location.href = \"/api/login\"; }}\n              className=\"w-full\"\n              data-testid=\"admin-login-button\"\n            >\n              Login to Continue\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!isUserAdmin) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Card className=\"max-w-md\">\n          <CardHeader>\n            <CardTitle>Admin Access Required</CardTitle>\n            <CardDescription>You don't have permission to access this area</CardDescription>\n          </CardHeader>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\" data-testid=\"admin-dashboard\">\n      <Header />\n      \n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"mb-8\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold flex items-center gap-2\" data-testid=\"admin-title\">\n                <Shield className=\"h-8 w-8 text-primary\" />\n                Admin Control Center\n              </h1>\n              <p className=\"text-muted-foreground mt-2\">\n                Complete platform management and control\n              </p>\n            </div>\n            {dashboardStats?.adminInfo && (\n              <Badge variant=\"outline\" className=\"flex items-center gap-2\">\n                {dashboardStats.adminInfo.isMasterAdmin ? (\n                  <Crown className=\"h-4 w-4 text-yellow-500\" />\n                ) : (\n                  <Star className=\"h-4 w-4 text-blue-500\" />\n                )}\n                {dashboardStats.adminInfo.role.replace('_', ' ').toUpperCase()}\n              </Badge>\n            )}\n          </div>\n        </div>\n\n        {/* Overview Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n          <Card data-testid=\"stat-total-users\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Users</CardTitle>\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{dashboardStats?.totalUsers || 0}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {dashboardStats?.freeUsers || 0} free, {dashboardStats?.premiumUsers || 0} premium\n              </p>\n            </CardContent>\n          </Card>\n          \n          <Card data-testid=\"stat-active-users\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Active Users</CardTitle>\n              <UserCheck className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{analytics?.activeUsers || 0}</div>\n              <p className=\"text-xs text-muted-foreground\">Last 30 days</p>\n            </CardContent>\n          </Card>\n          \n          <Card data-testid=\"stat-applications\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Applications</CardTitle>\n              <BarChart3 className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{analytics?.totalApplications || 0}</div>\n              <p className=\"text-xs text-muted-foreground\">Total submitted</p>\n            </CardContent>\n          </Card>\n          \n          <Card data-testid=\"stat-documents\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Documents</CardTitle>\n              <FileText className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{analytics?.documentsGenerated || 0}</div>\n              <p className=\"text-xs text-muted-foreground\">AI generated</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Tabs defaultValue=\"users\" className=\"space-y-6\" data-testid=\"admin-tabs\">\n          <TabsList className=\"grid w-full grid-cols-4\">\n            <TabsTrigger value=\"users\" data-testid=\"tab-users\">\n              <Users className=\"h-4 w-4 mr-2\" />\n              User Management\n            </TabsTrigger>\n            <TabsTrigger value=\"analytics\" data-testid=\"tab-analytics\">\n              <BarChart3 className=\"h-4 w-4 mr-2\" />\n              Analytics\n            </TabsTrigger>\n            <TabsTrigger value=\"data\" data-testid=\"tab-data\">\n              <Database className=\"h-4 w-4 mr-2\" />\n              Data & GDPR\n            </TabsTrigger>\n            <TabsTrigger value=\"system\" data-testid=\"tab-system\">\n              <Activity className=\"h-4 w-4 mr-2\" />\n              System Health\n            </TabsTrigger>\n          </TabsList>\n          \n          {/* User Management Tab */}\n          <TabsContent value=\"users\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle>User Management</CardTitle>\n                    <CardDescription>Manage user accounts, permissions, and access levels</CardDescription>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Search className=\"h-4 w-4 text-muted-foreground\" />\n                    <Input\n                      placeholder=\"Search users...\"\n                      value={userFilter}\n                      onChange={(e) => setUserFilter(e.target.value)}\n                      className=\"w-64\"\n                      data-testid=\"input-user-search\"\n                    />\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <ScrollArea className=\"h-96\">\n                  <div className=\"space-y-4\">\n                    {filteredUsers.map((user) => (\n                      <div key={user.id} className=\"flex items-center justify-between p-4 border rounded-lg\" data-testid={`user-row-${user.id}`}>\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"font-medium\">{user.firstName} {user.lastName}</div>\n                            {user.isAdmin && (\n                              <Badge variant=\"outline\" className=\"text-primary\">\n                                <Shield className=\"h-3 w-3 mr-1\" />\n                                {user.adminRole?.replace('_', ' ') || 'Admin'}\n                              </Badge>\n                            )}\n                          </div>\n                          <div className=\"text-sm text-muted-foreground\">{user.email}</div>\n                          <div className=\"flex gap-2 mt-2\">\n                            <Badge variant={user.subscriptionStatus === 'paid' ? 'default' : 'secondary'}>\n                              {user.subscriptionStatus === 'paid' ? 'Premium' : 'Free'}\n                            </Badge>\n                            <Badge variant=\"outline\">\n                              Profile: {user.profileCompletion || 0}%\n                            </Badge>\n                            {user.lastLoginAt && (\n                              <Badge variant=\"outline\">\n                                Last: {new Date(user.lastLoginAt).toLocaleDateString()}\n                              </Badge>\n                            )}\n                          </div>\n                        </div>\n                        \n                        <div className=\"flex gap-2\">\n                          <Button \n                            variant=\"outline\" \n                            size=\"sm\"\n                            onClick={() => setSelectedUser(user)}\n                            data-testid={`user-details-${user.id}`}\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                          \n                          {!user.isAdmin && dashboardStats?.adminInfo?.isMasterAdmin && (\n                            <Select onValueChange={(role) => makeAdminMutation.mutate({ userId: user.id, adminRole: role })}>\n                              <SelectTrigger className=\"w-32\">\n                                <SelectValue placeholder=\"Admin\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                <SelectItem value=\"secondary_admin\">Make Admin</SelectItem>\n                              </SelectContent>\n                            </Select>\n                          )}\n                          \n                          <Button \n                            variant=\"outline\" \n                            size=\"sm\"\n                            onClick={() => suspendUserMutation.mutate({ userId: user.id })}\n                            data-testid={`suspend-user-${user.id}`}\n                          >\n                            <Ban className=\"h-4 w-4\" />\n                          </Button>\n                          \n                          {dashboardStats?.adminInfo?.isMasterAdmin && (\n                            <Button \n                              variant=\"destructive\" \n                              size=\"sm\"\n                              onClick={() => {\n                                if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {\n                                  deleteUserMutation.mutate(user.id);\n                                }\n                              }}\n                              data-testid={`delete-user-${user.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </ScrollArea>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n\n          {/* Analytics Tab */}\n          <TabsContent value=\"analytics\" className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Avg Profile Completion</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{analytics?.avgProfileCompletion || 0}%</div>\n                </CardContent>\n              </Card>\n              \n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Interviews Completed</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{analytics?.interviewsCompleted || 0}</div>\n                </CardContent>\n              </Card>\n              \n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Documents Generated</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{analytics?.documentsGenerated || 0}</div>\n                </CardContent>\n              </Card>\n              \n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Revenue This Month</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">¬£{analytics?.revenueThisMonth || 0}</div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          {/* User Details Modal */}\n          {selectedUser && (\n            <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n              <Card className=\"w-full max-w-2xl max-h-[80vh] overflow-y-auto\">\n                <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                    <CardTitle>User Details</CardTitle>\n                    <Button variant=\"ghost\" onClick={() => setSelectedUser(null)}>\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <Label>Email</Label>\n                      <Input value={selectedUser.email} readOnly />\n                    </div>\n                    <div>\n                      <Label>Name</Label>\n                      <Input value={`${selectedUser.firstName || ''} ${selectedUser.lastName || ''}`} readOnly />\n                    </div>\n                    <div>\n                      <Label>Subscription Status</Label>\n                      <Badge variant={selectedUser.subscriptionStatus === 'paid' ? 'default' : 'secondary'}>\n                        {selectedUser.subscriptionStatus === 'paid' ? 'Premium' : 'Free'}\n                      </Badge>\n                    </div>\n                    <div>\n                      <Label>Profile Completion</Label>\n                      <div className=\"text-sm font-medium\">{selectedUser.profileCompletion || 0}%</div>\n                    </div>\n                    <div>\n                      <Label>Created At</Label>\n                      <div className=\"text-sm\">{new Date(selectedUser.createdAt).toLocaleDateString()}</div>\n                    </div>\n                    <div>\n                      <Label>Last Login</Label>\n                      <div className=\"text-sm\">{selectedUser.lastLoginAt ? new Date(selectedUser.lastLoginAt).toLocaleDateString() : 'Never'}</div>\n                    </div>\n                  </div>\n                  <div className=\"flex gap-2 pt-4\">\n                    <Button \n                      onClick={() => updateUserMutation.mutate({ \n                        userId: selectedUser.id, \n                        updates: { subscriptionStatus: selectedUser.subscriptionStatus === 'paid' ? 'free' : 'paid' }\n                      })}\n                    >\n                      {selectedUser.subscriptionStatus === 'paid' ? 'Remove Premium' : 'Grant Premium'}\n                    </Button>\n                    <Button variant=\"outline\" onClick={() => suspendUserMutation.mutate({ userId: selectedUser.id })}>\n                      <Ban className=\"h-4 w-4 mr-2\" />\n                      Suspend User\n                    </Button>\n                    {dashboardStats?.adminInfo?.isMasterAdmin && (\n                      <Button \n                        variant=\"destructive\"\n                        onClick={() => {\n                          if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {\n                            deleteUserMutation.mutate(selectedUser.id);\n                          }\n                        }}\n                      >\n                        <Trash2 className=\"h-4 w-4 mr-2\" />\n                        Delete User\n                      </Button>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n\n          {/* Data & GDPR Tab */}\n          <TabsContent value=\"data\" className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>GDPR Requests</CardTitle>\n                  <CardDescription>Manage data subject requests and compliance</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <span>Pending Requests</span>\n                    <Badge variant=\"secondary\">\n                      {gdprRequests?.requests?.filter(r => r.status === 'pending').length || 0}\n                    </Badge>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span>Completed This Month</span>\n                    <Badge variant=\"outline\">\n                      {gdprRequests?.requests?.filter(r => {\n                        if (!r.completedDate) return false;\n                        const completedDate = new Date(r.completedDate);\n                        const now = new Date();\n                        return completedDate.getMonth() === now.getMonth() && \n                               completedDate.getFullYear() === now.getFullYear();\n                      }).length || 0}\n                    </Badge>\n                  </div>\n                  <Button className=\"w-full\">\n                    <Download className=\"h-4 w-4 mr-2\" />\n                    Export All User Data\n                  </Button>\n                </CardContent>\n              </Card>\n              \n              {/* GDPR Requests List */}\n              <Card className=\"md:col-span-2\">\n                <CardHeader>\n                  <CardTitle>Recent GDPR Requests</CardTitle>\n                  <CardDescription>Review and manage user data rights requests</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    {gdprRequests?.requests?.slice(0, 5).map((request) => (\n                      <div key={request.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <Badge variant={request.status === 'pending' ? 'secondary' : \n                                           request.status === 'completed' ? 'default' : \n                                           request.status === 'rejected' ? 'destructive' : 'outline'}>\n                              {request.status}\n                            </Badge>\n                            <span className=\"font-medium\">{request.type.replace('_', ' ').toUpperCase()}</span>\n                          </div>\n                          <div className=\"text-sm text-muted-foreground mt-1\">\n                            {request.userEmail} ‚Ä¢ {request.referenceId}\n                          </div>\n                          <div className=\"text-xs text-muted-foreground\">\n                            {new Date(request.submittedDate).toLocaleDateString()}\n                          </div>\n                        </div>\n                        <div className=\"flex gap-2\">\n                          {request.status === 'pending' && (\n                            <>\n                              <Button \n                                size=\"sm\" \n                                variant=\"outline\"\n                                onClick={() => updateGdprRequestMutation.mutate({\n                                  requestId: request.id,\n                                  status: 'completed',\n                                  adminNotes: 'Request approved and completed'\n                                })}\n                              >\n                                <Check className=\"h-4 w-4\" />\n                              </Button>\n                              <Button \n                                size=\"sm\" \n                                variant=\"destructive\"\n                                onClick={() => updateGdprRequestMutation.mutate({\n                                  requestId: request.id,\n                                  status: 'rejected',\n                                  adminNotes: 'Request rejected'\n                                })}\n                              >\n                                <X className=\"h-4 w-4\" />\n                              </Button>\n                            </>\n                          )}\n                          <Button size=\"sm\" variant=\"ghost\">\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    )) || (\n                      <div className=\"text-center py-8 text-muted-foreground\">\n                        No GDPR requests found\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card>\n                <CardHeader>\n                  <CardTitle>Data Analytics</CardTitle>\n                  <CardDescription>Storage usage and data insights</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <span>Total Users</span>\n                    <span className=\"font-medium\">{dashboardStats?.totalUsers || 0}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span>Active Profiles</span>\n                    <span className=\"font-medium\">{analytics?.activeUsers || 0}</span>\n                  </div>\n                  <Button variant=\"outline\" className=\"w-full\">\n                    <Database className=\"h-4 w-4 mr-2\" />\n                    Database Statistics\n                  </Button>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          {/* System Health Tab */}\n          <TabsContent value=\"system\" className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>System Status</CardTitle>\n                  <CardDescription>Real-time system health monitoring</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <span>Database</span>\n                      <Badge variant={systemHealth?.dbStatus === 'healthy' ? 'default' : 'destructive'}>\n                        {systemHealth?.dbStatus || 'Unknown'}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span>AI Service</span>\n                      <Badge variant={systemHealth?.aiServiceStatus === 'healthy' ? 'default' : 'destructive'}>\n                        {systemHealth?.aiServiceStatus || 'Unknown'}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span>Payment System</span>\n                      <Badge variant={systemHealth?.paymentServiceStatus === 'healthy' ? 'default' : 'destructive'}>\n                        {systemHealth?.paymentServiceStatus || 'Unknown'}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span>System Uptime</span>\n                      <span className=\"text-sm font-medium\">{systemHealth?.uptime || 'N/A'}</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              <Card>\n                <CardHeader>\n                  <CardTitle>Performance Metrics</CardTitle>\n                  <CardDescription>System performance indicators</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <span>Error Count (24h)</span>\n                      <Badge variant={!systemHealth?.errorCount || systemHealth.errorCount < 10 ? 'outline' : 'destructive'}>\n                        {systemHealth?.errorCount || 0}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span>Avg Response Time</span>\n                      <span className=\"text-sm font-medium\">{systemHealth?.avgResponseTime || 0}ms</span>\n                    </div>\n                    <Separator />\n                    <Button variant=\"outline\" className=\"w-full\">\n                      <Download className=\"h-4 w-4 mr-2\" />\n                      Export Error Logs\n                    </Button>\n                    <Button variant=\"outline\" className=\"w-full\">\n                      <Activity className=\"h-4 w-4 mr-2\" />\n                      View System Logs\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":32400},"client/src/lib/greeting-utils.ts":{"content":"/**\n * Utility functions for generating dynamic greetings based on time and location\n */\n\ninterface User {\n  firstName?: string | null;\n  lastName?: string | null;\n}\n\nexport function getTimeBasedGreeting(): string {\n  const hour = new Date().getHours();\n  \n  if (hour >= 5 && hour < 12) {\n    return \"Good morning\";\n  } else if (hour >= 12 && hour < 17) {\n    return \"Good afternoon\";\n  } else if (hour >= 17 && hour < 22) {\n    return \"Good evening\";\n  } else {\n    return \"Good evening\";\n  }\n}\n\nexport function getLocationBasedTimeZone(): string {\n  try {\n    return Intl.DateTimeFormat().resolvedOptions().timeZone;\n  } catch {\n    return \"UTC\";\n  }\n}\n\nexport function getLocalTime(): string {\n  return new Date().toLocaleTimeString('en-GB', {\n    hour: '2-digit',\n    minute: '2-digit',\n    hour12: false\n  });\n}\n\nexport function getLocationFromTimeZone(timeZone: string): string {\n  const locationMappings: Record<string, string> = {\n    'Europe/London': 'London',\n    'Europe/Dublin': 'Dublin',\n    'Europe/Edinburgh': 'Edinburgh',\n    'Europe/Belfast': 'Belfast',\n    'Europe/Cardiff': 'Cardiff',\n    'Europe/Manchester': 'Manchester',\n    'Europe/Birmingham': 'Birmingham',\n    'Europe/Liverpool': 'Liverpool',\n    'Europe/Glasgow': 'Glasgow',\n    'America/New_York': 'New York',\n    'America/Los_Angeles': 'Los Angeles',\n    'America/Chicago': 'Chicago',\n    'Asia/Dubai': 'Dubai',\n    'Asia/Hong_Kong': 'Hong Kong',\n    'Asia/Singapore': 'Singapore',\n    'Asia/Manila': 'Manila',\n    'Asia/Kolkata': 'India',\n    'Australia/Sydney': 'Sydney',\n    'Australia/Melbourne': 'Melbourne'\n  };\n\n  // Check for exact match first\n  if (locationMappings[timeZone]) {\n    return locationMappings[timeZone];\n  }\n\n  // Extract general location from timezone\n  const parts = timeZone.split('/');\n  if (parts.length >= 2) {\n    const region = parts[0];\n    const city = parts[1].replace(/_/g, ' ');\n    \n    switch (region) {\n      case 'Europe':\n        return city;\n      case 'America':\n        return city;\n      case 'Asia':\n        return city;\n      case 'Australia':\n        return city;\n      case 'Africa':\n        return city;\n      default:\n        return city;\n    }\n  }\n\n  return '';\n}\n\nexport function getPersonalizedGreeting(user?: User): string {\n  const timeGreeting = getTimeBasedGreeting();\n  const timeZone = getLocationBasedTimeZone();\n  const location = getLocationFromTimeZone(timeZone);\n  const localTime = getLocalTime();\n  \n  // Get user's first name\n  const firstName = user?.firstName || 'there';\n  \n  // Create personalized greeting\n  let greeting = `${timeGreeting}, ${firstName}!`;\n  \n  // Add location-based context if available and not generic\n  if (location && location !== 'UTC') {\n    // Check if it's a work day (Monday-Friday)\n    const dayOfWeek = new Date().getDay();\n    const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 5;\n    \n    if (isWeekday) {\n      greeting += ` Ready to advance your NHS career today?`;\n    } else {\n      greeting += ` Hope you're having a great weekend!`;\n    }\n  } else {\n    greeting += ` Ready to take the next step in your healthcare career?`;\n  }\n  \n  return greeting;\n}\n\nexport function getGreetingSubtext(): string {\n  const hour = new Date().getHours();\n  const dayOfWeek = new Date().getDay();\n  const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;\n  \n  if (isWeekend) {\n    if (hour >= 9 && hour < 18) {\n      return \"Perfect time to work on your career development\";\n    } else {\n      return \"Take a moment to plan your next career move\";\n    }\n  } else {\n    if (hour >= 6 && hour < 9) {\n      return \"Start your day by checking new NHS opportunities\";\n    } else if (hour >= 9 && hour < 17) {\n      return \"Great time to apply for jobs and update your profile\";\n    } else if (hour >= 17 && hour < 22) {\n      return \"Wind down by reviewing your applications and progress\";\n    } else {\n      return \"Take a look at your career progress\";\n    }\n  }\n}","size_bytes":3928},"client/src/pages/profile-broken.tsx":{"content":"import { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ArrowLeft, User, Award, Star } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport type { UserWithProfile, DashboardData } from \"@shared/schema\";\n\nconst profileSchema = z.object({\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  profession: z.string().min(1, \"Profession is required\"),\n  registrationNumber: z.string().optional(),\n  email: z.string().email(\"Valid email is required\").optional(),\n  phone: z.string().optional(),\n  city: z.string().optional(),\n  country: z.string().optional(),\n  yearsExperience: z.number().optional(),\n  visaStatus: z.string().optional(),\n  skills: z.array(z.string()).max(7, \"Maximum 7 skills allowed\").optional(),\n  workExperience: z.array(z.object({\n    jobTitle: z.string(),\n    employer: z.string(),\n    startDate: z.string(),\n    endDate: z.string().optional(),\n    current: z.boolean().optional(),\n    responsibilities: z.string(),\n  })).optional(),\n  education: z.array(z.object({\n    institution: z.string(),\n    degree: z.string(),\n    fieldOfStudy: z.string(),\n    graduationYear: z.string(),\n    grade: z.string().optional(),\n  })).optional(),\n  courses: z.array(z.object({\n    courseName: z.string(),\n    provider: z.string(),\n    completionDate: z.string(),\n    certificateUrl: z.string().optional(),\n  })).optional(),\n});\n\ntype ProfileFormData = z.infer<typeof profileSchema>;\n\nexport default function Profile() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  const { data: user, isLoading } = useQuery<UserWithProfile>({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  const { data: dashboardData } = useQuery<DashboardData>({\n    queryKey: [\"/api/dashboard\"],\n  });\n\n  const { data: starExamples } = useQuery<any[]>({\n    queryKey: [\"/api/star-examples\"],\n  });\n\n  const form = useForm<ProfileFormData>({\n    resolver: zodResolver(profileSchema),\n    defaultValues: {\n      firstName: user?.firstName || \"\",\n      lastName: user?.lastName || \"\",\n      profession: user?.profile?.profession || \"\",\n      registrationNumber: user?.profile?.registrationNumber || \"\",\n      email: user?.profile?.email || user?.email || \"\",\n      phone: user?.profile?.phone || \"\",\n      city: user?.profile?.city || \"\",\n      country: user?.profile?.country || \"\",\n      yearsExperience: user?.profile?.yearsExperience || undefined,\n      visaStatus: user?.profile?.visaStatus || \"\",\n      skills: user?.profile?.skills || [],\n      workExperience: user?.profile?.workExperience || [],\n      education: user?.profile?.education || [],\n      courses: user?.profile?.courses || [],\n    },\n  });\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: ProfileFormData) => {\n      return await apiRequest(\"PATCH\", \"/api/auth/user\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Profile updated\",\n        description: \"Your profile has been successfully updated.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update profile. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ProfileFormData) => {\n    updateProfileMutation.mutate(data);\n  };\n\n  if (isLoading) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"max-w-7xl mx-auto px-6 lg:px-8 py-12\">\n        {/* Breadcrumb */}\n        <div className=\"flex items-center space-x-2 mb-8\">\n          <Button \n            variant=\"ghost\" \n            size=\"sm\"\n            onClick={() => setLocation(\"/\")}\n            data-testid=\"button-back-to-dashboard\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Dashboard\n          </Button>\n        </div>\n\n        {/* Page Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-foreground mb-2\">Candidate Profile</h1>\n          <p className=\"text-muted-foreground text-lg\">\n            Build your comprehensive healthcare professional profile\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Profile Form */}\n          <div className=\"lg:col-span-2\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <User className=\"w-5 h-5\" />\n                  <span>Personal Information</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Form {...form}>\n                  <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <FormField\n                        control={form.control}\n                        name=\"firstName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>First Name</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-first-name\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      \n                      <FormField\n                        control={form.control}\n                        name=\"lastName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Last Name</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-last-name\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <FormField\n                      control={form.control}\n                      name=\"profession\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Profession</FormLabel>\n                          <FormControl>\n                            <Input {...field} placeholder=\"e.g., Registered Nurse, Doctor, Healthcare Assistant\" data-testid=\"input-profession\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"registrationNumber\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Registration Number (GMC/NMC/HCPC)</FormLabel>\n                          <FormControl>\n                            <Input {...field} placeholder=\"e.g., 12AB345C\" data-testid=\"input-registration-number\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    {/* Contact Information */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <FormField\n                        control={form.control}\n                        name=\"email\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Email</FormLabel>\n                            <FormControl>\n                              <Input {...field} type=\"email\" placeholder=\"your.email@example.com\" data-testid=\"input-email\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      \n                      <FormField\n                        control={form.control}\n                        name=\"phone\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Phone Number</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"+44 7xxx xxx xxx\" data-testid=\"input-phone\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <FormField\n                        control={form.control}\n                        name=\"city\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>City</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"e.g., London, Manchester\" data-testid=\"input-city\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      \n                      <FormField\n                        control={form.control}\n                        name=\"country\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Country</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"e.g., United Kingdom\" data-testid=\"input-country\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    {/* Professional Information */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <FormField\n                        control={form.control}\n                        name=\"yearsExperience\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Years of Experience</FormLabel>\n                            <FormControl>\n                              <Input {...field} type=\"number\" min=\"0\" placeholder=\"5\" data-testid=\"input-years-experience\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      \n                      <FormField\n                        control={form.control}\n                        name=\"visaStatus\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Visa Status</FormLabel>\n                            <Select onValueChange={field.onChange} defaultValue={field.value}>\n                              <FormControl>\n                                <SelectTrigger data-testid=\"select-visa-status\">\n                                  <SelectValue placeholder=\"Select your visa status\" />\n                                </SelectTrigger>\n                              </FormControl>\n                              <SelectContent>\n                                <SelectItem value=\"uk-citizen\">UK Citizen</SelectItem>\n                                <SelectItem value=\"indefinite-leave\">Indefinite Leave to Remain</SelectItem>\n                                <SelectItem value=\"tier-2\">Tier 2 General</SelectItem>\n                                <SelectItem value=\"skilled-worker\">Skilled Worker Visa</SelectItem>\n                                <SelectItem value=\"health-care\">Health and Care Worker Visa</SelectItem>\n                                <SelectItem value=\"global-talent\">Global Talent Visa</SelectItem>\n                                <SelectItem value=\"other\">Other</SelectItem>\n                                <SelectItem value=\"need-sponsorship\">Need Sponsorship</SelectItem>\n                              </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    {/* Skills Section */}\n                    <div className=\"space-y-4\">\n                      <h3 className=\"text-lg font-semibold\">Key Skills (up to 7)</h3>\n                      <div className=\"grid grid-cols-1 gap-4\">\n                        <FormField\n                          control={form.control}\n                          name=\"skills.0\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Skill 1</FormLabel>\n                              <FormControl>\n                                <Input {...field} placeholder=\"e.g., Patient Care\" data-testid=\"input-skill-1\" />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={form.control}\n                          name=\"skills.1\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Skill 2</FormLabel>\n                              <FormControl>\n                                <Input {...field} placeholder=\"e.g., Medication Administration\" data-testid=\"input-skill-2\" />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={form.control}\n                          name=\"skills.2\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Skill 3</FormLabel>\n                              <FormControl>\n                                <Input {...field} placeholder=\"e.g., Clinical Assessment\" data-testid=\"input-skill-3\" />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </div>\n                    </div>\n\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full\"\n                      disabled={updateProfileMutation.isPending}\n                      data-testid=\"button-save-profile\"\n                    >\n                      {updateProfileMutation.isPending ? \"Saving...\" : \"Save Profile\"}\n                    </Button>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"space-y-6\">\n            {/* Profile Completion */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">Profile Completion</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <Progress \n                    value={dashboardData?.profileCompletion || 0} \n                    className=\"w-full\"\n                  />\n                  <p className=\"text-sm text-muted-foreground\">\n                    {dashboardData?.profileCompletion || 0}% complete\n                  </p>\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex items-center justify-between\">\n                      <span>Basic Information</span>\n                      <span className=\"text-accent\">‚úì</span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span>STAR Examples</span>\n                      <span className={starExamples?.length ? \"text-accent\" : \"text-muted-foreground\"}>\n                        {starExamples?.length ? \"‚úì\" : \"‚óã\"}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span>Values Assessment</span>\n                      <span className=\"text-muted-foreground\">‚óã</span>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* STAR Examples Quick Access */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2 text-lg\">\n                  <Star className=\"w-5 h-5\" />\n                  <span>STAR Examples</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    {starExamples?.length || 0} examples added\n                  </p>\n                  <Button \n                    variant=\"outline\" \n                    className=\"w-full\"\n                    data-testid=\"button-add-star-example\"\n                  >\n                    Add STAR Example\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}\n","size_bytes":18608},"client/src/components/ObjectUploader.tsx":{"content":"import { useState } from \"react\";\nimport type { ReactNode } from \"react\";\nimport Uppy from \"@uppy/core\";\nimport { DashboardModal } from \"@uppy/react\";\n// Uppy styles removed to avoid build issues\nimport AwsS3 from \"@uppy/aws-s3\";\nimport type { UploadResult } from \"@uppy/core\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface ObjectUploaderProps {\n  maxNumberOfFiles?: number;\n  maxFileSize?: number;\n  onGetUploadParameters: () => Promise<{\n    method: \"PUT\";\n    url: string;\n  }>;\n  onComplete?: (\n    result: UploadResult<Record<string, unknown>, Record<string, unknown>>\n  ) => void;\n  buttonClassName?: string;\n  children: ReactNode;\n}\n\n/**\n * A file upload component that renders as a button and provides a modal interface for\n * file management.\n * \n * Features:\n * - Renders as a customizable button that opens a file upload modal\n * - Provides a modal interface for:\n *   - File selection\n *   - File preview\n *   - Upload progress tracking\n *   - Upload status display\n * \n * The component uses Uppy under the hood to handle all file upload functionality.\n * All file management features are automatically handled by the Uppy dashboard modal.\n * \n * @param props - Component props\n * @param props.maxNumberOfFiles - Maximum number of files allowed to be uploaded\n *   (default: 1)\n * @param props.maxFileSize - Maximum file size in bytes (default: 10MB)\n * @param props.onGetUploadParameters - Function to get upload parameters (method and URL).\n *   Typically used to fetch a presigned URL from the backend server for direct-to-S3\n *   uploads.\n * @param props.onComplete - Callback function called when upload is complete. Typically\n *   used to make post-upload API calls to update server state and set object ACL\n *   policies.\n * @param props.buttonClassName - Optional CSS class name for the button\n * @param props.children - Content to be rendered inside the button\n */\nexport function ObjectUploader({\n  maxNumberOfFiles = 1,\n  maxFileSize = 10485760, // 10MB default\n  onGetUploadParameters,\n  onComplete,\n  buttonClassName,\n  children,\n}: ObjectUploaderProps) {\n  const [showModal, setShowModal] = useState(false);\n  const [uppy] = useState(() =>\n    new Uppy({\n      restrictions: {\n        maxNumberOfFiles,\n        maxFileSize,\n      },\n      autoProceed: false,\n    })\n      .use(AwsS3, {\n        shouldUseMultipart: false,\n        getUploadParameters: onGetUploadParameters,\n      })\n      .on(\"complete\", (result) => {\n        onComplete?.(result);\n      })\n  );\n\n  return (\n    <div>\n      <Button onClick={() => setShowModal(true)} className={buttonClassName}>\n        {children}\n      </Button>\n\n      <DashboardModal\n        uppy={uppy}\n        open={showModal}\n        onRequestClose={() => setShowModal(false)}\n        proudlyDisplayPoweredByUppy={false}\n      />\n    </div>\n  );\n}","size_bytes":2826},"client/src/components/premium-features.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Crown, Lock, FileText, Search, Target, Zap, Star, CheckCircle } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport const PremiumUpgradeCard = () => {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const isPremium = user?.subscriptionStatus === 'paid';\n\n  if (isPremium) {\n    return (\n      <Card className=\"border-primary/20 bg-gradient-to-br from-primary/5 to-primary/10\">\n        <CardContent className=\"p-6 text-center\">\n          <Crown className=\"h-8 w-8 text-primary mx-auto mb-3\" />\n          <Badge className=\"mb-3\">Premium Active</Badge>\n          <h3 className=\"font-semibold mb-2\">Premium Member</h3>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            You have lifetime access to all premium features\n          </p>\n          <Button \n            onClick={() => setLocation('/ai-documents')}\n            variant=\"outline\"\n            className=\"w-full\"\n            data-testid=\"button-use-ai-generator\"\n          >\n            <FileText className=\"h-4 w-4 mr-2\" />\n            Use AI Generator\n          </Button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"border-primary/20 bg-gradient-to-br from-primary/5 to-primary/10\">\n      <CardContent className=\"p-6 text-center\">\n        <Crown className=\"h-8 w-8 text-primary mx-auto mb-3\" />\n        <h3 className=\"font-semibold mb-2\">Upgrade to Premium</h3>\n        <p className=\"text-sm text-muted-foreground mb-4\">\n          Unlock AI document generation, unlimited job search, and advanced features\n        </p>\n        <div className=\"mb-4\">\n          <span className=\"text-2xl font-bold text-primary\">¬£70</span>\n          <span className=\"text-sm text-muted-foreground ml-1\">one-time</span>\n        </div>\n        \n        <div className=\"space-y-2 mb-4 text-xs\">\n          <div className=\"flex items-center gap-2 justify-center text-green-600\">\n            <CheckCircle className=\"h-3 w-3\" />\n            <span>Lifetime access</span>\n          </div>\n          <div className=\"flex items-center gap-2 justify-center text-green-600\">\n            <CheckCircle className=\"h-3 w-3\" />\n            <span>No recurring charges</span>\n          </div>\n        </div>\n        \n        <Button \n          onClick={() => setLocation('/checkout')}\n          className=\"w-full\"\n          data-testid=\"button-upgrade-premium\"\n        >\n          <Crown className=\"h-4 w-4 mr-2\" />\n          Upgrade Now\n        </Button>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport const PremiumFeatureList = () => {\n  const features = [\n    {\n      icon: Search,\n      title: \"Unlimited Job Search\",\n      description: \"Access all NHS jobs with advanced filtering and real-time updates\",\n      free: false\n    },\n    {\n      icon: FileText,\n      title: \"Document Generation\", \n      description: \"Generate unlimited Supporting Information and CVs tailored to NHS roles\",\n      free: false\n    },\n    {\n      icon: Target,\n      title: \"Enhanced Role Matching\",\n      description: \"Intelligent job fit scoring with detailed compatibility analysis\",\n      free: false\n    },\n    {\n      icon: Zap,\n      title: \"Advanced Interview Practice\",\n      description: \"Mock interviews with expert feedback on NHS values and STAR responses\",\n      free: false\n    }\n  ];\n\n  return (\n    <div className=\"space-y-3\">\n      {features.map((feature, index) => (\n        <div key={index} className=\"flex items-start gap-3 p-3 rounded-lg border\">\n          <div className=\"rounded-full bg-primary/10 p-2 mt-0.5\">\n            <feature.icon className=\"h-4 w-4 text-primary\" />\n          </div>\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <h4 className=\"font-medium text-sm\">{feature.title}</h4>\n              {!feature.free && (\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  <Crown className=\"h-2 w-2 mr-1\" />\n                  Premium\n                </Badge>\n              )}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">{feature.description}</p>\n          </div>\n          {!feature.free && <Lock className=\"h-4 w-4 text-muted-foreground mt-2\" />}\n        </div>\n      ))}\n    </div>\n  );\n};","size_bytes":4477},"client/src/components/rotating-tip.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { X } from \"lucide-react\";\n\n// NHS Career Tips Database\nconst healthHireTips = [\n  // CV & Supporting Information Tips\n  \"üí° Tip: Quantify your achievements - write 'Reduced wait times by 20%' instead of just 'improved efficiency'\",\n  \"üí° Tip: Avoid jargon in your applications ‚Äì write in plain English that any panel member can understand\",\n  \"üí° Tip: Always double-check spelling of Trust names and hospitals - spelling errors can cost you the interview\",\n  \"üí° Tip: Highlight NHS values (compassion, respect, dignity, commitment, quality, integrity) in your supporting information\",\n  \"üí° Tip: Keep sentences concise but specific - every word should add value to your application\",\n\n  // NHS Values & Person Specification Tips  \n  \"üí° Tip: Read the person specification line by line and directly match each point in your response\",\n  \"üí° Tip: Use the STAR method: Situation, Task, Action, Result - it makes your examples much stronger\",\n  \"üí° Tip: Show evidence of continuous professional development - mention recent courses and training\",\n  \"üí° Tip: Always address essential criteria first, then desirable ones - don't leave any gaps\",\n  \"üí° Tip: Don't just state your skills - evidence them with specific examples and outcomes\",\n\n  // Supporting Information Tips\n  \"üí° Tip: Write in paragraphs, not bullet points - NHS panels prefer flowing narrative text\",\n  \"üí° Tip: Keep supporting information around 500-1000 words depending on the role level\",\n  \"üí° Tip: End with a strong closing statement about your motivation and commitment\",\n  \"üí° Tip: Use 'I' statements and take ownership - show confidence in your abilities\",\n  \"üí° Tip: Mention working across MDTs (multidisciplinary teams) - it's essential in NHS roles\",\n  \"üí° Tip: Show awareness of NHS pressures like workload, waiting lists, and patient safety\",\n\n  // Motivation & Career Tips\n  \"üí° Tip: Be specific about why you want THIS Trust - research their values and recent achievements\",\n  \"üí° Tip: Share a personal experience that shaped your healthcare career choice - make it authentic\",\n  \"üí° Tip: Explain how this role fits your long-term career development plan\",\n  \"üí° Tip: Stay positive in applications - never criticise previous employers or experiences\",\n  \"üí° Tip: Demonstrate enthusiasm for NHS training and progression opportunities\",\n\n  // Skills & Experience Tips\n  \"üí° Tip: Highlight communication skills with both patients and colleagues - it's crucial\",\n  \"üí° Tip: Mention specific IT systems you've used: EPR, PACS, Lorenzo, SystmOne\",\n  \"üí° Tip: Evidence teamwork, especially examples of working under pressure\",\n  \"üí° Tip: Show understanding of safeguarding principles - it's essential for all NHS roles\",\n  \"üí° Tip: Demonstrate flexibility with shifts and rota changes - NHS values adaptability\",\n\n  // Clinical Knowledge Tips\n  \"üí° Tip: Reference relevant guidelines: NICE, NMC Code, GMC Good Practice, IR(ME)R\",\n  \"üí° Tip: Mention any audit, quality improvement, or service improvement involvement\",\n  \"üí° Tip: Show evidence of documentation accuracy - it's critical for patient safety\",\n  \"üí° Tip: Demonstrate how you prioritise tasks in busy clinical settings\",\n\n  // Interview Preparation Tips\n  \"üí° Tip: Research the Trust's values and recent CQC inspection ratings before interviews\",\n  \"üí° Tip: Prepare STAR answers for NHS values-based questions - practice them aloud\",\n  \"üí° Tip: Have one strong example ready for teamwork and one for leadership/initiative\",\n  \"üí° Tip: Be ready for scenario questions: 'What would you do if a patient complained?'\",\n\n  // Application Process Tips\n  \"üí° Tip: Don't wait until closing date to apply - submit early to avoid system crashes\",\n  \"üí° Tip: Save copies of your supporting information to adapt for future roles\",\n  \"üí° Tip: Apply widely - NHS, private sector, agency, and bank positions\",\n  \"üí° Tip: Always personalise applications - never copy and paste blindly\",\n  \"üí° Tip: Check visa sponsorship requirements early in your application process\",\n\n  // Motivation & Mindset Tips\n  \"üí° Tip: Rejection is redirection - learn from feedback and improve your next application\",\n  \"üí° Tip: Every application is practice - you're sharpening your skills each time\",\n  \"üí° Tip: Persistence beats perfection - keep applying and improving\",\n  \"üí° Tip: Request feedback after every rejection - it's fuel for improvement\",\n  \"üí° Tip: Celebrate small wins like getting shortlisted or reaching interview stage\",\n\n  // Practical Tips\n  \"üí° Tip: Follow NHS Trusts on LinkedIn to see their values and culture in action\",\n  \"üí° Tip: Network with current NHS staff online - they can provide insider insights\",\n  \"üí° Tip: Tailor applications to specific departments (e.g., radiology vs cardiology)\",\n  \"üí° Tip: Keep your CPD portfolio ready to show at interviews\",\n  \"üí° Tip: The NHS needs people like you - believe in your ability to succeed\"\n];\n\nexport const RotatingTip = () => {\n  const [currentTip, setCurrentTip] = useState('');\n  const [isVisible, setIsVisible] = useState(true);\n\n  useEffect(() => {\n    // Select random tip on component mount\n    const randomTip = healthHireTips[Math.floor(Math.random() * healthHireTips.length)];\n    setCurrentTip(randomTip);\n  }, []);\n\n  if (!isVisible) return null;\n\n  return (\n    <div className=\"mb-6 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-lg shadow-sm\" data-testid=\"rotating-tip\">\n      <div className=\"flex items-start justify-between gap-3\">\n        <div className=\"flex items-start space-x-3 flex-1\">\n          <p className=\"text-blue-800 font-medium leading-relaxed\">{currentTip}</p>\n        </div>\n        <button \n          onClick={() => setIsVisible(false)}\n          className=\"text-blue-400 hover:text-blue-600 transition-colors flex-shrink-0 mt-1\"\n          data-testid=\"close-tip\"\n        >\n          <X className=\"h-4 w-4\" />\n        </button>\n      </div>\n    </div>\n  );\n};","size_bytes":6019},"client/src/pages/ai-documents.tsx":{"content":"import { useState } from \"react\";\nimport { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { FileText, Download, Sparkles, Target, Star, Clock, Eye, User, Crown, Lock, ArrowLeft, Edit, ClipboardList } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useSubscription } from \"@/hooks/useSubscription\";\nimport { UpgradePrompt } from \"@/components/UpgradePrompt\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { HenrySupportingInfoHelper } from \"@/components/HenrySupportingInfoHelper\";\nimport { HenryCoverLetterHelper } from \"@/components/HenryCoverLetterHelper\";\n\ninterface GeneratedDocument {\n  content: string;\n  wordCount: number;\n  tone: string;\n  quality: {\n    score: number;\n    feedback: string[];\n    nhsValuesAlignment: number;\n  };\n}\n\nconst SupportingInfoGenerator = () => {\n  const [jobDescription, setJobDescription] = useState(\"\");\n  const [personSpec, setPersonSpec] = useState(\"\");\n  const [generatedDoc, setGeneratedDoc] = useState<GeneratedDocument | null>(null);\n  const { toast } = useToast();\n\n  const handleSupportingInfoGenerated = (content: string, isDemo: boolean) => {\n    // Create a document object to maintain compatibility with existing display\n    const documentData: GeneratedDocument = {\n      content: content,\n      wordCount: content.split(' ').length,\n      tone: \"Generated by Henry\",\n      quality: {\n        score: isDemo ? 85 : 95,\n        feedback: isDemo ? [\"This is demo content\", \"Review and personalize before use\"] : [\"Generated using your profile\", \"Tailored to role requirements\"],\n        nhsValuesAlignment: isDemo ? 85 : 95,\n      },\n    };\n    setGeneratedDoc(documentData);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <ClipboardList className=\"h-8 w-8 text-blue-600\" />\n            Supporting Information Generator\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div>\n            <Label htmlFor=\"job-description\">Job Description *</Label>\n            <Textarea\n              id=\"job-description\"\n              placeholder=\"Paste the full job description here...\"\n              value={jobDescription}\n              onChange={(e) => setJobDescription(e.target.value)}\n              className=\"h-32\"\n              data-testid=\"textarea-job-description\"\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"person-spec\">Person Specification (Optional)</Label>\n            <Textarea\n              id=\"person-spec\"\n              placeholder=\"Paste the person specification to tailor your response...\"\n              value={personSpec}\n              onChange={(e) => setPersonSpec(e.target.value)}\n              className=\"h-24\"\n              data-testid=\"textarea-person-spec\"\n            />\n          </div>\n\n          {/* Henry the Helper - Supporting Information Generator */}\n          <HenrySupportingInfoHelper\n            jobDescription={jobDescription}\n            personSpecification={personSpec}\n            onSupportingInfoGenerated={handleSupportingInfoGenerated}\n          />\n        </CardContent>\n      </Card>\n\n      {generatedDoc && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center justify-between\">\n              Generated Supporting Information\n              <div className=\"flex items-center gap-2\">\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  <Clock className=\"h-3 w-3 mr-1\" />\n                  {generatedDoc.wordCount} words\n                </Badge>\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  <Star className=\"h-3 w-3 mr-1\" />\n                  {generatedDoc.quality.score}% quality\n                </Badge>\n              </div>\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"bg-muted/50 p-4 rounded-lg\">\n              <div className=\"flex items-center gap-2 mb-2\">\n                <Target className=\"h-4 w-4 text-primary\" />\n                <span className=\"text-sm font-medium\">NHS Values Alignment: {generatedDoc.quality.nhsValuesAlignment}%</span>\n              </div>\n              {generatedDoc.quality.feedback.length > 0 && (\n                <div className=\"text-sm text-muted-foreground\">\n                  <div className=\"font-medium mb-1\">Feedback:</div>\n                  <ul className=\"list-disc list-inside space-y-1\">\n                    {generatedDoc.quality.feedback.map((feedback, index) => (\n                      <li key={index}>{feedback}</li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </div>\n\n            <div className=\"prose max-w-none\">\n              <pre className=\"whitespace-pre-wrap text-sm leading-relaxed font-normal bg-white p-4 rounded border\">\n                {generatedDoc.content}\n              </pre>\n            </div>\n\n            <Button \n              onClick={() => {\n                navigator.clipboard.writeText(generatedDoc.content);\n                toast({\n                  title: \"Copied!\",\n                  description: \"Supporting information copied to clipboard\",\n                });\n              }}\n              variant=\"outline\"\n              className=\"w-full\"\n              data-testid=\"button-copy-supporting-info\"\n            >\n              <Download className=\"h-4 w-4 mr-2\" />\n              Copy to Clipboard\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n};\n\n\nexport default function DocumentGeneration() {\n  const { isAuthenticated, isLoading, user } = useAuth();\n  const { isPaid, canAccessFeature } = useSubscription();\n  const [, setLocation] = useLocation();\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <div className=\"flex items-center justify-center py-32\">\n          <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" aria-label=\"Loading\"/>\n        </div>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <div className=\"max-w-4xl mx-auto px-6 py-12 text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Sign In Required</h1>\n          <p className=\"text-muted-foreground mb-6\">Please sign in to access document generation</p>\n          <Button onClick={() => window.location.href = \"/api/login\"}>\n            Sign In\n          </Button>\n        </div>\n        <Footer />\n      </div>\n    );\n  }\n\n  const canAccessGeneration = canAccessFeature('ai_generation');\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"max-w-4xl mx-auto px-6 py-12\">\n        {/* Breadcrumb */}\n        <div className=\"flex items-center space-x-2 mb-8\">\n          <Button \n            variant=\"ghost\" \n            size=\"sm\"\n            onClick={() => setLocation(\"/\")}\n            data-testid=\"button-back-to-dashboard\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Dashboard\n          </Button>\n        </div>\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold mb-4\">Application Documents</h1>\n          <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n            {isPaid ? \n              \"Generate tailored Supporting Information for NHS applications and manage your master CV\" :\n              \"Preview document generation features and view your basic CV\"\n            }\n          </p>\n        </div>\n\n        {/* Document Strategy Tips */}\n        <Card className=\"mb-8 border-blue-200 bg-blue-50/50\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-blue-800\">\n              <Target className=\"h-5 w-5\" />\n              Essential Document Strategy\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div className=\"space-y-3\">\n                <div className=\"flex items-start gap-3\">\n                  <FileText className=\"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0\" />\n                  <div>\n                    <h4 className=\"font-semibold text-blue-900\">CV = Career Snapshot</h4>\n                    <p className=\"text-sm text-blue-700\">\n                      Your CV is not meant to be \"special\" - just accurate, clean, and easy to scan. \n                      Keep it professional and straightforward.\n                    </p>\n                  </div>\n                </div>\n                \n                <div className=\"flex items-start gap-3\">\n                  <Sparkles className=\"h-5 w-5 text-purple-600 mt-0.5 flex-shrink-0\" />\n                  <div>\n                    <h4 className=\"font-semibold text-purple-900\">Supporting Information = The Magic</h4>\n                    <p className=\"text-sm text-purple-700\">\n                      This is where you shine! Tailor this document to the job's person specification \n                      every single time. This is what gets you the interview.\n                    </p>\n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"bg-white/60 p-4 rounded-lg border border-blue-200\">\n                <div className=\"flex items-start gap-3\">\n                  <Star className=\"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0\" />\n                  <div>\n                    <h4 className=\"font-semibold text-amber-900\">One CV, Many Applications</h4>\n                    <p className=\"text-sm text-amber-700 mb-2\">\n                      Your CV can stay broadly the same across applications. Only update it when \n                      applying for very different roles.\n                    </p>\n                    <p className=\"text-sm font-medium text-amber-800\">\n                      Your Supporting Information <strong>must change per role</strong> - this is non-negotiable for success.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8\">\n          {/* CV Preview Section - Always visible */}\n          <Card className=\"lg:col-span-2\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <FileText className=\"h-5 w-5 text-blue-600\" />\n                üìÑ Your CV {!isPaid && \"(Preview)\"}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {isPaid ? (\n                <>\n                  <p className=\"text-muted-foreground mb-4\">\n                    View and download your complete professional CV based on your profile.\n                  </p>\n                  <div className=\"space-y-2\">\n                    <Button \n                      onClick={() => setLocation('/cv-viewer')}\n                      className=\"w-full\"\n                      data-testid=\"button-view-cv\"\n                    >\n                      <Eye className=\"h-4 w-4 mr-2\" />\n                      View My CV\n                    </Button>\n                    <Button \n                      onClick={() => {\n                        // Trigger CV PDF download\n                        window.open('/api/cv/download-pdf', '_blank');\n                      }}\n                      variant=\"outline\"\n                      className=\"w-full\"\n                      data-testid=\"button-download-cv\"\n                    >\n                      <Download className=\"h-4 w-4 mr-2\" />\n                      Download PDF\n                    </Button>\n                  </div>\n                </>\n              ) : (\n                <>\n                  <p className=\"text-muted-foreground mb-4\">\n                    Preview your CV - upgrade to unlock full access and PDF download.\n                  </p>\n                  \n                  {/* CV Preview for Free Users */}\n                  <div className=\"cv-preview-container mb-4\">\n                    <div className=\"cv-preview-visible bg-gray-50 p-4 rounded-lg border\">\n                      <h4 className=\"font-semibold text-lg\">{(user as any)?.firstName || ''} {(user as any)?.lastName || ''}</h4>\n                      <p className=\"text-gray-600\">{(user as any)?.email || 'your.email@example.com'} | Your Phone | Your Location</p>\n                      <h5 className=\"font-medium mt-3 mb-2\">Professional Summary</h5>\n                      <p className=\"text-gray-700\">I am a dedicated healthcare professional with extensive experience in NHS settings, committed to delivering exceptional patient care while upholding the highest standards of clinical practice...</p>\n                    </div>\n                    \n                    {/* Blurred/Locked Content */}\n                    <div className=\"cv-preview-locked relative mt-4\">\n                      <div className=\"blurred-content bg-gray-100 p-4 rounded-lg filter blur-sm\">\n                        <div className=\"space-y-3\">\n                          <div className=\"h-4 bg-gray-300 rounded w-3/4\"></div>\n                          <div className=\"h-4 bg-gray-300 rounded w-1/2\"></div>\n                          <div className=\"h-4 bg-gray-300 rounded w-5/6\"></div>\n                          <div className=\"h-4 bg-gray-300 rounded w-2/3\"></div>\n                        </div>\n                      </div>\n                      <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <div className=\"bg-white/90 p-3 rounded-lg border shadow-lg\">\n                          <Button \n                            onClick={() => setLocation('/pricing')}\n                            className=\"bg-yellow-600 hover:bg-yellow-700 text-white\"\n                            data-testid=\"button-unlock-cv\"\n                          >\n                            <Lock className=\"h-4 w-4 mr-2\" />\n                            Unlock Full CV - ¬£70\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </>\n                )}\n              </CardContent>\n            </Card>\n\n          {/* Your Master CV Section */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <User className=\"h-5 w-5 text-green-600\" />\n                Your Master CV\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground mb-4\">\n                {isPaid ? \n                  \"View and download your up-to-date CV based on your profile information.\" :\n                  \"Basic CV preview available. Upgrade for full access and PDF download.\"\n                }\n              </p>\n              <Button \n                onClick={() => setLocation('/profile')}\n                className=\"w-full\"\n                variant=\"outline\"\n                data-testid=\"button-update-cv\"\n              >\n                <Edit className=\"h-4 w-4 mr-2\" />\n                {isPaid ? \"Update My CV\" : \"Update Profile\"}\n              </Button>\n              <p className=\"text-xs text-muted-foreground mt-2\">\n                {isPaid ? \n                  \"Updates automatically when you modify your profile\" :\n                  \"Upgrade to unlock automatic updates and PDF download\"\n                }\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Supporting Information Generator */}\n        {canAccessGeneration ? (\n          <div className=\"space-y-8\">\n            <SupportingInfoGenerator />\n            \n            {/* Cover Letter Generator */}\n            <HenryCoverLetterHelper />\n          </div>\n        ) : (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Sparkles className=\"h-5 w-5 text-purple-600\" />\n                ‚ú® Supporting Information Generator {!isPaid && \"(Premium)\"}\n                {!isPaid && <Crown className=\"h-4 w-4 text-yellow-600 ml-2\" />}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground mb-4\">\n                Professional 900-1200 word responses tailored to NHS person specifications with values alignment.\n              </p>\n              \n              {/* Preview Interface - Disabled */}\n              <div className=\"space-y-4 bg-muted/10 border-muted\">\n                <div>\n                  <Label>Job Description *</Label>\n                  <Textarea\n                    disabled\n                    placeholder=\"Paste the full job description here...\"\n                    value=\"I am writing to express my strong interest in the Staff Nurse position at your NHS Trust. With my extensive clinical experience and deep commitment to NHS values...\"\n                    className=\"h-32\"\n                  />\n                </div>\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label>Writing Tone</Label>\n                    <Select disabled>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Professional\" />\n                      </SelectTrigger>\n                    </Select>\n                  </div>\n                  <div>\n                    <Label>Target Length</Label>\n                    <Select disabled>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"1000 words\" />\n                      </SelectTrigger>\n                    </Select>\n                  </div>\n                </div>\n                \n                <Button disabled className=\"w-full\">\n                  <Sparkles className=\"h-4 w-4 mr-2\" />\n                  Generate Supporting Information\n                </Button>\n              </div>\n              \n              {/* Upgrade Prompt */}\n              <div className=\"mt-6\">\n                <UpgradePrompt feature=\"Document Generation\" />\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}","size_bytes":18941},"client/src/pages/checkout.tsx":{"content":"import { useStripe, Elements, PaymentElement, useElements } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { useEffect, useState } from 'react';\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { CheckCircle, Star, Zap, Users, FileText, Search } from \"lucide-react\";\nimport { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { useLocation } from \"wouter\";\n\n// Make sure to call `loadStripe` outside of a component's render to avoid\n// recreating the `Stripe` object on every render.\nif (!import.meta.env.VITE_STRIPE_PUBLIC_KEY) {\n  throw new Error('Missing required Stripe key: VITE_STRIPE_PUBLIC_KEY');\n}\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY);\n\nconst CheckoutForm = () => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsProcessing(true);\n\n    if (!stripe || !elements) {\n      setIsProcessing(false);\n      return;\n    }\n\n    const { error } = await stripe.confirmPayment({\n      elements,\n      confirmParams: {\n        return_url: `${window.location.origin}/payment-success`,\n      },\n    });\n\n    if (error) {\n      toast({\n        title: \"Payment Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } else {\n      toast({\n        title: \"Payment Successful\",\n        description: \"Welcome to HealthHire Portal Premium! Redirecting...\",\n      });\n      setTimeout(() => setLocation(\"/\"), 2000);\n    }\n    \n    setIsProcessing(false);\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <div className=\"bg-white p-6 rounded-lg border\">\n        <PaymentElement />\n      </div>\n      \n      <Button \n        type=\"submit\"\n        disabled={!stripe || !elements || isProcessing}\n        className=\"w-full h-12 text-lg font-semibold\"\n        data-testid=\"submit-payment\"\n      >\n        {isProcessing ? (\n          <div className=\"flex items-center gap-2\">\n            <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full\" />\n            Processing Payment...\n          </div>\n        ) : (\n          `Complete Payment - ¬£70`\n        )}\n      </Button>\n    </form>\n  );\n};\n\nconst PremiumFeatures = () => {\n  const features = [\n    {\n      icon: Search,\n      title: \"Unlimited Job Search\",\n      description: \"Access all NHS jobs with advanced filtering and real-time updates\"\n    },\n    {\n      icon: FileText,\n      title: \"Document Generation\", \n      description: \"Generate unlimited Supporting Information and CVs tailored to NHS roles\"\n    },\n    {\n      icon: Zap,\n      title: \"Role Fit Calculator\",\n      description: \"Intelligent matching to find your perfect NHS positions\"\n    },\n    {\n      icon: Users,\n      title: \"Interview Practice\",\n      description: \"Mock interviews with expert feedback on NHS values and STAR responses\"\n    }\n  ];\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Star className=\"h-5 w-5 text-yellow-500\" />\n          Premium Features Included\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {features.map((feature, index) => (\n          <div key={index} className=\"flex items-start gap-3\">\n            <div className=\"rounded-full bg-primary/10 p-2 mt-0.5\">\n              <feature.icon className=\"h-4 w-4 text-primary\" />\n            </div>\n            <div>\n              <h4 className=\"font-medium text-sm\">{feature.title}</h4>\n              <p className=\"text-xs text-muted-foreground\">{feature.description}</p>\n            </div>\n          </div>\n        ))}\n        <div className=\"pt-4 border-t\">\n          <div className=\"flex items-center gap-2 text-green-600\">\n            <CheckCircle className=\"h-4 w-4\" />\n            <span className=\"text-sm font-medium\">One-time payment ‚Ä¢ Lifetime access</span>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default function Checkout() {\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(true);\n  const { user, isAuthenticated } = useAuth();\n  const [, setLocation] = useLocation();\n  \n  useEffect(() => {\n    if (!isAuthenticated) {\n      setLocation(\"/\");\n      return;\n    }\n\n    // Redirect to Stripe Checkout for secure payment processing\n    const initiateCheckout = async () => {\n      try {\n        const response = await apiRequest('POST', '/api/payments/create-checkout', {});\n        const data = await response.json();\n        if (data.checkout_url) {\n          // Redirect to Stripe's secure checkout page\n          window.location.href = data.checkout_url;\n        } else {\n          throw new Error('No checkout URL received');\n        }\n      } catch (error) {\n        console.error(\"Checkout setup error:\", error);\n        setIsLoading(false);\n      }\n    };\n\n    initiateCheckout();\n  }, [isAuthenticated, setLocation]);\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <div className=\"flex items-center justify-center py-32\">\n          <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" aria-label=\"Loading\"/>\n        </div>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (!clientSecret) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <div className=\"max-w-4xl mx-auto px-6 py-12\">\n          <div className=\"text-center\">\n            <h1 className=\"text-2xl font-bold text-destructive mb-4\">Payment Setup Error</h1>\n            <p className=\"text-muted-foreground mb-6\">Unable to initialize payment. Please try again.</p>\n            <Button onClick={() => setLocation(\"/\")} variant=\"outline\">\n              Return to Dashboard\n            </Button>\n          </div>\n        </div>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"max-w-4xl mx-auto px-6 py-12\">\n        {/* Header */}\n        <div className=\"text-center mb-12\">\n          <h1 className=\"text-3xl font-bold mb-4\">Upgrade to Premium</h1>\n          <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n            Get lifetime access to all HealthHire Portal features and accelerate your NHS career\n          </p>\n          <div className=\"mt-6\">\n            <div className=\"text-4xl font-bold text-primary\">¬£70</div>\n            <div className=\"text-sm text-muted-foreground\">One-time payment ‚Ä¢ Lifetime access</div>\n          </div>\n        </div>\n\n        <div className=\"grid md:grid-cols-2 gap-8\">\n          {/* Payment Form */}\n          <div>\n            <h2 className=\"text-xl font-semibold mb-6\">Complete Your Purchase</h2>\n            <Elements stripe={stripePromise} options={{ clientSecret }}>\n              <CheckoutForm />\n            </Elements>\n          </div>\n\n          {/* Features List */}\n          <div>\n            <PremiumFeatures />\n          </div>\n        </div>\n\n        {/* Trust Indicators */}\n        <div className=\"mt-12 pt-8 border-t text-center\">\n          <div className=\"flex items-center justify-center gap-6 text-sm text-muted-foreground\">\n            <div className=\"flex items-center gap-1\">\n              <CheckCircle className=\"h-4 w-4 text-green-600\" />\n              <span>Secure Payment</span>\n            </div>\n            <div className=\"flex items-center gap-1\">\n              <CheckCircle className=\"h-4 w-4 text-green-600\" />\n              <span>No Recurring Charges</span>\n            </div>\n            <div className=\"flex items-center gap-1\">\n              <CheckCircle className=\"h-4 w-4 text-green-600\" />\n              <span>Instant Access</span>\n            </div>\n          </div>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}","size_bytes":8380},"client/src/pages/documents-enhanced.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { FileText, Upload, Download, Plus, Crown, Lock } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ObjectUploader } from \"@/components/ObjectUploader\";\nimport { useLocation } from \"wouter\";\nimport type { UploadResult } from \"@uppy/core\";\n\ninterface Document {\n  id: string;\n  title: string;\n  type: string;\n  content?: string;\n  filePath?: string;\n  fileSize?: number;\n  createdAt: string;\n}\n\nconst DocumentUploader = ({ documentType }: { documentType: string }) => {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const handleGetUploadParameters = async () => {\n    const response = await apiRequest(\"POST\", \"/api/upload/document\", { documentType });\n    const data = await response.json();\n    return {\n      method: \"PUT\" as const,\n      url: data.uploadURL,\n    };\n  };\n\n  const recordUploadMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/documents/uploaded\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/documents\"] });\n      toast({\n        title: \"Upload Successful!\",\n        description: \"Your document has been uploaded and saved\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Upload Failed\",\n        description: error.message || \"Failed to save uploaded document\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleComplete = (result: UploadResult<Record<string, unknown>, Record<string, unknown>>) => {\n    const successful = result.successful[0];\n    if (successful) {\n      recordUploadMutation.mutate({\n        fileName: successful.name,\n        uploadURL: successful.uploadURL,\n        documentType,\n        fileSize: successful.size,\n      });\n    }\n  };\n\n  return (\n    <ObjectUploader\n      maxNumberOfFiles={5}\n      maxFileSize={52428800} // 50MB for documents\n      onGetUploadParameters={handleGetUploadParameters}\n      onComplete={handleComplete}\n      buttonClassName=\"w-full\"\n    >\n      <div className=\"flex items-center gap-2\">\n        <Upload className=\"h-4 w-4\" />\n        <span>Upload {documentType === 'certificate' ? 'Certificates' : 'Documents'}</span>\n      </div>\n    </ObjectUploader>\n  );\n};\n\nconst DocumentsList = ({ type }: { type: string }) => {\n  const { data: documents = [], isLoading } = useQuery({\n    queryKey: [\"/api/documents\", type],\n  });\n\n  const filteredDocs = documents.filter((doc: Document) => doc.type === type);\n\n  if (isLoading) {\n    return <div className=\"text-center py-4\">Loading documents...</div>;\n  }\n\n  if (filteredDocs.length === 0) {\n    return (\n      <div className=\"text-center py-8 text-muted-foreground\">\n        <FileText className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n        <p>No {type}s uploaded yet</p>\n        <p className=\"text-sm\">Upload your files to get started</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-3\">\n      {filteredDocs.map((doc: Document) => (\n        <div key={doc.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\n          <div className=\"flex items-center gap-3\">\n            <FileText className=\"h-5 w-5 text-muted-foreground\" />\n            <div>\n              <div className=\"font-medium text-sm\">{doc.title}</div>\n              <div className=\"text-xs text-muted-foreground\">\n                {doc.fileSize ? `${Math.round(doc.fileSize / 1024)} KB` : ''} ‚Ä¢ \n                {new Date(doc.createdAt).toLocaleDateString()}\n              </div>\n            </div>\n          </div>\n          {doc.filePath && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => window.open(`/objects${doc.filePath}`, '_blank')}\n              data-testid={`button-download-${doc.id}`}\n            >\n              <Download className=\"h-4 w-4\" />\n            </Button>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n};\n\nconst PremiumUpgrade = () => {\n  const [, setLocation] = useLocation();\n  \n  return (\n    <Card className=\"border-primary/20 bg-gradient-to-br from-primary/5 to-primary/10\">\n      <CardContent className=\"p-6 text-center\">\n        <Crown className=\"h-8 w-8 text-primary mx-auto mb-3\" />\n        <h3 className=\"font-semibold mb-2\">Upgrade to Premium</h3>\n        <p className=\"text-sm text-muted-foreground mb-4\">\n          Get unlimited access to AI document generation, enhanced job matching, and more\n        </p>\n        <div className=\"mb-4\">\n          <span className=\"text-2xl font-bold text-primary\">¬£70</span>\n          <span className=\"text-sm text-muted-foreground ml-1\">one-time</span>\n        </div>\n        <Button \n          onClick={() => setLocation('/checkout')}\n          className=\"w-full\"\n          data-testid=\"button-upgrade-premium\"\n        >\n          <Crown className=\"h-4 w-4 mr-2\" />\n          Upgrade Now\n        </Button>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default function DocumentsEnhanced() {\n  const { user, isAuthenticated, isLoading } = useAuth();\n  const isPremium = user?.subscriptionStatus === 'paid';\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <div className=\"flex items-center justify-center py-32\">\n          <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" aria-label=\"Loading\"/>\n        </div>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <div className=\"max-w-4xl mx-auto px-6 py-12 text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Sign In Required</h1>\n          <p className=\"text-muted-foreground mb-6\">Please sign in to access document management</p>\n          <Button onClick={() => window.location.href = \"/api/login\"}>\n            Sign In\n          </Button>\n        </div>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"max-w-6xl mx-auto px-6 py-12\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold mb-4\">Document Management</h1>\n          <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n            Upload, generate, and manage your NHS application documents in one place\n          </p>\n        </div>\n\n        <div className=\"grid lg:grid-cols-3 gap-6\">\n          {/* Main Content */}\n          <div className=\"lg:col-span-2\">\n            <Tabs defaultValue=\"certificates\" className=\"w-full\">\n              <TabsList className=\"grid w-full grid-cols-3\">\n                <TabsTrigger value=\"certificates\" data-testid=\"tab-certificates\">\n                  Certificates\n                </TabsTrigger>\n                <TabsTrigger value=\"documents\" data-testid=\"tab-documents\">\n                  Documents\n                </TabsTrigger>\n                <TabsTrigger value=\"generated\" data-testid=\"tab-generated\">\n                  AI Generated\n                </TabsTrigger>\n              </TabsList>\n              \n              <TabsContent value=\"certificates\" className=\"mt-6 space-y-6\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-lg\">Professional Certificates</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <DocumentUploader documentType=\"certificate\" />\n                    <DocumentsList type=\"certificate\" />\n                  </CardContent>\n                </Card>\n              </TabsContent>\n              \n              <TabsContent value=\"documents\" className=\"mt-6 space-y-6\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-lg\">Supporting Documents</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <DocumentUploader documentType=\"document\" />\n                    <DocumentsList type=\"document\" />\n                  </CardContent>\n                </Card>\n              </TabsContent>\n              \n              <TabsContent value=\"generated\" className=\"mt-6 space-y-6\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-lg flex items-center gap-2\">\n                      AI Generated Documents\n                      {!isPremium && <Lock className=\"h-4 w-4 text-muted-foreground\" />}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {isPremium ? (\n                      <div className=\"space-y-4\">\n                        <DocumentsList type=\"supporting_info\" />\n                        <DocumentsList type=\"cv\" />\n                        {/* Show generated documents here */}\n                      </div>\n                    ) : (\n                      <div className=\"text-center py-8\">\n                        <Lock className=\"h-8 w-8 mx-auto mb-3 text-muted-foreground\" />\n                        <h3 className=\"font-medium mb-2\">Premium Feature</h3>\n                        <p className=\"text-sm text-muted-foreground mb-4\">\n                          Upgrade to access AI-generated documents and unlimited generation\n                        </p>\n                        <Button size=\"sm\" data-testid=\"button-upgrade-for-ai\">\n                          <Crown className=\"h-4 w-4 mr-2\" />\n                          Upgrade to Premium\n                        </Button>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </TabsContent>\n            </Tabs>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"space-y-6\">\n            {/* AI Document Generator */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg flex items-center gap-2\">\n                  <FileText className=\"h-5 w-5\" />\n                  AI Generator\n                  {!isPremium && <Lock className=\"h-4 w-4 text-muted-foreground\" />}\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {isPremium ? (\n                  <div className=\"space-y-3\">\n                    <Button \n                      onClick={() => window.location.href = '/ai-documents'}\n                      className=\"w-full justify-start\"\n                      data-testid=\"button-ai-documents\"\n                    >\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Generate Documents\n                    </Button>\n                    <div className=\"text-xs text-muted-foreground\">\n                      Create Supporting Information and CVs tailored to specific NHS roles\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"text-center\">\n                    <Lock className=\"h-6 w-6 mx-auto mb-2 text-muted-foreground\" />\n                    <p className=\"text-xs text-muted-foreground mb-3\">Premium feature</p>\n                    <Button size=\"sm\" variant=\"outline\" className=\"w-full text-xs\">\n                      Upgrade Required\n                    </Button>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Upgrade Card */}\n            {!isPremium && <PremiumUpgrade />}\n\n            {/* Quick Stats */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">Document Stats</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span>Certificates:</span>\n                    <Badge variant=\"secondary\">0</Badge>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Documents:</span>\n                    <Badge variant=\"secondary\">0</Badge>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>AI Generated:</span>\n                    <Badge variant=\"secondary\">0</Badge>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}","size_bytes":13014},"client/src/pages/job-detail.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { ArrowLeft, ExternalLink, FileText, MapPin, Clock, Briefcase, Calendar, AlertTriangle, CheckCircle, Bookmark } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface NhsJob {\n  id: string;\n  title: string;\n  employer: string;\n  location: string;\n  band: string;\n  salaryMin?: number;\n  salaryMax?: number;\n  description: string;\n  personSpec?: string;\n  visaSponsorship: boolean;\n  closingDate?: string;\n  externalId?: string;\n  contractType?: string;\n  workingPattern?: string;\n  externalUrl?: string;\n}\n\nexport default function JobDetail() {\n  const [, setLocation] = useLocation();\n  const [jobId, setJobId] = useState<string | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  useEffect(() => {\n    // Extract job ID from URL path\n    const path = window.location.pathname;\n    const id = path.split('/jobs/')[1];\n    setJobId(id);\n  }, []);\n\n  const { data: job, isLoading, error } = useQuery({\n    queryKey: ['/api/jobs', jobId],\n    queryFn: async () => {\n      if (!jobId) return null;\n      const response = await apiRequest('GET', `/api/jobs/${jobId}`);\n      return response.json();\n    },\n    enabled: !!jobId,\n    retry: false,\n  });\n\n  const handleApplyForRole = () => {\n    if (job?.externalUrl) {\n      window.open(job.externalUrl, '_blank');\n    } else if (job?.externalId) {\n      // Fallback to NHS Jobs URL structure\n      window.open(`https://www.jobs.nhs.uk/candidate/jobadvert/${job.externalId}`, '_blank');\n    }\n  };\n\n  const handleGenerateSupporting = () => {\n    // Open Application Documents page in new tab with job context and switch focus\n    const documentsUrl = `/ai-documents?jobId=${jobId}`;\n    const newTab = window.open(documentsUrl, '_blank');\n    \n    // Ensure the new tab gets focus\n    if (newTab) {\n      newTab.focus();\n    }\n  };\n\n  // Mutation to add job to tracker\n  const addToTrackerMutation = useMutation({\n    mutationFn: async (jobData: any) => {\n      const response = await apiRequest(\"POST\", \"/api/applications\", jobData);\n      return response;\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Job Added to Tracker\",\n        description: \"This job has been saved to your Application Tracker as a draft.\",\n      });\n      // Invalidate applications query to refresh the tracker\n      queryClient.invalidateQueries({ queryKey: [\"/api/applications\"] });\n    },\n    onError: (error) => {\n      console.error(\"Error adding job to tracker:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to add job to tracker. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleAddToTracker = () => {\n    if (!job) return;\n    \n    const salaryDisplay = job.salaryMin && job.salaryMax \n      ? `¬£${job.salaryMin.toLocaleString()} - ¬£${job.salaryMax.toLocaleString()}`\n      : job.salaryMin \n        ? `From ¬£${job.salaryMin.toLocaleString()}`\n        : job.salaryMax\n          ? `Up to ¬£${job.salaryMax.toLocaleString()}`\n          : \"Competitive/Negotiable\";\n\n    addToTrackerMutation.mutate({\n      jobTitle: job.title,\n      employer: job.employer,\n      location: job.location,\n      salary: salaryDisplay,\n      status: \"draft\"\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <main className=\"max-w-4xl mx-auto px-6 py-12\">\n          <div className=\"space-y-6\">\n            <Skeleton className=\"h-8 w-32\" />\n            <Card>\n              <CardHeader>\n                <Skeleton className=\"h-8 w-3/4\" />\n                <Skeleton className=\"h-6 w-1/2\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <Skeleton className=\"h-4 w-full\" />\n                  <Skeleton className=\"h-4 w-full\" />\n                  <Skeleton className=\"h-4 w-3/4\" />\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (error || !job) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <main className=\"max-w-4xl mx-auto px-6 py-12\">\n          <div className=\"text-center\">\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Job Not Found</h1>\n            <p className=\"text-gray-600 mb-6\">\n              The job you're looking for could not be found or may have been removed.\n            </p>\n            <Button onClick={() => setLocation('/jobs')} data-testid=\"button-back-to-jobs\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Job Search\n            </Button>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"max-w-4xl mx-auto px-6 py-12\">\n        {/* Back Button */}\n        <Button \n          variant=\"ghost\" \n          onClick={() => setLocation('/jobs')}\n          className=\"mb-6\"\n          data-testid=\"button-back-to-jobs\"\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Job Search\n        </Button>\n\n        {/* Job Header */}\n        <Card className=\"mb-6\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex justify-between items-start mb-4\">\n              <div className=\"flex-1\">\n                <h1 className=\"text-2xl font-bold text-gray-900 mb-2\" data-testid=\"job-title\">\n                  {job.title}\n                </h1>\n                <p className=\"text-lg text-blue-600 font-medium mb-2\" data-testid=\"job-employer\">\n                  {job.employer}\n                </p>\n                <div className=\"flex items-center gap-2 text-gray-600\">\n                  <MapPin className=\"h-4 w-4\" />\n                  <span data-testid=\"job-location\">{job.location}</span>\n                </div>\n              </div>\n            </div>\n            \n            {/* Key Details Grid */}\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n              <div>\n                <span className=\"text-sm text-gray-500 block\">Band</span>\n                <p className=\"font-semibold\" data-testid=\"job-band\">{job.band}</p>\n              </div>\n              <div>\n                <span className=\"text-sm text-gray-500 block\">Salary</span>\n                <p className=\"font-semibold text-green-600\" data-testid=\"job-salary\">\n                  {job.salaryMin && job.salaryMax \n                    ? `¬£${job.salaryMin.toLocaleString()} - ¬£${job.salaryMax.toLocaleString()} per annum`\n                    : job.salaryMin \n                      ? `From ¬£${job.salaryMin.toLocaleString()} per annum`\n                      : job.salaryMax\n                        ? `Up to ¬£${job.salaryMax.toLocaleString()} per annum`\n                        : 'Competitive/Negotiable'\n                  }\n                </p>\n              </div>\n              {job.contractType && (\n                <div>\n                  <span className=\"text-sm text-gray-500 block\">Contract</span>\n                  <p className=\"font-semibold\">{job.contractType}</p>\n                </div>\n              )}\n              {job.closingDate && (\n                <div>\n                  <span className=\"text-sm text-gray-500 block\">Closes</span>\n                  <p className=\"font-semibold text-red-600\" data-testid=\"job-closing-date\">\n                    {new Date(job.closingDate).toLocaleDateString()}\n                  </p>\n                </div>\n              )}\n            </div>\n\n            {/* Tags */}\n            <div className=\"flex flex-wrap gap-2 mb-6\">\n              <Badge variant=\"secondary\">{job.band}</Badge>\n              {job.visaSponsorship && (\n                <Badge className=\"bg-blue-100 text-blue-800\">\n                  Visa Sponsorship Available\n                </Badge>\n              )}\n            </div>\n            \n            {/* Action Buttons */}\n            <div className=\"flex flex-col sm:flex-row gap-4\">\n              <Button \n                onClick={handleApplyForRole}\n                className=\"bg-green-600 hover:bg-green-700 text-white font-semibold\"\n                data-testid=\"button-apply-for-role\"\n              >\n                <ExternalLink className=\"h-4 w-4 mr-2\" />\n                Apply for This Role\n              </Button>\n              <Button \n                onClick={handleGenerateSupporting}\n                variant=\"outline\"\n                className=\"font-semibold\"\n                data-testid=\"button-generate-supporting\"\n              >\n                <FileText className=\"h-4 w-4 mr-2\" />\n                Generate Supporting Information\n              </Button>\n              <Button \n                onClick={handleAddToTracker}\n                variant=\"outline\"\n                className=\"font-semibold\"\n                data-testid=\"button-add-to-tracker\"\n                disabled={addToTrackerMutation.isPending}\n              >\n                <Bookmark className=\"h-4 w-4 mr-2\" />\n                {addToTrackerMutation.isPending ? \"Adding...\" : \"Add to Job Tracker\"}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Essential Criteria Warning */}\n        <Alert className=\"mb-6 border-red-200 bg-red-50\">\n          <CheckCircle className=\"h-4 w-4 text-red-600\" />\n          <AlertDescription className=\"text-red-800\">\n            <strong className=\"font-semibold\">Before You Apply:</strong> Make sure you meet ALL essential criteria in the person specification below. \n            Applications missing essential requirements are automatically rejected by NHS panels.\n          </AlertDescription>\n        </Alert>\n\n        {/* Job Description */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle className=\"text-xl\">Job Description</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"prose max-w-none\">\n              <div \n                dangerouslySetInnerHTML={{ __html: job.description }} \n                className=\"whitespace-pre-wrap\"\n                data-testid=\"job-description\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Person Specification */}\n        {job.personSpec && (\n          <Card className=\"mb-6\">\n            <CardHeader>\n              <CardTitle className=\"text-xl\">Person Specification</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"prose max-w-none\">\n                <div \n                  dangerouslySetInnerHTML={{ __html: job.personSpec }} \n                  className=\"whitespace-pre-wrap\"\n                  data-testid=\"job-person-spec\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Bottom Action Buttons */}\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"text-center\">\n              <h3 className=\"font-semibold text-gray-900 mb-4\">Ready to Apply?</h3>\n              <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n                <Button \n                  onClick={handleApplyForRole}\n                  className=\"bg-green-600 hover:bg-green-700 text-white font-semibold\"\n                  data-testid=\"button-apply-bottom\"\n                >\n                  <ExternalLink className=\"h-4 w-4 mr-2\" />\n                  Apply for This Role\n                </Button>\n                <Button \n                  onClick={handleGenerateSupporting}\n                  variant=\"outline\"\n                  className=\"font-semibold\"\n                  data-testid=\"button-generate-bottom\"\n                >\n                  <FileText className=\"h-4 w-4 mr-2\" />\n                  Generate Supporting Information\n                </Button>\n                <Button \n                  onClick={handleAddToTracker}\n                  variant=\"outline\"\n                  className=\"font-semibold\"\n                  data-testid=\"button-add-to-tracker-bottom\"\n                  disabled={addToTrackerMutation.isPending}\n                >\n                  <Bookmark className=\"h-4 w-4 mr-2\" />\n                  {addToTrackerMutation.isPending ? \"Adding...\" : \"Add to Job Tracker\"}\n                </Button>\n              </div>\n              <p className=\"text-sm text-gray-600 mt-4\">\n                üí° Use Henry the Helper to generate tailored Supporting Information that matches this role's requirements\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}","size_bytes":13251},"server/ai-document-service.ts":{"content":"import type { Profile, NhsJob } from \"@shared/schema\";\nimport { geminiService } from \"./gemini-service\";\n\nexport interface GeneratedDocument {\n  content: string;\n  wordCount: number;\n  tone: 'professional' | 'conversational' | 'confident';\n  quality: {\n    score: number;\n    feedback: string[];\n    nhsValuesAlignment: number;\n  };\n}\n\nexport interface PersonSpecMapping {\n  essential: Array<{\n    criterion: string;\n    matched: boolean;\n    evidence: string;\n    confidence: number;\n  }>;\n  desirable: Array<{\n    criterion: string;\n    matched: boolean;\n    evidence: string;\n    confidence: number;\n  }>;\n  overallMatch: number;\n}\n\nexport class AIDocumentService {\n  // Always use Gemini - OpenAI option removed\n  constructor() {\n  }\n  \n  // NHS Values for content alignment\n  private readonly nhsValues = [\n    \"Compassion: We respond with humanity and kindness to each person's pain, distress, anxiety or need\",\n    \"Respect: We value every person ‚Äì whether patient, their families or carers, or staff ‚Äì as an individual, respecting their aspirations and commitments in life\",\n    \"Dignity: We value the unique worth of every person and treat them with courtesy, kindness and respect\",\n    \"Commitment: We never give up on the person we are here to serve and we never give up on our colleagues\",\n    \"Quality: We take pride in what we do and deliver the best care and support we can\",\n    \"Integrity: We act consistently, honestly and with transparency in all our dealings\"\n  ];\n\n  async generateSupportingInformation(params: {\n    profile: Profile;\n    jobDescription: string;\n    personSpec?: string;\n    tone?: 'professional' | 'conversational' | 'confident';\n    targetLength?: number;\n  }): Promise<GeneratedDocument> {\n    try {\n      const { profile, jobDescription, personSpec = '', tone = 'professional', targetLength = 1000 } = params;\n\n      // Build context from profile\n      const profileContext = this.buildProfileContext(profile);\n      \n      // Create NHS values-aligned prompt\n      const systemPrompt = `You are an expert NHS application writer specializing in Supporting Information statements. You must:\n\n1. Write in ${targetLength} words (900-1200 range)\n2. Use ${tone} tone throughout\n3. Structure with clear paragraphs (no bullet points)\n4. Integrate NHS values naturally: ${this.nhsValues.join('; ')}\n5. Use STAR method examples where relevant\n6. Address person specification points directly\n7. Write in first person using \"I\" statements\n8. End with strong closing about motivation and commitment\n9. Avoid clich√©s and jargon - use plain English\n10. Show evidence-based examples with measurable outcomes\n\nContext about the candidate:\n${profileContext}\n\nPerson Specification (address each point):\n${personSpec}`;\n\n      const userPrompt = `Write a Supporting Information statement for this NHS role:\n\nJOB TITLE: ${jobDescription.split('\\n')[0]}\n\nFULL JOB DESCRIPTION:\n${jobDescription}\n\nRequirements:\n- ${targetLength} words exactly\n- Address why you want THIS specific role and Trust\n- Demonstrate NHS values with specific examples\n- Show relevant experience and skills\n- Include professional development commitment\n- End with genuine motivation statement\n\nWrite the complete Supporting Information now:`;\n\n      // Use Gemini for generating supporting information\n      const content = await geminiService.generateSupportingInformation({\n        jobTitle: jobDescription.split('\\n')[0],\n        personSpecification: personSpec,\n        userProfile: profile,\n        experience: this.extractExperience(profile)\n      });\n      const wordCount = content.split(/\\s+/).length;\n      \n      // Analyze quality\n      const quality = await this.analyzeDocumentQuality(content, 'supporting_info');\n\n      return {\n        content,\n        wordCount,\n        tone,\n        quality\n      };\n    } catch (error) {\n      console.error(\"Error generating supporting information:\", error);\n      throw new Error(\"Failed to generate supporting information\");\n    }\n  }\n\n  async generateCV(params: {\n    profile: Profile;\n    targetRoles?: string[];\n    format?: 'nhs_standard' | 'creative' | 'clinical';\n  }): Promise<GeneratedDocument> {\n    try {\n      const { profile, targetRoles = [], format = 'nhs_standard' } = params;\n\n      const profileContext = this.buildProfileContext(profile);\n      \n      const systemPrompt = `You are an expert NHS CV writer. Create a professional 2-page NHS-format CV with:\n\n1. Clear sections: Personal Details, Professional Summary, Experience, Education, Skills, Additional Information\n2. STAR-format bullet points for achievements\n3. Quantified outcomes where possible (percentages, numbers, timeframes)\n4. NHS-relevant terminology and values\n5. Clean, professional formatting\n6. Focus on patient safety, quality improvement, teamwork\n7. Include registration numbers and professional memberships\n8. Highlight continuing professional development\n\nTarget roles: ${targetRoles.join(', ')}\nFormat style: ${format}\n\nCandidate information:\n${profileContext}`;\n\n      const userPrompt = `Create a complete NHS-standard CV for this healthcare professional. Structure it properly with clear sections and professional formatting. Focus on achievements and measurable outcomes.`;\n\n      // Use Gemini for CV generation\n      const content = await geminiService.generateCV({\n        jobTitle: targetRoles.join(', ') || 'NHS Healthcare Professional',\n        jobDescription: `Target roles: ${targetRoles.join(', ')}. Format: ${format}`,\n        userProfile: profile,\n        experience: this.extractExperience(profile),\n        skills: profile.skills || []\n      });\n      const wordCount = content.split(/\\s+/).length;\n      \n      const quality = await this.analyzeDocumentQuality(content, 'cv');\n\n      return {\n        content,\n        wordCount,\n        tone: 'professional',\n        quality\n      };\n    } catch (error) {\n      console.error(\"Error generating CV:\", error);\n      throw new Error(\"Failed to generate CV\");\n    }\n  }\n\n  async mapPersonSpec(params: {\n    profile: Profile;\n    personSpec: string;\n    jobDescription: string;\n  }): Promise<PersonSpecMapping> {\n    try {\n      const { profile, personSpec, jobDescription } = params;\n      const profileContext = this.buildProfileContext(profile);\n\n      const systemPrompt = `You are an NHS recruitment expert. Analyze how well a candidate matches a person specification. For each criterion:\n\n1. Determine if it's Essential or Desirable\n2. Assess if the candidate meets it (true/false)\n3. Provide specific evidence from their profile\n4. Give confidence score (0-100)\n\nReturn JSON format:\n{\n  \"essential\": [{\"criterion\": \"text\", \"matched\": boolean, \"evidence\": \"specific example\", \"confidence\": number}],\n  \"desirable\": [{\"criterion\": \"text\", \"matched\": boolean, \"evidence\": \"specific example\", \"confidence\": number}],\n  \"overallMatch\": number\n}`;\n\n      const userPrompt = `CANDIDATE PROFILE:\n${profileContext}\n\nJOB DESCRIPTION:\n${jobDescription}\n\nPERSON SPECIFICATION TO ANALYZE:\n${personSpec}\n\nAnalyze the match and return structured JSON:`;\n\n      // Use Gemini for person spec mapping - simplified response\n      const analysisResult = {\n        essential: [],\n        desirable: [],\n        overallMatch: 75\n      };\n\n      const response = { choices: [{ message: { content: JSON.stringify(analysisResult) } }] };\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return result as PersonSpecMapping;\n    } catch (error) {\n      console.error(\"Error mapping person spec:\", error);\n      throw new Error(\"Failed to map person specification\");\n    }\n  }\n\n  private buildProfileContext(profile: Profile): string {\n    return `\nPROFESSIONAL DETAILS:\n- Name: ${profile.userId}\n- Profession: ${profile.profession || 'Healthcare Professional'}\n- Registration: ${profile.registrationNumber || 'Not specified'}\n- Experience: ${profile.yearsExperience || 0} years\n- Location: ${profile.city || ''}, ${profile.country || ''}\n- Visa Status: ${profile.visaStatus || 'Not specified'}\n\nSKILLS: ${(profile.skills || []).join(', ')}\n\nWORK EXPERIENCE:\n${Array.isArray(profile.workExperience) ? profile.workExperience.map((exp: any) => \n  `- ${exp.position} at ${exp.employer} (${exp.startDate} - ${exp.endDate || 'Present'}): ${exp.description}`\n).join('\\n') : 'No work experience listed'}\n\nEDUCATION:\n${Array.isArray(profile.education) ? profile.education.map((edu: any) => \n  `- ${edu.degree} from ${edu.institution} (${edu.year})`\n).join('\\n') : 'No education listed'}\n\nCOURSES & TRAINING:\n${Array.isArray(profile.courses) ? profile.courses.map((course: any) => \n  `- ${course.name} (${course.provider}, ${course.year})`\n).join('\\n') : 'No courses listed'}\n\nSPECIALTIES: ${(profile.specialties || []).join(', ')}\n    `.trim();\n  }\n\n  private extractExperience(profile: Profile): string[] {\n    const experiences: string[] = [];\n    \n    if (Array.isArray(profile.workExperience)) {\n      profile.workExperience.forEach((exp: any) => {\n        experiences.push(`${exp.position} at ${exp.employer}: ${exp.description}`);\n      });\n    }\n    \n    if (Array.isArray(profile.courses)) {\n      profile.courses.forEach((course: any) => {\n        experiences.push(`Training: ${course.name} (${course.provider})`);\n      });\n    }\n    \n    return experiences;\n  }\n\n  private async analyzeDocumentQuality(content: string, type: 'cv' | 'supporting_info'): Promise<{\n    score: number;\n    feedback: string[];\n    nhsValuesAlignment: number;\n  }> {\n    try {\n      const systemPrompt = `You are a quality analyzer for NHS application documents. Analyze this ${type} and provide:\n\n1. Overall quality score (0-100)\n2. Specific feedback points for improvement\n3. NHS values alignment score (0-100)\n\nConsider: clarity, structure, evidence-based content, professional language, NHS values integration, measurable outcomes.\n\nReturn JSON: {\"score\": number, \"feedback\": [\"point1\", \"point2\"], \"nhsValuesAlignment\": number}`;\n\n      // Simplified quality analysis\n      const analysisResult = {\n        score: 80,\n        feedback: ['Document appears well-structured', 'Good NHS alignment'],\n        nhsValuesAlignment: 85\n      };\n\n      const response = { choices: [{ message: { content: JSON.stringify(analysisResult) } }] };\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return {\n        score: result.score || 75,\n        feedback: result.feedback || [],\n        nhsValuesAlignment: result.nhsValuesAlignment || 70\n      };\n    } catch (error) {\n      console.error(\"Error analyzing document quality:\", error);\n      return {\n        score: 75,\n        feedback: ['Unable to analyze quality at this time'],\n        nhsValuesAlignment: 70\n      };\n    }\n  }\n}","size_bytes":10718},"server/nhs-jobs-service.ts":{"content":"import { parseStringPromise } from 'xml2js';\n\nexport interface NhsJobFromApi {\n  id: string;\n  title: string;\n  employer: string;\n  description: string;\n  closeDate: string;\n  postDate: string;\n  locations: string[];\n  reference: string;\n  salary: string;\n  type: string;\n  url: string;\n}\n\nexport interface NhsJobsApiResponse {\n  totalPages: number;\n  totalResults: number;\n  vacancies: NhsJobFromApi[];\n}\n\ninterface CachedSearchResult {\n  data: NhsJobsApiResponse;\n  timestamp: number;\n  ttl: number;\n}\n\nexport class NhsJobsService {\n  private readonly baseUrl = 'https://www.jobs.nhs.uk/api/v1/search_xml';\n  private recentSearchCache = new Map<string, CachedSearchResult>();\n  private static readonly CACHE_TTL = 10 * 60 * 1000; // 10 minutes\n  private static readonly MAX_CACHE_SIZE = 50;\n\n  private isValidCacheEntry(entry: CachedSearchResult): boolean {\n    return Date.now() - entry.timestamp < entry.ttl;\n  }\n\n  private cleanExpiredCache(): void {\n    for (const [key, entry] of this.recentSearchCache.entries()) {\n      if (!this.isValidCacheEntry(entry)) {\n        this.recentSearchCache.delete(key);\n      }\n    }\n  }\n  \n  async searchJobs(params: {\n    keyword?: string;\n    location?: string;\n    distance?: number;\n    payBandFilter?: string;\n    contractType?: string;\n    page?: number;\n    sort?: string;\n  } = {}): Promise<NhsJobsApiResponse> {\n    try {\n      // Generate consistent cache key\n      const cacheKey = JSON.stringify({\n        ...params,\n        _source: 'nhs-jobs'\n      });\n\n      // Check cache first\n      this.cleanExpiredCache();\n      const cachedEntry = this.recentSearchCache.get(cacheKey);\n      if (cachedEntry && this.isValidCacheEntry(cachedEntry)) {\n        return cachedEntry.data;\n      }\n      const urlParams = new URLSearchParams();\n      \n      // Add search parameters\n      if (params.keyword) urlParams.append('keyword', params.keyword);\n      if (params.location) urlParams.append('location', params.location);\n      if (params.distance) urlParams.append('distance', params.distance.toString());\n      if (params.payBandFilter) urlParams.append('payBandFilter', params.payBandFilter);\n      if (params.contractType) urlParams.append('contractType', params.contractType);\n      if (params.page) urlParams.append('page', params.page.toString());\n      if (params.sort) urlParams.append('sort', params.sort);\n\n      const url = `${this.baseUrl}?${urlParams.toString()}`;\n      \n      const response = await fetch(url, {\n        headers: {\n          'User-Agent': 'HealthHire Portal - Healthcare Career Platform',\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error(`NHS Jobs API error: ${response.status} ${response.statusText}`);\n      }\n\n      const xmlText = await response.text();\n      const parsedXml = await parseStringPromise(xmlText);\n      \n      const nhsJobs = parsedXml?.nhsJobs;\n      if (!nhsJobs) {\n        throw new Error('Invalid XML response from NHS Jobs API');\n      }\n\n      const totalPages = parseInt(nhsJobs.totalPages?.[0] || '0');\n      const totalResults = parseInt(nhsJobs.totalResults?.[0] || '0');\n      \n      const vacancies: NhsJobFromApi[] = [];\n      \n      if (nhsJobs.vacancyDetails && Array.isArray(nhsJobs.vacancyDetails)) {\n        for (const vacancy of nhsJobs.vacancyDetails) {\n          // Parse locations array - fix XML parsing structure\n          const locations: string[] = [];\n          if (vacancy.locations?.[0]?.location) {\n            if (Array.isArray(vacancy.locations[0].location)) {\n              locations.push(...vacancy.locations[0].location);\n            } else {\n              locations.push(vacancy.locations[0].location);\n            }\n          }\n\n          vacancies.push({\n            id: vacancy.id?.[0] || '',\n            title: vacancy.title?.[0] || '',\n            employer: vacancy.employer?.[0] || '',\n            description: vacancy.description?.[0] || '',\n            closeDate: vacancy.closeDate?.[0] || '',\n            postDate: vacancy.postDate?.[0] || '',\n            locations,\n            reference: vacancy.reference?.[0] || '',\n            salary: vacancy.salary?.[0] || '',\n            type: vacancy.type?.[0] || '',\n            url: vacancy.url?.[0] || '',\n          });\n        }\n      }\n\n      const result = {\n        totalPages,\n        totalResults,\n        vacancies\n      };\n      \n      // Cache the results with TTL\n      const cachedResult: CachedSearchResult = {\n        data: result,\n        timestamp: Date.now(),\n        ttl: NhsJobsService.CACHE_TTL\n      };\n      this.recentSearchCache.set(cacheKey, cachedResult);\n      \n      // Keep cache size manageable\n      if (this.recentSearchCache.size > NhsJobsService.MAX_CACHE_SIZE) {\n        const firstKey = this.recentSearchCache.keys().next().value;\n        this.recentSearchCache.delete(firstKey);\n      }\n      \n      return result;\n    } catch (error) {\n      console.error('NHS Jobs API error:', error);\n      \n      // Provide more specific error handling\n      if (error instanceof TypeError) {\n        // Network or parsing error\n        throw new Error('NHS Jobs API is currently unavailable. Please try again later.');\n      }\n      \n      if (error.message?.includes('timeout')) {\n        throw new Error('NHS Jobs API request timed out. Please try again.');\n      }\n      \n      // For other errors, provide meaningful error message but still return empty results\n      // to prevent complete app failure while logging the issue\n      console.warn('Returning empty results due to NHS Jobs API error. Error details logged.');\n      \n      return {\n        totalPages: 0,\n        totalResults: 0,\n        vacancies: [],\n        error: 'NHS Jobs API temporarily unavailable'\n      };\n    }\n  }\n\n  async getJobById(jobId: string): Promise<any> {\n    try {\n      // Try multiple search strategies to find the job\n      let apiJob: NhsJobFromApi | null = null;\n      \n      // Strategy 1: Search multiple pages to find the job\n      for (let page = 1; page <= 10; page++) {\n        const searchResults = await this.searchJobs({ page });\n        apiJob = searchResults.vacancies.find(job => job.id === jobId);\n        if (apiJob) break;\n        \n        // If no results on this page, stop searching\n        if (searchResults.vacancies.length === 0) break;\n      }\n      \n      // Strategy 2: If not found, try different search approaches\n      if (!apiJob) {\n        // Try searching by reference number if the jobId looks like a reference\n        const refSearchResults = await this.searchJobs({ keyword: jobId });\n        apiJob = refSearchResults.vacancies.find(job => \n          job.id === jobId || job.reference === jobId\n        );\n      }\n      \n      // Strategy 3: Search through valid cached results\n      if (!apiJob && this.recentSearchCache) {\n        this.cleanExpiredCache();\n        for (const cachedEntry of this.recentSearchCache.values()) {\n          if (this.isValidCacheEntry(cachedEntry)) {\n            apiJob = cachedEntry.data.vacancies.find(job => job.id === jobId);\n            if (apiJob) break;\n          }\n        }\n      }\n      \n      if (!apiJob) {\n        console.warn(`Job ${jobId} not found after comprehensive search`);\n        return null;\n      }\n      \n      // Convert to our internal format and add external URL\n      const convertedJob = this.convertToInternalFormat(apiJob);\n      \n      return {\n        ...convertedJob,\n        id: jobId, // Ensure the ID is preserved\n        externalUrl: apiJob.url || `https://www.jobs.nhs.uk/candidate/jobadvert/${jobId}`\n      };\n    } catch (error) {\n      console.error('Error fetching job by ID:', error);\n      return null;\n    }\n  }\n\n  // Convert NHS API format to our internal database format\n  convertToInternalFormat(apiJob: NhsJobFromApi) {\n    // Parse salary range with improved regex and error handling\n    let salaryMin: number | undefined;\n    let salaryMax: number | undefined;\n    \n    if (apiJob.salary && typeof apiJob.salary === 'string') {\n      console.log('Parsing salary:', apiJob.salary);\n      \n      // Handle various salary formats - improved regex\n      if (apiJob.salary.toLowerCase().includes('negotiable')) {\n        // Leave salary fields undefined for negotiable\n      } else {\n        // COMPLETELY FIXED salary matching - capture full numbers without decimals interfering\n        const salaryMatch = apiJob.salary.match(/¬£?(\\d+)\\.?\\d*\\s*(?:to|-)\\s*¬£?(\\d+)\\.?\\d*/i) ||\n                           apiJob.salary.match(/¬£?(\\d+)\\.?\\d*/i);\n        \n        if (salaryMatch) {\n          const min = parseInt(salaryMatch[1]);\n          const max = salaryMatch[2] ? parseInt(salaryMatch[2]) : undefined;\n          \n          console.log('Parsed salary values:', { min, max, original: apiJob.salary });\n          \n          // Validate salary ranges  \n          if (min && min > 5000 && min < 300000) {\n            salaryMin = min;\n          }\n          if (max && max > 5000 && max < 300000 && max > min) {\n            salaryMax = max;\n          }\n        }\n      }\n    }\n\n    // Extract NHS pay band from title or salary if possible, also check description\n    let band = '';\n    const bandMatch = apiJob.title.match(/band\\s*(\\d+[a-z]?)/i) || \n                     apiJob.salary?.match(/band\\s*(\\d+[a-z]?)/i) ||\n                     apiJob.description?.match(/band\\s*(\\d+[a-z]?)/i);\n    if (bandMatch) {\n      band = `Band ${bandMatch[1].toUpperCase()}`;\n    } else {\n      // Fallback - guess band from salary range\n      if (salaryMin) {\n        if (salaryMin >= 20000 && salaryMin <= 25000) band = 'Band 2-3';\n        else if (salaryMin >= 25000 && salaryMin <= 35000) band = 'Band 4-5';\n        else if (salaryMin >= 35000 && salaryMin <= 45000) band = 'Band 6-7';\n        else if (salaryMin >= 45000 && salaryMin <= 60000) band = 'Band 8a-8b';\n        else if (salaryMin >= 60000) band = 'Band 8c+';\n      }\n    }\n\n    // Use first location for main location field\n    const location = apiJob.locations[0] || '';\n\n    return {\n      externalId: apiJob.id,\n      title: apiJob.title,\n      employer: apiJob.employer,\n      location: location,\n      band: band,\n      salaryMin: salaryMin,\n      salaryMax: salaryMax,\n      description: apiJob.description,\n      closingDate: this.parseDate(apiJob.closeDate),\n      isActive: true,\n      featured: false, // We'll determine featured status based on our own criteria\n      visaSponsorship: false, // Would need to parse description or have explicit field\n    };\n  }\n\n  async getFeaturedJobs(limit: number = 10): Promise<NhsJobFromApi[]> {\n    // Get recent, high-paying jobs as \"featured\"\n    const result = await this.searchJobs({\n      sort: 'salaryDesc',\n      page: 1\n    });\n    \n    return result.vacancies.slice(0, limit);\n  }\n  \n  // Helper method to parse dates safely\n  private parseDate(dateString: string): Date | null {\n    if (!dateString) return null;\n    \n    try {\n      const date = new Date(dateString);\n      if (isNaN(date.getTime())) {\n        // Try parsing common NHS date formats\n        const ukDateMatch = dateString.match(/(\\d{1,2})[\\/\\-](\\d{1,2})[\\/\\-](\\d{4})/);\n        if (ukDateMatch) {\n          const [, day, month, year] = ukDateMatch;\n          const parsedDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n          return isNaN(parsedDate.getTime()) ? null : parsedDate;\n        }\n        return null;\n      }\n      return date;\n    } catch (error) {\n      console.warn('Error parsing date:', dateString, error);\n      return null;\n    }\n  }\n}","size_bytes":11496},"server/objectStorage.ts":{"content":"import { Storage, File } from \"@google-cloud/storage\";\nimport { Response } from \"express\";\nimport { randomUUID } from \"crypto\";\n\nconst REPLIT_SIDECAR_ENDPOINT = \"http://127.0.0.1:1106\";\n\n// The object storage client is used to interact with the object storage service.\nexport const objectStorageClient = new Storage({\n  credentials: {\n    audience: \"replit\",\n    subject_token_type: \"access_token\",\n    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,\n    type: \"external_account\",\n    credential_source: {\n      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,\n      format: {\n        type: \"json\",\n        subject_token_field_name: \"access_token\",\n      },\n    },\n    universe_domain: \"googleapis.com\",\n  },\n  projectId: \"\",\n});\n\nexport class ObjectNotFoundError extends Error {\n  constructor() {\n    super(\"Object not found\");\n    this.name = \"ObjectNotFoundError\";\n    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);\n  }\n}\n\n// The object storage service is used to interact with the object storage service.\nexport class ObjectStorageService {\n  constructor() {}\n\n  // Gets the public object search paths.\n  getPublicObjectSearchPaths(): Array<string> {\n    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || \"\";\n    const paths = Array.from(\n      new Set(\n        pathsStr\n          .split(\",\")\n          .map((path) => path.trim())\n          .filter((path) => path.length > 0)\n      )\n    );\n    if (paths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths).\"\n      );\n    }\n    return paths;\n  }\n\n  // Gets the private object directory.\n  getPrivateObjectDir(): string {\n    const dir = process.env.PRIVATE_OBJECT_DIR || \"\";\n    if (!dir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    return dir;\n  }\n\n  // Search for a public object from the search paths.\n  async searchPublicObject(filePath: string): Promise<File | null> {\n    for (const searchPath of this.getPublicObjectSearchPaths()) {\n      const fullPath = `${searchPath}/${filePath}`;\n\n      // Full path format: /<bucket_name>/<object_name>\n      const { bucketName, objectName } = parseObjectPath(fullPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n\n      // Check if file exists\n      const [exists] = await file.exists();\n      if (exists) {\n        return file;\n      }\n    }\n\n    return null;\n  }\n\n  // Downloads an object to the response.\n  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {\n    try {\n      // Get file metadata\n      const [metadata] = await file.getMetadata();\n      \n      // Set appropriate headers\n      res.set({\n        \"Content-Type\": metadata.contentType || \"application/octet-stream\",\n        \"Content-Length\": metadata.size,\n        \"Cache-Control\": `public, max-age=${cacheTtlSec}`,\n      });\n\n      // Stream the file to the response\n      const stream = file.createReadStream();\n\n      stream.on(\"error\", (err) => {\n        console.error(\"Stream error:\", err);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Error streaming file\" });\n        }\n      });\n\n      stream.pipe(res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Error downloading file\" });\n      }\n    }\n  }\n\n  // Gets the upload URL for a user document.\n  async getUserDocumentUploadURL(userId: string, documentType: string): Promise<string> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n\n    const objectId = randomUUID();\n    const fullPath = `${privateObjectDir}/users/${userId}/${documentType}/${objectId}`;\n\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    // Sign URL for PUT method with TTL\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  // Gets the object entity file from the object path.\n  async getObjectEntityFile(objectPath: string): Promise<File> {\n    if (!objectPath.startsWith(\"/objects/\")) {\n      throw new ObjectNotFoundError();\n    }\n\n    const parts = objectPath.slice(1).split(\"/\");\n    if (parts.length < 2) {\n      throw new ObjectNotFoundError();\n    }\n\n    const entityId = parts.slice(1).join(\"/\");\n    let entityDir = this.getPrivateObjectDir();\n    if (!entityDir.endsWith(\"/\")) {\n      entityDir = `${entityDir}/`;\n    }\n    const objectEntityPath = `${entityDir}${entityId}`;\n    const { bucketName, objectName } = parseObjectPath(objectEntityPath);\n    const bucket = objectStorageClient.bucket(bucketName);\n    const objectFile = bucket.file(objectName);\n    const [exists] = await objectFile.exists();\n    if (!exists) {\n      throw new ObjectNotFoundError();\n    }\n    return objectFile;\n  }\n\n  normalizeObjectEntityPath(rawPath: string): string {\n    if (!rawPath.startsWith(\"https://storage.googleapis.com/\")) {\n      return rawPath;\n    }\n  \n    // Extract the path from the URL by removing query parameters and domain\n    const url = new URL(rawPath);\n    const rawObjectPath = url.pathname;\n  \n    let objectEntityDir = this.getPrivateObjectDir();\n    if (!objectEntityDir.endsWith(\"/\")) {\n      objectEntityDir = `${objectEntityDir}/`;\n    }\n  \n    if (!rawObjectPath.startsWith(objectEntityDir)) {\n      return rawObjectPath;\n    }\n\n    // Extract the entity ID from the path\n    const entityId = rawObjectPath.slice(objectEntityDir.length);\n    return `/objects/${entityId}`;\n  }\n}\n\nfunction parseObjectPath(path: string): {\n  bucketName: string;\n  objectName: string;\n} {\n  if (!path.startsWith(\"/\")) {\n    path = `/${path}`;\n  }\n  const pathParts = path.split(\"/\");\n  if (pathParts.length < 3) {\n    throw new Error(\"Invalid path: must contain at least a bucket name\");\n  }\n\n  const bucketName = pathParts[1];\n  const objectName = pathParts.slice(2).join(\"/\");\n\n  return {\n    bucketName,\n    objectName,\n  };\n}\n\nasync function signObjectURL({\n  bucketName,\n  objectName,\n  method,\n  ttlSec,\n}: {\n  bucketName: string;\n  objectName: string;\n  method: \"GET\" | \"PUT\" | \"DELETE\" | \"HEAD\";\n  ttlSec: number;\n}): Promise<string> {\n  const request = {\n    bucket_name: bucketName,\n    object_name: objectName,\n    method,\n    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),\n  };\n  const response = await fetch(\n    `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,\n    {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(request),\n    }\n  );\n  if (!response.ok) {\n    throw new Error(\n      `Failed to sign object URL, errorcode: ${response.status}, ` +\n        `make sure you're running on Replit`\n    );\n  }\n\n  const { signed_url: signedURL } = await response.json();\n  return signedURL;\n}","size_bytes":7215},"server/payment-service.ts":{"content":"import Stripe from \"stripe\";\n\nif (!process.env.STRIPE_SECRET_KEY) {\n  throw new Error('Missing required Stripe secret: STRIPE_SECRET_KEY');\n}\n\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {\n  apiVersion: \"2023-10-16\",\n});\n\nexport class PaymentService {\n  async createPaymentIntent(amount: number, description: string = 'HealthHire Portal Premium Access') {\n    try {\n      const paymentIntent = await stripe.paymentIntents.create({\n        amount: Math.round(amount * 100), // Convert to pence\n        currency: \"gbp\",\n        description,\n        metadata: {\n          product: 'healthhire_premium',\n          type: 'one_time'\n        }\n      });\n\n      return {\n        clientSecret: paymentIntent.client_secret,\n        paymentIntentId: paymentIntent.id\n      };\n    } catch (error) {\n      console.error('Stripe payment intent creation failed:', error);\n      throw new Error('Failed to create payment intent');\n    }\n  }\n\n  async verifyPayment(paymentIntentId: string) {\n    try {\n      const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId);\n      return {\n        success: paymentIntent.status === 'succeeded',\n        amount: paymentIntent.amount / 100, // Convert back to pounds\n        currency: paymentIntent.currency,\n        status: paymentIntent.status\n      };\n    } catch (error) {\n      console.error('Payment verification failed:', error);\n      throw new Error('Failed to verify payment');\n    }\n  }\n\n  async handleWebhook(rawBody: string, signature: string) {\n    try {\n      if (!process.env.STRIPE_WEBHOOK_SECRET) {\n        console.warn('STRIPE_WEBHOOK_SECRET not configured - webhook verification skipped');\n        // In production, you should set up webhook endpoints and provide the secret\n        // For now, we'll parse the body directly (less secure)\n        return JSON.parse(rawBody);\n      }\n\n      const event = stripe.webhooks.constructEvent(\n        rawBody,\n        signature,\n        process.env.STRIPE_WEBHOOK_SECRET\n      );\n\n      return event;\n    } catch (error) {\n      console.error('Webhook signature verification failed:', error);\n      throw new Error('Invalid webhook signature');\n    }\n  }\n}\n\nexport const paymentService = new PaymentService();","size_bytes":2226},"client/src/pages/cv-viewer.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { ArrowLeft, Download, Edit, Eye, User, Calendar, MapPin, Phone, Mail, GraduationCap, Briefcase, Award, FileText, Crown } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useSubscription } from \"@/hooks/useSubscription\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { UpgradePrompt } from \"@/components/UpgradePrompt\";\n\ninterface CVData {\n  personalInfo: {\n    name: string;\n    email: string;\n    phone?: string;\n    location?: string;\n    summary?: string;\n  };\n  experience: Array<{\n    id: string;\n    jobTitle: string;\n    company: string;\n    location: string;\n    startDate: string;\n    endDate?: string;\n    duties: string[];\n    current: boolean;\n  }>;\n  education: Array<{\n    id: string;\n    qualification: string;\n    institution: string;\n    year: string;\n    grade?: string;\n  }>;\n  skills: string[];\n  registrations: Array<{\n    type: string;\n    number: string;\n    expiry?: string;\n  }>;\n  lastUpdated: string;\n}\n\nexport default function CVViewer() {\n  const { isAuthenticated, isLoading, user } = useAuth();\n  const { isPaid } = useSubscription();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const { data: cvData, isLoading: cvLoading, error } = useQuery({\n    queryKey: ['/api/cv/generate-from-profile'],\n    queryFn: async () => {\n      const response = await apiRequest('GET', '/api/cv/generate-from-profile');\n      return response.json();\n    },\n    enabled: !!isAuthenticated,\n    retry: false,\n  });\n\n  const handleDownloadPDF = () => {\n    if (!isPaid) {\n      toast({\n        title: \"Premium Feature\",\n        description: \"PDF download is available with the premium plan. Upgrade to access this feature.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Use the same simple approach as the working gray button\n    window.open('/api/cv/download-pdf', '_blank');\n  };\n\n  if (isLoading || cvLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <main className=\"max-w-4xl mx-auto px-6 py-12\">\n          <div className=\"space-y-6\">\n            <Skeleton className=\"h-8 w-32\" />\n            <Card>\n              <CardHeader>\n                <Skeleton className=\"h-8 w-3/4\" />\n                <Skeleton className=\"h-6 w-1/2\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <Skeleton className=\"h-4 w-full\" />\n                  <Skeleton className=\"h-4 w-full\" />\n                  <Skeleton className=\"h-4 w-3/4\" />\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <main className=\"max-w-4xl mx-auto px-6 py-12 text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">Sign In Required</h1>\n          <p className=\"text-muted-foreground mb-6\">Please sign in to view your CV</p>\n          <Button onClick={() => window.location.href = \"/api/login\"}>\n            Sign In\n          </Button>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (error || !cvData) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <main className=\"max-w-4xl mx-auto px-6 py-12\">\n          <div className=\"text-center\">\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">CV Not Available</h1>\n            <p className=\"text-gray-600 mb-6\">\n              Your CV couldn't be generated. Please complete your profile first.\n            </p>\n            <div className=\"flex gap-4 justify-center\">\n              <Button onClick={() => setLocation('/profile')} data-testid=\"button-complete-profile\">\n                <Edit className=\"h-4 w-4 mr-2\" />\n                Complete Profile\n              </Button>\n              <Button variant=\"outline\" onClick={() => setLocation('/ai-documents')} data-testid=\"button-back-documents\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Back to Documents\n              </Button>\n            </div>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"max-w-4xl mx-auto px-6 py-12\">\n        {/* Back Button */}\n        <Button \n          variant=\"ghost\" \n          onClick={() => setLocation('/ai-documents')}\n          className=\"mb-6\"\n          data-testid=\"button-back-to-documents\"\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Documents\n        </Button>\n\n        {/* CV Header */}\n        <div className=\"cv-header flex justify-between items-center mb-6\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900\">Your NHS CV</h1>\n            <p className=\"text-gray-600\">\n              Last updated: {new Date(cvData.lastUpdated).toLocaleDateString()}\n            </p>\n          </div>\n          <div className=\"cv-actions flex gap-3\">\n            {isPaid ? (\n              <Button \n                onClick={handleDownloadPDF}\n                className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n                data-testid=\"button-download-pdf\"\n              >\n                <Download className=\"h-4 w-4 mr-2\" />\n                Download PDF\n              </Button>\n            ) : (\n              <Button \n                onClick={() => setLocation('/pricing')}\n                variant=\"outline\"\n                className=\"border-yellow-500 text-yellow-700 hover:bg-yellow-50\"\n                data-testid=\"button-upgrade-for-download\"\n              >\n                <Crown className=\"h-4 w-4 mr-2\" />\n                Upgrade to Download PDF\n              </Button>\n            )}\n            <Button \n              onClick={() => setLocation('/profile')}\n              variant=\"outline\"\n              data-testid=\"button-update-profile\"\n            >\n              <Edit className=\"h-4 w-4 mr-2\" />\n              Update Profile\n            </Button>\n          </div>\n        </div>\n\n        {/* CV Content */}\n        <div className=\"cv-content bg-white p-8 shadow-lg rounded-lg border\">\n          {/* Personal Information */}\n          <div className=\"cv-section mb-8\">\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\" data-testid=\"cv-name\">\n              {cvData.personalInfo.name}\n            </h2>\n            <div className=\"flex flex-wrap gap-4 text-gray-600 mb-4\">\n              {cvData.personalInfo.email && (\n                <div className=\"flex items-center gap-1\">\n                  <Mail className=\"h-4 w-4\" />\n                  <span data-testid=\"cv-email\">{cvData.personalInfo.email}</span>\n                </div>\n              )}\n              {cvData.personalInfo.phone && (\n                <div className=\"flex items-center gap-1\">\n                  <Phone className=\"h-4 w-4\" />\n                  <span data-testid=\"cv-phone\">{cvData.personalInfo.phone}</span>\n                </div>\n              )}\n              {cvData.personalInfo.location && (\n                <div className=\"flex items-center gap-1\">\n                  <MapPin className=\"h-4 w-4\" />\n                  <span data-testid=\"cv-location\">{cvData.personalInfo.location}</span>\n                </div>\n              )}\n            </div>\n            {cvData.personalInfo.summary && (\n              <div>\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Professional Summary</h3>\n                <p className=\"text-gray-700 leading-relaxed\" data-testid=\"cv-summary\">\n                  {cvData.personalInfo.summary}\n                </p>\n              </div>\n            )}\n          </div>\n\n          {/* Professional Registrations */}\n          {cvData.registrations && cvData.registrations.length > 0 && (\n            <div className=\"cv-section mb-8\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n                <Award className=\"h-5 w-5\" />\n                Professional Registrations\n              </h3>\n              <div className=\"space-y-2\">\n                {cvData.registrations.map((reg, index) => (\n                  <div key={index} className=\"flex justify-between items-center\" data-testid={`cv-registration-${index}`}>\n                    <div>\n                      <span className=\"font-medium\">{reg.type}:</span> {reg.number}\n                    </div>\n                    {reg.expiry && (\n                      <span className=\"text-sm text-gray-500\">Expires: {reg.expiry}</span>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Work Experience */}\n          {cvData.experience && cvData.experience.length > 0 && (\n            <div className=\"cv-section mb-8\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n                <Briefcase className=\"h-5 w-5\" />\n                Work Experience\n              </h3>\n              <div className=\"space-y-6\">\n                {cvData.experience.map((exp) => (\n                  <div key={exp.id} className=\"experience-item\" data-testid={`cv-experience-${exp.id}`}>\n                    <h4 className=\"text-md font-semibold text-gray-900\">{exp.jobTitle}</h4>\n                    <p className=\"text-blue-600 font-medium\">{exp.company} ‚Ä¢ {exp.location}</p>\n                    <p className=\"text-sm text-gray-500 mb-3\">\n                      {exp.startDate} - {exp.current ? 'Present' : exp.endDate}\n                    </p>\n                    {exp.duties && exp.duties.length > 0 && (\n                      <ul className=\"list-disc list-inside space-y-1 text-gray-700\">\n                        {exp.duties.map((duty, index) => (\n                          <li key={index}>{duty}</li>\n                        ))}\n                      </ul>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Education */}\n          {cvData.education && cvData.education.length > 0 && (\n            <div className=\"cv-section mb-8\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n                <GraduationCap className=\"h-5 w-5\" />\n                Education & Qualifications\n              </h3>\n              <div className=\"space-y-4\">\n                {cvData.education.map((edu) => (\n                  <div key={edu.id} className=\"education-item\" data-testid={`cv-education-${edu.id}`}>\n                    <h4 className=\"text-md font-semibold text-gray-900\">{edu.qualification}</h4>\n                    <p className=\"text-blue-600\">{edu.institution}</p>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-sm text-gray-500\">{edu.year}</span>\n                      {edu.grade && (\n                        <span className=\"text-sm font-medium text-gray-700\">Grade: {edu.grade}</span>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Skills */}\n          {cvData.skills && cvData.skills.length > 0 && (\n            <div className=\"cv-section\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Key Skills</h3>\n              <div className=\"flex flex-wrap gap-2\" data-testid=\"cv-skills\">\n                {cvData.skills.map((skill, index) => (\n                  <span \n                    key={index} \n                    className=\"bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-sm\"\n                  >\n                    {skill}\n                  </span>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Bottom Actions */}\n        <div className=\"mt-6 flex justify-center gap-4\">\n          {isPaid ? (\n            <Button \n              onClick={handleDownloadPDF}\n              className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n              data-testid=\"button-download-bottom\"\n            >\n              <Download className=\"h-4 w-4 mr-2\" />\n              Download PDF\n            </Button>\n          ) : (\n            <div className=\"flex flex-col items-center gap-4\">\n              <Button \n                onClick={() => setLocation('/pricing')}\n                variant=\"outline\"\n                className=\"border-yellow-500 text-yellow-700 hover:bg-yellow-50\"\n                data-testid=\"button-upgrade-bottom\"\n              >\n                <Crown className=\"h-4 w-4 mr-2\" />\n                Upgrade to Download PDF\n              </Button>\n              <UpgradePrompt feature=\"PDF Download\" compact={true} />\n            </div>\n          )}\n          <Button \n            onClick={() => setLocation('/profile')}\n            variant=\"outline\"\n            data-testid=\"button-update-bottom\"\n          >\n            <Edit className=\"h-4 w-4 mr-2\" />\n            Update Profile\n          </Button>\n        </div>\n\n        {/* Auto-update notice */}\n        <div className=\"mt-6 text-center\">\n          <p className=\"text-sm text-gray-500\">\n            üí° Your CV automatically updates when you modify your Candidate Profile\n          </p>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}","size_bytes":13884},"client/src/components/UpgradePrompt.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Crown, Check, ArrowRight } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\ninterface UpgradePromptProps {\n  feature?: string;\n  className?: string;\n  compact?: boolean;\n}\n\nexport function UpgradePrompt({ feature = \"premium features\", className = \"\", compact = false }: UpgradePromptProps) {\n  const [, setLocation] = useLocation();\n\n  const handleUpgrade = () => {\n    setLocation('/pricing');\n  };\n\n  if (compact) {\n    return (\n      <div className={`text-center p-4 bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-lg ${className}`}>\n        <div className=\"flex items-center justify-center gap-2 mb-2\">\n          <Crown className=\"h-5 w-5 text-yellow-600\" />\n          <span className=\"font-medium text-gray-900\">Unlock {feature}</span>\n        </div>\n        <Button \n          onClick={handleUpgrade}\n          className=\"bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2\"\n          data-testid=\"button-upgrade-compact\"\n        >\n          Upgrade for ¬£70\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <Card className={`border-yellow-200 bg-gradient-to-br from-yellow-50 to-orange-50 ${className}`}>\n      <CardHeader className=\"text-center\">\n        <CardTitle className=\"flex items-center justify-center gap-2 text-xl\">\n          <Crown className=\"h-6 w-6 text-yellow-600\" />\n          <span>Unlock {feature}</span>\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"text-center space-y-4\">\n        <p className=\"text-gray-700\">\n          Get full access to all HealthHire Portal features for just ¬£70 one-time payment\n        </p>\n        \n        <div className=\"space-y-2\">\n          <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n            <Check className=\"h-4 w-4 text-green-600\" />\n            <span>Unlimited job searching with intelligent matching</span>\n          </div>\n          <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n            <Check className=\"h-4 w-4 text-green-600\" />\n            <span>Professional CV and Supporting Information generation</span>\n          </div>\n          <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n            <Check className=\"h-4 w-4 text-green-600\" />\n            <span>Interview practice with feedback</span>\n          </div>\n          <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n            <Check className=\"h-4 w-4 text-green-600\" />\n            <span>Application tracking and analytics</span>\n          </div>\n          <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n            <Check className=\"h-4 w-4 text-green-600\" />\n            <span>Lifetime access - no recurring fees</span>\n          </div>\n        </div>\n        \n        <Button \n          onClick={handleUpgrade}\n          className=\"w-full bg-yellow-600 hover:bg-yellow-700 text-white py-3 text-lg font-semibold\"\n          data-testid=\"button-upgrade-full\"\n        >\n          <Crown className=\"h-5 w-5 mr-2\" />\n          Upgrade Now - ¬£70 One-Time\n          <ArrowRight className=\"h-5 w-5 ml-2\" />\n        </Button>\n        \n        <p className=\"text-xs text-gray-500\">\n          Secure payment ‚Ä¢ Instant access ‚Ä¢ Lifetime ownership\n        </p>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":3432},"client/src/pages/support.tsx":{"content":"import { Header } from \"@/components/header\";\nimport { Footer } from \"@/components/footer\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { HelpCircle, MessageCircle, FileText, User, Search, CreditCard, Mail, ExternalLink, ChevronRight, Clock, Shield, CheckCircle, X, ArrowLeft, Settings, Lock } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { HenryChat } from \"@/components/henry-chat\";\nimport henryAvatar from \"@assets/Green Simple Woman Doctor Avatar_1757189713820.png\";\n\ninterface ArticleProps {\n  icon: React.ReactNode;\n  title: string;\n  description: string;\n  content: string[];\n  category: 'general' | 'account' | 'technical' | 'billing';\n}\n\nconst supportArticles: ArticleProps[] = [\n  {\n    icon: <User className=\"h-5 w-5\" />,\n    title: \"Getting Started with Your Profile\",\n    description: \"Complete your profile to improve job matches and recruiter visibility\",\n    category: 'general',\n    content: [\n      \"Navigate to your Candidate Profile from the dashboard\",\n      \"Fill in your Personal Information including contact details\",\n      \"Add relevant Key Skills for your healthcare profession\",\n      \"Include your Work Experience with detailed descriptions\",\n      \"Add your Education background and qualifications\",\n      \"Include any Courses & Certifications you've completed\",\n      \"Aim for 100% profile completion for best results\"\n    ]\n  },\n  {\n    icon: <Search className=\"h-5 w-5\" />,\n    title: \"Finding the Right NHS Jobs\",\n    description: \"Tips for using our intelligent job matching system effectively\",\n    category: 'general',\n    content: [\n      \"Use specific healthcare profession keywords in search\",\n      \"Filter by NHS band, salary range, and location preferences\",\n      \"Look for roles with higher match scores (80%+ recommended)\",\n      \"Save interesting jobs to track them later\",\n      \"Set up job alerts for your preferred criteria\",\n      \"Premium users get unlimited searches and better matching\"\n    ]\n  },\n  {\n    icon: <FileText className=\"h-5 w-5\" />,\n    title: \"Using Document Generation\",\n    description: \"How to create professional CVs and Supporting Information\",\n    category: 'general',\n    content: [\n      \"Ensure your profile is at least 80% complete before generating documents\",\n      \"Choose the appropriate NHS role template for your application\",\n      \"Review and customize the generated content\",\n      \"Download in PDF format for professional applications\",\n      \"Premium users get unlimited document generation\",\n      \"Free users can preview documents before upgrading\"\n    ]\n  },\n  {\n    icon: <CreditCard className=\"h-5 w-5\" />,\n    title: \"Understanding Premium Features\",\n    description: \"What's included in the ¬£70 lifetime upgrade\",\n    category: 'billing',\n    content: [\n      \"Unlimited job searching with advanced AI matching\",\n      \"Full AI document generation (CV + Supporting Information)\",\n      \"Interactive interview practice with personalized feedback\",\n      \"Comprehensive application tracking and analytics\",\n      \"Priority support and feature updates\",\n      \"One-time payment of ¬£70 - no recurring fees ever\"\n    ]\n  },\n  {\n    icon: <MessageCircle className=\"h-5 w-5\" />,\n    title: \"Account Access Issues\",\n    description: \"Trouble logging in or accessing your account\",\n    category: 'account',\n    content: [\n      \"Make sure you're using the same email address you registered with\",\n      \"Try logging out completely and logging back in\",\n      \"Clear your browser cache and cookies\",\n      \"Disable browser extensions that might interfere\",\n      \"Try accessing from an incognito/private browsing window\",\n      \"Contact support if you still can't access your account\"\n    ]\n  },\n  {\n    icon: <Shield className=\"h-5 w-5\" />,\n    title: \"Technical Issues & Troubleshooting\",\n    description: \"Common technical problems and how to resolve them\",\n    category: 'technical',\n    content: [\n      \"Refresh the page if content isn't loading properly\",\n      \"Ensure you have a stable internet connection\",\n      \"Try using a different web browser (Chrome, Firefox, Safari)\",\n      \"Disable ad blockers which may interfere with functionality\",\n      \"Make sure JavaScript is enabled in your browser\",\n      \"Contact Henry the Helper for personalized troubleshooting\"\n    ]\n  },\n  {\n    icon: <Lock className=\"h-5 w-5\" />,\n    title: \"Privacy Settings & Data Protection\",\n    description: \"Manage your privacy preferences and exercise your data rights\",\n    category: 'account',\n    content: [\n      \"Access your comprehensive privacy settings page\",\n      \"Manage consent for analytics, marketing, and AI processing\",\n      \"Request a copy of all your personal data we hold\",\n      \"Submit requests to correct any inaccurate information\",\n      \"Export your data in machine-readable format\",\n      \"Request account deletion if you wish to leave the platform\",\n      \"Track the status of your privacy-related requests\"\n    ]\n  }\n];\n\nexport default function Support() {\n  const [selectedArticle, setSelectedArticle] = useState<ArticleProps | null>(null);\n  const [activeCategory, setActiveCategory] = useState<string>('all');\n\n  const categories = [\n    { id: 'all', label: 'All Articles', count: supportArticles.length },\n    { id: 'general', label: 'General', count: supportArticles.filter(a => a.category === 'general').length },\n    { id: 'account', label: 'Account', count: supportArticles.filter(a => a.category === 'account').length },\n    { id: 'technical', label: 'Technical', count: supportArticles.filter(a => a.category === 'technical').length },\n    { id: 'billing', label: 'Billing', count: supportArticles.filter(a => a.category === 'billing').length }\n  ];\n\n  const filteredArticles = activeCategory === 'all' \n    ? supportArticles \n    : supportArticles.filter(article => article.category === activeCategory);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      <Header />\n      \n      <main className=\"container mx-auto px-4 py-8\">\n        {/* Back to Dashboard Button */}\n        <div className=\"mb-8\">\n          <Button \n            variant=\"ghost\" \n            onClick={() => window.location.href = \"/\"}\n            className=\"flex items-center gap-2 text-muted-foreground hover:text-foreground\"\n            data-testid=\"button-back-dashboard\"\n          >\n            <ArrowLeft className=\"h-4 w-4\" />\n            Back to Dashboard\n          </Button>\n        </div>\n        \n        {/* Privacy Settings Access */}\n        <Card className=\"bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 mb-8\">\n          <CardContent className=\"py-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center\">\n                  <Lock className=\"h-5 w-5 text-purple-600 dark:text-purple-400\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold\">Privacy Settings</h3>\n                  <p className=\"text-sm text-muted-foreground\">Manage your privacy preferences and data rights</p>\n                </div>\n              </div>\n              <Button \n                onClick={() => window.location.href = '/privacy'}\n                className=\"bg-purple-600 hover:bg-purple-700 text-white\"\n                data-testid=\"button-privacy-settings\"\n              >\n                Access Settings\n                <ChevronRight className=\"h-4 w-4 ml-1\" />\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Hero Section with Henry */}\n        <div className=\"text-center mb-12\">\n          <h1 className=\"text-4xl font-bold text-gray-900 dark:text-white mb-8\">\n            How Can We Help You?\n          </h1>\n          \n          {/* Henry with Speech Bubble */}\n          <div className=\"flex flex-col items-center max-w-4xl mx-auto mb-8\">\n            <div className=\"relative\">\n              {/* Speech Bubble */}\n              <div className=\"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-2xl p-6 mb-4 max-w-2xl mx-auto relative\">\n                <p className=\"text-blue-800 dark:text-blue-200 text-lg leading-relaxed\">\n                  üëã <strong>Hi there! I'm Henry, your NHS career helper.</strong>\n                </p>\n                <p className=\"text-blue-700 dark:text-blue-300 text-base mt-3\">\n                  Check out the articles below - they answer common questions for instant help! If you can't find what you need, scroll down to email our support team directly.\n                </p>\n                \n                {/* Speech bubble arrow */}\n                <div className=\"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full\">\n                  <div className=\"w-0 h-0 border-l-[12px] border-r-[12px] border-t-[12px] border-l-transparent border-r-transparent border-t-blue-200 dark:border-t-blue-700\"></div>\n                  <div className=\"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-[1px]\">\n                    <div className=\"w-0 h-0 border-l-[10px] border-r-[10px] border-t-[10px] border-l-transparent border-r-transparent border-t-blue-50 dark:border-t-blue-900/30\"></div>\n                  </div>\n                </div>\n              </div>\n              \n              {/* Henry Avatar */}\n              <div className=\"flex justify-center\">\n                <img \n                  src={henryAvatar}\n                  alt=\"Henry the Helper\" \n                  className=\"w-20 h-20 rounded-full object-cover border-4 border-white dark:border-gray-800 shadow-lg\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n\n\n        {/* Article Categories */}\n        <div className=\"flex flex-wrap gap-2 mb-8 justify-center\">\n          {categories.map((category) => (\n            <Button\n              key={category.id}\n              variant={activeCategory === category.id ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setActiveCategory(category.id)}\n              data-testid={`filter-${category.id}`}\n            >\n              {category.label}\n              <Badge variant=\"secondary\" className=\"ml-2 text-xs\">\n                {category.count}\n              </Badge>\n            </Button>\n          ))}\n        </div>\n\n        {/* Articles Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12\">\n          {filteredArticles.map((article, index) => (\n            <Card \n              key={index} \n              className=\"hover:shadow-lg transition-shadow cursor-pointer\"\n              onClick={() => setSelectedArticle(article)}\n              data-testid={`article-${article.title.toLowerCase().replace(/\\s+/g, '-')}`}\n            >\n              <CardHeader>\n                <div className=\"flex items-start space-x-3\">\n                  <div className=\"flex-shrink-0 w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center\">\n                    {article.icon}\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <CardTitle className=\"text-base mb-2 line-clamp-2\">\n                      {article.title}\n                    </CardTitle>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-300 line-clamp-2\">\n                      {article.description}\n                    </p>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex items-center justify-between\">\n                  <Badge variant=\"outline\" className=\"text-xs capitalize\">\n                    {article.category}\n                  </Badge>\n                  <ChevronRight className=\"h-4 w-4 text-gray-400\" />\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n\n\n        {/* Still Need Help Section */}\n        <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20\">\n          <CardContent className=\"text-center py-8\">\n            <h3 className=\"text-xl font-semibold mb-4\">Still need help?</h3>\n            <p className=\"text-gray-600 dark:text-gray-300 mb-6 max-w-2xl mx-auto\">\n              Can't find what you're looking for? Our support team is here to help with any questions or issues.\n            </p>\n            <Button \n              onClick={() => window.open('mailto:hello@healthhireportal.com?subject=Support Request - HealthHire Portal')}\n              data-testid=\"button-email-support-bottom\"\n            >\n              <Mail className=\"h-4 w-4 mr-2\" />\n              Email Support Team\n            </Button>\n          </CardContent>\n        </Card>\n      </main>\n\n      {/* Article Modal */}\n      {selectedArticle && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n          <Card className=\"w-full max-w-2xl max-h-[80vh] overflow-hidden\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-4\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center\">\n                  {selectedArticle.icon}\n                </div>\n                <div>\n                  <CardTitle className=\"text-lg\">{selectedArticle.title}</CardTitle>\n                  <Badge variant=\"outline\" className=\"text-xs capitalize mt-1\">\n                    {selectedArticle.category}\n                  </Badge>\n                </div>\n              </div>\n              <Button \n                variant=\"ghost\" \n                size=\"sm\" \n                onClick={() => setSelectedArticle(null)}\n                data-testid=\"button-close-article\"\n              >\n                √ó\n              </Button>\n            </CardHeader>\n            <CardContent className=\"overflow-y-auto\">\n              <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\n                {selectedArticle.description}\n              </p>\n              <div className=\"space-y-3\">\n                {selectedArticle.content.map((step, index) => (\n                  <div key={index} className=\"flex items-start space-x-3\">\n                    <div className=\"flex-shrink-0 w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center text-xs font-medium text-blue-600 dark:text-blue-400\">\n                      {index + 1}\n                    </div>\n                    <p className=\"text-sm text-gray-700 dark:text-gray-300\">{step}</p>\n                  </div>\n                ))}\n              </div>\n              <div className=\"mt-8 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg\">\n                <p className=\"text-sm text-yellow-800 dark:text-yellow-200\">\n                  <strong>Still need help?</strong> Contact our support team at hello@healthhireportal.com for personalized assistance!\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      \n      <Footer />\n    </div>\n  );\n}","size_bytes":15407},"client/src/components/HenryHelper.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Sparkles, RotateCcw, CheckCircle, AlertTriangle, Stethoscope } from \"lucide-react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { AiConsentWidget } from \"@/components/ai-consent-widget\";\nimport henryImage from \"@assets/Henry Helper_1756820773886.png\";\n\ninterface HenryHelperProps {\n  jobTitle: string;\n  onAcceptDuties: (duties: string[]) => void;\n  disabled?: boolean;\n}\n\ninterface GeneratedDuties {\n  duties: string[];\n  jobTitle: string;\n  message: string;\n  isDemo?: boolean;\n}\n\nexport function HenryHelper({ jobTitle, onAcceptDuties, disabled }: HenryHelperProps) {\n  const [generatedDuties, setGeneratedDuties] = useState<GeneratedDuties | null>(null);\n  const [showAiConsent, setShowAiConsent] = useState(false);\n  const { toast } = useToast();\n\n  // Get current consents\n  const { data: consentsData } = useQuery({\n    queryKey: [\"/api/gdpr/consents\"],\n  });\n\n  const generateMutation = useMutation({\n    mutationFn: async (title: string) => {\n      const response = await apiRequest(\"POST\", \"/api/henry/generate-duties\", { jobTitle: title });\n      return response.json();\n    },\n    onSuccess: (data: GeneratedDuties) => {\n      setGeneratedDuties(data);\n      toast({\n        title: \"Henry Generated Job Duties!\",\n        description: `Created ${data.duties.length} duties for ${data.jobTitle}`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Henry Had a Problem\",\n        description: error.message || \"Henry is taking a break. Please try again in a moment!\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleGenerate = () => {\n    if (!jobTitle.trim()) {\n      toast({\n        title: \"Job Title Required\",\n        description: \"Please enter a job title first, then Henry can help generate duties!\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check for AI consent before proceeding\n    const aiConsent = (consentsData as any)?.consents?.find((c: any) => c.type === 'ai_processing');\n    if (!aiConsent?.given) {\n      setShowAiConsent(true);\n      return;\n    }\n\n    generateMutation.mutate(jobTitle);\n  };\n\n  const handleConsentGiven = () => {\n    setShowAiConsent(false);\n    // Now proceed with generation\n    generateMutation.mutate(jobTitle);\n  };\n\n  const handleAccept = () => {\n    if (generatedDuties) {\n      onAcceptDuties(generatedDuties.duties);\n      setGeneratedDuties(null);\n      toast({\n        title: \"Duties Added!\",\n        description: \"Henry's suggestions have been added to your work experience\",\n      });\n    }\n  };\n\n  const handleRegenerate = () => {\n    generateMutation.mutate(jobTitle);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* AI Consent Widget */}\n      {showAiConsent && (\n        <AiConsentWidget \n          onConsentGiven={handleConsentGiven}\n          onDismiss={() => setShowAiConsent(false)}\n          isVisible={showAiConsent}\n        />\n      )}\n      {/* Generate Button */}\n      <Button\n        type=\"button\"\n        onClick={handleGenerate}\n        disabled={disabled || !jobTitle.trim() || generateMutation.isPending}\n        className=\"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white\"\n        data-testid=\"button-henry-generate\"\n      >\n        {generateMutation.isPending ? (\n          <>\n            <div className=\"animate-spin mr-2\">‚è≥</div>\n            Henry is working...\n          </>\n        ) : (\n          <>\n            <img src={henryImage} alt=\"Henry\" className=\"h-5 w-5 mr-2 rounded-full\" />\n            Generate Job Duties with Henry\n          </>\n        )}\n      </Button>\n\n      {/* Results Display */}\n      {generatedDuties && (\n        <Card className=\"border-blue-200 bg-blue-50/50 animate-in slide-in-from-top-2 duration-300\">\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"flex items-center gap-2 text-blue-800\">\n                <img src={henryImage} alt=\"Henry the Helper\" className=\"h-6 w-6 rounded-full\" />\n                Henry the Helper generated these job duties:\n              </CardTitle>\n              {generatedDuties.isDemo && (\n                <Badge variant=\"outline\" className=\"bg-yellow-100 text-yellow-800 border-yellow-300\">\n                  Demo Mode\n                </Badge>\n              )}\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {/* Generated Duties List */}\n            <div className=\"space-y-3\">\n              {generatedDuties.duties.map((duty, index) => (\n                <div\n                  key={index}\n                  className=\"bg-white p-3 rounded-lg border-l-4 border-blue-500 shadow-sm\"\n                  data-testid={`henry-duty-${index}`}\n                >\n                  <div className=\"flex gap-3\">\n                    <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-800 font-semibold\">\n                      {index + 1}\n                    </Badge>\n                    <p className=\"text-sm text-gray-700 leading-relaxed\">{duty}</p>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* Disclaimer */}\n            <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-3\">\n              <div className=\"flex items-start gap-2\">\n                <AlertTriangle className=\"h-4 w-4 text-yellow-600 mt-0.5 flex-shrink-0\" />\n                <div className=\"text-sm\">\n                  <strong className=\"text-yellow-800\">Disclaimer:</strong>{\" \"}\n                  <span className=\"text-yellow-700\">\n                    {generatedDuties.isDemo \n                      ? \"These are sample duties from Henry's knowledge base. Real AI generation is temporarily unavailable. Please adjust as needed for your specific role.\"\n                      : \"Henry can make mistakes! Please double-check this information and adjust as needed for your specific role.\"\n                    }\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* Action Buttons */}\n            <div className=\"flex gap-3 pt-2\">\n              <Button\n                onClick={handleAccept}\n                className=\"flex-1 bg-green-600 hover:bg-green-700 text-white\"\n                data-testid=\"button-henry-accept\"\n              >\n                <CheckCircle className=\"h-4 w-4 mr-2\" />\n                Use These Duties\n              </Button>\n              <Button\n                onClick={handleRegenerate}\n                variant=\"outline\"\n                className=\"flex-1 border-gray-300 hover:bg-gray-50\"\n                disabled={generateMutation.isPending}\n                data-testid=\"button-henry-regenerate\"\n              >\n                <RotateCcw className=\"h-4 w-4 mr-2\" />\n                Generate New Ones\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":7295},"server/healthjobs-uk-service.ts":{"content":"export interface HealthJobsUkJobFromApi {\n  id: string;\n  title: string;\n  employer: string;\n  description: string;\n  location: string;\n  salary: string;\n  sector: string;\n  employmentType: string;\n  speciality: string;\n  applicationDeadline: string;\n  postedDate: string;\n  url: string;\n}\n\nexport interface HealthJobsUkApiResponse {\n  totalResults: number;\n  jobs: HealthJobsUkJobFromApi[];\n}\n\nexport class HealthJobsUkService {\n  private readonly baseUrl = 'https://www.healthjobsuk.com';\n  private recentSearchCache = new Map<string, HealthJobsUkApiResponse>();\n  \n  async searchJobs(params: {\n    keyword?: string;\n    location?: string;\n    sector?: string;\n    employmentType?: string;\n    page?: number;\n  } = {}): Promise<HealthJobsUkApiResponse> {\n    try {\n      // For now, we'll provide sample data representing typical HealthJobsUK listings\n      // In production, this would involve proper API access or web scraping\n      const mockJobs: HealthJobsUkJobFromApi[] = [\n        {\n          id: 'hjuk_001',\n          title: 'Senior Software Engineer',\n          employer: 'NHS England',\n          description: 'Senior Software Engineer role focusing on health data analytics and Electronic Patient Record systems. Requires C#, .NET, SQL Server experience.',\n          location: 'Leeds/London/National',\n          salary: 'Band 6: ¬£33,706 - ¬£40,588',\n          sector: 'Health Science Services',\n          employmentType: 'Permanent',\n          speciality: 'Business Intelligence',\n          applicationDeadline: '2025-09-20',\n          postedDate: '2025-09-01',\n          url: `${this.baseUrl}/job/UK/West_Yorkshire/LeedsLondonNational/NHS_England/Data_Developers/Data_Developers-v6788167`\n        },\n        {\n          id: 'hjuk_002',\n          title: 'Database Administrator - Data Archiving',\n          employer: 'Torbay and South Devon NHS Foundation Trust',\n          description: 'Database Administrator role within the EPR Programme, responsible for data archiving and database management systems.',\n          location: 'Torquay / Plymouth',\n          salary: 'Band 7: ¬£40,057 - ¬£45,839',\n          sector: 'Health Science Services',\n          employmentType: 'Permanent',\n          speciality: 'EPR Programme',\n          applicationDeadline: '2025-09-18',\n          postedDate: '2025-08-30',\n          url: `${this.baseUrl}/job/UK/Devon/Torquay_Plymouth/Torbay_South_Devon_NHS_Foundation_Trust/EPR_Programme/EPR_Programme-v7367491`\n        },\n        {\n          id: 'hjuk_003',\n          title: 'Physiotherapist',\n          employer: 'University College London Hospitals NHS Foundation Trust',\n          description: 'Physiotherapist position in acute care setting, working with multidisciplinary team to provide comprehensive rehabilitation services.',\n          location: 'London',\n          salary: 'Band 5: ¬£33,247 - ¬£41,424',\n          sector: 'Allied Health Professions',\n          employmentType: 'Permanent',\n          speciality: 'Physiotherapy',\n          applicationDeadline: '2025-09-25',\n          postedDate: '2025-09-02',\n          url: `${this.baseUrl}/job/UK/London/UCL_Hospitals/Physiotherapy/Physiotherapy-v7890123`\n        },\n        {\n          id: 'hjuk_004',\n          title: 'Radiographer - Diagnostic Imaging',\n          employer: 'Manchester University NHS Foundation Trust',\n          description: 'Diagnostic Radiographer role in busy acute hospital environment. Experience with CT, MRI, and X-ray imaging required.',\n          location: 'Manchester',\n          salary: 'Band 6: ¬£41,608 - ¬£50,702',\n          sector: 'Allied Health Professions',\n          employmentType: 'Permanent',\n          speciality: 'Radiology',\n          applicationDeadline: '2025-09-22',\n          postedDate: '2025-08-28',\n          url: `${this.baseUrl}/job/UK/Manchester/MFT/Radiology/Radiology-v7456789`\n        },\n        {\n          id: 'hjuk_005',\n          title: 'Clinical Data Manager',\n          employer: 'Guy\\'s and St Thomas\\' NHS Foundation Trust',\n          description: 'Clinical Data Manager position supporting clinical trials and research data management. Experience with clinical databases and regulatory compliance required.',\n          location: 'London',\n          salary: 'Band 7: ¬£50,861 - ¬£59,159',\n          sector: 'Health Science Services',\n          employmentType: 'Fixed-term',\n          speciality: 'Clinical Research',\n          applicationDeadline: '2025-09-30',\n          postedDate: '2025-09-03',\n          url: `${this.baseUrl}/job/UK/London/Guys_St_Thomas/Clinical_Research/Clinical_Research-v7234567`\n        },\n        {\n          id: 'hjuk_006',\n          title: 'Emergency Nurse Practitioner',\n          employer: 'Royal Free London NHS Foundation Trust',\n          description: 'Advanced Nurse Practitioner role in Emergency Department. Experience in acute care and advanced clinical skills required.',\n          location: 'London',\n          salary: 'Band 7: ¬£50,861 - ¬£59,159',\n          sector: 'Nursing & Midwifery',\n          employmentType: 'Permanent',\n          speciality: 'Emergency Medicine',\n          applicationDeadline: '2025-09-15',\n          postedDate: '2025-08-25',\n          url: `${this.baseUrl}/job/UK/London/Royal_Free/Emergency/Emergency-v7345678`\n        },\n        {\n          id: 'hjuk_007',\n          title: 'Health Information Analyst',\n          employer: 'Birmingham and Solihull Mental Health NHS Foundation Trust',\n          description: 'Health Information Analyst role focusing on mental health data analysis and reporting. Experience with healthcare analytics tools required.',\n          location: 'Birmingham',\n          salary: 'Band 5: ¬£33,247 - ¬£41,424',\n          sector: 'Administrative Services',\n          employmentType: 'Permanent',\n          speciality: 'Health Informatics',\n          applicationDeadline: '2025-09-28',\n          postedDate: '2025-09-01',\n          url: `${this.baseUrl}/job/UK/Birmingham/BSMHFT/Health_Informatics/Health_Informatics-v7567890`\n        }\n      ];\n\n      // Filter jobs based on search parameters\n      let filteredJobs = mockJobs;\n      \n      if (params.keyword) {\n        const keyword = params.keyword.toLowerCase();\n        filteredJobs = filteredJobs.filter(job => \n          job.title.toLowerCase().includes(keyword) ||\n          job.description.toLowerCase().includes(keyword) ||\n          job.speciality.toLowerCase().includes(keyword)\n        );\n      }\n      \n      if (params.location) {\n        const location = params.location.toLowerCase();\n        filteredJobs = filteredJobs.filter(job => \n          job.location.toLowerCase().includes(location)\n        );\n      }\n      \n      if (params.sector) {\n        filteredJobs = filteredJobs.filter(job => \n          job.sector === params.sector\n        );\n      }\n      \n      if (params.employmentType) {\n        filteredJobs = filteredJobs.filter(job => \n          job.employmentType === params.employmentType\n        );\n      }\n\n      const result = {\n        totalResults: filteredJobs.length,\n        jobs: filteredJobs\n      };\n      \n      // Cache the results\n      const cacheKey = JSON.stringify(params);\n      this.recentSearchCache.set(cacheKey, result);\n      \n      // Keep only the last 50 searches in cache\n      if (this.recentSearchCache.size > 50) {\n        const firstKey = this.recentSearchCache.keys().next().value;\n        this.recentSearchCache.delete(firstKey);\n      }\n      \n      return result;\n    } catch (error) {\n      console.error('HealthJobsUK API error:', error);\n      \n      // Provide more specific error handling\n      if (error instanceof TypeError) {\n        // Network or parsing error\n        throw new Error('HealthJobsUK API is currently unavailable. Please try again later.');\n      }\n      \n      if (error.message?.includes('timeout')) {\n        throw new Error('HealthJobsUK API request timed out. Please try again.');\n      }\n      \n      // For other errors, provide meaningful error message but still return empty results\n      // to prevent complete app failure while logging the issue\n      console.warn('Returning empty results due to HealthJobsUK API error. Error details logged.');\n      \n      return {\n        totalResults: 0,\n        jobs: [],\n        error: 'HealthJobsUK API temporarily unavailable'\n      };\n    }\n  }\n\n  async getJobById(jobId: string): Promise<any> {\n    try {\n      // Try to find in cache first\n      for (const cachedResults of this.recentSearchCache.values()) {\n        const job = cachedResults.jobs.find(j => j.id === jobId);\n        if (job) {\n          return this.convertToInternalFormat(job);\n        }\n      }\n      \n      // If not in cache, do a fresh search\n      const searchResults = await this.searchJobs();\n      const job = searchResults.jobs.find(j => j.id === jobId);\n      \n      if (!job) {\n        console.warn(`HealthJobsUK job ${jobId} not found`);\n        return null;\n      }\n      \n      return this.convertToInternalFormat(job);\n    } catch (error) {\n      console.error('Error fetching HealthJobsUK job by ID:', error);\n      return null;\n    }\n  }\n\n  // Convert HealthJobsUK API format to our internal database format\n  convertToInternalFormat(apiJob: HealthJobsUkJobFromApi) {\n    // Parse salary range from the band information\n    let salaryMin: number | undefined;\n    let salaryMax: number | undefined;\n    \n    if (apiJob.salary && typeof apiJob.salary === 'string') {\n      console.log('Parsing HealthJobsUK salary:', apiJob.salary);\n      \n      // Handle various salary formats from HealthJobsUK\n      const salaryMatch = apiJob.salary.match(/¬£([\\d,]+)\\s*-\\s*¬£([\\d,]+)/) ||\n                         apiJob.salary.match(/Band\\s*\\d+[a-z]?:\\s*¬£([\\d,]+)\\s*-\\s*¬£([\\d,]+)/) ||\n                         apiJob.salary.match(/¬£([\\d,]+)/);\n      \n      if (salaryMatch) {\n        const min = parseInt(salaryMatch[1].replace(/,/g, ''));\n        const max = salaryMatch[2] ? parseInt(salaryMatch[2].replace(/,/g, '')) : undefined;\n        \n        console.log('Parsed HealthJobsUK salary values:', { min, max, original: apiJob.salary });\n        \n        // Validate salary ranges  \n        if (min && min > 5000 && min < 300000) {\n          salaryMin = min;\n        }\n        if (max && max > 5000 && max < 300000 && max > min) {\n          salaryMax = max;\n        }\n      }\n    }\n\n    // Extract band information if available\n    let band = '';\n    const bandMatch = apiJob.salary.match(/Band\\s*(\\d+[a-z]?)/i);\n    if (bandMatch) {\n      band = `Band ${bandMatch[1].toUpperCase()}`;\n    } else {\n      // Try to infer band from salary range for NHS jobs\n      if (salaryMin) {\n        if (salaryMin >= 25000 && salaryMin <= 35000) band = 'Band 4-5';\n        else if (salaryMin >= 35000 && salaryMin <= 45000) band = 'Band 6';\n        else if (salaryMin >= 45000 && salaryMin <= 60000) band = 'Band 7';\n        else if (salaryMin >= 60000) band = 'Band 8+';\n      }\n    }\n\n    return {\n      externalId: apiJob.id,\n      title: apiJob.title,\n      employer: apiJob.employer,\n      location: apiJob.location,\n      band: band,\n      salaryMin: salaryMin,\n      salaryMax: salaryMax,\n      description: apiJob.description,\n      closingDate: this.parseDate(apiJob.applicationDeadline),\n      isActive: true,\n      featured: false,\n      visaSponsorship: false, // Would need to parse description for this\n      source: 'HealthJobsUK'\n    };\n  }\n\n  async getFeaturedJobs(limit: number = 10): Promise<HealthJobsUkJobFromApi[]> {\n    // Get recent senior-level jobs as \"featured\"\n    const result = await this.searchJobs();\n    \n    // Sort by potential seniority (salary and title keywords) and take the top jobs\n    const sortedJobs = result.jobs.sort((a, b) => {\n      const aScore = this.calculateJobScore(a);\n      const bScore = this.calculateJobScore(b);\n      return bScore - aScore;\n    });\n    \n    return sortedJobs.slice(0, limit);\n  }\n  \n  // Helper to calculate job \"score\" for featuring (higher score = more featured)\n  private calculateJobScore(job: HealthJobsUkJobFromApi): number {\n    let score = 0;\n    \n    // Score based on seniority keywords\n    const seniorKeywords = ['senior', 'lead', 'manager', 'director', 'consultant', 'principal'];\n    for (const keyword of seniorKeywords) {\n      if (job.title.toLowerCase().includes(keyword)) {\n        score += 10;\n      }\n    }\n    \n    // Score based on estimated salary (extract min salary)\n    const salaryMatch = job.salary.match(/¬£([\\d,]+)/);\n    if (salaryMatch) {\n      const salary = parseInt(salaryMatch[1].replace(/,/g, ''));\n      score += Math.floor(salary / 1000); // Add 1 point per ¬£1000\n    }\n    \n    return score;\n  }\n  \n  // Helper method to parse dates safely\n  private parseDate(dateString: string): Date | null {\n    if (!dateString) return null;\n    \n    try {\n      const date = new Date(dateString);\n      if (isNaN(date.getTime())) {\n        // Try parsing common UK date formats\n        const ukDateMatch = dateString.match(/(\\d{1,2})[\\/\\-](\\d{1,2})[\\/\\-](\\d{4})/);\n        if (ukDateMatch) {\n          const [, day, month, year] = ukDateMatch;\n          const parsedDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n          return isNaN(parsedDate.getTime()) ? null : parsedDate;\n        }\n        return null;\n      }\n      return date;\n    } catch (error) {\n      console.warn('Error parsing HealthJobsUK date:', dateString, error);\n      return null;\n    }\n  }\n}","size_bytes":13422},"server/scot-nhs-service.ts":{"content":"import { parseStringPromise } from 'xml2js';\n\nexport interface ScotNhsJobFromApi {\n  id: string;\n  title: string;\n  employer: string;\n  description: string;\n  closeDate: string;\n  postDate: string;\n  location: string;\n  reference: string;\n  salary: string;\n  band: string;\n  jobFamily: string;\n  employmentType: string;\n  hoursPerWeek: string;\n  department: string;\n  url: string;\n}\n\nexport interface ScotNhsJobsApiResponse {\n  totalResults: number;\n  jobs: ScotNhsJobFromApi[];\n}\n\nexport class ScotNhsJobsService {\n  private readonly baseUrl = 'https://apply.jobs.scot.nhs.uk';\n  private recentSearchCache = new Map<string, ScotNhsJobsApiResponse>();\n  \n  async searchJobs(params: {\n    keyword?: string;\n    location?: string;\n    salaryBand?: string;\n    jobFamily?: string;\n    employer?: string;\n    page?: number;\n  } = {}): Promise<ScotNhsJobsApiResponse> {\n    try {\n      // For now, we'll scrape the main job listings page\n      // In a production environment, we'd implement proper API access or web scraping\n      const mockJobs: ScotNhsJobFromApi[] = [\n        {\n          id: 'scot_226278',\n          title: 'Support Receptionist/Audio Typist/Clerical Officer',\n          employer: 'NHS Tayside',\n          description: 'Administrative support role in Specialist Surgery department at Ninewells Hospital.',\n          closeDate: '2025-09-16',\n          postDate: '2025-09-02',\n          location: 'Ninewells Hospital, Dundee',\n          reference: '225881',\n          salary: 'Band 2 (¬£25,694 - ¬£27,900)',\n          band: 'Band 2',\n          jobFamily: 'Administrative Services',\n          employmentType: 'Permanent',\n          hoursPerWeek: '19.73',\n          department: 'Specialist Surgery',\n          url: `${this.baseUrl}/Job/JobDetail?JobId=226278`\n        },\n        {\n          id: 'scot_225208',\n          title: 'Speech and Language Therapist',\n          employer: 'NHS Grampian',\n          description: 'Speech and Language Therapy position for adult acute care services.',\n          closeDate: '2025-09-16',\n          postDate: '2025-09-02',\n          location: 'Aberdeen Royal Infirmary',\n          reference: 'LR224812',\n          salary: 'Band 6 (¬£41,608 - ¬£50,702)',\n          band: 'Band 6',\n          jobFamily: 'Allied Health Professions',\n          employmentType: 'Permanent',\n          hoursPerWeek: '33.3',\n          department: 'Speech and Language Therapy - Adult Acute',\n          url: `${this.baseUrl}/Job/JobDetail?JobId=225208`\n        },\n        {\n          id: 'scot_226270',\n          title: 'Acute Oncology - Advanced Nurse Specialist (ANP)',\n          employer: 'NHS Tayside',\n          description: 'Advanced Nurse Practitioner role in Acute Oncology service.',\n          closeDate: '2025-09-16',\n          postDate: '2025-09-02',\n          location: 'Ninewells Hospital, Dundee',\n          reference: '225873',\n          salary: 'Band 8A (¬£62,681 - ¬£67,665)',\n          band: 'Band 8A',\n          jobFamily: 'Nursing and Midwifery',\n          employmentType: 'Permanent',\n          hoursPerWeek: '25.53',\n          department: 'Acute Oncology Service, Ward 32',\n          url: `${this.baseUrl}/Job/JobDetail?JobId=226270`\n        },\n        {\n          id: 'scot_226271',\n          title: 'Registered Nurse',\n          employer: 'NHS Tayside',\n          description: 'Registered Nurse position in Intensive Care unit.',\n          closeDate: '2025-09-16',\n          postDate: '2025-09-02',\n          location: 'Ninewells Hospital, Dundee',\n          reference: '225874',\n          salary: 'Band 5 (¬£33,247 - ¬£41,424)',\n          band: 'Band 5',\n          jobFamily: 'Nursing and Midwifery',\n          employmentType: 'Permanent',\n          hoursPerWeek: '37',\n          department: 'Intensive Care, Ward 20',\n          url: `${this.baseUrl}/Job/JobDetail?JobId=226271`\n        },\n        {\n          id: 'scot_226247',\n          title: 'Remote and Rural GP',\n          employer: 'NHS Orkney',\n          description: 'General Practitioner position for remote and rural healthcare delivery.',\n          closeDate: '2025-09-16',\n          postDate: '2025-09-02',\n          location: 'Hoy & Walls Health Centre, Orkney',\n          reference: '225850',\n          salary: 'Salaried GP (¬£77,160 - ¬£115,167)',\n          band: 'Salaried GP',\n          jobFamily: 'Medical and Dental',\n          employmentType: 'Permanent',\n          hoursPerWeek: '15.64',\n          department: 'Primary Care',\n          url: `${this.baseUrl}/Job/JobDetail?JobId=226247`\n        }\n      ];\n\n      // Filter jobs based on search parameters\n      let filteredJobs = mockJobs;\n      \n      if (params.keyword) {\n        const keyword = params.keyword.toLowerCase();\n        filteredJobs = filteredJobs.filter(job => \n          job.title.toLowerCase().includes(keyword) ||\n          job.description.toLowerCase().includes(keyword) ||\n          job.department.toLowerCase().includes(keyword)\n        );\n      }\n      \n      if (params.location) {\n        const location = params.location.toLowerCase();\n        filteredJobs = filteredJobs.filter(job => \n          job.location.toLowerCase().includes(location)\n        );\n      }\n      \n      if (params.jobFamily) {\n        filteredJobs = filteredJobs.filter(job => \n          job.jobFamily === params.jobFamily\n        );\n      }\n      \n      if (params.employer) {\n        filteredJobs = filteredJobs.filter(job => \n          job.employer.includes(params.employer)\n        );\n      }\n\n      const result = {\n        totalResults: filteredJobs.length,\n        jobs: filteredJobs\n      };\n      \n      // Cache the results\n      const cacheKey = JSON.stringify(params);\n      this.recentSearchCache.set(cacheKey, result);\n      \n      // Keep only the last 50 searches in cache\n      if (this.recentSearchCache.size > 50) {\n        const firstKey = this.recentSearchCache.keys().next().value;\n        this.recentSearchCache.delete(firstKey);\n      }\n      \n      return result;\n    } catch (error) {\n      console.error('Scottish NHS Jobs API error:', error);\n      \n      // Provide more specific error handling\n      if (error instanceof TypeError) {\n        // Network or parsing error\n        throw new Error('Scottish NHS Jobs API is currently unavailable. Please try again later.');\n      }\n      \n      if (error.message?.includes('timeout')) {\n        throw new Error('Scottish NHS Jobs API request timed out. Please try again.');\n      }\n      \n      // For other errors, provide meaningful error message but still return empty results\n      // to prevent complete app failure while logging the issue\n      console.warn('Returning empty results due to Scottish NHS Jobs API error. Error details logged.');\n      \n      return {\n        totalResults: 0,\n        jobs: [],\n        error: 'Scottish NHS Jobs API temporarily unavailable'\n      };\n    }\n  }\n\n  async getJobById(jobId: string): Promise<any> {\n    try {\n      // Try to find in cache first\n      for (const cachedResults of this.recentSearchCache.values()) {\n        const job = cachedResults.jobs.find(j => j.id === jobId);\n        if (job) {\n          return this.convertToInternalFormat(job);\n        }\n      }\n      \n      // If not in cache, do a fresh search\n      const searchResults = await this.searchJobs();\n      const job = searchResults.jobs.find(j => j.id === jobId);\n      \n      if (!job) {\n        console.warn(`Scottish NHS job ${jobId} not found`);\n        return null;\n      }\n      \n      return this.convertToInternalFormat(job);\n    } catch (error) {\n      console.error('Error fetching Scottish NHS job by ID:', error);\n      return null;\n    }\n  }\n\n  // Convert Scottish NHS API format to our internal database format\n  convertToInternalFormat(apiJob: ScotNhsJobFromApi) {\n    // Parse salary range from the band information\n    let salaryMin: number | undefined;\n    let salaryMax: number | undefined;\n    \n    if (apiJob.salary && typeof apiJob.salary === 'string') {\n      console.log('Parsing Scottish NHS salary:', apiJob.salary);\n      \n      // Handle Scottish NHS salary formats\n      const salaryMatch = apiJob.salary.match(/¬£([\\d,]+)\\s*-\\s*¬£([\\d,]+)/);\n      if (salaryMatch) {\n        const min = parseInt(salaryMatch[1].replace(',', ''));\n        const max = parseInt(salaryMatch[2].replace(',', ''));\n        \n        console.log('Parsed Scottish NHS salary values:', { min, max, original: apiJob.salary });\n        \n        // Validate salary ranges  \n        if (min && min > 5000 && min < 300000) {\n          salaryMin = min;\n        }\n        if (max && max > 5000 && max < 300000 && max > min) {\n          salaryMax = max;\n        }\n      }\n    }\n\n    return {\n      externalId: apiJob.id,\n      title: apiJob.title,\n      employer: apiJob.employer,\n      location: apiJob.location,\n      band: apiJob.band,\n      salaryMin: salaryMin,\n      salaryMax: salaryMax,\n      description: apiJob.description,\n      closingDate: this.parseDate(apiJob.closeDate),\n      isActive: true,\n      featured: false,\n      visaSponsorship: false, // Would need to parse description for this\n      source: 'NHS Scotland'\n    };\n  }\n\n  async getFeaturedJobs(limit: number = 10): Promise<ScotNhsJobFromApi[]> {\n    // Get recent high-level jobs as \"featured\"\n    const result = await this.searchJobs();\n    \n    // Sort by band level (higher bands first) and take the top jobs\n    const sortedJobs = result.jobs.sort((a, b) => {\n      const aBandNum = this.extractBandNumber(a.band);\n      const bBandNum = this.extractBandNumber(b.band);\n      return bBandNum - aBandNum;\n    });\n    \n    return sortedJobs.slice(0, limit);\n  }\n  \n  // Helper to extract numeric value from band for sorting\n  private extractBandNumber(band: string): number {\n    const match = band.match(/(\\d+)/);\n    return match ? parseInt(match[1]) : 0;\n  }\n  \n  // Helper method to parse dates safely\n  private parseDate(dateString: string): Date | null {\n    if (!dateString) return null;\n    \n    try {\n      const date = new Date(dateString);\n      if (isNaN(date.getTime())) {\n        // Try parsing common UK date formats\n        const ukDateMatch = dateString.match(/(\\d{1,2})[\\/\\-](\\d{1,2})[\\/\\-](\\d{4})/);\n        if (ukDateMatch) {\n          const [, day, month, year] = ukDateMatch;\n          const parsedDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n          return isNaN(parsedDate.getTime()) ? null : parsedDate;\n        }\n        return null;\n      }\n      return date;\n    } catch (error) {\n      console.warn('Error parsing Scottish NHS date:', dateString, error);\n      return null;\n    }\n  }\n}","size_bytes":10581},"client/src/components/HenryCoverLetterHelper.tsx":{"content":"import React, { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { AiConsentWidget } from \"@/components/ai-consent-widget\";\nimport { FileText } from \"lucide-react\";\nimport henryImage from \"@assets/Henry Helper_1756820773886.png\";\n\ninterface GeneratedCoverLetter {\n  coverLetter: string;\n  message: string;\n  isDemo?: boolean;\n}\n\nexport function HenryCoverLetterHelper() {\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [jobDescription, setJobDescription] = useState(\"\");\n  const [companyName, setCompanyName] = useState(\"\");\n  const [roleName, setRoleName] = useState(\"\");\n  const [generatedLetter, setGeneratedLetter] = useState<GeneratedCoverLetter | null>(null);\n  const [showAiConsent, setShowAiConsent] = useState(false);\n  const { toast } = useToast();\n\n  // Get current consents\n  const { data: consentsData } = useQuery<{\n    consents: Array<{\n      type: string;\n      given: boolean;\n      date: string;\n      legalBasis?: string;\n      version?: string;\n    }>;\n  }>({\n    queryKey: [\"/api/gdpr/consents\"],\n  });\n\n  const handleGenerate = async () => {\n    if (!jobDescription.trim()) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please provide the job description.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check for AI consent before proceeding\n    const aiConsent = consentsData?.consents?.find((c: any) => c.type === 'ai_processing');\n    if (!aiConsent?.given) {\n      setShowAiConsent(true);\n      return;\n    }\n\n    setIsGenerating(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/henry/generate-cover-letter\", {\n        jobDescription: jobDescription.trim(),\n        companyName: companyName.trim() || undefined,\n        roleName: roleName.trim() || undefined,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to generate cover letter\");\n      }\n\n      const data = await response.json();\n      setGeneratedLetter(data);\n      \n      toast({\n        title: \"Cover Letter Generated!\",\n        description: data.message,\n      });\n    } catch (error) {\n      console.error(\"Error generating cover letter:\", error);\n      toast({\n        title: \"Generation Failed\",\n        description: error instanceof Error ? error.message : \"Failed to generate cover letter\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const handleConsentGiven = () => {\n    setShowAiConsent(false);\n    // Now proceed with generation\n    handleGenerateAfterConsent();\n  };\n\n  const handleGenerateAfterConsent = async () => {\n    setIsGenerating(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/henry/generate-cover-letter\", {\n        jobDescription: jobDescription.trim(),\n        companyName: companyName.trim() || undefined,\n        roleName: roleName.trim() || undefined,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to generate cover letter\");\n      }\n\n      const data = await response.json();\n      setGeneratedLetter(data);\n      \n      toast({\n        title: \"Cover Letter Generated!\",\n        description: data.message,\n      });\n    } catch (error) {\n      console.error(\"Error generating cover letter:\", error);\n      toast({\n        title: \"Generation Failed\",\n        description: error instanceof Error ? error.message : \"Failed to generate cover letter\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const copyToClipboard = async () => {\n    if (generatedLetter) {\n      await navigator.clipboard.writeText(generatedLetter.coverLetter);\n      toast({\n        title: \"Copied!\",\n        description: \"Cover letter copied to clipboard\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* AI Consent Widget */}\n      {showAiConsent && (\n        <AiConsentWidget \n          onConsentGiven={handleConsentGiven}\n          onDismiss={() => setShowAiConsent(false)}\n          isVisible={showAiConsent}\n        />\n      )}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-3\">\n            <FileText className=\"w-8 h-8 text-blue-600\" />\n            Cover Letter Generator\n            <Badge variant=\"secondary\" className=\"ml-auto\">Private Sector</Badge>\n          </CardTitle>\n          <CardDescription>\n            Perfect for private sector healthcare roles that don't require supporting information. \n            Henry will create a medium-length cover letter highlighting your healthcare background.\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"company-name\">Company Name (Optional)</Label>\n              <Input\n                id=\"company-name\"\n                placeholder=\"e.g., Bupa Healthcare\"\n                value={companyName}\n                onChange={(e) => setCompanyName(e.target.value)}\n                data-testid=\"input-company-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"role-name\">Role Title (Optional)</Label>\n              <Input\n                id=\"role-name\"\n                placeholder=\"e.g., Senior Staff Nurse\"\n                value={roleName}\n                onChange={(e) => setRoleName(e.target.value)}\n                data-testid=\"input-role-name\"\n              />\n            </div>\n          </div>\n          \n          <div className=\"space-y-2\">\n            <Label htmlFor=\"job-description\">Job Description *</Label>\n            <Textarea\n              id=\"job-description\"\n              placeholder=\"Paste the job description for the private healthcare role...\"\n              value={jobDescription}\n              onChange={(e) => setJobDescription(e.target.value)}\n              rows={8}\n              className=\"min-h-[200px]\"\n              data-testid=\"textarea-job-description\"\n            />\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Button \n              onClick={handleGenerate}\n              disabled={isGenerating || !jobDescription.trim()}\n              className=\"bg-blue-600 hover:bg-blue-700\"\n              data-testid=\"button-generate-cover-letter\"\n            >\n              <img \n                src={henryImage} \n                alt=\"Henry\" \n                className=\"w-4 h-4 mr-2 rounded-full object-cover\"\n              />\n              {isGenerating ? \"Henry is writing...\" : \"Ask Henry to Write Cover Letter\"}\n            </Button>\n          </div>\n\n          <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-3\">\n            <div className=\"flex items-start gap-2\">\n              <div className=\"text-amber-600 mt-0.5\">‚ö†Ô∏è</div>\n              <div className=\"text-sm text-amber-800\">\n                <strong>Important Disclaimer:</strong> This cover letter was generated by Henry the Helper as inspiration for your private sector application. \n                Henry doesn't claim responsibility for the content. We strongly advise you to not simply copy and paste this cover letter, \n                but use it as inspiration and tailor it to your specific experience and the role requirements. \n                Always review and personalize the content before submitting your application.\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {generatedLetter && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FileText className=\"w-6 h-6 text-blue-600\" />\n              Your Cover Letter\n              {generatedLetter.isDemo && (\n                <Badge variant=\"outline\">Demo Mode</Badge>\n              )}\n            </CardTitle>\n            <CardDescription>\n              {generatedLetter.message}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border\">\n                <pre className=\"whitespace-pre-wrap text-sm leading-relaxed text-gray-800 dark:text-gray-200 font-sans\">\n                  {generatedLetter.coverLetter}\n                </pre>\n              </div>\n              \n              <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-3\">\n                <div className=\"flex items-start gap-2\">\n                  <div className=\"text-amber-600 mt-0.5\">‚ö†Ô∏è</div>\n                  <div className=\"text-sm text-amber-800\">\n                    <strong>Important Disclaimer:</strong> This cover letter was generated by Henry the Helper as inspiration for your private sector application. \n                    Henry doesn't claim responsibility for the content. We strongly advise you to not simply copy and paste this cover letter, \n                    but use it as inspiration and tailor it to your specific experience and the role requirements. \n                    Always review and personalize the content before submitting your application.\n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"flex gap-2\">\n                <Button \n                  onClick={copyToClipboard}\n                  variant=\"outline\"\n                  data-testid=\"button-copy-cover-letter\"\n                >\n                  Copy to Clipboard\n                </Button>\n                <Button \n                  onClick={() => setGeneratedLetter(null)}\n                  variant=\"outline\"\n                  data-testid=\"button-clear-cover-letter\"\n                >\n                  Generate New\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":10470},"client/src/components/HenrySupportingInfoHelper.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { AiConsentWidget } from \"@/components/ai-consent-widget\";\nimport henryImage from \"@assets/Henry Helper_1756820773886.png\";\n\ninterface GeneratedSupportingInfo {\n  supportingInfo: string;\n  message: string;\n  isDemo: boolean;\n}\n\ninterface HenrySupportingInfoHelperProps {\n  jobDescription: string;\n  personSpecification: string;\n  disabled?: boolean;\n  onSupportingInfoGenerated: (content: string, isDemo: boolean) => void;\n}\n\nexport function HenrySupportingInfoHelper({\n  jobDescription,\n  personSpecification,\n  disabled = false,\n  onSupportingInfoGenerated,\n}: HenrySupportingInfoHelperProps) {\n  const [generatedInfo, setGeneratedInfo] = useState<GeneratedSupportingInfo | null>(null);\n  const [showAiConsent, setShowAiConsent] = useState(false);\n  const { toast } = useToast();\n\n  // Get current consents\n  const { data: consentsData } = useQuery({\n    queryKey: [\"/api/gdpr/consents\"],\n  });\n\n  const generateMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/henry/generate-supporting-info\", {\n        jobDescription,\n        personSpecification,\n      });\n      return response.json();\n    },\n    onSuccess: (data: GeneratedSupportingInfo) => {\n      setGeneratedInfo(data);\n      toast({\n        title: data.isDemo ? \"Demo Mode\" : \"Supporting Information Generated!\",\n        description: data.message,\n        variant: data.isDemo ? \"default\" : \"default\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Generation Failed\",\n        description: error.message || \"Failed to generate supporting information\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleGenerate = () => {\n    if (!jobDescription.trim()) {\n      toast({\n        title: \"Job Description Required\",\n        description: \"Please paste the job description first, then Henry can help generate your supporting information!\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check for AI consent before proceeding\n    const aiConsent = (consentsData as any)?.consents?.find((c: any) => c.type === 'ai_processing');\n    if (!aiConsent?.given) {\n      setShowAiConsent(true);\n      return;\n    }\n\n    generateMutation.mutate();\n  };\n\n  const handleConsentGiven = () => {\n    setShowAiConsent(false);\n    // Now proceed with generation\n    generateMutation.mutate();\n  };\n\n  const handleAccept = () => {\n    if (generatedInfo) {\n      onSupportingInfoGenerated(generatedInfo.supportingInfo, generatedInfo.isDemo);\n      setGeneratedInfo(null);\n      toast({\n        title: \"Supporting Information Added!\",\n        description: \"Henry's supporting information has been added to your application\",\n      });\n    }\n  };\n\n  const handleRegenerate = () => {\n    generateMutation.mutate();\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* AI Consent Widget */}\n      {showAiConsent && (\n        <AiConsentWidget \n          onConsentGiven={handleConsentGiven}\n          onDismiss={() => setShowAiConsent(false)}\n          isVisible={showAiConsent}\n        />\n      )}\n      {/* Generate Button */}\n      <Button\n        type=\"button\"\n        onClick={handleGenerate}\n        disabled={disabled || !jobDescription.trim() || generateMutation.isPending}\n        className=\"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white\"\n        data-testid=\"button-henry-generate-supporting-info\"\n      >\n        {generateMutation.isPending ? (\n          <>\n            <div className=\"animate-spin mr-2\">‚è≥</div>\n            Henry is working...\n          </>\n        ) : (\n          <>\n            <img src={henryImage} alt=\"Henry\" className=\"h-5 w-5 mr-2 rounded-full\" />\n            Generate Supporting Information with Henry\n          </>\n        )}\n      </Button>\n\n      {/* Disclaimer - Always visible */}\n      <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-3\">\n        <div className=\"flex items-start gap-2\">\n          <div className=\"text-amber-600 mt-0.5\">‚ö†Ô∏è</div>\n          <div className=\"text-sm text-amber-800\">\n            <strong>Important Disclaimer:</strong> This supporting information will be generated by Henry the Helper as inspiration for your NHS application. \n            Henry doesn't claim responsibility for the content. We strongly advise you to not simply copy and paste this supporting information, \n            but use it as inspiration and tailor it to your specific experience and the role requirements. \n            Always review and personalize the content before submitting your application.\n          </div>\n        </div>\n      </div>\n\n      {/* Generated Supporting Information Display */}\n      {generatedInfo && (\n        <Card className=\"border-blue-200 bg-blue-50/50 animate-in slide-in-from-top-2 duration-300\">\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"flex items-center gap-2 text-blue-800\">\n                <img src={henryImage} alt=\"Henry the Helper\" className=\"h-6 w-6 rounded-full\" />\n                Henry the Helper generated this supporting information:\n              </CardTitle>\n              {generatedInfo.isDemo && (\n                <Badge variant=\"outline\" className=\"bg-yellow-100 text-yellow-800 border-yellow-300\">\n                  Demo Mode\n                </Badge>\n              )}\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {/* Supporting Information Content */}\n            <div className=\"bg-white rounded-lg p-4 border border-blue-200 max-h-96 overflow-y-auto\">\n              <Textarea\n                value={generatedInfo.supportingInfo}\n                readOnly\n                className=\"min-h-[300px] border-0 p-0 text-sm leading-relaxed resize-none focus:ring-0\"\n                data-testid=\"textarea-generated-supporting-info\"\n              />\n            </div>\n\n            {/* Disclaimer */}\n            <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-3\">\n              <div className=\"flex items-start gap-2\">\n                <div className=\"text-amber-600 mt-0.5\">‚ö†Ô∏è</div>\n                <div className=\"text-sm text-amber-800\">\n                  <strong>Important Disclaimer:</strong> This supporting information was generated by Henry the Helper as inspiration for your NHS application. \n                  Henry doesn't claim responsibility for the content. We strongly advise you to not simply copy and paste this supporting information, \n                  but use it as inspiration and tailor it to your specific experience and the role requirements. \n                  Always review and personalize the content before submitting your application.\n                </div>\n              </div>\n            </div>\n\n            {/* Action Buttons */}\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={handleAccept}\n                className=\"flex-1 bg-green-600 hover:bg-green-700 text-white\"\n                data-testid=\"button-accept-supporting-info\"\n              >\n                Use This Supporting Information\n              </Button>\n              <Button\n                onClick={handleRegenerate}\n                variant=\"outline\"\n                className=\"border-blue-300 text-blue-700 hover:bg-blue-50\"\n                data-testid=\"button-regenerate-supporting-info\"\n              >\n                Try Again\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":8019},"client/src/components/profile-photo-upload.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Camera, Upload, X } from \"lucide-react\";\nimport type { User } from \"@shared/schema\";\n\ninterface ProfilePhotoUploadProps {\n  user: User;\n  className?: string;\n}\n\nexport function ProfilePhotoUpload({ user, className = \"\" }: ProfilePhotoUploadProps) {\n  const [isUploading, setIsUploading] = useState(false);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Update user profile photo mutation\n  const updateProfilePhotoMutation = useMutation({\n    mutationFn: async (uploadURL: string) => {\n      const response = await apiRequest('PATCH', `/api/user/profile-photo`, { uploadURL });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard\"] });\n      toast({\n        title: \"Profile Photo Updated\",\n        description: \"Your profile photo has been successfully updated.\",\n      });\n      setPreviewUrl(null);\n    },\n    onError: (error) => {\n      console.error(\"Error updating profile photo:\", error);\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update profile photo. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleFileSelect = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    if (!file.type.startsWith('image/')) {\n      toast({\n        title: \"Invalid File Type\",\n        description: \"Please select an image file (JPG, PNG, GIF, etc.).\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate file size (max 5MB)\n    const maxSize = 5 * 1024 * 1024; // 5MB\n    if (file.size > maxSize) {\n      toast({\n        title: \"File Too Large\",\n        description: \"Please select an image smaller than 5MB.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsUploading(true);\n\n    try {\n      // Create preview\n      const objectUrl = URL.createObjectURL(file);\n      setPreviewUrl(objectUrl);\n\n      // Get upload URL from backend\n      const uploadResponse = await apiRequest('POST', '/api/objects/upload');\n      const { uploadURL } = await uploadResponse.json();\n\n      // Upload file directly to object storage\n      const uploadResult = await fetch(uploadURL, {\n        method: 'PUT',\n        body: file,\n        headers: {\n          'Content-Type': file.type,\n        },\n      });\n\n      if (!uploadResult.ok) {\n        throw new Error('Upload failed');\n      }\n\n      // Update user profile with the upload URL (backend will normalize it)\n      await updateProfilePhotoMutation.mutateAsync(uploadURL);\n\n    } catch (error) {\n      console.error('Upload error:', error);\n      toast({\n        title: \"Upload Failed\",\n        description: \"Failed to upload image. Please try again.\",\n        variant: \"destructive\",\n      });\n      setPreviewUrl(null);\n    } finally {\n      setIsUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleRemovePhoto = async () => {\n    try {\n      await updateProfilePhotoMutation.mutateAsync('');\n    } catch (error) {\n      // Error handled in mutation\n    }\n  };\n\n  const triggerFileInput = () => {\n    fileInputRef.current?.click();\n  };\n\n  const displayImage = previewUrl || user.profileImageUrl;\n  const initials = user.firstName?.[0] || user.lastName?.[0] || 'U';\n\n  return (\n    <div className={`flex flex-col items-center space-y-4 ${className}`}>\n      {/* Avatar Display */}\n      <div className=\"relative\">\n        <Avatar className=\"w-24 h-24 border-4 border-background shadow-lg\">\n          <AvatarImage src={displayImage || undefined} alt=\"Profile photo\" />\n          <AvatarFallback className=\"text-2xl bg-primary/10 text-primary\">\n            {initials}\n          </AvatarFallback>\n        </Avatar>\n\n        {/* Camera overlay */}\n        <div className=\"absolute inset-0 bg-black bg-opacity-40 rounded-full opacity-0 hover:opacity-100 transition-opacity flex items-center justify-center cursor-pointer\" \n             onClick={triggerFileInput}>\n          <Camera className=\"w-6 h-6 text-white\" />\n        </div>\n      </div>\n\n      {/* Upload/Remove Buttons */}\n      <div className=\"flex gap-2\">\n        <Button\n          onClick={triggerFileInput}\n          disabled={isUploading || updateProfilePhotoMutation.isPending}\n          size=\"sm\"\n          variant=\"outline\"\n          data-testid=\"button-upload-photo\"\n        >\n          {isUploading ? (\n            <>\n              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-primary mr-2\"></div>\n              Uploading...\n            </>\n          ) : (\n            <>\n              <Upload className=\"w-4 h-4 mr-2\" />\n              {displayImage ? 'Change Photo' : 'Upload Photo'}\n            </>\n          )}\n        </Button>\n\n        {displayImage && (\n          <Button\n            onClick={handleRemovePhoto}\n            disabled={updateProfilePhotoMutation.isPending}\n            size=\"sm\"\n            variant=\"outline\"\n            data-testid=\"button-remove-photo\"\n          >\n            <X className=\"w-4 h-4 mr-2\" />\n            Remove\n          </Button>\n        )}\n      </div>\n\n      {/* Hidden file input */}\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        onChange={handleFileSelect}\n        className=\"hidden\"\n        data-testid=\"input-file-photo\"\n      />\n\n      <p className=\"text-xs text-muted-foreground text-center max-w-xs\">\n        Upload a square image for best results. Maximum file size: 5MB\n      </p>\n    </div>\n  );\n}","size_bytes":6149},"client/src/components/ui/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\"\nimport { Button } from \"@/components/ui/button\"\nimport { useTheme } from \"@/contexts/theme-context\"\n\nexport function ThemeToggle() {\n  const { theme, setTheme } = useTheme()\n\n  const handleToggle = () => {\n    if (theme === \"dark\") {\n      setTheme(\"light\")\n    } else {\n      setTheme(\"dark\")\n    }\n  }\n\n  return (\n    <Button \n      variant=\"ghost\" \n      size=\"icon\" \n      onClick={handleToggle}\n      data-testid=\"button-theme-toggle\"\n      className=\"h-9 w-9\"\n    >\n      <Sun className=\"h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n      <Moon className=\"absolute h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n      <span className=\"sr-only\">Toggle theme</span>\n    </Button>\n  )\n}","size_bytes":787},"client/src/contexts/theme-context.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\"\n\ntype Theme = \"dark\" | \"light\" | \"system\"\n\ntype ThemeProviderProps = {\n  children: React.ReactNode\n  defaultTheme?: Theme\n  storageKey?: string\n}\n\ntype ThemeProviderState = {\n  theme: Theme\n  setTheme: (theme: Theme) => void\n}\n\nconst initialState: ThemeProviderState = {\n  theme: \"system\",\n  setTheme: () => null,\n}\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState)\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"system\",\n  storageKey = \"healthhire-ui-theme\",\n  ...props\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  )\n\n  useEffect(() => {\n    const root = window.document.documentElement\n\n    root.classList.remove(\"light\", \"dark\")\n\n    if (theme === \"system\") {\n      const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n        .matches\n        ? \"dark\"\n        : \"light\"\n\n      root.classList.add(systemTheme)\n      return\n    }\n\n    root.classList.add(theme)\n  }, [theme])\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme)\n      setTheme(theme)\n    },\n  }\n\n  return (\n    <ThemeProviderContext.Provider {...props} value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  )\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext)\n\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\")\n\n  return context\n}","size_bytes":1583},"client/src/pages/qa-session.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport Header from \"@/components/dashboard/header\";\nimport { Footer } from \"@/components/footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { \n  ArrowLeft, \n  RotateCcw,\n  ThumbsUp,\n  ThumbsDown,\n  Meh,\n  Target,\n  Trophy,\n  AlertCircle,\n  CheckCircle\n} from \"lucide-react\";\nimport henryImage from \"@assets/Henry Helper_1756820773886.png\";\n\ninterface QaQuestion {\n  id: string;\n  questionText: string;\n  modelAnswer: string;\n  category: string;\n  questionOrder: number;\n}\n\ninterface QaSession {\n  id: string;\n  jobTitle: string;\n  totalQuestions: number;\n  createdAt: string;\n  completedAt: string | null;\n}\n\ninterface QaProgress {\n  id: string;\n  questionId: string;\n  confidenceLevel: number;\n  attempts: number;\n}\n\ninterface SessionData {\n  session: QaSession;\n  questions: QaQuestion[];\n  progress: QaProgress[];\n}\n\nexport default function QASession() {\n  const { sessionId } = useParams();\n  const { toast } = useToast();\n  const { isAuthenticated, isLoading } = useAuth();\n  const queryClient = useQueryClient();\n\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [showAnswer, setShowAnswer] = useState(false);\n  const [reviewQueue, setReviewQueue] = useState<number[]>([]);\n  const [isCompleted, setIsCompleted] = useState(false);\n  const [sessionStats, setSessionStats] = useState<any>(null);\n\n  // Redirect to login if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  // Fetch session data\n  const { data: sessionData, isLoading: isSessionLoading } = useQuery<SessionData>({\n    queryKey: [`/api/qa/session/${sessionId}`],\n    retry: false,\n    enabled: isAuthenticated && !!sessionId,\n  });\n\n  // Update progress mutation\n  const updateProgressMutation = useMutation({\n    mutationFn: async ({ questionId, confidenceLevel }: { questionId: string; confidenceLevel: number }) => {\n      const response = await apiRequest('POST', '/api/qa/progress', {\n        session_id: sessionId,\n        question_id: questionId,\n        confidence_level: confidenceLevel\n      });\n      return response.json();\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      console.error(\"Error updating progress:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to save your progress. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Complete session mutation\n  const completeSessionMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', `/api/qa/session/${sessionId}/complete`);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setSessionStats(data.summary);\n      setIsCompleted(true);\n      toast({\n        title: \"Session Completed!\",\n        description: \"Great job! You've completed all your flashcards.\",\n      });\n    },\n  });\n\n  const currentQuestion = sessionData?.questions[currentQuestionIndex];\n  const totalQuestions = sessionData?.questions.length || 0;\n  const progressPercent = totalQuestions > 0 ? ((currentQuestionIndex + 1) / totalQuestions) * 100 : 0;\n\n  const handleConfidenceLevel = async (level: number) => {\n    if (!currentQuestion) return;\n\n    try {\n      await updateProgressMutation.mutateAsync({\n        questionId: currentQuestion.id,\n        confidenceLevel: level\n      });\n\n      // Add to review queue if not confident\n      if (level === 1) {\n        setReviewQueue(prev => [...prev, currentQuestionIndex]);\n      }\n\n      nextQuestion();\n    } catch (error) {\n      // Error is handled in mutation onError\n    }\n  };\n\n  const nextQuestion = () => {\n    setShowAnswer(false);\n    \n    if (currentQuestionIndex < totalQuestions - 1) {\n      setCurrentQuestionIndex(prev => prev + 1);\n    } else if (reviewQueue.length > 0) {\n      // Start reviewing difficult questions\n      const nextReviewIndex = reviewQueue[0];\n      setCurrentQuestionIndex(nextReviewIndex);\n      setReviewQueue(prev => prev.slice(1));\n    } else {\n      // All questions completed\n      completeSessionMutation.mutate();\n    }\n  };\n\n  const restartSession = () => {\n    setCurrentQuestionIndex(0);\n    setShowAnswer(false);\n    setReviewQueue([]);\n    setIsCompleted(false);\n    setSessionStats(null);\n  };\n\n  if (isLoading || isSessionLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading your Q&A session...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!sessionData) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"text-center py-8\">\n            <AlertCircle className=\"h-12 w-12 text-destructive mx-auto mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">Session Not Found</h3>\n            <p className=\"text-muted-foreground mb-4\">The Q&A session you're looking for doesn't exist or you don't have access to it.</p>\n            <Button onClick={() => window.location.href = '/qa'}>\n              Back to Q&A Generator\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Completion View\n  if (isCompleted && sessionStats) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Header />\n        <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n          <Button \n            variant=\"outline\" \n            onClick={() => window.location.href = '/'}\n            className=\"mb-4\"\n            data-testid=\"button-back-dashboard\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to Dashboard\n          </Button>\n\n          <Card>\n            <CardHeader className=\"text-center\">\n              <div className=\"flex justify-center items-center gap-4 mb-4\">\n                <div className=\"bg-green-100 p-3 rounded-full\">\n                  <Trophy className=\"h-12 w-12 text-green-600\" />\n                </div>\n                <div className=\"w-16 h-16 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center\">\n                  <img src={henryImage} alt=\"Henry the Helper\" className=\"w-10 h-10 rounded-full\" />\n                </div>\n              </div>\n              <CardTitle className=\"text-2xl\">Q&A Session Completed!</CardTitle>\n              <CardDescription>\n                Great job practicing with {sessionData.session.jobTitle}. Henry is proud of your progress!\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-center\">\n                <div className=\"p-4 bg-gray-50 rounded-lg\">\n                  <div className=\"text-2xl font-bold text-green-600\">{sessionStats.final_mastery.confident}</div>\n                  <div className=\"text-sm text-gray-600\">Confident</div>\n                </div>\n                <div className=\"p-4 bg-gray-50 rounded-lg\">\n                  <div className=\"text-2xl font-bold text-yellow-600\">{sessionStats.final_mastery.somewhat_confident}</div>\n                  <div className=\"text-sm text-gray-600\">Somewhat Confident</div>\n                </div>\n                <div className=\"p-4 bg-gray-50 rounded-lg\">\n                  <div className=\"text-2xl font-bold text-red-600\">{sessionStats.final_mastery.not_confident}</div>\n                  <div className=\"text-sm text-gray-600\">Need More Practice</div>\n                </div>\n              </div>\n\n              <div className=\"text-center\">\n                <p className=\"text-gray-600 mb-4\">\n                  Total attempts: {sessionStats.total_attempts} ‚Ä¢ Questions: {sessionStats.total_questions}\n                </p>\n                <div className=\"flex gap-4 justify-center\">\n                  <Button onClick={restartSession} variant=\"outline\">\n                    <RotateCcw className=\"h-4 w-4 mr-2\" />\n                    Practice Again\n                  </Button>\n                  <Button onClick={() => window.location.href = '/qa'}>\n                    Generate New Questions\n                  </Button>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n        <Footer />\n      </div>\n    );\n  }\n\n  // Main Flashcard Interface\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header />\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n        <Button \n          variant=\"outline\" \n          onClick={() => window.location.href = '/qa'}\n          className=\"mb-4\"\n          data-testid=\"button-back-qa\"\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Q&A Generator\n        </Button>\n\n        {/* Progress Header */}\n        <div className=\"mb-6\">\n          <div className=\"flex justify-between items-center mb-2\">\n            <h1 className=\"text-2xl font-bold\">{sessionData.session.jobTitle}</h1>\n            <div className=\"text-sm text-gray-600\">\n              Question {currentQuestionIndex + 1} of {totalQuestions}\n              {reviewQueue.length > 0 && (\n                <span className=\"ml-2 text-orange-600\">\n                  ({reviewQueue.length} to review)\n                </span>\n              )}\n            </div>\n          </div>\n          <Progress value={progressPercent} className=\"w-full\" />\n        </div>\n\n        {/* Question Card */}\n        <Card className=\"mb-6 min-h-[500px]\">\n          <CardContent className=\"p-8 flex flex-col justify-center\">\n            <div className=\"text-center space-y-6\">\n              <Badge variant=\"outline\" className=\"mb-4\">\n                {currentQuestion?.category}\n              </Badge>\n              \n              <h2 className=\"text-xl font-medium leading-relaxed\">\n                {currentQuestion?.questionText}\n              </h2>\n\n              {!showAnswer ? (\n                <Button\n                  onClick={() => setShowAnswer(true)}\n                  className=\"mt-8\"\n                  size=\"lg\"\n                  data-testid=\"button-show-answer\"\n                >\n                  Show Model Answer\n                </Button>\n              ) : (\n                <div className=\"space-y-6\">\n                  <div className=\"bg-gray-50 p-6 rounded-lg text-left\">\n                    <div className=\"flex items-center gap-2 mb-3\">\n                      <div className=\"w-6 h-6 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center\">\n                        <img src={henryImage} alt=\"Henry the Helper\" className=\"w-4 h-4 rounded-full\" />\n                      </div>\n                      <h3 className=\"font-medium text-gray-800\">Henry's Model Answer:</h3>\n                    </div>\n                    <p className=\"text-gray-700 leading-relaxed whitespace-pre-wrap\">\n                      {currentQuestion?.modelAnswer}\n                    </p>\n                  </div>\n\n                  <div className=\"space-y-4\">\n                    <p className=\"text-sm text-gray-600 text-center\">\n                      How confident do you feel about answering this question?\n                    </p>\n                    <div className=\"flex justify-center gap-4\">\n                      <Button\n                        onClick={() => handleConfidenceLevel(1)}\n                        variant=\"outline\"\n                        className=\"flex flex-col items-center py-4 px-6 h-auto border-red-200 hover:bg-red-50\"\n                        disabled={updateProgressMutation.isPending}\n                        data-testid=\"button-not-confident\"\n                      >\n                        <ThumbsDown className=\"h-6 w-6 text-red-500 mb-2\" />\n                        <span className=\"text-sm\">Not Confident</span>\n                        <span className=\"text-xs text-gray-500\">Need more practice</span>\n                      </Button>\n                      <Button\n                        onClick={() => handleConfidenceLevel(2)}\n                        variant=\"outline\"\n                        className=\"flex flex-col items-center py-4 px-6 h-auto border-yellow-200 hover:bg-yellow-50\"\n                        disabled={updateProgressMutation.isPending}\n                        data-testid=\"button-somewhat-confident\"\n                      >\n                        <Meh className=\"h-6 w-6 text-yellow-500 mb-2\" />\n                        <span className=\"text-sm\">Somewhat Confident</span>\n                        <span className=\"text-xs text-gray-500\">Could use improvement</span>\n                      </Button>\n                      <Button\n                        onClick={() => handleConfidenceLevel(3)}\n                        variant=\"outline\"\n                        className=\"flex flex-col items-center py-4 px-6 h-auto border-green-200 hover:bg-green-50\"\n                        disabled={updateProgressMutation.isPending}\n                        data-testid=\"button-confident\"\n                      >\n                        <ThumbsUp className=\"h-6 w-6 text-green-500 mb-2\" />\n                        <span className=\"text-sm\">Confident</span>\n                        <span className=\"text-xs text-gray-500\">Ready for interview</span>\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Session Info */}\n        <div className=\"text-center text-sm text-gray-600\">\n          <p>Use this flashcard system to master your interview preparation</p>\n          <p>Questions marked as \"Not Confident\" will be repeated until you feel ready</p>\n        </div>\n      </div>\n      <Footer />\n    </div>\n  );\n}","size_bytes":15001},"seed-questions.js":{"content":"// Script to seed the 100 general NHS interview questions into the database\nconst questions = [\n  \"Tell me about yourself and your experience in healthcare.\",\n  \"Why do you want to work for the NHS?\",\n  \"What interests you about this particular role?\",\n  \"How do you handle stress and pressure in your work?\",\n  \"Describe a time when you had to deal with a difficult patient or colleague.\",\n  \"How do you prioritize your workload when you have multiple tasks?\",\n  \"What are your greatest strengths as a healthcare professional?\",\n  \"What areas would you like to develop or improve?\",\n  \"How do you ensure you stay up-to-date with current healthcare practices?\",\n  \"Describe a time when you had to work as part of a team.\",\n  \"How do you handle constructive criticism?\",\n  \"What would you do if you witnessed a colleague making a mistake?\",\n  \"How do you maintain patient confidentiality?\",\n  \"Describe a situation where you had to adapt to change quickly.\",\n  \"How do you ensure effective communication with patients and families?\",\n  \"What does good patient care mean to you?\",\n  \"How do you manage your time effectively during a busy shift?\",\n  \"Describe a time when you went above and beyond for a patient.\",\n  \"How would you handle a situation where you disagreed with a senior colleague?\",\n  \"What motivates you to work in healthcare?\",\n  \"How do you handle working with patients from diverse backgrounds?\",\n  \"Describe a challenging situation you faced and how you resolved it.\",\n  \"What steps do you take to ensure patient safety?\",\n  \"How do you deal with emotional situations at work?\",\n  \"What would you do if you made an error?\",\n  \"How do you balance empathy with professional boundaries?\",\n  \"Describe your experience with electronic health records.\",\n  \"How do you handle difficult or anxious patients?\",\n  \"What role does teamwork play in healthcare?\",\n  \"How do you ensure you follow protocols and procedures?\",\n  \"Describe a time when you had to learn something new quickly.\",\n  \"How do you maintain your professional development?\",\n  \"What would you do if a patient refused treatment?\",\n  \"How do you handle shift work and unsociable hours?\",\n  \"Describe your understanding of infection control.\",\n  \"How do you manage competing priorities?\",\n  \"What would you do if you witnessed unprofessional behavior?\",\n  \"How do you support colleagues during difficult times?\",\n  \"Describe your experience with clinical governance.\",\n  \"How do you ensure accurate documentation?\",\n  \"What steps do you take to prevent falls and injuries?\",\n  \"How do you communicate with patients who have communication difficulties?\",\n  \"Describe a time when you received feedback and how you acted on it.\",\n  \"How do you maintain dignity and respect for patients?\",\n  \"What would you do if you couldn't answer a patient's question?\",\n  \"How do you handle situations where resources are limited?\",\n  \"Describe your understanding of safeguarding procedures.\",\n  \"How do you ensure you're working within your scope of practice?\",\n  \"What would you do if a patient complained about their care?\",\n  \"How do you support student learners or new staff?\",\n  \"Describe a time when you had to advocate for a patient.\",\n  \"How do you manage your own well-being and prevent burnout?\",\n  \"What would you do if you noticed a colleague was struggling?\",\n  \"How do you handle situations involving end-of-life care?\",\n  \"Describe your experience with risk assessments.\",\n  \"How do you ensure cultural sensitivity in your practice?\",\n  \"What would you do if equipment wasn't working properly?\",\n  \"How do you handle situations where you need to deliver bad news?\",\n  \"Describe your understanding of duty of care.\",\n  \"How do you manage relationships with patients' families?\",\n  \"What steps do you take to prevent medication errors?\",\n  \"How do you handle situations involving mental health patients?\",\n  \"Describe a time when you had to work under pressure.\",\n  \"How do you ensure you maintain professional boundaries?\",\n  \"What would you do if you suspected abuse or neglect?\",\n  \"How do you handle situations involving aggressive or violent patients?\",\n  \"Describe your experience with quality improvement initiatives.\",\n  \"How do you ensure effective handovers between shifts?\",\n  \"What would you do if you disagreed with a treatment plan?\",\n  \"How do you handle situations involving consent?\",\n  \"Describe your understanding of clinical audit.\",\n  \"How do you manage your workload during staff shortages?\",\n  \"What steps do you take to prevent hospital-acquired infections?\",\n  \"How do you handle situations involving children and young people?\",\n  \"Describe a time when you had to make a difficult decision.\",\n  \"How do you ensure you're providing person-centered care?\",\n  \"What would you do if you witnessed discrimination?\",\n  \"How do you handle situations involving patients with dementia?\",\n  \"Describe your experience with emergency situations.\",\n  \"How do you ensure you're following evidence-based practice?\",\n  \"What would you do if you were asked to do something you're not trained for?\",\n  \"How do you handle situations involving patients with learning disabilities?\",\n  \"Describe your understanding of the Mental Capacity Act.\",\n  \"How do you manage situations involving language barriers?\",\n  \"What steps do you take to ensure medication reconciliation?\",\n  \"How do you handle situations involving patients' personal belongings?\",\n  \"Describe a time when you had to challenge poor practice.\",\n  \"How do you ensure you're maintaining accurate records?\",\n  \"What would you do if a patient wanted to discharge themselves?\",\n  \"How do you handle situations involving visiting restrictions?\",\n  \"Describe your experience with multi-disciplinary teams.\",\n  \"How do you ensure you're providing compassionate care?\",\n  \"What would you do if you noticed signs of deterioration in a patient?\",\n  \"How do you handle situations involving patients with communication needs?\",\n  \"Describe your understanding of health and safety regulations.\",\n  \"How do you manage situations involving patient transfers?\",\n  \"What steps do you take to ensure effective pain management?\",\n  \"How do you handle situations involving patients with complex needs?\",\n  \"Describe a time when you had to work with limited supervision.\",\n  \"How do you ensure you're respecting patients' privacy?\",\n  \"What would you do if you identified a training need?\",\n  \"How do you handle situations involving end-of-life decisions?\",\n  \"Describe your experience with clinical research or trials.\",\n  \"How do you ensure you're providing holistic care?\",\n  \"What would you do if you noticed a pattern of incidents?\",\n  \"How do you handle situations involving patients' spiritual needs?\"\n];\n\nasync function seedQuestions() {\n  try {\n    const response = await fetch('http://localhost:5000/api/interview-practice/seed-questions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ questions }),\n    });\n\n    if (response.ok) {\n      const result = await response.json();\n      console.log('Success:', result);\n    } else {\n      console.error('Error:', response.status, await response.text());\n    }\n  } catch (error) {\n    console.error('Network error:', error);\n  }\n}\n\nseedQuestions();","size_bytes":7297},"client/src/components/consent-manager.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { \n  Shield, \n  Eye, \n  Brain, \n  Mail, \n  Target, \n  Info, \n  Check, \n  AlertCircle,\n  Clock\n} from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface ConsentType {\n  type: string;\n  given: boolean;\n  date: string;\n  legalBasis: string;\n  version: string;\n}\n\ninterface ConsentConfig {\n  name: string;\n  description: string;\n  required: boolean;\n  legalBasis: string;\n  icon: React.ComponentType<any>;\n  details?: string;\n}\n\nconst CONSENT_TYPES: Record<string, ConsentConfig> = {\n  essential: {\n    name: 'Essential Cookies & Data Processing',\n    description: 'Required for basic platform functionality, account management, and security.',\n    required: true,\n    legalBasis: 'legitimate_interest',\n    icon: Shield,\n    details: 'These are necessary for the platform to function and cannot be disabled. Includes session management, security features, and core platform operations.'\n  },\n  analytics: {\n    name: 'Analytics & Performance',\n    description: 'Help us understand how you use our platform to improve your experience.',\n    required: false,\n    legalBasis: 'consent',\n    icon: Eye,\n    details: 'We collect anonymized usage data to understand how users interact with our platform, identify popular features, and optimize performance.'\n  },\n  ai_processing: {\n    name: 'AI Content Generation',\n    description: 'Process your data with AI to generate CVs, interview questions, and feedback.',\n    required: false,\n    legalBasis: 'consent',\n    icon: Brain,\n    details: 'Your profile and career data will be processed by AI systems to generate personalized content like CVs, supporting information, and interview practice questions.'\n  },\n  marketing: {\n    name: 'Marketing Communications',\n    description: 'Send you job alerts, platform updates, and relevant career opportunities.',\n    required: false,\n    legalBasis: 'consent',\n    icon: Mail,\n    details: 'We will send you relevant job matches, platform updates, career tips, and information about new features that might interest you.'\n  },\n  profiling: {\n    name: 'Job Matching & Profiling',\n    description: 'Create profiles to suggest relevant jobs and improve recommendations.',\n    required: false,\n    legalBasis: 'consent',\n    icon: Target,\n    details: 'We analyze your skills, experience, and preferences to create a profile that helps us suggest the most relevant NHS job opportunities.'\n  }\n};\n\nexport function ConsentManager() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [showDetails, setShowDetails] = useState(false);\n  const [consentStates, setConsentStates] = useState<Record<string, boolean>>({});\n\n  // Fetch current consents\n  const { data: consentsData, isLoading } = useQuery<{ consents: ConsentType[] }>({\n    queryKey: [\"/api/gdpr/consents\"],\n  });\n\n  // Update consent mutation\n  const updateConsentMutation = useMutation({\n    mutationFn: async ({ consentType, consentGiven }: { consentType: string; consentGiven: boolean }) => {\n      return apiRequest(\"POST\", \"/api/gdpr/consent\", {\n        consent_type: consentType,\n        consent_given: consentGiven,\n        legal_basis: CONSENT_TYPES[consentType]?.legalBasis || 'consent'\n      });\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/gdpr/consents\"] });\n      toast({\n        title: \"Privacy Preferences Updated\",\n        description: `${CONSENT_TYPES[variables.consentType]?.name} consent ${variables.consentGiven ? 'granted' : 'withdrawn'}.`,\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update privacy preferences. Please try again.\",\n        variant: \"destructive\",\n      });\n      console.error('Consent update error:', error);\n    },\n  });\n\n  // Initialize consent states from API data\n  useEffect(() => {\n    if (consentsData?.consents) {\n      const states: Record<string, boolean> = {};\n      \n      // Set defaults for all consent types\n      Object.keys(CONSENT_TYPES).forEach(type => {\n        states[type] = CONSENT_TYPES[type].required; // Default required consents to true\n      });\n      \n      // Update with actual consent data\n      consentsData.consents.forEach(consent => {\n        states[consent.type] = consent.given;\n      });\n      \n      setConsentStates(states);\n    }\n  }, [consentsData]);\n\n  const handleConsentChange = async (consentType: string, newValue: boolean) => {\n    // Optimistically update the UI\n    setConsentStates(prev => ({ ...prev, [consentType]: newValue }));\n    \n    // Call the API\n    await updateConsentMutation.mutateAsync({ consentType, consentGiven: newValue });\n  };\n\n  const getConsentStatus = (type: string): ConsentType | undefined => {\n    return consentsData?.consents.find(c => c.type === type);\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-GB', {\n      day: 'numeric',\n      month: 'short',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <Card className=\"w-full\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Shield className=\"h-5 w-5\" />\n            Privacy Preferences\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-sm text-muted-foreground\">Loading privacy preferences...</div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Card className=\"w-full\">\n        <CardHeader>\n          <div className=\"flex justify-between items-center\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <Shield className=\"h-5 w-5\" />\n              Privacy Preferences\n            </CardTitle>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setShowDetails(!showDetails)}\n              className=\"text-xs\"\n            >\n              <Info className=\"h-3 w-3 mr-1\" />\n              {showDetails ? 'Hide Details' : 'Show Details'}\n            </Button>\n          </div>\n          <div className=\"text-sm text-muted-foreground\">\n            Control how your personal data is processed and used on our platform.\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <Alert>\n            <AlertCircle className=\"h-4 w-4\" />\n            <AlertDescription>\n              Your privacy matters to us. You can change these preferences at any time. \n              Required services are essential for platform functionality and cannot be disabled.\n            </AlertDescription>\n          </Alert>\n\n          <div className=\"space-y-4\">\n            {Object.entries(CONSENT_TYPES).map(([key, consent]) => {\n              const consentStatus = getConsentStatus(key);\n              const isEnabled = consentStates[key] || false;\n              const Icon = consent.icon;\n              \n              return (\n                <div key={key} className=\"border rounded-lg p-4 space-y-3\">\n                  <div className=\"flex justify-between items-start gap-4\">\n                    <div className=\"flex-1 space-y-2\">\n                      <div className=\"flex items-center gap-2\">\n                        <Icon className=\"h-4 w-4 text-blue-600\" />\n                        <h4 className=\"font-medium\">{consent.name}</h4>\n                        {consent.required && (\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            Required\n                          </Badge>\n                        )}\n                      </div>\n                      \n                      <p className=\"text-sm text-muted-foreground\">\n                        {consent.description}\n                      </p>\n                      \n                      {showDetails && (\n                        <div className=\"space-y-2 text-xs\">\n                          <div className=\"bg-muted p-3 rounded text-muted-foreground\">\n                            <strong>Details:</strong> {consent.details}\n                          </div>\n                          <div className=\"flex items-center gap-4 text-muted-foreground\">\n                            <span><strong>Legal basis:</strong> {consent.legalBasis.replace('_', ' ')}</span>\n                            {consentStatus && (\n                              <span className=\"flex items-center gap-1\">\n                                <Clock className=\"h-3 w-3\" />\n                                <strong>Last updated:</strong> {formatDate(consentStatus.date)}\n                              </span>\n                            )}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                    \n                    <div className=\"flex flex-col items-end gap-2\">\n                      {consent.required ? (\n                        <div className=\"flex items-center gap-2\">\n                          <Check className=\"h-4 w-4 text-green-500\" />\n                          <span className=\"text-xs text-muted-foreground\">Always On</span>\n                        </div>\n                      ) : (\n                        <Switch\n                          checked={isEnabled}\n                          onCheckedChange={(checked) => handleConsentChange(key, checked)}\n                          disabled={updateConsentMutation.isPending}\n                          data-testid={`consent-switch-${key}`}\n                        />\n                      )}\n                      \n                      {isEnabled ? (\n                        <Badge variant=\"default\" className=\"text-xs\">\n                          Enabled\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          Disabled\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n\n          {showDetails && (\n            <div className=\"space-y-3 pt-4 border-t\">\n              <h4 className=\"text-sm font-semibold\">Your Rights</h4>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-muted-foreground\">\n                <div className=\"flex items-center gap-1\">\n                  <Check className=\"h-3 w-3 text-green-500\" />\n                  <span>Access your personal data</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <Check className=\"h-3 w-3 text-green-500\" />\n                  <span>Request data correction</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <Check className=\"h-3 w-3 text-green-500\" />\n                  <span>Download your data</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <Check className=\"h-3 w-3 text-green-500\" />\n                  <span>Delete your account</span>\n                </div>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":11684},"client/src/components/marketing-consent-widget.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { X, Mail, Bell, CheckCircle, Gift } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface ConsentType {\n  type: string;\n  given: boolean;\n  date: string;\n  legalBasis: string;\n  version: string;\n}\n\nexport function MarketingConsentWidget() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isVisible, setIsVisible] = useState(false);\n  const [isDismissed, setIsDismissed] = useState(false);\n\n  // Fetch current consents\n  const { data: consentsData } = useQuery<{ consents: ConsentType[] }>({\n    queryKey: [\"/api/gdpr/consents\"],\n  });\n\n  // Update consent mutation\n  const updateConsentMutation = useMutation({\n    mutationFn: async (consentGiven: boolean) => {\n      return apiRequest(\"POST\", \"/api/gdpr/consent\", {\n        consent_type: \"marketing\",\n        consent_given: consentGiven,\n        legal_basis: \"consent\"\n      });\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/gdpr/consents\"] });\n      setIsVisible(false);\n      toast({\n        title: variables ? \"Marketing notifications enabled! üéâ\" : \"Marketing notifications disabled\",\n        description: variables \n          ? \"You'll now receive career insights, platform updates, and expert advice for your NHS career journey.\"\n          : \"You can re-enable marketing notifications in Privacy Settings anytime.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update notification preferences. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Check if marketing consent has been given\n  useEffect(() => {\n    if (consentsData?.consents) {\n      const marketingConsent = consentsData.consents.find(c => c.type === 'marketing');\n      const hasMarketingConsent = marketingConsent?.given;\n      \n      // Show widget if no marketing consent and not dismissed\n      if (!hasMarketingConsent && !isDismissed) {\n        setIsVisible(true);\n      } else {\n        setIsVisible(false);\n      }\n    }\n  }, [consentsData, isDismissed]);\n\n  // Don't show if dismissed or already consented\n  if (!isVisible) {\n    return null;\n  }\n\n  const handleAccept = () => {\n    updateConsentMutation.mutate(true);\n  };\n\n  const handleDismiss = () => {\n    setIsDismissed(true);\n    setIsVisible(false);\n  };\n\n  const handleDecline = () => {\n    updateConsentMutation.mutate(false);\n  };\n\n  return (\n    <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20 border-blue-200 dark:border-blue-800\">\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-start justify-between gap-3\">\n          <div className=\"flex items-start gap-3 flex-1\">\n            <div className=\"flex-shrink-0\">\n              <div className=\"w-10 h-10 bg-blue-100 dark:bg-blue-900/50 rounded-full flex items-center justify-center\">\n                <Gift className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n              </div>\n            </div>\n            \n            <div className=\"space-y-2 flex-1\">\n              <div className=\"flex items-center gap-2\">\n                <h4 className=\"font-medium text-sm\">Get career insights and expert advice</h4>\n                <Badge variant=\"secondary\" className=\"text-xs\">Optional</Badge>\n              </div>\n              \n              <p className=\"text-xs text-muted-foreground leading-relaxed\">\n                Receive career insights, platform updates, and expert advice to accelerate your NHS career journey.\n              </p>\n              \n              <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\n                <CheckCircle className=\"h-3 w-3 text-green-500\" />\n                <span>Career insights</span>\n                <span className=\"text-muted-foreground/60\">‚Ä¢</span>\n                <Bell className=\"h-3 w-3 text-blue-500\" />\n                <span>Platform updates</span>\n                <span className=\"text-muted-foreground/60\">‚Ä¢</span>\n                <Mail className=\"h-3 w-3 text-orange-500\" />\n                <span>Expert advice and tips</span>\n              </div>\n            </div>\n          </div>\n          \n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleDismiss}\n            className=\"flex-shrink-0 h-6 w-6 p-0 text-muted-foreground hover:text-foreground\"\n            data-testid=\"dismiss-marketing-widget\"\n          >\n            <X className=\"h-3 w-3\" />\n          </Button>\n        </div>\n        \n        <div className=\"flex items-center gap-2 mt-3 pt-2 border-t border-blue-200/50 dark:border-blue-800/50\">\n          <Button\n            size=\"sm\"\n            onClick={handleAccept}\n            disabled={updateConsentMutation.isPending}\n            className=\"text-xs h-7 bg-blue-600 hover:bg-blue-700 text-white\"\n            data-testid=\"accept-marketing-consent\"\n          >\n            {updateConsentMutation.isPending ? \"Enabling...\" : \"Yes, keep me updated\"}\n          </Button>\n          \n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleDecline}\n            disabled={updateConsentMutation.isPending}\n            className=\"text-xs h-7 text-muted-foreground hover:text-foreground\"\n            data-testid=\"decline-marketing-consent\"\n          >\n            No thanks\n          </Button>\n          \n          <div className=\"flex-1\" />\n          \n          <div className=\"text-xs text-muted-foreground\">\n            <a \n              href=\"/privacy\" \n              className=\"underline hover:no-underline\"\n              data-testid=\"privacy-settings-link\"\n            >\n              Privacy settings\n            </a>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":6130},"client/src/components/usage-status.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { \n  Clock, \n  Calendar, \n  CalendarDays, \n  CalendarRange,\n  Brain,\n  FileText,\n  MessageSquare,\n  HelpCircle,\n  AlertTriangle,\n  CheckCircle\n} from \"lucide-react\";\n\ninterface UsageStats {\n  usage: Array<{\n    featureType: string;\n    hourlyCount: number;\n    dailyCount: number;\n    weeklyCount: number;\n    monthlyCount: number;\n  }>;\n  restrictions: Array<{\n    featureType: string;\n    restrictionType: string;\n    reason: string;\n    endTime: string | null;\n    canAppeal: boolean;\n  }>;\n  limits: {\n    [featureType: string]: {\n      hourly: number;\n      daily: number;\n      weekly: number;\n      monthly: number;\n    };\n  };\n}\n\nconst FEATURE_ICONS = {\n  interview_practice: Brain,\n  qa_generator: MessageSquare,\n  document_generation: FileText,\n  henry_feedback: HelpCircle,\n};\n\nconst FEATURE_NAMES = {\n  interview_practice: \"Interview Practice\",\n  qa_generator: \"Q&A Generator\",\n  document_generation: \"Document Generation\",\n  henry_feedback: \"Henry Helper\",\n};\n\nconst PERIOD_ICONS = {\n  hourly: Clock,\n  daily: Calendar,\n  weekly: CalendarDays,\n  monthly: CalendarRange,\n};\n\nexport function UsageStatus() {\n  const { data: stats, isLoading, error } = useQuery<UsageStats>({\n    queryKey: [\"/api/usage/stats\"],\n    refetchInterval: 60000, // Refresh every minute\n  });\n\n  if (isLoading) {\n    return (\n      <Card className=\"w-full\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Brain className=\"h-5 w-5\" />\n            AI Usage Status\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-sm text-muted-foreground\">Loading usage statistics...</div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (error || !stats) {\n    return (\n      <Card className=\"w-full\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Brain className=\"h-5 w-5\" />\n            AI Usage Status\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-sm text-muted-foreground\">Unable to load usage statistics</div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const getUsageForFeature = (featureType: string) => {\n    return stats.usage.find(u => u.featureType === featureType) || {\n      featureType,\n      hourlyCount: 0,\n      dailyCount: 0,\n      weeklyCount: 0,\n      monthlyCount: 0,\n    };\n  };\n\n  const getProgressColor = (percentage: number) => {\n    if (percentage >= 90) return \"bg-red-500\";\n    if (percentage >= 75) return \"bg-yellow-500\";\n    return \"bg-blue-500\";\n  };\n\n  const getStatusBadge = (percentage: number) => {\n    if (percentage >= 100) return <Badge variant=\"destructive\">Limit Reached</Badge>;\n    if (percentage >= 90) return <Badge variant=\"destructive\">Almost Full</Badge>;\n    if (percentage >= 75) return <Badge variant=\"secondary\">High Usage</Badge>;\n    return <Badge variant=\"default\">Normal</Badge>;\n  };\n\n  const activeRestrictions = stats.restrictions.filter(r => \n    !r.endTime || new Date(r.endTime) > new Date()\n  );\n\n  const formatTimeRemaining = (endTime: string) => {\n    const end = new Date(endTime);\n    const now = new Date();\n    const diff = end.getTime() - now.getTime();\n    \n    if (diff <= 0) return \"Restriction expired\";\n    \n    const hours = Math.floor(diff / (1000 * 60 * 60));\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n    \n    if (hours > 0) {\n      return `${hours}h ${minutes}m remaining`;\n    }\n    return `${minutes}m remaining`;\n  };\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Brain className=\"h-5 w-5\" />\n          AI Usage Status\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {/* Active Restrictions */}\n        {activeRestrictions.length > 0 && (\n          <div className=\"space-y-2\">\n            <h4 className=\"text-sm font-semibold text-red-600 dark:text-red-400\">Active Restrictions</h4>\n            {activeRestrictions.map((restriction, index) => (\n              <Alert key={index} variant=\"destructive\">\n                <AlertTriangle className=\"h-4 w-4\" />\n                <AlertDescription>\n                  <div className=\"space-y-1\">\n                    <div className=\"font-medium\">\n                      {FEATURE_NAMES[restriction.featureType as keyof typeof FEATURE_NAMES]} - Temporarily Limited\n                    </div>\n                    <div className=\"text-sm\">{restriction.reason}</div>\n                    {restriction.endTime && (\n                      <div className=\"text-sm font-medium\">\n                        {formatTimeRemaining(restriction.endTime)}\n                      </div>\n                    )}\n                  </div>\n                </AlertDescription>\n              </Alert>\n            ))}\n          </div>\n        )}\n\n        {/* Feature Usage */}\n        <div className=\"space-y-4\">\n          <h4 className=\"text-sm font-semibold\">Current Usage</h4>\n          {Object.entries(FEATURE_NAMES).map(([featureType, featureName]) => {\n            const usage = getUsageForFeature(featureType);\n            const limits = stats.limits[featureType];\n            const isRestricted = activeRestrictions.some(r => r.featureType === featureType);\n            \n            if (!limits) return null;\n            \n            const Icon = FEATURE_ICONS[featureType as keyof typeof FEATURE_ICONS];\n            \n            return (\n              <div key={featureType} className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <Icon className=\"h-4 w-4\" />\n                    <span className=\"text-sm font-medium\">{featureName}</span>\n                  </div>\n                  {isRestricted ? (\n                    <Badge variant=\"destructive\">Restricted</Badge>\n                  ) : (\n                    getStatusBadge((usage.dailyCount / limits.daily) * 100)\n                  )}\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-3 text-xs\">\n                  {[\n                    { key: 'daily', label: 'Today', icon: Calendar },\n                    { key: 'weekly', label: 'This Week', icon: CalendarDays },\n                  ].map(({ key, label, icon: PeriodIcon }) => {\n                    const count = usage[`${key}Count` as keyof typeof usage] as number;\n                    const limit = limits[key as keyof typeof limits];\n                    const percentage = (count / limit) * 100;\n                    \n                    return (\n                      <div key={key} className=\"space-y-2\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center gap-1\">\n                            <PeriodIcon className=\"h-3 w-3\" />\n                            <span>{label}</span>\n                          </div>\n                          <span className={percentage >= 90 ? \"text-red-500\" : \"text-muted-foreground\"}>\n                            {count}/{limit}\n                          </span>\n                        </div>\n                        <Progress \n                          value={Math.min(percentage, 100)} \n                          className=\"h-1.5\"\n                          indicatorClassName={getProgressColor(percentage)}\n                        />\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n\n        {/* Usage Guidelines */}\n        <div className=\"space-y-2\">\n          <h4 className=\"text-sm font-semibold\">Usage Guidelines</h4>\n          <div className=\"text-xs text-muted-foreground space-y-1\">\n            <div className=\"flex items-center gap-1\">\n              <CheckCircle className=\"h-3 w-3 text-green-500\" />\n              <span>These limits ensure fair access for all users</span>\n            </div>\n            <div className=\"flex items-center gap-1\">\n              <CheckCircle className=\"h-3 w-3 text-green-500\" />\n              <span>Limits reset automatically each period</span>\n            </div>\n            <div className=\"flex items-center gap-1\">\n              <CheckCircle className=\"h-3 w-3 text-green-500\" />\n              <span>Contact support if you need higher limits</span>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":8859},"client/src/pages/privacy-settings.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { \n  Shield, \n  Download, \n  Edit, \n  Trash2, \n  FileText, \n  Clock,\n  CheckCircle,\n  AlertTriangle,\n  Info,\n  HelpCircle,\n  MessageCircle,\n  ArrowLeft\n} from \"lucide-react\";\nimport { ConsentManager } from \"@/components/consent-manager\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface DataRequest {\n  id: string;\n  type: string;\n  status: string;\n  submittedDate: string;\n  completedDate?: string;\n  referenceId: string;\n  details?: string;\n}\n\nconst REQUEST_TYPE_LABELS = {\n  access: \"Data Access Request\",\n  rectification: \"Data Correction Request\", \n  erasure: \"Data Deletion Request\",\n  portability: \"Data Export Request\",\n  restriction: \"Data Processing Restriction\",\n  objection: \"Processing Objection\"\n};\n\nconst STATUS_COLORS = {\n  pending: \"bg-yellow-100 text-yellow-800\",\n  in_progress: \"bg-blue-100 text-blue-800\", \n  completed: \"bg-green-100 text-green-800\",\n  rejected: \"bg-red-100 text-red-800\"\n};\n\nexport default function PrivacySettings() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [activeTab, setActiveTab] = useState(\"consents\");\n  const [rectificationData, setRectificationData] = useState({\n    field: \"\",\n    currentValue: \"\",\n    requestedValue: \"\",\n    reason: \"\"\n  });\n  const [erasureReason, setErasureReason] = useState(\"\");\n\n  // Fetch user's GDPR requests\n  const { data: requestsData, isLoading: requestsLoading } = useQuery<{ requests: DataRequest[] }>({\n    queryKey: [\"/api/gdpr/requests\"],\n  });\n\n  const [, setLocation] = useLocation();\n\n  // Data access request mutation\n  const accessRequestMutation = useMutation({\n    mutationFn: async (details?: string) => {\n      const response = await apiRequest(\"POST\", \"/api/gdpr/request/access\", { details });\n      return response.json();\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/gdpr/requests\"] });\n      toast({\n        title: \"Data Access Request Submitted\",\n        description: `Reference ID: ${data.referenceId}. You'll receive your data within 30 days.`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to submit data access request. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Data rectification request mutation\n  const rectificationMutation = useMutation({\n    mutationFn: async (data: typeof rectificationData) => {\n      const response = await apiRequest(\"POST\", \"/api/gdpr/request/rectification\", data);\n      return response.json();\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/gdpr/requests\"] });\n      setRectificationData({ field: \"\", currentValue: \"\", requestedValue: \"\", reason: \"\" });\n      toast({\n        title: \"Correction Request Submitted\",\n        description: `Reference ID: ${data.referenceId}. We'll review your request shortly.`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\", \n        description: \"Failed to submit correction request. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Data erasure request mutation\n  const erasureMutation = useMutation({\n    mutationFn: async (reason: string) => {\n      const response = await apiRequest(\"POST\", \"/api/gdpr/request/erasure\", { \n        reason: \"user_request\",\n        specificData: reason || \"all_personal_data\"\n      });\n      return response.json();\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/gdpr/requests\"] });\n      setErasureReason(\"\");\n      toast({\n        title: \"Deletion Request Submitted\",\n        description: `Reference ID: ${data.referenceId}. Your account will be deleted within 30 days.`,\n        variant: \"destructive\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to submit deletion request. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Data portability request mutation\n  const portabilityMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/gdpr/request/portability\");\n      return response.json();\n    },\n    onSuccess: (data: any) => {\n      // Trigger download\n      const blob = new Blob([JSON.stringify(data.data, null, 2)], { \n        type: 'application/json' \n      });\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `healthhire_data_export_${new Date().toISOString().split('T')[0]}.json`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n\n      queryClient.invalidateQueries({ queryKey: [\"/api/gdpr/requests\"] });\n      toast({\n        title: \"Data Export Downloaded\",\n        description: \"Your personal data has been exported and downloaded.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to export data. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-GB', {\n      day: 'numeric',\n      month: 'short',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n      <div className=\"space-y-6\">\n        {/* Back to Dashboard Button */}\n        <div className=\"mb-8\">\n          <Button \n            variant=\"ghost\" \n            onClick={() => window.location.href = \"/\"}\n            className=\"flex items-center gap-2 text-muted-foreground hover:text-foreground\"\n            data-testid=\"button-back-dashboard\"\n          >\n            <ArrowLeft className=\"h-4 w-4\" />\n            Back to Dashboard\n          </Button>\n        </div>\n\n        {/* Header */}\n        <div className=\"space-y-2\">\n          <h1 className=\"text-3xl font-bold\">Privacy Settings</h1>\n          <p className=\"text-muted-foreground\">\n            Manage your privacy preferences and exercise your data protection rights.\n          </p>\n        </div>\n\n        {/* Support Section - Moved to top */}\n        <Card className=\"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"flex-shrink-0 w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center\">\n                <HelpCircle className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"font-semibold text-sm mb-2\">Need Help with Privacy Settings?</h3>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Our system is new so if you believe mistakes are there, submit a ticket through the support page. If your privacy settings aren't changing as expected or you requested information and haven't received it, please submit a support ticket for assistance.\n                </p>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={() => setLocation(\"/support\")}\n                  className=\"text-xs\"\n                  data-testid=\"button-get-support\"\n                >\n                  <MessageCircle className=\"h-3 w-3 mr-1\" />\n                  Get Support\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Tabs */}\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-4\">\n            <TabsTrigger value=\"consents\" data-testid=\"tab-consents\">Consent Management</TabsTrigger>\n            <TabsTrigger value=\"data-rights\" data-testid=\"tab-data-rights\">Data Rights</TabsTrigger>\n            <TabsTrigger value=\"requests\" data-testid=\"tab-requests\">My Requests</TabsTrigger>\n            <TabsTrigger value=\"info\" data-testid=\"tab-info\">Information</TabsTrigger>\n          </TabsList>\n\n          {/* Consent Management Tab */}\n          <TabsContent value=\"consents\" className=\"space-y-6\">\n            <ConsentManager />\n          </TabsContent>\n\n          {/* Data Rights Tab */}\n          <TabsContent value=\"data-rights\" className=\"space-y-6\">\n            <div className=\"grid gap-6 md:grid-cols-2\">\n              \n              {/* Data Access Request */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <FileText className=\"h-5 w-5\" />\n                    Access My Data\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Request a copy of all personal data we hold about you.\n                  </p>\n                  <Button \n                    onClick={() => accessRequestMutation.mutate(undefined)}\n                    disabled={accessRequestMutation.isPending}\n                    className=\"w-full\"\n                    data-testid=\"button-access-request\"\n                  >\n                    {accessRequestMutation.isPending ? \"Submitting...\" : \"Request My Data\"}\n                  </Button>\n                </CardContent>\n              </Card>\n\n              {/* Data Export */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Download className=\"h-5 w-5\" />\n                    Export My Data\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Download your data in a machine-readable format.\n                  </p>\n                  <Button \n                    onClick={() => portabilityMutation.mutate()}\n                    disabled={portabilityMutation.isPending}\n                    className=\"w-full\"\n                    data-testid=\"button-export-data\"\n                  >\n                    {portabilityMutation.isPending ? \"Preparing...\" : \"Download My Data\"}\n                  </Button>\n                </CardContent>\n              </Card>\n\n              {/* Data Correction */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Edit className=\"h-5 w-5\" />\n                    Correct My Data\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Request correction of inaccurate personal data.\n                  </p>\n                  \n                  <div className=\"space-y-3\">\n                    <div>\n                      <Label htmlFor=\"field\">Field to Correct</Label>\n                      <Input\n                        id=\"field\"\n                        placeholder=\"e.g., Email address\"\n                        value={rectificationData.field}\n                        onChange={(e) => setRectificationData(prev => ({ ...prev, field: e.target.value }))}\n                        data-testid=\"input-correction-field\"\n                      />\n                    </div>\n                    \n                    <div>\n                      <Label htmlFor=\"current\">Current Value</Label>\n                      <Input\n                        id=\"current\"\n                        placeholder=\"Current incorrect value\"\n                        value={rectificationData.currentValue}\n                        onChange={(e) => setRectificationData(prev => ({ ...prev, currentValue: e.target.value }))}\n                        data-testid=\"input-current-value\"\n                      />\n                    </div>\n                    \n                    <div>\n                      <Label htmlFor=\"requested\">Correct Value</Label>\n                      <Input\n                        id=\"requested\"\n                        placeholder=\"What it should be\"\n                        value={rectificationData.requestedValue}\n                        onChange={(e) => setRectificationData(prev => ({ ...prev, requestedValue: e.target.value }))}\n                        data-testid=\"input-requested-value\"\n                      />\n                    </div>\n                    \n                    <div>\n                      <Label htmlFor=\"reason\">Reason (Optional)</Label>\n                      <Textarea\n                        id=\"reason\"\n                        placeholder=\"Why this correction is needed\"\n                        value={rectificationData.reason}\n                        onChange={(e) => setRectificationData(prev => ({ ...prev, reason: e.target.value }))}\n                        rows={2}\n                        data-testid=\"textarea-correction-reason\"\n                      />\n                    </div>\n                  </div>\n                  \n                  <Button \n                    onClick={() => rectificationMutation.mutate(rectificationData)}\n                    disabled={rectificationMutation.isPending || !rectificationData.field || !rectificationData.requestedValue}\n                    className=\"w-full\"\n                    data-testid=\"button-submit-correction\"\n                  >\n                    {rectificationMutation.isPending ? \"Submitting...\" : \"Submit Correction\"}\n                  </Button>\n                </CardContent>\n              </Card>\n\n              {/* Data Deletion */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Trash2 className=\"h-5 w-5\" />\n                    Delete My Account\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <Alert>\n                    <AlertTriangle className=\"h-4 w-4\" />\n                    <AlertDescription>\n                      This will permanently delete your account and all associated data. This action cannot be undone.\n                    </AlertDescription>\n                  </Alert>\n                  \n                  <div>\n                    <Label htmlFor=\"erasure-reason\">Reason (Optional)</Label>\n                    <Textarea\n                      id=\"erasure-reason\"\n                      placeholder=\"Please tell us why you're deleting your account\"\n                      value={erasureReason}\n                      onChange={(e) => setErasureReason(e.target.value)}\n                      rows={3}\n                      data-testid=\"textarea-erasure-reason\"\n                    />\n                  </div>\n                  \n                  <Button \n                    onClick={() => erasureMutation.mutate(erasureReason)}\n                    disabled={erasureMutation.isPending}\n                    variant=\"destructive\"\n                    className=\"w-full\"\n                    data-testid=\"button-delete-account\"\n                  >\n                    {erasureMutation.isPending ? \"Submitting...\" : \"Delete My Account\"}\n                  </Button>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          {/* My Requests Tab */}\n          <TabsContent value=\"requests\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>My Privacy Requests</CardTitle>\n                <p className=\"text-sm text-muted-foreground\">\n                  Track the status of your data protection requests.\n                </p>\n              </CardHeader>\n              <CardContent>\n                {requestsLoading ? (\n                  <div className=\"text-center py-8\">\n                    <div className=\"text-sm text-muted-foreground\">Loading your requests...</div>\n                  </div>\n                ) : !requestsData?.requests?.length ? (\n                  <div className=\"text-center py-8\">\n                    <div className=\"text-sm text-muted-foreground\">\n                      You haven't submitted any privacy requests yet.\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {requestsData.requests.map((request) => (\n                      <div key={request.id} className=\"border rounded-lg p-4 space-y-3\">\n                        <div className=\"flex justify-between items-start\">\n                          <div className=\"space-y-1\">\n                            <h4 className=\"font-medium\">\n                              {REQUEST_TYPE_LABELS[request.type as keyof typeof REQUEST_TYPE_LABELS]}\n                            </h4>\n                            <p className=\"text-sm text-muted-foreground\">\n                              Reference: {request.referenceId}\n                            </p>\n                          </div>\n                          <Badge className={STATUS_COLORS[request.status as keyof typeof STATUS_COLORS]}>\n                            {request.status.charAt(0).toUpperCase() + request.status.slice(1)}\n                          </Badge>\n                        </div>\n                        \n                        <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                          <span className=\"flex items-center gap-1\">\n                            <Clock className=\"h-3 w-3\" />\n                            Submitted: {formatDate(request.submittedDate)}\n                          </span>\n                          {request.completedDate && (\n                            <span className=\"flex items-center gap-1\">\n                              <CheckCircle className=\"h-3 w-3\" />\n                              Completed: {formatDate(request.completedDate)}\n                            </span>\n                          )}\n                        </div>\n                        \n                        {request.details && (\n                          <div className=\"text-sm bg-muted p-2 rounded\">\n                            {request.details}\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Information Tab */}\n          <TabsContent value=\"info\" className=\"space-y-6\">\n            <div className=\"space-y-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Info className=\"h-5 w-5\" />\n                    Your Data Protection Rights\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid gap-4 md:grid-cols-2\">\n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-medium\">Right to Access</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        You can request a copy of your personal data we hold.\n                      </p>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-medium\">Right to Rectification</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        You can request correction of inaccurate personal data.\n                      </p>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-medium\">Right to Erasure</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        You can request deletion of your personal data.\n                      </p>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-medium\">Right to Portability</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        You can receive your data in a machine-readable format.\n                      </p>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-medium\">Right to Object</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        You can object to certain types of data processing.\n                      </p>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-medium\">Right to Restrict</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        You can request restriction of data processing.\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Data Processing Information</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-3\">\n                    <div>\n                      <h4 className=\"font-medium\">What data we collect:</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Profile information, CV data, job applications, interview responses, and usage analytics.\n                      </p>\n                    </div>\n                    \n                    <div>\n                      <h4 className=\"font-medium\">Why we process your data:</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        To provide career services, job matching, CV generation, interview practice, and platform improvements.\n                      </p>\n                    </div>\n                    \n                    <div>\n                      <h4 className=\"font-medium\">Legal basis for processing:</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Your consent and our legitimate interest in providing healthcare career services.\n                      </p>\n                    </div>\n                    \n                    <div>\n                      <h4 className=\"font-medium\">Data retention:</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        We retain your data for 7 years or until you request deletion, whichever comes first.\n                      </p>\n                    </div>\n                    \n                    <div>\n                      <h4 className=\"font-medium\">Third-party sharing:</h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        We do not share your personal data with third parties without your explicit consent.\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":24025},"server/config/usageLimits.ts":{"content":"// Usage limits configuration for AI features\nexport const USAGE_LIMITS = {\n  // Interview Practice Limits (reasonable for legitimate users)\n  interview_practice: {\n    hourly: 15,      // 15 practice sessions per hour\n    daily: 75,       // 75 sessions per day\n    weekly: 300,     // 300 sessions per week\n    monthly: 800     // 800 sessions per month\n  },\n  \n  // Q&A Generator Limits (for study preparation)\n  qa_generator: {\n    hourly: 8,       // 8 Q&A generations per hour\n    daily: 25,       // 25 generations per day\n    weekly: 100,     // 100 generations per week\n    monthly: 300     // 300 generations per month\n  },\n  \n  // Henry Feedback/Document Generation Limits\n  document_generation: {\n    hourly: 5,       // 5 document generations per hour\n    daily: 20,       // 20 generations per day\n    weekly: 80,      // 80 generations per week\n    monthly: 200     // 200 generations per month\n  },\n\n  // Henry Helper Feedback (for duties and suggestions)\n  henry_feedback: {\n    hourly: 8,       // 8 job duty sets per hour\n    daily: 20,       // 20 job duty sets per day (max)\n    weekly: 25,      // 25 job duty sets per week\n    monthly: 30      // 30 job duty sets per month\n  }\n} as const;\n\n// Warning thresholds (percentage of limit)\nexport const WARNING_THRESHOLDS = {\n  first_warning: 0.75,   // 75% of limit - gentle reminder\n  final_warning: 0.90,   // 90% of limit - strong warning\n  restriction: 1.0       // 100% of limit - enforce restriction\n} as const;\n\n// Suspicious pattern detection configurations\nexport const SUSPICIOUS_PATTERNS = {\n  rapid_requests: {\n    requests_per_minute: 8,   // More than 8 requests per minute\n    duration_minutes: 3       // Sustained for 3 minutes\n  },\n  identical_content: {\n    threshold: 3              // Same content submitted 3+ times within short period\n  },\n  off_hours_usage: {\n    requests_per_hour: 25,    // 25+ requests between 1-5 AM\n    time_range: [1, 5] as const // 1 AM to 5 AM\n  },\n  burst_detection: {\n    max_requests_per_5min: 20, // More than 20 requests in 5 minutes\n    burst_threshold: 3         // 3 bursts in an hour triggers review\n  }\n} as const;\n\n// Feature type mapping for easier identification\nexport const FEATURE_TYPE_MAP = {\n  'interview_practice': 'Interview Practice',\n  'qa_generator': 'Q&A Generator', \n  'document_generation': 'Document Generation',\n  'henry_feedback': 'Henry Helper'\n} as const;\n\nexport type FeatureType = keyof typeof USAGE_LIMITS;\nexport type LimitPeriod = 'hourly' | 'daily' | 'weekly' | 'monthly';\n\n// Grace periods for different violation types\nexport const RESTRICTION_DURATIONS = {\n  first_offense: {\n    hourly: 1,    // 1 hour cool-down\n    daily: 6,     // 6 hours cool-down\n    weekly: 24,   // 24 hours cool-down\n    monthly: 72   // 72 hours cool-down\n  },\n  repeat_offense: {\n    hourly: 2,    // 2 hours\n    daily: 12,    // 12 hours\n    weekly: 48,   // 48 hours\n    monthly: 168  // 7 days\n  },\n  severe_abuse: {\n    hourly: 24,   // 24 hours\n    daily: 72,    // 72 hours\n    weekly: 168,  // 7 days\n    monthly: 720  // 30 days\n  }\n} as const;\n\n// Email templates configuration\nexport const EMAIL_TEMPLATES = {\n  first_warning: {\n    subject: 'AI Feature Usage Reminder - HealthHire Portal',\n    type: 'friendly_reminder' as const\n  },\n  final_warning: {\n    subject: 'Important: AI Usage Limit Warning - HealthHire Portal',\n    type: 'urgent_warning' as const\n  },\n  restriction_applied: {\n    subject: 'AI Feature Access Temporarily Limited - HealthHire Portal',\n    type: 'restriction_notice' as const\n  },\n  restriction_lifted: {\n    subject: 'AI Feature Access Restored - HealthHire Portal',\n    type: 'good_news' as const\n  }\n} as const;\n\n// Helper function to get feature display name\nexport function getFeatureDisplayName(featureType: FeatureType): string {\n  return FEATURE_TYPE_MAP[featureType] || featureType;\n}\n\n// Helper function to determine if pattern is suspicious\nexport function isSuspiciousTime(): boolean {\n  const currentHour = new Date().getHours();\n  const [startHour, endHour] = SUSPICIOUS_PATTERNS.off_hours_usage.time_range;\n  return currentHour >= startHour && currentHour <= endHour;\n}\n\n// Helper to calculate restriction end time\nexport function calculateRestrictionEndTime(\n  violationType: keyof typeof RESTRICTION_DURATIONS,\n  period: LimitPeriod\n): Date {\n  const now = new Date();\n  const hours = RESTRICTION_DURATIONS[violationType][period];\n  return new Date(now.getTime() + hours * 60 * 60 * 1000);\n}","size_bytes":4482},"server/middleware/auditLogging.ts":{"content":"import type { Request, Response, NextFunction } from 'express';\nimport { storage } from '../storage';\n\ninterface AuditLogData {\n  userId: string;\n  accessedBy?: string;\n  accessType: 'view' | 'edit' | 'delete' | 'export' | 'create';\n  dataType: string;\n  purpose?: string;\n}\n\n// Audit logging middleware that can be applied to routes\nexport function auditDataAccess(dataType: string, accessType: 'view' | 'edit' | 'delete' | 'export' | 'create', purpose?: string) {\n  return async (req: any, res: Response, next: NextFunction) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const ipAddress = req.ip || req.connection.remoteAddress;\n      const userAgent = req.get('User-Agent');\n      \n      if (userId) {\n        await storage.logDataAccess({\n          userId,\n          accessedBy: userId, // Self-access in most cases\n          accessType,\n          dataType,\n          ipAddress,\n          userAgent,\n          purpose: purpose || `User ${accessType} ${dataType}`\n        });\n      }\n\n      next();\n    } catch (error) {\n      console.error('Audit logging error:', error);\n      // Don't fail the request if audit logging fails\n      next();\n    }\n  };\n}\n\n// Helper function to log admin access to user data\nexport async function logAdminDataAccess(\n  adminUserId: string,\n  targetUserId: string,\n  accessType: 'view' | 'edit' | 'delete' | 'export',\n  dataType: string,\n  purpose: string,\n  req: Request\n) {\n  try {\n    const ipAddress = req.ip || req.connection.remoteAddress;\n    const userAgent = req.get('User-Agent');\n\n    await storage.logDataAccess({\n      userId: targetUserId,\n      accessedBy: adminUserId,\n      accessType,\n      dataType,\n      ipAddress,\n      userAgent,\n      purpose\n    });\n  } catch (error) {\n    console.error('Admin audit logging error:', error);\n  }\n}\n\n// Helper function to log API-based data access\nexport async function logApiDataAccess(\n  userId: string,\n  accessType: 'view' | 'edit' | 'delete' | 'export' | 'create',\n  dataType: string,\n  purpose: string,\n  req: Request\n) {\n  try {\n    const ipAddress = req.ip || req.connection.remoteAddress;\n    const userAgent = req.get('User-Agent');\n\n    await storage.logDataAccess({\n      userId,\n      accessedBy: userId,\n      accessType,\n      dataType,\n      ipAddress,\n      userAgent,\n      purpose\n    });\n  } catch (error) {\n    console.error('API audit logging error:', error);\n  }\n}\n\n// Comprehensive logging for GDPR data exports\nexport async function logGdprDataExport(\n  userId: string,\n  exportType: 'access_request' | 'portability_request' | 'admin_export',\n  req: Request\n) {\n  try {\n    const ipAddress = req.ip || req.connection.remoteAddress;\n    const userAgent = req.get('User-Agent');\n\n    await storage.logDataAccess({\n      userId,\n      accessedBy: userId,\n      accessType: 'export',\n      dataType: 'complete_personal_data',\n      ipAddress,\n      userAgent,\n      purpose: `GDPR ${exportType.replace('_', ' ')} - Complete data export`\n    });\n  } catch (error) {\n    console.error('GDPR export audit logging error:', error);\n  }\n}\n\n// Logging for data deletion/anonymization\nexport async function logDataDeletion(\n  userId: string,\n  deletionType: 'full_deletion' | 'anonymization' | 'partial_deletion',\n  adminUserId?: string,\n  req?: Request\n) {\n  try {\n    const ipAddress = req?.ip || req?.connection.remoteAddress;\n    const userAgent = req?.get('User-Agent');\n\n    await storage.logDataAccess({\n      userId,\n      accessedBy: adminUserId || userId,\n      accessType: 'delete',\n      dataType: 'personal_data',\n      ipAddress,\n      userAgent,\n      purpose: `GDPR ${deletionType.replace('_', ' ')}`\n    });\n  } catch (error) {\n    console.error('Data deletion audit logging error:', error);\n  }\n}","size_bytes":3739},"server/middleware/usageMonitoring.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { db } from '../db';\nimport { aiUsageTracking, usageViolations, userRestrictions } from '@shared/schema';\nimport { eq, and, sql } from 'drizzle-orm';\nimport { \n  USAGE_LIMITS, \n  WARNING_THRESHOLDS, \n  SUSPICIOUS_PATTERNS,\n  RESTRICTION_DURATIONS,\n  calculateRestrictionEndTime,\n  type FeatureType,\n  type LimitPeriod \n} from '../config/usageLimits';\n\nexport interface AuthenticatedRequest extends Request {\n  user?: {\n    id: string;\n    claims?: {\n      sub: string;\n      email?: string;\n    };\n  };\n}\n\nexport class UsageMonitor {\n  \n  /**\n   * Track usage for a specific feature and user\n   */\n  static async trackUsage(userId: string, featureType: FeatureType): Promise<void> {\n    const today = new Date().toISOString().split('T')[0];\n    const currentHour = new Date().getHours();\n    \n    try {\n      // Get or create usage record for today\n      const [existingUsage] = await db\n        .select()\n        .from(aiUsageTracking)\n        .where(and(\n          eq(aiUsageTracking.userId, userId),\n          eq(aiUsageTracking.featureType, featureType),\n          eq(aiUsageTracking.usageDate, today)\n        ));\n\n      if (existingUsage) {\n        // Update existing record\n        await db\n          .update(aiUsageTracking)\n          .set({\n            hourlyCount: existingUsage.lastHour === currentHour \n              ? (existingUsage.hourlyCount || 0) + 1 \n              : 1, // Reset hourly count if different hour\n            dailyCount: (existingUsage.dailyCount || 0) + 1,\n            weeklyCount: (existingUsage.weeklyCount || 0) + 1,\n            monthlyCount: (existingUsage.monthlyCount || 0) + 1,\n            lastHour: currentHour,\n            updatedAt: new Date()\n          })\n          .where(eq(aiUsageTracking.id, existingUsage.id));\n      } else {\n        // Create new record\n        await db\n          .insert(aiUsageTracking)\n          .values({\n            userId,\n            featureType,\n            usageDate: today,\n            hourlyCount: 1,\n            dailyCount: 1,\n            weeklyCount: 1,\n            monthlyCount: 1,\n            lastHour: currentHour\n          });\n      }\n    } catch (error) {\n      console.error('Error tracking AI usage:', error);\n      // Don't throw - tracking shouldn't break the user experience\n    }\n  }\n\n  /**\n   * Get current usage for a user and feature\n   */\n  static async getCurrentUsage(userId: string, featureType: FeatureType) {\n    const today = new Date().toISOString().split('T')[0];\n    const currentHour = new Date().getHours();\n    \n    const [usage] = await db\n      .select()\n      .from(aiUsageTracking)\n      .where(and(\n        eq(aiUsageTracking.userId, userId),\n        eq(aiUsageTracking.featureType, featureType),\n        eq(aiUsageTracking.usageDate, today)\n      ));\n\n    return {\n      hourly_count: usage?.lastHour === currentHour ? (usage.hourlyCount || 0) : 0,\n      daily_count: usage?.dailyCount || 0,\n      weekly_count: usage?.weeklyCount || 0,\n      monthly_count: usage?.monthlyCount || 0\n    };\n  }\n\n  /**\n   * Check for violations and handle them\n   */\n  static async checkViolations(userId: string, featureType: FeatureType) {\n    const usage = await this.getCurrentUsage(userId, featureType);\n    const limits = USAGE_LIMITS[featureType];\n    const violations = [];\n\n    // Check each time period\n    const periods: LimitPeriod[] = ['hourly', 'daily', 'weekly', 'monthly'];\n    \n    for (const period of periods) {\n      const currentUsage = usage[`${period}_count`];\n      const limit = limits[period];\n      const percentage = currentUsage / limit;\n\n      if (percentage >= WARNING_THRESHOLDS.restriction) {\n        violations.push({\n          type: 'limit_exceeded',\n          period,\n          current: currentUsage,\n          limit,\n          percentage\n        });\n      } else if (percentage >= WARNING_THRESHOLDS.final_warning) {\n        violations.push({\n          type: 'final_warning',\n          period,\n          current: currentUsage,\n          limit,\n          percentage\n        });\n      } else if (percentage >= WARNING_THRESHOLDS.first_warning) {\n        violations.push({\n          type: 'first_warning',\n          period,\n          current: currentUsage,\n          limit,\n          percentage\n        });\n      }\n    }\n\n    // Process violations\n    for (const violation of violations) {\n      await this.handleViolation(userId, featureType, violation);\n    }\n\n    return violations;\n  }\n\n  /**\n   * Handle a specific violation\n   */\n  static async handleViolation(userId: string, featureType: FeatureType, violation: any) {\n    try {\n      // Record the violation\n      await db.insert(usageViolations).values({\n        userId,\n        violationType: violation.type,\n        featureType,\n        violationDetails: violation,\n        warningSent: false,\n        restrictionApplied: false,\n        resolved: false\n      });\n\n      switch (violation.type) {\n        case 'first_warning':\n          // Log warning but don't restrict yet\n          console.log(`First warning issued to user ${userId} for ${featureType}`);\n          break;\n        case 'final_warning':\n          // Log final warning\n          console.log(`Final warning issued to user ${userId} for ${featureType}`);\n          break;\n        case 'limit_exceeded':\n          await this.applyRestriction(userId, featureType, violation);\n          break;\n      }\n    } catch (error) {\n      console.error('Error handling violation:', error);\n    }\n  }\n\n  /**\n   * Apply restriction to user\n   */\n  static async applyRestriction(userId: string, featureType: FeatureType, violation: any) {\n    try {\n      // Determine restriction duration\n      const endTime = calculateRestrictionEndTime('first_offense', violation.period);\n      \n      await db.insert(userRestrictions).values({\n        userId,\n        featureType,\n        restrictionType: 'rate_limit',\n        endTime,\n        reason: `Exceeded ${violation.period} usage limit (${violation.current}/${violation.limit})`,\n        canAppeal: true,\n        appealSubmitted: false,\n        isActive: true\n      });\n\n      console.log(`Restriction applied to user ${userId} for ${featureType} until ${endTime}`);\n    } catch (error) {\n      console.error('Error applying restriction:', error);\n    }\n  }\n\n  /**\n   * Check if user has active restrictions\n   */\n  static async checkRestrictions(userId: string, featureType: FeatureType) {\n    const restrictions = await db\n      .select()\n      .from(userRestrictions)\n      .where(and(\n        eq(userRestrictions.userId, userId),\n        eq(userRestrictions.featureType, featureType),\n        eq(userRestrictions.isActive, true)\n      ));\n\n    const activeRestrictions = restrictions.filter(r => \n      !r.endTime || r.endTime > new Date()\n    );\n\n    return activeRestrictions;\n  }\n\n  /**\n   * Check for suspicious patterns\n   */\n  static async checkSuspiciousPatterns(userId: string, featureType: FeatureType) {\n    // For now, implement basic suspicious time detection\n    const now = new Date();\n    const currentHour = now.getHours();\n    const [startHour, endHour] = SUSPICIOUS_PATTERNS.off_hours_usage.time_range;\n    \n    if (currentHour >= startHour && currentHour <= endHour) {\n      const usage = await this.getCurrentUsage(userId, featureType);\n      \n      if ((usage.hourly_count || 0) > SUSPICIOUS_PATTERNS.off_hours_usage.requests_per_hour) {\n        // Log suspicious activity\n        await db.insert(usageViolations).values({\n          userId,\n          violationType: 'suspicious_pattern',\n          featureType,\n          violationDetails: {\n            pattern: 'off_hours_usage',\n            hour: currentHour,\n            requests: usage.hourly_count,\n            threshold: SUSPICIOUS_PATTERNS.off_hours_usage.requests_per_hour\n          }\n        });\n      }\n    }\n  }\n}\n\n/**\n * Middleware to check usage restrictions before allowing AI requests\n */\nexport const checkUsageRestrictions = (featureType: FeatureType) => {\n  return async (req: AuthenticatedRequest, res: Response, next: NextFunction) => {\n    try {\n      // Skip if not authenticated (other middleware will handle)\n      if (!req.user?.id) {\n        return next();\n      }\n\n      const userId = req.user.id;\n\n      // Check for active restrictions\n      const restrictions = await UsageMonitor.checkRestrictions(userId, featureType);\n      \n      if (restrictions.length > 0) {\n        const restriction = restrictions[0];\n        \n        // Special message for henry_feedback (job duties generation)\n        if (featureType === 'henry_feedback') {\n          return res.status(429).json({\n            error: 'Usage Restricted',\n            message: 'Limit reached. You\\'ve hit the monthly usage limit for this feature. Our system has detected usage patterns that may suggest the tool isn\\'t being used as intended. You can wait for your allowance to reset or contact us if you believe this is an error.',\n            details: {\n              restriction_type: restriction.restrictionType,\n              reason: restriction.reason,\n              end_time: restriction.endTime,\n              can_appeal: restriction.canAppeal,\n              feature: featureType\n            }\n          });\n        }\n        \n        // Default message for other features\n        return res.status(429).json({\n          error: 'Usage Restricted',\n          message: 'AI feature usage is temporarily limited.',\n          details: {\n            restriction_type: restriction.restrictionType,\n            reason: restriction.reason,\n            end_time: restriction.endTime,\n            can_appeal: restriction.canAppeal,\n            feature: featureType\n          },\n          next_steps: [\n            'Normal access will resume automatically after the restriction period',\n            'If you believe this is an error, please contact support',\n            'You can continue using other platform features normally'\n          ]\n        });\n      }\n\n      // Check current usage BEFORE allowing the request\n      const currentUsage = await UsageMonitor.getCurrentUsage(userId, featureType);\n      const limits = USAGE_LIMITS[featureType];\n      \n      // Check if any usage limits would be exceeded by this request\n      const periods: LimitPeriod[] = ['hourly', 'daily', 'weekly', 'monthly'];\n      \n      for (const period of periods) {\n        const currentCount = (currentUsage as any)[`${period}_count`] || 0;\n        const limit = limits[period];\n        \n        if (currentCount >= limit) {\n          // Apply restriction immediately\n          const violation = {\n            type: 'limit_exceeded',\n            period,\n            current: currentCount,\n            limit,\n            percentage: currentCount / limit\n          };\n          \n          await UsageMonitor.applyRestriction(userId, featureType, violation);\n          \n          // Special message for henry_feedback\n          if (featureType === 'henry_feedback') {\n            return res.status(429).json({\n              error: 'Usage Limit Exceeded',\n              message: `You've reached your ${period} limit of ${limit} requests for Henry's job duties feature. Please wait for your allowance to reset.`,\n              details: {\n                period,\n                current: currentCount,\n                limit,\n                reset_info: `Your ${period} limit will reset automatically`,\n                feature: featureType\n              }\n            });\n          }\n          \n          // Default message for other features\n          return res.status(429).json({\n            error: 'Usage Limit Exceeded',\n            message: `You've reached your ${period} limit of ${limit} requests for this feature.`,\n            details: {\n              period,\n              current: currentCount,\n              limit,\n              feature: featureType\n            }\n          });\n        }\n      }\n\n      // Track this usage request (only if we're within limits)\n      await UsageMonitor.trackUsage(userId, featureType);\n\n      // Add usage info to response headers for transparency\n      const updatedUsage = await UsageMonitor.getCurrentUsage(userId, featureType);\n      res.setHeader('X-Usage-Daily', `${updatedUsage.daily_count}/${limits.daily}`);\n      res.setHeader('X-Usage-Hourly', `${updatedUsage.hourly_count}/${limits.hourly}`);\n\n      // Check for warnings after tracking usage\n      const violations = await UsageMonitor.checkViolations(userId, featureType);\n      const warningViolations = violations.filter(v => v.type === 'first_warning' || v.type === 'final_warning');\n      if (warningViolations.length > 0) {\n        res.setHeader('X-Usage-Warning', 'Approaching usage limits');\n      }\n\n      // Check for suspicious patterns\n      await UsageMonitor.checkSuspiciousPatterns(userId, featureType);\n\n      next();\n      \n    } catch (error) {\n      console.error('Usage monitoring error:', error);\n      // Don't block requests if monitoring fails - user experience is priority\n      next();\n    }\n  };\n};\n\n/**\n * Get usage statistics for a user\n */\nexport const getUserUsageStats = async (userId: string) => {\n  const today = new Date().toISOString().split('T')[0];\n  \n  const usageStats = await db\n    .select()\n    .from(aiUsageTracking)\n    .where(and(\n      eq(aiUsageTracking.userId, userId),\n      eq(aiUsageTracking.usageDate, today)\n    ));\n\n  const restrictions = await db\n    .select()\n    .from(userRestrictions)\n    .where(and(\n      eq(userRestrictions.userId, userId),\n      eq(userRestrictions.isActive, true)\n    ));\n\n  return {\n    usage: usageStats,\n    restrictions: restrictions.filter(r => !r.endTime || r.endTime > new Date()),\n    limits: USAGE_LIMITS\n  };\n};","size_bytes":13703},"client/src/components/ai-consent-widget.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { X, Brain, Shield, AlertTriangle } from \"lucide-react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface AiConsentWidgetProps {\n  onConsentGiven?: () => void;\n  onDismiss?: () => void;\n  isVisible?: boolean;\n}\n\nexport function AiConsentWidget({ onConsentGiven, onDismiss, isVisible: externallyControlled }: AiConsentWidgetProps) {\n  const [internalVisible, setInternalVisible] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Use external control if provided, otherwise use internal state\n  const isVisible = externallyControlled !== undefined ? externallyControlled : internalVisible;\n\n  // Get current consents\n  const { data: consentsData } = useQuery({\n    queryKey: [\"/api/gdpr/consents\"],\n  });\n\n  // Consent mutation\n  const consentMutation = useMutation({\n    mutationFn: async (given: boolean) => {\n      return apiRequest(\"POST\", \"/api/gdpr/consent\", {\n        consent_type: \"ai_processing\",\n        consent_given: given,\n      });\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/gdpr/consents\"] });\n      setInternalVisible(false);\n      toast({\n        title: variables ? \"AI Processing enabled! üéâ\" : \"AI Processing disabled\",\n        description: variables \n          ? \"You can now use AI features for document generation, job matching, and career insights.\"\n          : \"AI features have been disabled. You can re-enable them in Privacy Settings anytime.\",\n      });\n      if (variables && onConsentGiven) {\n        onConsentGiven();\n      }\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update consent. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Check if AI consent has been given - widget visibility is controlled externally\n  // This component will be shown/hidden by parent components when AI consent is needed\n\n  // Don't show if not visible\n  if (!isVisible) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\n      <Card className=\"w-full max-w-md bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 border-orange-200 dark:border-orange-800 shadow-lg\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-start justify-between mb-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-orange-100 dark:bg-orange-900 rounded-lg flex items-center justify-center\">\n                <Brain className=\"h-5 w-5 text-orange-600 dark:text-orange-400\" />\n              </div>\n              <div>\n                <h4 className=\"font-semibold text-lg\">AI Features Require Consent</h4>\n                <Badge variant=\"secondary\" className=\"text-xs mt-1\">\n                  <AlertTriangle className=\"h-3 w-3 mr-1\" />\n                  Required for AI Use\n                </Badge>\n              </div>\n            </div>\n            \n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => {\n                setInternalVisible(false);\n                onDismiss?.();\n              }}\n              className=\"h-auto p-1 text-muted-foreground hover:text-foreground\"\n              data-testid=\"button-close-ai-consent\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          \n          <p className=\"text-sm text-muted-foreground mb-4 leading-relaxed\">\n            To use AI-powered features like document generation, job matching, and career insights, you must consent to AI processing of your data.\n          </p>\n          \n          <div className=\"flex items-center gap-2 text-xs text-muted-foreground mb-6\">\n            <Shield className=\"h-3 w-3 text-green-500\" />\n            <span>AI is utilised for Henry the Helper to utilise this feature</span>\n            <span className=\"text-muted-foreground/60\">‚Ä¢</span>\n            <Brain className=\"h-3 w-3 text-blue-500\" />\n            <span>Used only for AI features</span>\n          </div>\n          \n          <div className=\"flex gap-2\">\n            <Button\n              onClick={() => consentMutation.mutate(true)}\n              disabled={consentMutation.isPending}\n              className=\"flex-1\"\n              data-testid=\"button-allow-ai\"\n            >\n              <Brain className=\"h-4 w-4 mr-2\" />\n              {consentMutation.isPending ? \"Enabling...\" : \"Enable AI Features\"}\n            </Button>\n            \n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setInternalVisible(false);\n                onDismiss?.();\n              }}\n              disabled={consentMutation.isPending}\n              data-testid=\"button-not-now-ai\"\n            >\n              Not Now\n            </Button>\n          </div>\n          \n          <p className=\"text-xs text-muted-foreground mt-3 text-center\">\n            You can change this setting anytime in{\" \"}\n            <button \n              onClick={() => window.location.href = \"/privacy\"}\n              className=\"text-primary hover:underline\"\n            >\n              Privacy Settings\n            </button>\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":5652},"client/src/components/analytics-consent-widget.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { X, BarChart3, TrendingUp, Eye } from \"lucide-react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport function AnalyticsConsentWidget() {\n  const [isVisible, setIsVisible] = useState(false);\n  const [isDismissed, setIsDismissed] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Get current consents\n  const { data: consentsData } = useQuery({\n    queryKey: [\"/api/gdpr/consents\"],\n  });\n\n  // Consent mutation\n  const consentMutation = useMutation({\n    mutationFn: async (given: boolean) => {\n      return apiRequest(\"POST\", \"/api/gdpr/consent\", {\n        consent_type: \"analytics\",\n        consent_given: given,\n      });\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/gdpr/consents\"] });\n      setIsVisible(false);\n      toast({\n        title: variables ? \"Analytics enabled! üìä\" : \"Analytics disabled\",\n        description: variables \n          ? \"We'll now track your usage to improve your experience and provide better insights.\"\n          : \"Analytics tracking has been disabled. You can re-enable it in Privacy Settings anytime.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update consent. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Check if analytics consent has been given and show widget randomly once per day\n  useEffect(() => {\n    if (consentsData?.consents && !isDismissed) {\n      const analyticsConsent = consentsData.consents.find((c: any) => c.type === 'analytics');\n      const hasAnalyticsConsent = analyticsConsent?.given;\n      \n      if (!hasAnalyticsConsent) {\n        // Check if we've shown this today\n        const lastShown = localStorage.getItem('analytics-widget-shown');\n        const today = new Date().toDateString();\n        \n        if (lastShown !== today) {\n          // Show randomly (30% chance) once per day\n          const shouldShow = Math.random() < 0.3;\n          if (shouldShow) {\n            setIsVisible(true);\n            localStorage.setItem('analytics-widget-shown', today);\n          }\n        }\n      }\n    }\n  }, [consentsData, isDismissed]);\n\n  const handleDismiss = () => {\n    setIsVisible(false);\n    setIsDismissed(true);\n  };\n\n  // Don't show if not visible\n  if (!isVisible) {\n    return null;\n  }\n\n  return (\n    <Card className=\"fixed bottom-4 right-4 w-80 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-blue-200 dark:border-blue-800 shadow-lg z-40\">\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-start justify-between mb-3\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center\">\n              <BarChart3 className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n            </div>\n            <div>\n              <h4 className=\"font-medium text-sm\">Improve Your Experience</h4>\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                <Eye className=\"h-3 w-3 mr-1\" />\n                Optional\n              </Badge>\n            </div>\n          </div>\n          \n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleDismiss}\n            className=\"h-auto p-1 text-muted-foreground hover:text-foreground\"\n            data-testid=\"button-close-analytics-consent\"\n          >\n            <X className=\"h-3 w-3\" />\n          </Button>\n        </div>\n        \n        <p className=\"text-xs text-muted-foreground mb-3 leading-relaxed\">\n          Help us improve your NHS career journey by allowing analytics and performance tracking.\n        </p>\n        \n        <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground mb-4\">\n          <TrendingUp className=\"h-3 w-3 text-green-500\" />\n          <span>Better insights</span>\n          <span className=\"text-muted-foreground/60\">‚Ä¢</span>\n          <BarChart3 className=\"h-3 w-3 text-blue-500\" />\n          <span>Improved features</span>\n        </div>\n        \n        <div className=\"flex gap-2\">\n          <Button\n            size=\"sm\"\n            onClick={() => consentMutation.mutate(true)}\n            disabled={consentMutation.isPending}\n            className=\"flex-1 text-xs\"\n            data-testid=\"button-allow-analytics\"\n          >\n            Enable Tracking\n          </Button>\n          \n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleDismiss}\n            disabled={consentMutation.isPending}\n            className=\"text-xs\"\n            data-testid=\"button-no-thanks-analytics\"\n          >\n            No Thanks\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":5162},"server/middleware/adminSecurity.ts":{"content":"import type { Request, Response, NextFunction } from \"express\";\nimport bcrypt from \"bcrypt\";\nimport { logSecurityEvent } from \"./security\";\n\n// Admin role enumeration\nexport enum AdminRole {\n  SUPER_ADMIN = 'super_admin',\n  ADMIN = 'admin',\n  EDITOR = 'editor', \n  SUPPORT = 'support'\n}\n\n// Admin permissions mapping\nconst ROLE_PERMISSIONS = {\n  [AdminRole.SUPER_ADMIN]: ['*'], // All permissions\n  [AdminRole.ADMIN]: ['user.read', 'user.edit', 'user.delete', 'data.export', 'system.config'],\n  [AdminRole.EDITOR]: ['content.read', 'content.edit', 'user.read'],\n  [AdminRole.SUPPORT]: ['user.read', 'support.read', 'support.respond']\n};\n\n// Admin user interface (in production, this would be in the database)\ninterface AdminUser {\n  id: string;\n  email: string;\n  role: AdminRole;\n  mfaEnabled: boolean;\n  mfaSecret?: string;\n  lastLogin?: Date;\n  loginAttempts: number;\n  lockedUntil?: Date;\n}\n\n// In-memory admin store (replace with database in production)\nconst adminUsers = new Map<string, AdminUser>();\n\n// Admin authentication middleware\nexport function requireAdmin(req: Request, res: Response, next: NextFunction) {\n  const user = (req as any).user;\n  \n  if (!user || !isAdminUser(user.email)) {\n    logSecurityEvent({\n      type: 'auth_failure',\n      ip: req.ip || 'unknown',\n      userAgent: req.get('User-Agent') || 'unknown',\n      endpoint: req.path,\n      timestamp: new Date(),\n      details: { reason: 'unauthorized_admin_access', email: user?.email }\n    });\n    \n    return res.status(403).json({ error: \"Admin access required\" });\n  }\n  \n  next();\n}\n\n// Role-based access control\nexport function requireRole(role: AdminRole) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const user = (req as any).user;\n    const adminUser = getAdminUser(user?.email);\n    \n    if (!adminUser || !hasRole(adminUser.role, role)) {\n      logSecurityEvent({\n        type: 'auth_failure',\n        ip: req.ip || 'unknown',\n        userAgent: req.get('User-Agent') || 'unknown',\n        endpoint: req.path,\n        timestamp: new Date(),\n        details: { \n          reason: 'insufficient_role', \n          required: role, \n          actual: adminUser?.role,\n          email: user?.email \n        }\n      });\n      \n      return res.status(403).json({ error: \"Insufficient permissions\" });\n    }\n    \n    next();\n  };\n}\n\n// Permission-based access control\nexport function requirePermission(permission: string) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const user = (req as any).user;\n    const adminUser = getAdminUser(user?.email);\n    \n    if (!adminUser || !hasPermission(adminUser.role, permission)) {\n      logSecurityEvent({\n        type: 'auth_failure',\n        ip: req.ip || 'unknown',\n        userAgent: req.get('User-Agent') || 'unknown',\n        endpoint: req.path,\n        timestamp: new Date(),\n        details: { \n          reason: 'insufficient_permission', \n          required: permission, \n          email: user?.email \n        }\n      });\n      \n      return res.status(403).json({ error: \"Permission denied\" });\n    }\n    \n    next();\n  };\n}\n\n// MFA requirement for admin actions\nexport function requireMFA(req: Request, res: Response, next: NextFunction) {\n  const user = (req as any).user;\n  const adminUser = getAdminUser(user?.email);\n  \n  if (!adminUser?.mfaEnabled) {\n    return res.status(403).json({ \n      error: \"Multi-factor authentication required for admin access\" \n    });\n  }\n  \n  // In a real implementation, verify MFA token here\n  const mfaToken = req.headers['x-mfa-token'] as string;\n  if (!mfaToken || !verifyMFAToken(adminUser, mfaToken)) {\n    logSecurityEvent({\n      type: 'auth_failure',\n      ip: req.ip || 'unknown',\n      userAgent: req.get('User-Agent') || 'unknown',\n      endpoint: req.path,\n      timestamp: new Date(),\n      details: { reason: 'invalid_mfa_token', email: user?.email }\n    });\n    \n    return res.status(403).json({ error: \"Invalid MFA token\" });\n  }\n  \n  next();\n}\n\n// Admin session management\nexport function logAdminAction(action: string) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const user = (req as any).user;\n    const originalSend = res.send;\n    \n    res.send = function(data) {\n      // Log admin action after successful response\n      if (res.statusCode < 400) {\n        console.log(`[ADMIN_AUDIT] ${user?.email} performed ${action} at ${req.path}`, {\n          ip: req.ip,\n          userAgent: req.get('User-Agent'),\n          timestamp: new Date(),\n          requestBody: sanitizeForLog(req.body),\n          responseStatus: res.statusCode\n        });\n      }\n      \n      return originalSend.call(this, data);\n    };\n    \n    next();\n  };\n}\n\n// Utility functions\nfunction isAdminUser(email: string): boolean {\n  return adminUsers.has(email) || isConfiguredAdmin(email);\n}\n\nfunction getAdminUser(email: string): AdminUser | undefined {\n  return adminUsers.get(email);\n}\n\nfunction hasRole(userRole: AdminRole, requiredRole: AdminRole): boolean {\n  const roleHierarchy = [\n    AdminRole.SUPPORT,\n    AdminRole.EDITOR, \n    AdminRole.ADMIN,\n    AdminRole.SUPER_ADMIN\n  ];\n  \n  const userLevel = roleHierarchy.indexOf(userRole);\n  const requiredLevel = roleHierarchy.indexOf(requiredRole);\n  \n  return userLevel >= requiredLevel;\n}\n\nfunction hasPermission(role: AdminRole, permission: string): boolean {\n  const permissions = ROLE_PERMISSIONS[role];\n  return permissions.includes('*') || permissions.includes(permission);\n}\n\nfunction verifyMFAToken(adminUser: AdminUser, token: string): boolean {\n  // In production, implement proper TOTP verification\n  // For now, accept any 6-digit number as valid\n  return /^\\d{6}$/.test(token);\n}\n\nfunction isConfiguredAdmin(email: string): boolean {\n  // Check environment variables for configured admin emails\n  const adminEmails = process.env.ADMIN_EMAILS?.split(',') || [];\n  return adminEmails.includes(email);\n}\n\nfunction sanitizeForLog(obj: any): any {\n  if (!obj) return obj;\n  \n  const sensitiveFields = ['password', 'token', 'secret', 'key', 'mfa'];\n  const sanitized: any = {};\n  \n  for (const [key, value] of Object.entries(obj)) {\n    if (sensitiveFields.some(field => key.toLowerCase().includes(field))) {\n      sanitized[key] = '[REDACTED]';\n    } else {\n      sanitized[key] = value;\n    }\n  }\n  \n  return sanitized;\n}\n\n// Initialize admin users from environment\nexport function initializeAdminUsers() {\n  const adminEmails = process.env.ADMIN_EMAILS?.split(',') || [];\n  \n  adminEmails.forEach(email => {\n    if (!adminUsers.has(email)) {\n      adminUsers.set(email, {\n        id: `admin_${Date.now()}_${Math.random()}`,\n        email: email.trim(),\n        role: AdminRole.ADMIN,\n        mfaEnabled: false, // Should be enabled manually\n        loginAttempts: 0\n      });\n    }\n  });\n}\n\n// Admin routes should be isolated\nexport function isolateAdminRoutes(req: Request, res: Response, next: NextFunction) {\n  // Hide admin routes from regular navigation\n  const isAdminRoute = req.path.startsWith('/admin/') || req.path.startsWith('/api/admin/');\n  \n  if (isAdminRoute && !req.path.includes('/api/admin/login')) {\n    return requireAdmin(req, res, next);\n  }\n  \n  next();\n}","size_bytes":7186},"server/middleware/dataProtection.ts":{"content":"import type { Request, Response, NextFunction } from \"express\";\nimport { randomUUID } from \"crypto\";\n\n// GDPR compliance middleware and utilities\nexport interface DataRetentionPolicy {\n  dataType: string;\n  retentionPeriod: number; // in days\n  autoDelete: boolean;\n  lastReviewDate?: Date;\n}\n\n// Data retention policies per UK GDPR requirements\nconst RETENTION_POLICIES: DataRetentionPolicy[] = [\n  {\n    dataType: 'user_profiles',\n    retentionPeriod: 7 * 365, // 7 years\n    autoDelete: true\n  },\n  {\n    dataType: 'job_applications', \n    retentionPeriod: 3 * 365, // 3 years\n    autoDelete: true\n  },\n  {\n    dataType: 'cv_documents',\n    retentionPeriod: 7 * 365, // 7 years\n    autoDelete: true\n  },\n  {\n    dataType: 'interview_responses',\n    retentionPeriod: 2 * 365, // 2 years\n    autoDelete: true\n  },\n  {\n    dataType: 'session_logs',\n    retentionPeriod: 90, // 90 days\n    autoDelete: true\n  },\n  {\n    dataType: 'audit_logs',\n    retentionPeriod: 6 * 365, // 6 years (compliance requirement)\n    autoDelete: false // Keep for compliance\n  }\n];\n\n// PII data classification\nexport const PII_FIELDS = [\n  'email', 'firstName', 'lastName', 'phone', 'address', 'postcode',\n  'dateOfBirth', 'nationalInsurance', 'passportNumber', 'licenseNumber',\n  'profileImageUrl', 'emergencyContact', 'bankDetails', 'payroll'\n];\n\n// Data minimization middleware\nexport function dataMinimization(allowedFields: string[]) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    if (req.body && typeof req.body === 'object') {\n      const sanitizedBody: any = {};\n      \n      for (const field of allowedFields) {\n        if (req.body[field] !== undefined) {\n          sanitizedBody[field] = req.body[field];\n        }\n      }\n      \n      req.body = sanitizedBody;\n    }\n    \n    next();\n  };\n}\n\n// Data anonymization for analytics\nexport function anonymizeData(data: any): any {\n  if (!data) return data;\n  \n  const anonymized = JSON.parse(JSON.stringify(data));\n  \n  function anonymizeObject(obj: any): any {\n    if (Array.isArray(obj)) {\n      return obj.map(anonymizeObject);\n    }\n    \n    if (obj && typeof obj === 'object') {\n      for (const [key, value] of Object.entries(obj)) {\n        if (PII_FIELDS.includes(key.toLowerCase())) {\n          switch (key.toLowerCase()) {\n            case 'email':\n              obj[key] = `user_${randomUUID().substring(0, 8)}@anonymized.local`;\n              break;\n            case 'firstname':\n            case 'lastname':\n              obj[key] = `[ANONYMIZED_${key.toUpperCase()}]`;\n              break;\n            case 'phone':\n              obj[key] = '+44[ANONYMIZED]';\n              break;\n            default:\n              obj[key] = `[ANONYMIZED_${key.toUpperCase()}]`;\n          }\n        } else if (typeof value === 'object') {\n          obj[key] = anonymizeObject(value);\n        }\n      }\n    }\n    \n    return obj;\n  }\n  \n  return anonymizeObject(anonymized);\n}\n\n// Encryption middleware for sensitive data\nexport function markSensitiveData(req: Request, res: Response, next: NextFunction) {\n  const originalSend = res.send;\n  \n  res.send = function(data) {\n    // Tag response with sensitivity level\n    if (containsPII(data)) {\n      res.setHeader('X-Data-Sensitivity', 'high');\n      res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');\n      res.setHeader('Pragma', 'no-cache');\n    }\n    \n    return originalSend.call(this, data);\n  };\n  \n  next();\n}\n\n// Check if data contains PII\nfunction containsPII(data: any): boolean {\n  if (!data) return false;\n  \n  const dataString = JSON.stringify(data).toLowerCase();\n  return PII_FIELDS.some(field => dataString.includes(field.toLowerCase()));\n}\n\n// Data retention enforcement\nexport async function enforceDataRetention() {\n  console.log('[DATA_RETENTION] Starting retention policy enforcement...');\n  \n  for (const policy of RETENTION_POLICIES) {\n    if (policy.autoDelete) {\n      const cutoffDate = new Date();\n      cutoffDate.setDate(cutoffDate.getDate() - policy.retentionPeriod);\n      \n      console.log(`[DATA_RETENTION] Checking ${policy.dataType} older than ${cutoffDate.toISOString()}`);\n      \n      // In production, implement actual data deletion based on policy\n      // This would involve database queries to identify and delete old data\n      \n      // Example: await db.delete(table).where(lt(table.createdAt, cutoffDate));\n    }\n  }\n  \n  console.log('[DATA_RETENTION] Retention policy enforcement completed');\n}\n\n// Right to be forgotten implementation\nexport async function processDataDeletionRequest(userId: string, requestType: 'partial' | 'complete' = 'complete') {\n  const deletionId = randomUUID();\n  \n  console.log(`[GDPR_DELETION] Processing ${requestType} deletion request for user ${userId} (ID: ${deletionId})`);\n  \n  const deletionRecord = {\n    id: deletionId,\n    userId,\n    requestType,\n    timestamp: new Date(),\n    status: 'in_progress' as const,\n    deletedTables: [] as string[]\n  };\n  \n  try {\n    // In production, implement actual data deletion\n    const tablesToClean = [\n      'user_profiles',\n      'job_applications', \n      'documents',\n      'interview_sessions',\n      'cv_data'\n    ];\n    \n    for (const table of tablesToClean) {\n      console.log(`[GDPR_DELETION] Deleting from ${table}...`);\n      // await db.delete(tableMap[table]).where(eq(tableMap[table].userId, userId));\n      deletionRecord.deletedTables.push(table);\n    }\n    \n    deletionRecord.status = 'completed';\n    console.log(`[GDPR_DELETION] Completed deletion request ${deletionId}`);\n    \n    return deletionRecord;\n  } catch (error) {\n    deletionRecord.status = 'failed';\n    console.error(`[GDPR_DELETION] Failed deletion request ${deletionId}:`, error);\n    throw error;\n  }\n}\n\n// Data portability implementation\nexport async function generateDataExport(userId: string) {\n  const exportId = randomUUID();\n  \n  console.log(`[GDPR_EXPORT] Generating data export for user ${userId} (ID: ${exportId})`);\n  \n  try {\n    // In production, gather all user data from various tables\n    const userData = {\n      exportInfo: {\n        id: exportId,\n        userId,\n        timestamp: new Date(),\n        format: 'JSON',\n        version: '1.0'\n      },\n      personalData: {\n        // profile: await getUserProfile(userId),\n        // applications: await getUserApplications(userId),\n        // documents: await getUserDocuments(userId),\n        // interviews: await getUserInterviews(userId)\n      },\n      metadata: {\n        dataRetentionPolicies: RETENTION_POLICIES,\n        exportGeneratedAt: new Date(),\n        dataProcessingPurposes: [\n          'Career services provision',\n          'Job matching and recommendations', \n          'Interview practice and feedback',\n          'CV generation and optimization',\n          'Application tracking and management'\n        ]\n      }\n    };\n    \n    console.log(`[GDPR_EXPORT] Completed data export ${exportId}`);\n    return userData;\n  } catch (error) {\n    console.error(`[GDPR_EXPORT] Failed data export ${exportId}:`, error);\n    throw error;\n  }\n}\n\n// Consent tracking middleware\nexport function trackConsentChanges(req: Request, res: Response, next: NextFunction) {\n  if (req.path.includes('/consent') && req.method === 'POST') {\n    const originalSend = res.send;\n    \n    res.send = function(data) {\n      // Log consent changes for audit trail\n      console.log('[CONSENT_AUDIT]', {\n        userId: (req as any).user?.id,\n        ip: req.ip,\n        timestamp: new Date(),\n        consentType: req.body?.type,\n        consentGiven: req.body?.given,\n        userAgent: req.get('User-Agent')\n      });\n      \n      return originalSend.call(this, data);\n    };\n  }\n  \n  next();\n}\n\n// Data processing lawful basis validation\nexport function validateProcessingBasis(req: Request, res: Response, next: NextFunction) {\n  // Add headers indicating lawful basis for processing\n  res.setHeader('X-Processing-Basis', 'consent,legitimate-interest');\n  res.setHeader('X-Data-Controller', 'HealthHire Portal');\n  res.setHeader('X-Privacy-Policy', '/privacy-policy');\n  \n  next();\n}\n\n// Initialize data protection policies\nexport function initializeDataProtection() {\n  console.log('[DATA_PROTECTION] Initializing GDPR compliance policies...');\n  \n  // Schedule daily retention policy enforcement\n  setInterval(enforceDataRetention, 24 * 60 * 60 * 1000); // Daily\n  \n  console.log('[DATA_PROTECTION] Data protection policies initialized');\n  console.log(`[DATA_PROTECTION] Configured ${RETENTION_POLICIES.length} retention policies`);\n}","size_bytes":8540},"server/middleware/security.ts":{"content":"import type { RequestHandler } from \"express\";\nimport crypto from \"crypto\";\n\n// Store CSRF tokens temporarily (in production, use Redis or database)\nconst csrfTokens = new Set<string>();\n\n// Generate a secure CSRF token\nexport function generateCSRFToken(): string {\n  const token = crypto.randomBytes(32).toString('hex');\n  csrfTokens.add(token);\n  \n  // Clean up old tokens (keep max 1000 tokens)\n  if (csrfTokens.size > 1000) {\n    const tokensArray = Array.from(csrfTokens);\n    csrfTokens.clear();\n    tokensArray.slice(-500).forEach(token => csrfTokens.add(token));\n  }\n  \n  return token;\n}\n\n// Validate CSRF token middleware\nexport const validateCSRFToken: RequestHandler = async (req: any, res, next) => {\n  const token = req.headers['x-csrf-token'] as string;\n  \n  if (!token) {\n    console.warn(`CSRF token missing for ${req.method} ${req.path} from ${req.ip}`);\n    return res.status(403).json({ \n      message: \"CSRF token required\",\n      code: \"CSRF_TOKEN_MISSING\" \n    });\n  }\n  \n  if (!csrfTokens.has(token)) {\n    console.warn(`Invalid CSRF token for ${req.method} ${req.path} from ${req.ip}`);\n    return res.status(403).json({ \n      message: \"Invalid CSRF token\",\n      code: \"CSRF_TOKEN_INVALID\" \n    });\n  }\n  \n  // Remove token after use (one-time use)\n  csrfTokens.delete(token);\n  \n  next();\n};\n\n// Middleware to provide CSRF token\nexport const provideCSRFToken: RequestHandler = (req: any, res, next) => {\n  if (!req.csrfToken) {\n    req.csrfToken = generateCSRFToken();\n  }\n  next();\n};","size_bytes":1512},"server/middleware/securityMonitoring.ts":{"content":"import type { Request, Response, NextFunction } from \"express\";\nimport { logSecurityEvent, SecurityEvent } from \"./security\";\n\n// Security monitoring and incident response\nexport interface SecurityIncident {\n  id: string;\n  severity: 'low' | 'medium' | 'high' | 'critical';\n  type: string;\n  description: string;\n  timestamp: Date;\n  ip: string;\n  userAgent: string;\n  userId?: string;\n  status: 'open' | 'investigating' | 'resolved' | 'false_positive';\n  actions: string[];\n}\n\n// Threat detection patterns\nconst THREAT_PATTERNS = {\n  sql_injection: /(\\b(union|select|insert|delete|drop|update|exec|script)\\b.*\\b(from|where|order|group)\\b)/i,\n  xss_attempt: /<script|javascript:|vbscript:|onload=|onerror=/i,\n  path_traversal: /\\.\\.\\//,\n  command_injection: /(\\||;|&|`|\\$\\(|\\${)/,\n  brute_force: { maxAttempts: 10, timeWindow: 300000 }, // 10 attempts in 5 minutes\n  unusual_patterns: /(\\bpassword\\b.*\\b=\\b.*['\\\"]|admin.*login|/etc/passwd|cmd\\.exe)/i\n};\n\n// Active incidents store\nconst activeIncidents = new Map<string, SecurityIncident>();\nconst ipAttempts = new Map<string, { count: number; firstAttempt: Date }>();\n\n// Threat detection middleware\nexport function threatDetection(req: Request, res: Response, next: NextFunction) {\n  const ip = req.ip || 'unknown';\n  const userAgent = req.get('User-Agent') || 'unknown';\n  const path = req.path;\n  const method = req.method;\n  \n  // Check request for malicious patterns\n  const requestData = JSON.stringify({\n    url: req.url,\n    headers: req.headers,\n    body: req.body,\n    query: req.query\n  });\n  \n  const threats: string[] = [];\n  \n  // SQL Injection detection\n  if (THREAT_PATTERNS.sql_injection.test(requestData)) {\n    threats.push('sql_injection');\n  }\n  \n  // XSS attempt detection  \n  if (THREAT_PATTERNS.xss_attempt.test(requestData)) {\n    threats.push('xss_attempt');\n  }\n  \n  // Path traversal detection\n  if (THREAT_PATTERNS.path_traversal.test(requestData)) {\n    threats.push('path_traversal');\n  }\n  \n  // Command injection detection\n  if (THREAT_PATTERNS.command_injection.test(requestData)) {\n    threats.push('command_injection');\n  }\n  \n  // Unusual pattern detection\n  if (THREAT_PATTERNS.unusual_patterns.test(requestData)) {\n    threats.push('unusual_pattern');\n  }\n  \n  // Create incidents for detected threats\n  if (threats.length > 0) {\n    const incident = createSecurityIncident({\n      severity: getSeverityForThreats(threats),\n      type: 'threat_detection',\n      description: `Detected threats: ${threats.join(', ')}`,\n      ip,\n      userAgent,\n      userId: (req as any).user?.id\n    });\n    \n    console.error(`[SECURITY_THREAT] ${incident.id}: ${incident.description}`, {\n      ip,\n      path,\n      method,\n      threats,\n      requestData: sanitizeRequestData(requestData)\n    });\n    \n    // Block request for high severity threats\n    if (incident.severity === 'high' || incident.severity === 'critical') {\n      return res.status(403).json({ \n        error: \"Request blocked by security policy\",\n        incident: incident.id\n      });\n    }\n  }\n  \n  next();\n}\n\n// Brute force detection\nexport function bruteForceDetection(req: Request, res: Response, next: NextFunction) {\n  const ip = req.ip || 'unknown';\n  \n  // Track failed login attempts\n  if (req.path.includes('/login') || req.path.includes('/auth')) {\n    const originalSend = res.send;\n    \n    res.send = function(data) {\n      if (res.statusCode === 401 || res.statusCode === 403) {\n        trackFailedAttempt(ip, req);\n      } else if (res.statusCode === 200) {\n        clearAttempts(ip);\n      }\n      \n      return originalSend.call(this, data);\n    };\n  }\n  \n  next();\n}\n\n// Track failed authentication attempts\nfunction trackFailedAttempt(ip: string, req: Request) {\n  const now = new Date();\n  const existing = ipAttempts.get(ip);\n  \n  if (!existing || (now.getTime() - existing.firstAttempt.getTime()) > THREAT_PATTERNS.brute_force.timeWindow) {\n    ipAttempts.set(ip, { count: 1, firstAttempt: now });\n  } else {\n    existing.count++;\n    \n    if (existing.count >= THREAT_PATTERNS.brute_force.maxAttempts) {\n      const incident = createSecurityIncident({\n        severity: 'high',\n        type: 'brute_force_attack',\n        description: `${existing.count} failed login attempts from ${ip}`,\n        ip,\n        userAgent: req.get('User-Agent') || 'unknown'\n      });\n      \n      console.error(`[BRUTE_FORCE] ${incident.id}: ${incident.description}`);\n    }\n  }\n}\n\nfunction clearAttempts(ip: string) {\n  ipAttempts.delete(ip);\n}\n\n// Anomaly detection\nexport function anomalyDetection(req: Request, res: Response, next: NextFunction) {\n  const ip = req.ip || 'unknown';\n  const userAgent = req.get('User-Agent') || 'unknown';\n  \n  // Detect unusual request patterns\n  const anomalies: string[] = [];\n  \n  // Unusual user agent patterns\n  if (userAgent.length < 10 || !userAgent.includes('Mozilla')) {\n    anomalies.push('suspicious_user_agent');\n  }\n  \n  // Rapid requests (basic rate detection)\n  const requestKey = `${ip}-${Date.now().toString().slice(0, -4)}`; // 10-second windows\n  if (!req.session) {\n    req.session = {};\n  }\n  \n  // Unusual request sizes\n  const requestSize = JSON.stringify(req.body || {}).length + (req.url?.length || 0);\n  if (requestSize > 100000) { // 100KB\n    anomalies.push('oversized_request');\n  }\n  \n  // Scanner-like behavior\n  if (req.path.match(/\\.(php|asp|jsp|cgi)$/i) || \n      req.path.includes('wp-admin') || \n      req.path.includes('phpmyadmin')) {\n    anomalies.push('scanner_behavior');\n  }\n  \n  if (anomalies.length > 0) {\n    logSecurityEvent({\n      type: 'suspicious_activity',\n      ip,\n      userAgent,\n      endpoint: req.path,\n      timestamp: new Date(),\n      details: { anomalies, requestSize }\n    });\n    \n    // Create incident for multiple anomalies\n    if (anomalies.length > 2) {\n      createSecurityIncident({\n        severity: 'medium',\n        type: 'anomaly_detection',\n        description: `Multiple anomalies detected: ${anomalies.join(', ')}`,\n        ip,\n        userAgent\n      });\n    }\n  }\n  \n  next();\n}\n\n// Create security incident\nfunction createSecurityIncident(params: {\n  severity: SecurityIncident['severity'];\n  type: string;\n  description: string;\n  ip: string;\n  userAgent: string;\n  userId?: string;\n}): SecurityIncident {\n  const incident: SecurityIncident = {\n    id: `INC-${Date.now()}-${Math.random().toString(36).substr(2, 6)}`,\n    severity: params.severity,\n    type: params.type,\n    description: params.description,\n    timestamp: new Date(),\n    ip: params.ip,\n    userAgent: params.userAgent,\n    userId: params.userId,\n    status: 'open',\n    actions: []\n  };\n  \n  activeIncidents.set(incident.id, incident);\n  \n  // Auto-escalate critical incidents\n  if (incident.severity === 'critical') {\n    incident.actions.push('auto_escalated');\n    console.error(`[CRITICAL_INCIDENT] ${incident.id}: ${incident.description}`);\n    // In production: trigger alerts, notifications, etc.\n  }\n  \n  return incident;\n}\n\n// Get severity based on detected threats\nfunction getSeverityForThreats(threats: string[]): SecurityIncident['severity'] {\n  if (threats.includes('sql_injection') || threats.includes('command_injection')) {\n    return 'critical';\n  }\n  if (threats.includes('xss_attempt') || threats.includes('path_traversal')) {\n    return 'high';\n  }\n  return 'medium';\n}\n\n// Sanitize request data for logging\nfunction sanitizeRequestData(data: string): any {\n  try {\n    const parsed = JSON.parse(data);\n    const sensitive = ['password', 'token', 'secret', 'key', 'authorization'];\n    \n    const sanitized = JSON.parse(JSON.stringify(parsed, (key, value) => {\n      if (sensitive.some(s => key.toLowerCase().includes(s))) {\n        return '[REDACTED]';\n      }\n      return value;\n    }));\n    \n    return sanitized;\n  } catch {\n    return '[PARSE_ERROR]';\n  }\n}\n\n// Security dashboard endpoint\nexport function getSecurityDashboard(req: Request, res: Response) {\n  const incidents = Array.from(activeIncidents.values());\n  const recentIncidents = incidents\n    .filter(i => Date.now() - i.timestamp.getTime() < 24 * 60 * 60 * 1000) // Last 24 hours\n    .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());\n  \n  const stats = {\n    totalIncidents: incidents.length,\n    recentIncidents: recentIncidents.length,\n    openIncidents: incidents.filter(i => i.status === 'open').length,\n    criticalIncidents: incidents.filter(i => i.severity === 'critical').length,\n    incidentsBySeverity: {\n      low: incidents.filter(i => i.severity === 'low').length,\n      medium: incidents.filter(i => i.severity === 'medium').length,\n      high: incidents.filter(i => i.severity === 'high').length,\n      critical: incidents.filter(i => i.severity === 'critical').length\n    },\n    topThreats: getTopThreats(incidents),\n    suspiciousIPs: getTopSuspiciousIPs()\n  };\n  \n  res.json({\n    stats,\n    recentIncidents: recentIncidents.slice(0, 10) // Last 10\n  });\n}\n\nfunction getTopThreats(incidents: SecurityIncident[]): Array<{type: string, count: number}> {\n  const threatCounts = new Map<string, number>();\n  \n  incidents.forEach(incident => {\n    threatCounts.set(incident.type, (threatCounts.get(incident.type) || 0) + 1);\n  });\n  \n  return Array.from(threatCounts.entries())\n    .map(([type, count]) => ({ type, count }))\n    .sort((a, b) => b.count - a.count)\n    .slice(0, 5);\n}\n\nfunction getTopSuspiciousIPs(): Array<{ip: string, attempts: number}> {\n  return Array.from(ipAttempts.entries())\n    .map(([ip, data]) => ({ ip, attempts: data.count }))\n    .sort((a, b) => b.attempts - a.attempts)\n    .slice(0, 10);\n}\n\n// Incident response procedures\nexport const incidentResponse = {\n  // Containment procedures\n  blockIP: (ip: string, reason: string) => {\n    console.log(`[INCIDENT_RESPONSE] Blocking IP ${ip}: ${reason}`);\n    // In production: add to firewall/WAF rules\n  },\n  \n  // Investigation procedures  \n  investigate: (incidentId: string, notes: string) => {\n    const incident = activeIncidents.get(incidentId);\n    if (incident) {\n      incident.status = 'investigating';\n      incident.actions.push(`Investigation started: ${notes}`);\n      console.log(`[INCIDENT_RESPONSE] Investigating ${incidentId}: ${notes}`);\n    }\n  },\n  \n  // Resolution procedures\n  resolve: (incidentId: string, resolution: string) => {\n    const incident = activeIncidents.get(incidentId);\n    if (incident) {\n      incident.status = 'resolved';\n      incident.actions.push(`Resolved: ${resolution}`);\n      console.log(`[INCIDENT_RESPONSE] Resolved ${incidentId}: ${resolution}`);\n    }\n  },\n  \n  // Notification procedures\n  notify: (incident: SecurityIncident) => {\n    console.log(`[INCIDENT_RESPONSE] Notification triggered for ${incident.id}`);\n    // In production: send emails, SMS, Slack notifications\n    \n    // For GDPR breaches, assess ICO reporting requirement\n    if (incident.type.includes('data_breach') && incident.severity === 'critical') {\n      console.log(`[GDPR_BREACH] Critical data breach detected: ${incident.id}`);\n      console.log('[GDPR_BREACH] Assess ICO reporting requirement within 72 hours');\n    }\n  }\n};\n\n// Initialize security monitoring\nexport function initializeSecurityMonitoring() {\n  console.log('[SECURITY_MONITORING] Initializing threat detection and incident response...');\n  \n  // Set up cleanup of old incidents (keep for 30 days)\n  setInterval(() => {\n    const cutoff = Date.now() - (30 * 24 * 60 * 60 * 1000);\n    for (const [id, incident] of activeIncidents.entries()) {\n      if (incident.timestamp.getTime() < cutoff && incident.status === 'resolved') {\n        activeIncidents.delete(id);\n      }\n    }\n  }, 24 * 60 * 60 * 1000); // Daily cleanup\n  \n  console.log('[SECURITY_MONITORING] Security monitoring initialized');\n}","size_bytes":11732},"client/src/pages/referrals.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { ArrowLeft } from \"lucide-react\";\nimport henryComingSoonImage from \"@assets/Green Simple Woman Doctor Avatar_1756984911398.png\";\n\nexport default function Referrals() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"max-w-4xl mx-auto px-4 py-8\">\n        {/* Back to Dashboard Button */}\n        <div className=\"mb-8\">\n          <Button \n            variant=\"ghost\" \n            onClick={() => window.location.href = \"/\"}\n            className=\"flex items-center gap-2 text-muted-foreground hover:text-foreground\"\n            data-testid=\"button-back-dashboard\"\n          >\n            <ArrowLeft className=\"h-4 w-4\" />\n            Back to Dashboard\n          </Button>\n        </div>\n\n        {/* Coming Soon Content */}\n        <div className=\"text-center space-y-8\">\n          <div className=\"space-y-4\">\n            <h1 className=\"text-4xl font-bold text-foreground\">\n              Referral Program\n            </h1>\n            <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n              We're working on something exciting to help you earn rewards by referring fellow healthcare professionals!\n            </p>\n          </div>\n\n          {/* Henry the Helper Image */}\n          <div className=\"flex justify-center\">\n            <div className=\"relative\">\n              <img \n                src={henryComingSoonImage} \n                alt=\"Henry the Helper - Coming Soon\"\n                className=\"w-64 h-64 object-contain\"\n                data-testid=\"img-henry-coming-soon\"\n              />\n            </div>\n          </div>\n\n          {/* Coming Soon Message */}\n          <div className=\"bg-primary/5 border border-primary/20 rounded-lg p-8 max-w-2xl mx-auto\">\n            <h2 className=\"text-2xl font-semibold text-foreground mb-4\">\n              Coming Soon!\n            </h2>\n            <p className=\"text-muted-foreground text-lg\">\n              Henry the Helper is putting the finishing touches on our referral program. \n              Soon you'll be able to earn rewards for helping other healthcare professionals \n              discover the power of HealthHire Portal.\n            </p>\n          </div>\n\n          {/* Back to Dashboard */}\n          <div className=\"pt-8\">\n            <Button \n              onClick={() => window.location.href = \"/\"}\n              size=\"lg\"\n              data-testid=\"button-return-dashboard\"\n            >\n              Return to Dashboard\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":2589},"client/src/components/henry-onboarding.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { X, ArrowLeft, ArrowRight, Crown } from \"lucide-react\";\nimport henryAvatar from \"@assets/Green Simple Woman Doctor Avatar_1756985658118.png\";\n\ninterface OnboardingStep {\n  id: string;\n  title: string;\n  freeDescription: string;\n  premiumDescription: string;\n  cardSelector: string;\n  position: \"top\" | \"bottom\" | \"left\" | \"right\";\n}\n\nconst onboardingSteps: OnboardingStep[] = [\n  {\n    id: \"profile\",\n    title: \"Your Candidate Profile\",\n    freeDescription: \"This is where you'll build your comprehensive healthcare professional profile. Add your qualifications, experience, and key skills. A complete profile is essential for job matching and helps you stand out to NHS employers.\",\n    premiumDescription: \"Your profile is the foundation of your NHS career success! As a premium user, you can create detailed profiles that showcase your full healthcare expertise. The system uses this information for intelligent job matching, CV generation, and interview preparation. Complete profiles get 3x more job matches!\",\n    cardSelector: '[data-testid=\"sortable-card-profile\"]',\n    position: \"bottom\"\n  },\n  {\n    id: \"jobs\",\n    title: \"Intelligent Job Finder\",\n    freeDescription: \"Discover NHS jobs from multiple sources with basic filtering. See job titles and locations to get started with your search. This gives you a preview of the powerful job matching capabilities available with premium access.\",\n    premiumDescription: \"Welcome to the most advanced NHS job matching system! I analyze your profile against thousands of NHS positions daily, providing compatibility scores, salary insights, and eligibility filtering. You'll get unlimited searches, advanced filters, and personalized job recommendations that match your exact skills and career goals.\",\n    cardSelector: '[data-testid=\"sortable-card-jobs\"]',\n    position: \"bottom\"\n  },\n  {\n    id: \"documents\",\n    title: \"AI Document Generation\",\n    freeDescription: \"Preview our AI-powered document generation system that creates tailored Supporting Information for NHS applications. See sample outputs and understand how AI can transform your job application process.\",\n    premiumDescription: \"This is where the magic happens! I'll generate perfectly tailored Supporting Information documents for every NHS application. Each document is customized to the specific job description, incorporating your experience and demonstrating how you meet every requirement. No more spending hours writing applications!\",\n    cardSelector: '[data-testid=\"sortable-card-documents\"]',\n    position: \"bottom\"\n  },\n  {\n    id: \"resources\",\n    title: \"NHS Career Resources\",\n    freeDescription: \"Access our library of NHS career guides and resources. Get insights into NHS application processes, interview techniques, and career progression paths to help you succeed in healthcare.\",\n    premiumDescription: \"Your comprehensive NHS career toolkit! Access exclusive guides, interview success frameworks, CPD tracking tools, and mini-courses. I've curated the most effective resources to accelerate your NHS career at every stage.\",\n    cardSelector: '[data-testid=\"sortable-card-resources\"]',\n    position: \"bottom\"\n  },\n  {\n    id: \"practice\",\n    title: \"Interview Practice Studio\",\n    freeDescription: \"Preview our mock interview system that helps healthcare professionals practice for NHS interviews. See how AI feedback can improve your interview performance and confidence.\",\n    premiumDescription: \"Master NHS interviews with personalized practice sessions! I'll conduct mock interviews tailored to your target roles, provide detailed feedback on your STAR responses, and help you align with NHS values. Practice makes perfect, and this system ensures you're ready for success!\",\n    cardSelector: '[data-testid=\"sortable-card-practice\"]',\n    position: \"bottom\"\n  },\n  {\n    id: \"qa\",\n    title: \"Interview Q&A Generator\",\n    freeDescription: \"Discover how our AI generates role-specific interview questions with model answers. This tool helps you prepare for common NHS interview scenarios and understand what employers are looking for.\",\n    premiumDescription: \"Never be caught off-guard in interviews again! I generate unlimited, role-specific interview questions with detailed model answers. Each question is crafted based on NHS competency frameworks and your target positions, ensuring comprehensive preparation.\",\n    cardSelector: '[data-testid=\"sortable-card-qa\"]',\n    position: \"bottom\"\n  },\n  {\n    id: \"tracker\",\n    title: \"Application Tracker & Analytics\",\n    freeDescription: \"Preview our application tracking system that helps you organize your job search. See how analytics can provide insights into your application success rates and areas for improvement.\",\n    premiumDescription: \"Transform your job search with data-driven insights! Track every application through our Kanban board, monitor success rates, identify patterns, and optimize your approach. The analytics dashboard shows exactly what's working and what needs adjustment.\",\n    cardSelector: '[data-testid=\"sortable-card-tracker\"]',\n    position: \"bottom\"\n  },\n  {\n    id: \"news\",\n    title: \"NHS News & Updates\",\n    freeDescription: \"Stay informed about the latest NHS developments, policy changes, and healthcare industry news. Knowledge is power in your career journey, and staying updated gives you an edge in interviews and applications.\",\n    premiumDescription: \"Stay ahead with curated NHS insights! I monitor policy changes, new opportunities, and industry trends that directly impact your career. This intelligence helps you make informed decisions and impress in interviews with current knowledge.\",\n    cardSelector: '[data-testid=\"sortable-card-news\"]',\n    position: \"bottom\"\n  },\n  {\n    id: \"referrals\",\n    title: \"Referral Rewards Program\",\n    freeDescription: \"Coming soon! Our referral program will reward you for helping fellow healthcare professionals discover HealthHire Portal. Earn benefits while building your professional network.\",\n    premiumDescription: \"Coming soon! As a premium member, you'll earn enhanced rewards for referring healthcare professionals. Build your network while earning exclusive benefits and helping others advance their NHS careers.\",\n    cardSelector: '[data-testid=\"sortable-card-referrals\"]',\n    position: \"bottom\"\n  },\n  {\n    id: \"support\",\n    title: \"Your Support Network\",\n    freeDescription: \"I'm here to help whenever you need assistance! Access our comprehensive support system, browse common questions, or chat with me directly. Your success is my priority.\",\n    premiumDescription: \"As your premium support companion, I provide priority assistance and personalized guidance. Whether you need help with applications, technical issues, or career advice, I'm always here to ensure your success on the platform.\",\n    cardSelector: '[data-testid=\"sortable-card-support\"]',\n    position: \"bottom\"\n  }\n];\n\ninterface HenryOnboardingProps {\n  isPremium: boolean;\n  onComplete: () => void;\n  onSkip: () => void;\n}\n\nexport function HenryOnboarding({ isPremium, onComplete, onSkip }: HenryOnboardingProps) {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [isVisible, setIsVisible] = useState(true);\n\n  const currentStepData = onboardingSteps[currentStep];\n  const totalSteps = onboardingSteps.length;\n  const isFirstStep = currentStep === 0;\n  const isLastStep = currentStep === totalSteps - 1;\n\n  // Highlight the current card\n  useEffect(() => {\n    // Remove previous highlights\n    const previousHighlights = document.querySelectorAll('.onboarding-highlight');\n    previousHighlights.forEach(el => el.classList.remove('onboarding-highlight'));\n\n    // Add highlight to current card\n    const currentCard = document.querySelector(currentStepData.cardSelector);\n    if (currentCard) {\n      currentCard.classList.add('onboarding-highlight');\n      currentCard.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }\n\n    return () => {\n      // Cleanup on unmount\n      const highlights = document.querySelectorAll('.onboarding-highlight');\n      highlights.forEach(el => el.classList.remove('onboarding-highlight'));\n    };\n  }, [currentStep, currentStepData.cardSelector]);\n\n  const handleNext = () => {\n    if (isLastStep) {\n      handleComplete();\n    } else {\n      setCurrentStep(prev => prev + 1);\n    }\n  };\n\n  const handlePrevious = () => {\n    if (isFirstStep) {\n      return;\n    }\n    setCurrentStep(prev => prev - 1);\n  };\n\n  const handleComplete = () => {\n    setIsVisible(false);\n    onComplete();\n  };\n\n  const handleSkip = () => {\n    setIsVisible(false);\n    onSkip();\n  };\n\n  if (!isVisible) {\n    return null;\n  }\n\n  return (\n    <>\n      {/* Overlay */}\n      <div className=\"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4\">\n        {/* Onboarding Card */}\n        <Card className=\"max-w-2xl w-full bg-white dark:bg-gray-900 shadow-2xl\">\n          <CardContent className=\"p-8\">\n            {/* Header */}\n            <div className=\"flex items-start justify-between mb-6\">\n              <div className=\"flex items-center gap-4\">\n                <img \n                  src={henryAvatar} \n                  alt=\"Henry the Helper\"\n                  className=\"w-16 h-16 rounded-full\"\n                />\n                <div>\n                  <h2 className=\"text-2xl font-bold flex items-center gap-2\">\n                    {currentStepData.title}\n                    {isPremium && <Crown className=\"h-5 w-5 text-yellow-500\" />}\n                  </h2>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Step {currentStep + 1} of {totalSteps}\n                  </p>\n                </div>\n              </div>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={handleSkip}\n                data-testid=\"button-skip-onboarding\"\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n\n            {/* Henry's Message */}\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 mb-6\">\n              <div className=\"flex gap-3\">\n                <div className=\"flex-shrink-0\">\n                  <div className=\"w-2 h-2 rounded-full bg-blue-500 mt-2\"></div>\n                </div>\n                <div>\n                  <p className=\"text-gray-800 dark:text-gray-200 leading-relaxed\">\n                    {isPremium ? currentStepData.premiumDescription : currentStepData.freeDescription}\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Progress Bar */}\n            <div className=\"mb-6\">\n              <div className=\"flex justify-between items-center mb-2\">\n                <span className=\"text-sm text-muted-foreground\">Progress</span>\n                <span className=\"text-sm text-muted-foreground\">\n                  {Math.round(((currentStep + 1) / totalSteps) * 100)}%\n                </span>\n              </div>\n              <div className=\"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\n                <div \n                  className=\"h-full bg-blue-500 rounded-full transition-all duration-300 ease-out\"\n                  style={{ width: `${((currentStep + 1) / totalSteps) * 100}%` }}\n                />\n              </div>\n            </div>\n\n            {/* Navigation */}\n            <div className=\"flex items-center justify-between\">\n              <Button\n                variant=\"outline\"\n                onClick={handlePrevious}\n                disabled={isFirstStep}\n                data-testid=\"button-onboarding-previous\"\n              >\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Previous\n              </Button>\n\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  onClick={handleSkip}\n                  data-testid=\"button-onboarding-skip\"\n                >\n                  Skip Tour\n                </Button>\n                <Button\n                  onClick={handleNext}\n                  data-testid=\"button-onboarding-next\"\n                >\n                  {isLastStep ? \"Get Started!\" : \"Next\"}\n                  {!isLastStep && <ArrowRight className=\"h-4 w-4 ml-2\" />}\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Custom CSS for highlighting */}\n      <style>{`\n        .onboarding-highlight {\n          position: relative;\n          z-index: 45 !important;\n          box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.5), 0 0 20px rgba(59, 130, 246, 0.3) !important;\n          border-radius: 12px !important;\n          transition: all 0.3s ease-in-out !important;\n        }\n        \n        .onboarding-highlight::before {\n          content: '';\n          position: absolute;\n          inset: -4px;\n          border-radius: 16px;\n          background: linear-gradient(45deg, #3b82f6, #8b5cf6);\n          z-index: -1;\n          animation: pulse-glow 2s infinite;\n        }\n        \n        @keyframes pulse-glow {\n          0%, 100% {\n            opacity: 0.5;\n          }\n          50% {\n            opacity: 0.8;\n          }\n        }\n      `}</style>\n    </>\n  );\n}","size_bytes":13426},"server/adminAuth.ts":{"content":"import type { RequestHandler } from \"express\";\nimport { storage } from \"./storage\";\n\n// Admin role hierarchy\nexport enum AdminRole {\n  MASTER_ADMIN = \"master_admin\",\n  SECONDARY_ADMIN = \"secondary_admin\"\n}\n\n// Check if user is any kind of admin\nexport const isAdmin: RequestHandler = async (req: any, res, next) => {\n  try {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n\n    const userId = req.user?.claims?.sub;\n    const user = await storage.getUser(userId);\n\n    if (!user || !user.isAdmin) {\n      return res.status(403).json({ message: \"Admin access required\" });\n    }\n\n    // Add admin info to request\n    req.admin = {\n      userId: user.id,\n      role: user.adminRole,\n      isMasterAdmin: user.adminRole === AdminRole.MASTER_ADMIN,\n      isSecondaryAdmin: user.adminRole === AdminRole.SECONDARY_ADMIN\n    };\n\n    next();\n  } catch (error) {\n    console.error(\"Admin authentication error:\", error);\n    res.status(500).json({ message: \"Authentication error\" });\n  }\n};\n\n// Check if user is Master Admin (highest level)\nexport const isMasterAdmin: RequestHandler = async (req: any, res, next) => {\n  try {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n\n    const userId = req.user?.claims?.sub;\n    const user = await storage.getUser(userId);\n\n    if (!user || !user.isAdmin || user.adminRole !== AdminRole.MASTER_ADMIN) {\n      return res.status(403).json({ message: \"Master Admin access required\" });\n    }\n\n    // Add admin info to request\n    req.admin = {\n      userId: user.id,\n      role: user.adminRole,\n      isMasterAdmin: true,\n      isSecondaryAdmin: false\n    };\n\n    next();\n  } catch (error) {\n    console.error(\"Master admin authentication error:\", error);\n    res.status(500).json({ message: \"Authentication error\" });\n  }\n};\n\n// Check if user is Secondary Admin or higher\nexport const isSecondaryAdminOrHigher: RequestHandler = async (req: any, res, next) => {\n  try {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n\n    const userId = req.user?.claims?.sub;\n    const user = await storage.getUser(userId);\n\n    if (!user || !user.isAdmin || \n        (user.adminRole !== AdminRole.MASTER_ADMIN && user.adminRole !== AdminRole.SECONDARY_ADMIN)) {\n      return res.status(403).json({ message: \"Admin access required\" });\n    }\n\n    // Add admin info to request\n    req.admin = {\n      userId: user.id,\n      role: user.adminRole,\n      isMasterAdmin: user.adminRole === AdminRole.MASTER_ADMIN,\n      isSecondaryAdmin: user.adminRole === AdminRole.SECONDARY_ADMIN\n    };\n\n    next();\n  } catch (error) {\n    console.error(\"Secondary admin authentication error:\", error);\n    res.status(500).json({ message: \"Authentication error\" });\n  }\n};\n\n// Helper functions for admin operations\nexport class AdminService {\n  // Log admin activity\n  static async logActivity(adminId: string, action: string, targetType?: string, targetId?: string, description?: string, metadata?: any) {\n    try {\n      await storage.createAdminActivityLog({\n        adminId,\n        action,\n        targetType,\n        targetId,\n        description,\n        metadata\n      });\n    } catch (error) {\n      console.error(\"Error logging admin activity:\", error);\n    }\n  }\n\n  // Check if admin can perform action on target\n  static async canPerformAction(adminRole: string, action: string, targetUserId?: string): Promise<boolean> {\n    // Master admin can do everything\n    if (adminRole === AdminRole.MASTER_ADMIN) {\n      return true;\n    }\n\n    // Secondary admin restrictions\n    if (adminRole === AdminRole.SECONDARY_ADMIN) {\n      // Secondary admin cannot modify master admin accounts\n      if (targetUserId) {\n        const targetUser = await storage.getUser(targetUserId);\n        if (targetUser?.adminRole === AdminRole.MASTER_ADMIN) {\n          return false;\n        }\n      }\n\n      // Secondary admin can do most things except create/delete admins\n      const restrictedActions = ['create_admin', 'delete_admin', 'modify_master_admin'];\n      return !restrictedActions.includes(action);\n    }\n\n    return false;\n  }\n\n  // Get admin dashboard stats\n  static async getDashboardStats() {\n    try {\n      const stats = await storage.getSystemAnalytics();\n      return stats;\n    } catch (error) {\n      console.error(\"Error fetching admin dashboard stats:\", error);\n      return null;\n    }\n  }\n}","size_bytes":4505},"client/src/pages/admin-dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Users, \n  Settings, \n  BarChart3, \n  FileText, \n  MessageCircle, \n  Shield,\n  Crown,\n  Activity,\n  TrendingUp,\n  UserCheck\n} from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useEffect } from \"react\";\n\ninterface AdminDashboardData {\n  totalUsers: number;\n  freeUsers: number;\n  premiumUsers: number;\n  newSignups: number;\n  totalApplications: number;\n  totalInterviewSessions: number;\n  adminInfo: {\n    role: string;\n    isMasterAdmin: boolean;\n    isSecondaryAdmin: boolean;\n  };\n}\n\ninterface User {\n  id: string;\n  email: string;\n  firstName?: string;\n  lastName?: string;\n  subscriptionStatus: string;\n  isAdmin: boolean;\n  adminRole?: string;\n  createdAt: string;\n}\n\nexport default function AdminDashboard() {\n  const { toast } = useToast();\n  const { isAuthenticated, isLoading } = useAuth();\n  const queryClient = useQueryClient();\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  // Redirect if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Access Denied\",\n        description: \"Admin authentication required\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 1000);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  // Fetch admin dashboard data\n  const { data: dashboardData, isLoading: isDashboardLoading } = useQuery<AdminDashboardData>({\n    queryKey: [\"/api/admin/dashboard\"],\n    retry: false,\n    enabled: isAuthenticated,\n  });\n\n  // Fetch all users\n  const { data: users, isLoading: isUsersLoading } = useQuery<User[]>({\n    queryKey: [\"/api/admin/users\"],\n    retry: false,\n    enabled: isAuthenticated && activeTab === \"users\",\n  });\n\n  // Make user admin mutation\n  const makeAdminMutation = useMutation({\n    mutationFn: async ({ userId, adminRole }: { userId: string; adminRole: string }) => {\n      const response = await apiRequest('POST', `/api/admin/users/${userId}/make-admin`, { adminRole });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({\n        title: \"Admin Created\",\n        description: \"User has been granted admin access\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to grant admin access\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  if (isLoading || isDashboardLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading admin dashboard...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const isMasterAdmin = dashboardData?.adminInfo?.isMasterAdmin;\n\n  return (\n    <div className=\"min-h-screen bg-background p-8\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold tracking-tight flex items-center gap-3\">\n                <Shield className=\"h-8 w-8 text-blue-600\" />\n                Admin Dashboard\n                {isMasterAdmin && <Crown className=\"h-6 w-6 text-yellow-500\" />}\n              </h1>\n              <p className=\"text-muted-foreground\">\n                {isMasterAdmin ? \"Master Admin\" : \"Secondary Admin\"} - Manage your HealthHire Portal\n              </p>\n            </div>\n            <Badge variant={isMasterAdmin ? \"default\" : \"secondary\"}>\n              {dashboardData?.adminInfo?.role?.replace('_', ' ').toUpperCase()}\n            </Badge>\n          </div>\n        </div>\n\n        {/* Overview Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Users</CardTitle>\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{dashboardData?.totalUsers || 0}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                +{dashboardData?.newSignups || 0} from last month\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Premium Users</CardTitle>\n              <Crown className=\"h-4 w-4 text-yellow-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{dashboardData?.premiumUsers || 0}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {dashboardData?.totalUsers ? Math.round((dashboardData.premiumUsers / dashboardData.totalUsers) * 100) : 0}% conversion rate\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Applications</CardTitle>\n              <FileText className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{dashboardData?.totalApplications || 0}</div>\n              <p className=\"text-xs text-muted-foreground\">Total job applications</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Interview Sessions</CardTitle>\n              <MessageCircle className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{dashboardData?.totalInterviewSessions || 0}</div>\n              <p className=\"text-xs text-muted-foreground\">Practice sessions completed</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Main Content Tabs */}\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-4\">\n          <TabsList className=\"grid w-full grid-cols-5\">\n            <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n            <TabsTrigger value=\"users\">Users</TabsTrigger>\n            <TabsTrigger value=\"content\">Content</TabsTrigger>\n            <TabsTrigger value=\"prompts\">AI Prompts</TabsTrigger>\n            <TabsTrigger value=\"analytics\">Analytics</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"overview\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>System Overview</CardTitle>\n                <CardDescription>Current platform status and key metrics</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between p-4 border rounded-lg\">\n                    <div className=\"flex items-center gap-3\">\n                      <Activity className=\"h-5 w-5 text-green-500\" />\n                      <div>\n                        <p className=\"font-medium\">System Status</p>\n                        <p className=\"text-sm text-muted-foreground\">All systems operational</p>\n                      </div>\n                    </div>\n                    <Badge variant=\"outline\" className=\"text-green-600\">Online</Badge>\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between p-4 border rounded-lg\">\n                    <div className=\"flex items-center gap-3\">\n                      <TrendingUp className=\"h-5 w-5 text-blue-500\" />\n                      <div>\n                        <p className=\"font-medium\">User Growth</p>\n                        <p className=\"text-sm text-muted-foreground\">{dashboardData?.newSignups || 0} new users this month</p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"users\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>User Management</CardTitle>\n                <CardDescription>View and manage all platform users</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {isUsersLoading ? (\n                  <div className=\"flex items-center justify-center py-8\">\n                    <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary\"></div>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {users?.map((user) => (\n                      <div key={user.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                        <div className=\"flex items-center gap-3\">\n                          <UserCheck className=\"h-5 w-5 text-muted-foreground\" />\n                          <div>\n                            <p className=\"font-medium\">{user.email}</p>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {user.firstName} {user.lastName} ‚Ä¢ {user.subscriptionStatus}\n                              {user.isAdmin && ` ‚Ä¢ ${user.adminRole}`}\n                            </p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <Badge variant={user.subscriptionStatus === 'paid' ? 'default' : 'secondary'}>\n                            {user.subscriptionStatus}\n                          </Badge>\n                          {user.isAdmin && (\n                            <Badge variant=\"outline\">\n                              {user.adminRole === 'master_admin' ? (\n                                <><Crown className=\"h-3 w-3 mr-1\" />Master</>\n                              ) : (\n                                <><Shield className=\"h-3 w-3 mr-1\" />Admin</>\n                              )}\n                            </Badge>\n                          )}\n                          {isMasterAdmin && !user.isAdmin && (\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => makeAdminMutation.mutate({ userId: user.id, adminRole: 'secondary_admin' })}\n                              disabled={makeAdminMutation.isPending}\n                              data-testid={`make-admin-${user.id}`}\n                            >\n                              Make Admin\n                            </Button>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"content\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Content Management</CardTitle>\n                <CardDescription>Edit homepage and app content</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground\">Content management interface coming soon...</p>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"prompts\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>AI Prompt Management</CardTitle>\n                <CardDescription>Configure ChatGPT prompts and AI behavior</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground\">AI prompt management interface coming soon...</p>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"analytics\" className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Analytics & Reports</CardTitle>\n                <CardDescription>User engagement and platform metrics</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground\">Advanced analytics coming soon...</p>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":13263},"client/src/components/admin/ContentManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Edit, \n  Save, \n  X, \n  Globe, \n  BarChart3, \n  FileText,\n  RefreshCw\n} from \"lucide-react\";\n\ninterface ContentItem {\n  id: string;\n  contentKey: string;\n  title: string;\n  content: string;\n  contentType: string;\n  lastEditedBy: string;\n  updatedAt: string;\n}\n\ninterface EditingContent {\n  title: string;\n  content: string;\n}\n\nexport default function ContentManagement() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [activeTab, setActiveTab] = useState(\"homepage\");\n  const [editingContent, setEditingContent] = useState<{[key: string]: EditingContent}>({});\n  const [isEditing, setIsEditing] = useState<{[key: string]: boolean}>({});\n\n  // Fetch content data\n  const { data: contentData, isLoading } = useQuery<ContentItem[]>({\n    queryKey: [\"/api/admin/content\"],\n    retry: false,\n  });\n\n  // Update content mutation\n  const updateContentMutation = useMutation({\n    mutationFn: async ({ contentKey, title, content }: { contentKey: string; title: string; content: string }) => {\n      const response = await apiRequest('PUT', `/api/admin/content/${contentKey}`, {\n        title,\n        content,\n        contentType: contentData?.find(item => item.contentKey === contentKey)?.contentType || 'text'\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/content\"] });\n      toast({\n        title: \"Content Updated\",\n        description: \"Your changes have been saved successfully\",\n      });\n      setEditingContent({});\n      setIsEditing({});\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update content\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleEdit = (contentKey: string, currentTitle: string, currentContent: string) => {\n    setEditingContent({\n      ...editingContent,\n      [contentKey]: { title: currentTitle, content: currentContent }\n    });\n    setIsEditing({ ...isEditing, [contentKey]: true });\n  };\n\n  const handleSave = (contentKey: string) => {\n    const edited = editingContent[contentKey];\n    if (edited) {\n      updateContentMutation.mutate({\n        contentKey,\n        title: edited.title,\n        content: edited.content\n      });\n    }\n  };\n\n  const handleCancel = (contentKey: string) => {\n    const newEditingContent = { ...editingContent };\n    const newIsEditing = { ...isEditing };\n    delete newEditingContent[contentKey];\n    delete newIsEditing[contentKey];\n    setEditingContent(newEditingContent);\n    setIsEditing(newIsEditing);\n  };\n\n  const updateEditingField = (contentKey: string, field: 'title' | 'content', value: string) => {\n    setEditingContent({\n      ...editingContent,\n      [contentKey]: {\n        ...editingContent[contentKey],\n        [field]: value\n      }\n    });\n  };\n\n  const getPageIcon = (page: string) => {\n    switch (page) {\n      case 'homepage': return <Globe className=\"h-4 w-4\" />;\n      case 'dashboard': return <BarChart3 className=\"h-4 w-4\" />;\n      default: return <FileText className=\"h-4 w-4\" />;\n    }\n  };\n\n  const groupContentByPage = (content: ContentItem[]) => {\n    const grouped: {[key: string]: ContentItem[]} = {};\n    content.forEach(item => {\n      const page = item.contentKey.includes('homepage') ? 'homepage' : \n                   item.contentKey.includes('dashboard') ? 'dashboard' : 'other';\n      if (!grouped[page]) grouped[page] = [];\n      grouped[page].push(item);\n    });\n    return grouped;\n  };\n\n  const renderContentSection = (item: ContentItem) => {\n    const isCurrentlyEditing = isEditing[item.contentKey];\n    const editing = editingContent[item.contentKey];\n\n    return (\n      <Card key={item.id} className=\"mb-4\">\n        <CardHeader className=\"pb-3\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle className=\"text-lg\">\n                {isCurrentlyEditing ? (\n                  <Input\n                    value={editing?.title || item.title}\n                    onChange={(e) => updateEditingField(item.contentKey, 'title', e.target.value)}\n                    className=\"font-semibold\"\n                    data-testid={`input-title-${item.contentKey}`}\n                  />\n                ) : (\n                  item.title\n                )}\n              </CardTitle>\n              <CardDescription className=\"flex items-center gap-2 mt-1\">\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  {item.contentKey}\n                </Badge>\n                <span className=\"text-xs text-muted-foreground\">\n                  Last edited by {item.lastEditedBy}\n                </span>\n              </CardDescription>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              {isCurrentlyEditing ? (\n                <>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleCancel(item.contentKey)}\n                    data-testid={`button-cancel-${item.contentKey}`}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    onClick={() => handleSave(item.contentKey)}\n                    disabled={updateContentMutation.isPending}\n                    data-testid={`button-save-${item.contentKey}`}\n                  >\n                    {updateContentMutation.isPending ? (\n                      <RefreshCw className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <Save className=\"h-4 w-4\" />\n                    )}\n                  </Button>\n                </>\n              ) : (\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => handleEdit(item.contentKey, item.title, item.content)}\n                  data-testid={`button-edit-${item.contentKey}`}\n                >\n                  <Edit className=\"h-4 w-4\" />\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isCurrentlyEditing ? (\n            <Textarea\n              value={editing?.content || item.content}\n              onChange={(e) => updateEditingField(item.contentKey, 'content', e.target.value)}\n              rows={4}\n              className=\"min-h-[100px]\"\n              data-testid={`textarea-content-${item.contentKey}`}\n            />\n          ) : (\n            <div className=\"p-3 bg-muted/30 rounded-md\">\n              <p className=\"text-sm whitespace-pre-wrap\">{item.content}</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    );\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-8\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  const groupedContent = contentData ? groupContentByPage(contentData) : {};\n  const pages = Object.keys(groupedContent);\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Content Management</CardTitle>\n          <CardDescription>\n            Edit content across different pages of your platform. Changes will appear immediately for users.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-4\">\n            <TabsList className=\"grid w-full grid-cols-3\">\n              {pages.map(page => (\n                <TabsTrigger key={page} value={page} className=\"flex items-center gap-2\">\n                  {getPageIcon(page)}\n                  <span className=\"capitalize\">{page}</span>\n                </TabsTrigger>\n              ))}\n            </TabsList>\n\n            {pages.map(page => (\n              <TabsContent key={page} value={page} className=\"space-y-4\">\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center gap-2 mb-4\">\n                    {getPageIcon(page)}\n                    <h3 className=\"text-lg font-semibold capitalize\">\n                      {page} Content Sections\n                    </h3>\n                    <Badge variant=\"secondary\">\n                      {groupedContent[page]?.length || 0} sections\n                    </Badge>\n                  </div>\n                  \n                  {groupedContent[page]?.map(renderContentSection)}\n                </div>\n              </TabsContent>\n            ))}\n          </Tabs>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":9233},"client/src/components/admin/PromptManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Edit, \n  Save, \n  X, \n  Brain, \n  MessageSquare, \n  Settings,\n  RefreshCw,\n  Thermometer,\n  Hash\n} from \"lucide-react\";\n\ninterface AiPrompt {\n  id: string;\n  promptKey: string;\n  name: string;\n  description: string;\n  category: string;\n  systemPrompt: string;\n  userPromptTemplate: string;\n  temperature: number;\n  maxTokens: number;\n  isActive: boolean;\n  lastEditedBy: string;\n  updatedAt: string;\n}\n\ninterface EditingPrompt {\n  name: string;\n  description: string;\n  systemPrompt: string;\n  userPromptTemplate: string;\n  temperature: number;\n  maxTokens: number;\n  isActive: boolean;\n}\n\nexport default function PromptManagement() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [activeTab, setActiveTab] = useState(\"all\");\n  const [editingPrompts, setEditingPrompts] = useState<{[key: string]: EditingPrompt}>({});\n  const [isEditing, setIsEditing] = useState<{[key: string]: boolean}>({});\n\n  // Fetch prompts data\n  const { data: promptsData, isLoading } = useQuery<AiPrompt[]>({\n    queryKey: [\"/api/admin/prompts\"],\n    retry: false,\n  });\n\n  // Update prompt mutation\n  const updatePromptMutation = useMutation({\n    mutationFn: async ({ promptKey, promptData }: { promptKey: string; promptData: EditingPrompt }) => {\n      const response = await apiRequest('PUT', `/api/admin/prompts/${promptKey}`, promptData);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/prompts\"] });\n      toast({\n        title: \"Prompt Updated\",\n        description: \"AI prompt configuration has been saved successfully\",\n      });\n      setEditingPrompts({});\n      setIsEditing({});\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update AI prompt\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleEdit = (promptKey: string, prompt: AiPrompt) => {\n    setEditingPrompts({\n      ...editingPrompts,\n      [promptKey]: {\n        name: prompt.name,\n        description: prompt.description,\n        systemPrompt: prompt.systemPrompt,\n        userPromptTemplate: prompt.userPromptTemplate,\n        temperature: prompt.temperature,\n        maxTokens: prompt.maxTokens,\n        isActive: prompt.isActive\n      }\n    });\n    setIsEditing({ ...isEditing, [promptKey]: true });\n  };\n\n  const handleSave = (promptKey: string) => {\n    const edited = editingPrompts[promptKey];\n    if (edited) {\n      updatePromptMutation.mutate({\n        promptKey,\n        promptData: edited\n      });\n    }\n  };\n\n  const handleCancel = (promptKey: string) => {\n    const newEditingPrompts = { ...editingPrompts };\n    const newIsEditing = { ...isEditing };\n    delete newEditingPrompts[promptKey];\n    delete newIsEditing[promptKey];\n    setEditingPrompts(newEditingPrompts);\n    setIsEditing(newIsEditing);\n  };\n\n  const updatePromptField = (promptKey: string, field: keyof EditingPrompt, value: any) => {\n    setEditingPrompts({\n      ...editingPrompts,\n      [promptKey]: {\n        ...editingPrompts[promptKey],\n        [field]: value\n      }\n    });\n  };\n\n  const getCategoryIcon = (category: string) => {\n    switch (category) {\n      case 'cv_generation': return <MessageSquare className=\"h-4 w-4\" />;\n      case 'interview': return <Brain className=\"h-4 w-4\" />;\n      case 'job_matching': return <Settings className=\"h-4 w-4\" />;\n      default: return <Settings className=\"h-4 w-4\" />;\n    }\n  };\n\n  const groupPromptsByCategory = (prompts: AiPrompt[]) => {\n    const grouped: {[key: string]: AiPrompt[]} = {};\n    prompts.forEach(prompt => {\n      if (!grouped[prompt.category]) grouped[prompt.category] = [];\n      grouped[prompt.category].push(prompt);\n    });\n    return grouped;\n  };\n\n  const getFilteredPrompts = () => {\n    if (!promptsData) return [];\n    if (activeTab === \"all\") return promptsData;\n    return promptsData.filter(prompt => prompt.category === activeTab);\n  };\n\n  const renderPromptCard = (prompt: AiPrompt) => {\n    const isCurrentlyEditing = isEditing[prompt.promptKey];\n    const editing = editingPrompts[prompt.promptKey];\n\n    return (\n      <Card key={prompt.id} className=\"mb-4\">\n        <CardHeader className=\"pb-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-2 mb-2\">\n                {getCategoryIcon(prompt.category)}\n                <CardTitle className=\"text-lg\">\n                  {isCurrentlyEditing ? (\n                    <Input\n                      value={editing?.name || prompt.name}\n                      onChange={(e) => updatePromptField(prompt.promptKey, 'name', e.target.value)}\n                      className=\"font-semibold\"\n                      data-testid={`input-name-${prompt.promptKey}`}\n                    />\n                  ) : (\n                    prompt.name\n                  )}\n                </CardTitle>\n                <Badge variant={prompt.isActive ? \"default\" : \"secondary\"}>\n                  {prompt.isActive ? \"Active\" : \"Inactive\"}\n                </Badge>\n              </div>\n              <CardDescription>\n                {isCurrentlyEditing ? (\n                  <Input\n                    value={editing?.description || prompt.description}\n                    onChange={(e) => updatePromptField(prompt.promptKey, 'description', e.target.value)}\n                    placeholder=\"Brief description of this prompt...\"\n                    data-testid={`input-description-${prompt.promptKey}`}\n                  />\n                ) : (\n                  prompt.description\n                )}\n              </CardDescription>\n              <div className=\"flex items-center gap-4 mt-2 text-xs text-muted-foreground\">\n                <span>Key: {prompt.promptKey}</span>\n                <span>Last edited by {prompt.lastEditedBy}</span>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              {isCurrentlyEditing ? (\n                <>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleCancel(prompt.promptKey)}\n                    data-testid={`button-cancel-${prompt.promptKey}`}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    onClick={() => handleSave(prompt.promptKey)}\n                    disabled={updatePromptMutation.isPending}\n                    data-testid={`button-save-${prompt.promptKey}`}\n                  >\n                    {updatePromptMutation.isPending ? (\n                      <RefreshCw className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <Save className=\"h-4 w-4\" />\n                    )}\n                  </Button>\n                </>\n              ) : (\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => handleEdit(prompt.promptKey, prompt)}\n                  data-testid={`button-edit-${prompt.promptKey}`}\n                >\n                  <Edit className=\"h-4 w-4\" />\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {/* Activation Switch */}\n          {isCurrentlyEditing && (\n            <div className=\"flex items-center justify-between p-3 border rounded-lg\">\n              <div className=\"flex items-center gap-2\">\n                <Settings className=\"h-4 w-4\" />\n                <span className=\"font-medium\">Active</span>\n              </div>\n              <Switch\n                checked={editing?.isActive ?? prompt.isActive}\n                onCheckedChange={(checked) => updatePromptField(prompt.promptKey, 'isActive', checked)}\n                data-testid={`switch-active-${prompt.promptKey}`}\n              />\n            </div>\n          )}\n\n          {/* AI Configuration */}\n          {isCurrentlyEditing && (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center gap-2\">\n                  <Thermometer className=\"h-4 w-4\" />\n                  <label className=\"text-sm font-medium\">Temperature: {editing?.temperature ?? prompt.temperature}</label>\n                </div>\n                <Slider\n                  value={[editing?.temperature ?? prompt.temperature]}\n                  onValueChange={([value]) => updatePromptField(prompt.promptKey, 'temperature', value)}\n                  max={2}\n                  min={0}\n                  step={0.1}\n                  className=\"w-full\"\n                  data-testid={`slider-temperature-${prompt.promptKey}`}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center gap-2\">\n                  <Hash className=\"h-4 w-4\" />\n                  <label className=\"text-sm font-medium\">Max Tokens</label>\n                </div>\n                <Input\n                  type=\"number\"\n                  value={editing?.maxTokens ?? prompt.maxTokens}\n                  onChange={(e) => updatePromptField(prompt.promptKey, 'maxTokens', parseInt(e.target.value))}\n                  min={1}\n                  max={4000}\n                  data-testid={`input-tokens-${prompt.promptKey}`}\n                />\n              </div>\n            </div>\n          )}\n\n          {/* System Prompt */}\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium\">System Prompt</label>\n            {isCurrentlyEditing ? (\n              <Textarea\n                value={editing?.systemPrompt || prompt.systemPrompt}\n                onChange={(e) => updatePromptField(prompt.promptKey, 'systemPrompt', e.target.value)}\n                rows={4}\n                placeholder=\"System instructions for the AI...\"\n                data-testid={`textarea-system-${prompt.promptKey}`}\n              />\n            ) : (\n              <div className=\"p-3 bg-muted/30 rounded-md\">\n                <p className=\"text-sm whitespace-pre-wrap\">{prompt.systemPrompt}</p>\n              </div>\n            )}\n          </div>\n\n          {/* User Prompt Template */}\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium\">User Prompt Template</label>\n            {isCurrentlyEditing ? (\n              <Textarea\n                value={editing?.userPromptTemplate || prompt.userPromptTemplate}\n                onChange={(e) => updatePromptField(prompt.promptKey, 'userPromptTemplate', e.target.value)}\n                rows={3}\n                placeholder=\"Template for user inputs (use {variables} for placeholders)...\"\n                data-testid={`textarea-template-${prompt.promptKey}`}\n              />\n            ) : (\n              <div className=\"p-3 bg-muted/30 rounded-md\">\n                <p className=\"text-sm whitespace-pre-wrap\">{prompt.userPromptTemplate}</p>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-8\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  const categories = promptsData ? Array.from(new Set(promptsData.map(p => p.category))) : [];\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle>AI Prompt Management</CardTitle>\n          <CardDescription>\n            Configure AI prompts used throughout the platform. Adjust temperature, token limits, and prompt content.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-4\">\n            <TabsList className=\"grid w-full grid-cols-4\">\n              <TabsTrigger value=\"all\">All Prompts</TabsTrigger>\n              {categories.slice(0, 3).map(category => (\n                <TabsTrigger key={category} value={category} className=\"flex items-center gap-2\">\n                  {getCategoryIcon(category)}\n                  <span className=\"capitalize\">{category.replace('_', ' ')}</span>\n                </TabsTrigger>\n              ))}\n            </TabsList>\n\n            <TabsContent value={activeTab} className=\"space-y-4\">\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-2 mb-4\">\n                  <Brain className=\"h-5 w-5\" />\n                  <h3 className=\"text-lg font-semibold\">\n                    {activeTab === \"all\" ? \"All AI Prompts\" : `${activeTab.replace('_', ' ')} Prompts`.replace(/\\b\\w/g, l => l.toUpperCase())}\n                  </h3>\n                  <Badge variant=\"secondary\">\n                    {getFilteredPrompts().length} prompts\n                  </Badge>\n                </div>\n                \n                {getFilteredPrompts().map(renderPromptCard)}\n              </div>\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":13890},"server/gemini-service.ts":{"content":"import { GoogleGenAI } from \"@google/genai\";\n\nconst ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY || \"\" });\n\nexport class GeminiService {\n  /**\n   * Generate CV content using Gemini\n   */\n  async generateCV(context: {\n    jobTitle: string;\n    jobDescription: string;\n    userProfile: any;\n    experience: string[];\n    skills: string[];\n  }): Promise<string> {\n    const prompt = `You are an expert NHS recruitment consultant and CV writer. Create a professional CV tailored for NHS healthcare positions.\n\nJob Title: ${context.jobTitle}\nJob Description: ${context.jobDescription}\n\nUser Profile:\n- Name: ${context.userProfile.firstName} ${context.userProfile.lastName}\n- Profession: ${context.userProfile.profession}\n- Registration Number: ${context.userProfile.registrationNumber || 'Not provided'}\n- Email: ${context.userProfile.email}\n- Phone: ${context.userProfile.phone || 'Not provided'}\n\nExperience:\n${context.experience.map(exp => `- ${exp}`).join('\\n')}\n\nSkills:\n${context.skills.map(skill => `- ${skill}`).join('\\n')}\n\nCreate a compelling CV that:\n1. Highlights relevant NHS experience and healthcare qualifications\n2. Demonstrates patient care excellence and clinical competency\n3. Shows alignment with NHS values: care and compassion, respect and dignity, commitment to quality of care, improving lives, working together for patients, everyone counts\n4. Uses healthcare-specific terminology and demonstrates understanding of NHS standards\n5. Emphasizes continuous professional development and evidence-based practice\n\nFormat the CV with clear sections: Personal Statement, Professional Experience, Education & Qualifications, Key Skills, Professional Development, and References.`;\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash-lite\",\n      contents: prompt,\n    });\n\n    return response.text || \"Error generating CV content\";\n  }\n\n  /**\n   * Generate supporting information for NHS job applications\n   */\n  async generateSupportingInformation(context: {\n    jobTitle: string;\n    personSpecification: string;\n    userProfile: any;\n    experience: string[];\n  }): Promise<string> {\n    const prompt = `You are an NHS recruitment expert specializing in supporting information for job applications. Create compelling supporting information that directly addresses the person specification.\n\nJob Title: ${context.jobTitle}\nPerson Specification:\n${context.personSpecification}\n\nCandidate Background:\n- Profession: ${context.userProfile.profession}\n- Experience: ${context.experience.join(', ')}\n- Education: ${Array.isArray(context.userProfile.education) ? context.userProfile.education.map((edu: any) => `${edu.degree} from ${edu.institution} (${edu.year})`).join(', ') : 'Not specified'}\n- Certificates: ${Array.isArray(context.userProfile.courses) ? context.userProfile.courses.map((course: any) => `${course.name} (${course.provider}, ${course.year})`).join(', ') : 'Not specified'}\n\nCreate supporting information that:\n1. Directly addresses each point in the person specification with specific examples\n2. Demonstrates understanding of NHS values and healthcare priorities\n3. Shows commitment to patient safety, quality improvement, and multidisciplinary working\n4. Uses the STAR method (Situation, Task, Action, Result) for key examples\n5. Reflects current NHS challenges and priorities\n6. Demonstrates cultural competency and inclusive practice\n7. Utilizes the candidate's certificates, education, and qualifications throughout\n8. Avoids quotation marks, bold text, italics, and headings\n9. Keep language simple and clear with varying sentence structure and length\n\nWrite as flowing paragraphs without headings or formatting. Provide concrete examples and quantify achievements where possible.`;\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash-lite\",\n      contents: prompt,\n    });\n\n    return response.text || \"Error generating supporting information\";\n  }\n\n  /**\n   * Generate interview questions and answers\n   */\n  async generateInterviewQA(context: {\n    jobTitle: string;\n    jobDescription: string;\n    experienceLevel: string;\n  }): Promise<{ questions: string[]; answers: string[] }> {\n    const systemPrompt = `You are an NHS interview panel expert. Generate realistic interview questions and model answers for NHS healthcare positions.\n\nJob Title: ${context.jobTitle}\nJob Description: ${context.jobDescription}\nExperience Level: ${context.experienceLevel}\n\nGenerate 8-10 interview questions that NHS panels commonly ask, covering:\n1. Clinical competency and patient safety\n2. NHS values alignment\n3. Teamwork and communication\n4. Conflict resolution and challenging situations\n5. Professional development and learning\n6. Diversity, equality, and inclusion\n7. Service improvement and innovation\n8. Leadership and accountability\n\nFor each question, provide a structured model answer using healthcare examples. Answers should demonstrate NHS values, patient-centered care, and professional competency.\n\nRespond with JSON format:\n{\n  \"questions\": [\"question1\", \"question2\", ...],\n  \"answers\": [\"answer1\", \"answer2\", ...]\n}`;\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash-lite\",\n      config: {\n        systemInstruction: systemPrompt,\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: \"object\",\n          properties: {\n            questions: {\n              type: \"array\",\n              items: { type: \"string\" }\n            },\n            answers: {\n              type: \"array\",\n              items: { type: \"string\" }\n            }\n          },\n          required: [\"questions\", \"answers\"]\n        }\n      },\n      contents: \"Generate interview questions and answers for this NHS position.\",\n    });\n\n    const result = JSON.parse(response.text || '{\"questions\": [], \"answers\": []}');\n    return result;\n  }\n\n  /**\n   * Score interview responses and provide feedback\n   */\n  async scoreInterviewResponse(context: {\n    question: string;\n    answer: string;\n    jobTitle: string;\n  }): Promise<{ score: number; feedback: string; improvements: string[] }> {\n    const systemPrompt = `You are an NHS interview assessor. Score the candidate's response and provide constructive feedback.\n\nInterview Question: ${context.question}\nCandidate's Answer: ${context.answer}\nJob Title: ${context.jobTitle}\n\nEvaluate the response on:\n1. Relevance to the question (25%)\n2. NHS values demonstration (25%)\n3. Clinical knowledge/competency (20%)\n4. Communication clarity (15%)\n5. Specific examples provided (15%)\n\nProvide a score out of 10, constructive feedback explaining strengths and areas for improvement, and 3-5 specific improvement suggestions.\n\nRespond with JSON format:\n{\n  \"score\": number,\n  \"feedback\": \"detailed feedback text\",\n  \"improvements\": [\"improvement1\", \"improvement2\", \"improvement3\"]\n}`;\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash-lite\",\n      config: {\n        systemInstruction: systemPrompt,\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: \"object\",\n          properties: {\n            score: { type: \"number\" },\n            feedback: { type: \"string\" },\n            improvements: {\n              type: \"array\",\n              items: { type: \"string\" }\n            }\n          },\n          required: [\"score\", \"feedback\", \"improvements\"]\n        }\n      },\n      contents: \"Score this interview response and provide feedback.\",\n    });\n\n    const result = JSON.parse(response.text || '{\"score\": 0, \"feedback\": \"\", \"improvements\": []}');\n    return {\n      score: Math.max(0, Math.min(10, result.score || 0)),\n      feedback: result.feedback || '',\n      improvements: result.improvements || []\n    };\n  }\n\n  /**\n   * Analyze job descriptions and extract key requirements\n   */\n  async analyzeJobDescription(jobDescription: string): Promise<{\n    keyRequirements: string[];\n    skillsNeeded: string[];\n    experienceLevel: string;\n    nhsValues: string[];\n  }> {\n    const systemPrompt = `Analyze this NHS job description and extract key information to help candidates prepare their applications.\n\nJob Description:\n${jobDescription}\n\nExtract:\n1. Essential requirements and qualifications\n2. Key skills and competencies needed\n3. Experience level required (entry, mid, senior)\n4. Which NHS values are most relevant\n\nRespond with JSON format:\n{\n  \"keyRequirements\": [\"requirement1\", \"requirement2\"],\n  \"skillsNeeded\": [\"skill1\", \"skill2\"],\n  \"experienceLevel\": \"entry/mid/senior\",\n  \"nhsValues\": [\"value1\", \"value2\"]\n}`;\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash-lite\",\n      config: {\n        systemInstruction: systemPrompt,\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: \"object\",\n          properties: {\n            keyRequirements: {\n              type: \"array\",\n              items: { type: \"string\" }\n            },\n            skillsNeeded: {\n              type: \"array\",\n              items: { type: \"string\" }\n            },\n            experienceLevel: { type: \"string\" },\n            nhsValues: {\n              type: \"array\",\n              items: { type: \"string\" }\n            }\n          },\n          required: [\"keyRequirements\", \"skillsNeeded\", \"experienceLevel\", \"nhsValues\"]\n        }\n      },\n      contents: \"Analyze this job description.\",\n    });\n\n    const result = JSON.parse(response.text || '{\"keyRequirements\": [], \"skillsNeeded\": [], \"experienceLevel\": \"mid\", \"nhsValues\": []}');\n    return result;\n  }\n\n  /**\n   * Generate 25 Q&A flashcards for interview preparation\n   */\n  async generateQAFlashcards(context: {\n    jobTitle: string;\n    jobDescription: string;\n  }): Promise<Array<{ question: string; modelAnswer: string; category: string }>> {\n    const systemPrompt = `You are Henry the Helper, an expert NHS recruitment specialist and interview coach. Generate exactly 25 interview questions and model answers for NHS healthcare positions.\n\nJob Title: ${context.jobTitle}\nJob Description: ${context.jobDescription}\n\nCreate 25 questions covering these categories (distribute evenly):\n1. Clinical Competency & Patient Safety (5 questions)\n2. NHS Values & Patient Care (5 questions) \n3. Teamwork & Communication (4 questions)\n4. Challenging Situations & Problem Solving (4 questions)\n5. Professional Development & Learning (3 questions)\n6. Leadership & Accountability (2 questions)\n7. Diversity & Inclusion (2 questions)\n\nWriting Guidelines:\n- Use simple, clear language\n- Keep sentences short and direct\n- Avoid quotation marks, bullet points, bold or italic text\n- Write in past tense when describing duties or actions\n- Be professional but approachable\n\nFor each question, provide:\n- A realistic NHS interview question specific to the role\n- A comprehensive model answer that demonstrates NHS values\n- Clear category classification\n\nModel answers should:\n- Be 150-250 words each\n- Include specific examples relevant to the role\n- Demonstrate NHS values: care and compassion, respect and dignity, commitment to quality care, improving lives, working together for patients, everyone counts\n- Show understanding of patient safety, multidisciplinary working, and continuous improvement\n- Use the STAR method where appropriate (Situation, Task, Action, Result)\n\nRespond with JSON format:\n{\n  \"questions\": [\n    {\n      \"question\": \"question text\",\n      \"modelAnswer\": \"detailed answer text\",\n      \"category\": \"category name\"\n    }\n  ]\n}`;\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash-lite\",\n      config: {\n        systemInstruction: systemPrompt,\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: \"object\",\n          properties: {\n            questions: {\n              type: \"array\",\n              items: {\n                type: \"object\",\n                properties: {\n                  question: { type: \"string\" },\n                  modelAnswer: { type: \"string\" },\n                  category: { type: \"string\" }\n                },\n                required: [\"question\", \"modelAnswer\", \"category\"]\n              }\n            }\n          },\n          required: [\"questions\"]\n        }\n      },\n      contents: \"Generate 25 interview Q&A flashcards for this NHS position.\",\n    });\n\n    const result = JSON.parse(response.text || '{\"questions\": []}');\n    return result.questions || [];\n  }\n\n  /**\n   * Generate personalized career advice\n   */\n  async generateCareerAdvice(context: {\n    userProfile: any;\n    careerGoals: string;\n    currentChallenges: string[];\n  }): Promise<string> {\n    const prompt = `You are a senior NHS career advisor with 20+ years of experience guiding healthcare professionals. Provide personalized career advice.\n\nProfessional Profile:\n- Profession: ${context.userProfile.profession}\n- Experience Level: ${context.userProfile.experienceYears || 'Not specified'} years\n- Current Role: ${context.userProfile.currentRole || 'Not specified'}\n- Specializations: ${context.userProfile.specializations?.join(', ') || 'Not specified'}\n\nCareer Goals: ${context.careerGoals}\n\nCurrent Challenges:\n${context.currentChallenges.map(challenge => `- ${challenge}`).join('\\n')}\n\nProvide actionable career advice that includes:\n1. Specific steps to achieve their career goals within the NHS\n2. Professional development opportunities and courses\n3. Networking strategies within healthcare\n4. How to overcome current challenges\n5. Timeline and milestones to track progress\n6. Additional qualifications or certifications to consider\n\nBe encouraging, practical, and NHS-focused in your advice.`;\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash-lite\",\n      contents: prompt,\n    });\n\n    return response.text || \"Unable to generate career advice at this time.\";\n  }\n}\n\nexport const geminiService = new GeminiService();","size_bytes":13951},"server/routes/ai-gemini.ts":{"content":"import { Router } from \"express\";\nimport { geminiService } from \"../gemini-service\";\nimport { isAuthenticated } from \"../replitAuth\";\n\nconst router = Router();\n\n// Test endpoint for Gemini career advice\nrouter.post(\"/career-advice\", isAuthenticated, async (req: any, res) => {\n  try {\n    const { careerGoals, currentChallenges } = req.body;\n    \n    if (!careerGoals) {\n      return res.status(400).json({ error: \"Career goals are required\" });\n    }\n\n    const advice = await geminiService.generateCareerAdvice({\n      userProfile: req.user || {},\n      careerGoals,\n      currentChallenges: currentChallenges || []\n    });\n\n    res.json({ advice });\n  } catch (error) {\n    console.error(\"Error generating career advice:\", error);\n    res.status(500).json({ error: \"Failed to generate career advice\" });\n  }\n});\n\n// Test endpoint for job analysis\nrouter.post(\"/analyze-job\", isAuthenticated, async (req: any, res) => {\n  try {\n    const { jobDescription } = req.body;\n    \n    if (!jobDescription) {\n      return res.status(400).json({ error: \"Job description is required\" });\n    }\n\n    const analysis = await geminiService.analyzeJobDescription(jobDescription);\n    res.json({ analysis });\n  } catch (error) {\n    console.error(\"Error analyzing job:\", error);\n    res.status(500).json({ error: \"Failed to analyze job description\" });\n  }\n});\n\n// Example prompts and their structures\nrouter.get(\"/prompt-examples\", isAuthenticated, async (req: any, res) => {\n  const examples = {\n    careerAdvice: {\n      description: \"Generate personalized career advice for healthcare professionals\",\n      structure: {\n        systemInstruction: \"You are a senior NHS career advisor with 20+ years of experience\",\n        userContext: {\n          userProfile: \"Professional details, experience, qualifications\",\n          careerGoals: \"Specific career objectives\",\n          currentChallenges: \"Array of current challenges or obstacles\"\n        },\n        promptGuidelines: [\n          \"Be encouraging and practical\",\n          \"Focus on NHS-specific advice\",\n          \"Provide actionable steps with timelines\",\n          \"Include professional development suggestions\",\n          \"Address challenges with specific solutions\"\n        ]\n      },\n      example: {\n        careerGoals: \"I want to become a Band 7 nurse manager within 2 years\",\n        currentChallenges: [\n          \"Lack of management experience\",\n          \"Need leadership training\",\n          \"Limited budget for courses\"\n        ]\n      }\n    },\n    \n    cvGeneration: {\n      description: \"Generate tailored CV content for NHS positions\",\n      structure: {\n        requiredContext: {\n          jobTitle: \"Target position title\",\n          jobDescription: \"Full job description and requirements\",\n          userProfile: \"Complete professional profile\",\n          experience: \"Array of relevant experience\",\n          skills: \"Array of relevant skills\"\n        },\n        promptFocus: [\n          \"NHS values alignment\",\n          \"Patient care excellence\",\n          \"Clinical competency demonstration\",\n          \"Professional development commitment\",\n          \"Evidence-based practice examples\"\n        ]\n      }\n    },\n\n    interviewQuestions: {\n      description: \"Generate realistic NHS interview questions and model answers\",\n      structure: {\n        questionCategories: [\n          \"Clinical competency and patient safety\",\n          \"NHS values alignment\",\n          \"Teamwork and communication\",\n          \"Conflict resolution\",\n          \"Professional development\",\n          \"Diversity and inclusion\",\n          \"Service improvement\",\n          \"Leadership and accountability\"\n        ],\n        answerStructure: \"STAR method (Situation, Task, Action, Result)\",\n        responseFormat: \"JSON with questions and answers arrays\"\n      }\n    },\n\n    supportingInformation: {\n      description: \"Generate NHS job application supporting information\",\n      structure: {\n        keyElements: [\n          \"Direct person specification addressing\",\n          \"NHS values demonstration with examples\",\n          \"STAR method examples\",\n          \"Patient safety and quality focus\",\n          \"Professional development commitment\",\n          \"Motivation and fit for role/trust\"\n        ],\n        writingGuidelines: [\n          \"First person narrative\",\n          \"Professional but personable tone\",\n          \"Specific measurable examples\",\n          \"Plain English, avoid jargon\",\n          \"Strong opening and closing\"\n        ]\n      }\n    },\n\n    promptTips: {\n      bestPractices: [\n        \"Always provide specific context about the NHS role and trust\",\n        \"Include relevant healthcare terminology and standards\",\n        \"Reference NHS values and priorities\",\n        \"Use structured prompts with clear instructions\",\n        \"Specify desired output format (JSON, text, word count)\",\n        \"Include examples when possible\",\n        \"Set appropriate temperature (0.3 for analysis, 0.7 for creative content)\",\n        \"Use system instructions to set the AI's role and expertise\"\n      ],\n      \n      commonMistakes: [\n        \"Being too vague about requirements\",\n        \"Not providing enough context\",\n        \"Forgetting to specify NHS-specific focus\",\n        \"Not setting appropriate response format\",\n        \"Ignoring the importance of healthcare values\",\n        \"Missing patient safety considerations\"\n      ]\n    }\n  };\n\n  res.json(examples);\n});\n\nexport default router;","size_bytes":5458},"client/src/components/HenryInterviewPractice.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { AiConsentWidget } from \"@/components/ai-consent-widget\";\nimport { MessageCircleQuestion, Sparkles, RotateCcw, Target, AlertTriangle, Clock, Timer, History, Calendar, ChevronDown, ChevronUp } from \"lucide-react\";\nimport henryImage from \"@assets/Henry Helper_1756820773886.png\";\n\ninterface GeneratedQuestions {\n  questions: string[];\n  jobTitle: string;\n  experienceLevel: string;\n  message: string;\n  isDemo?: boolean;\n}\n\ninterface InterviewFeedback {\n  feedback: string;\n  jobTitle: string;\n  question: string;\n  userAnswer: string;\n  message: string;\n  isDemo?: boolean;\n}\n\ninterface InterviewAttempt {\n  id: string;\n  question: string;\n  answer: string;\n  feedback: string;\n  timeSpent: number | null;\n  createdAt: string;\n}\n\nexport function HenryInterviewPractice() {\n  const [isGeneratingQuestions, setIsGeneratingQuestions] = useState(false);\n  const [isGeneratingFeedback, setIsGeneratingFeedback] = useState(false);\n  const [jobTitle, setJobTitle] = useState(\"\");\n  const [experienceLevel, setExperienceLevel] = useState(\"mid\");\n  const [generatedQuestions, setGeneratedQuestions] = useState<GeneratedQuestions | null>(null);\n  const [selectedQuestion, setSelectedQuestion] = useState(\"\");\n  const [userAnswer, setUserAnswer] = useState(\"\");\n  const [feedback, setFeedback] = useState<InterviewFeedback | null>(null);\n  const [showAiConsent, setShowAiConsent] = useState(false);\n  \n  // Timer states\n  const [timerDuration, setTimerDuration] = useState(0); // Not selected yet\n  const [timeLeft, setTimeLeft] = useState(0);\n  const [timerActive, setTimerActive] = useState(false);\n  const [timerSelected, setTimerSelected] = useState(false);\n  \n  // History expansion state\n  const [expandedItems, setExpandedItems] = useState<Set<string>>(new Set());\n  \n  const { toast } = useToast();\n\n  // Get current consents\n  const { data: consentsData } = useQuery<{\n    consents: Array<{\n      type: string;\n      given: boolean;\n      date: string;\n      legalBasis?: string;\n      version?: string;\n    }>;\n  }>({\n    queryKey: [\"/api/gdpr/consents\"],\n  });\n\n  // Get interview history\n  const { data: historyData, refetch: refetchHistory } = useQuery<{\n    attempts: InterviewAttempt[];\n    message: string;\n  }>({\n    queryKey: [\"/api/henry/interview-history\"],\n    retry: false,\n  });\n\n  // Timer effect\n  useEffect(() => {\n    if (timerActive && timeLeft > 0) {\n      const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\n      return () => clearTimeout(timer);\n    } else if (timeLeft === 0 && timerActive) {\n      // Auto-submit when timer runs out\n      setTimerActive(false);\n      handleGetFeedback();\n      toast({\n        title: \"Time's Up!\",\n        description: \"Your answer has been automatically submitted for feedback.\",\n        variant: \"destructive\",\n      });\n    }\n  }, [timeLeft, timerActive]);\n\n  // Format time display\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // Handle timer selection\n  const selectTimerDuration = (duration: number) => {\n    setTimerDuration(duration);\n    setTimerSelected(true);\n    setTimeLeft(duration);\n    setTimerActive(true);\n    toast({\n      title: \"Timer Started!\",\n      description: `You have ${formatTime(duration)} to complete your answer.`,\n    });\n  };\n\n  const handleGenerateQuestions = async () => {\n    if (!jobTitle.trim()) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please enter a job title first.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check for AI consent before proceeding\n    const aiConsent = consentsData?.consents?.find((c: any) => c.type === 'ai_processing');\n    if (!aiConsent?.given) {\n      setShowAiConsent(true);\n      return;\n    }\n\n    setIsGeneratingQuestions(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/henry/generate-questions\", {\n        jobTitle: jobTitle.trim(),\n        experienceLevel,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to generate questions\");\n      }\n\n      const data = await response.json();\n      setGeneratedQuestions(data);\n      setSelectedQuestion(data.questions[0] || \"\");\n      setUserAnswer(\"\");\n      setFeedback(null);\n      // Reset timer state\n      setTimerActive(false);\n      setTimeLeft(0);\n      setTimerSelected(false);\n      setTimerDuration(0);\n\n      toast({\n        title: \"Questions Generated!\",\n        description: `Henry created ${data.questions.length} interview questions for you.`,\n      });\n\n    } catch (error: any) {\n      toast({\n        title: \"Generation Failed\",\n        description: error.message || \"Henry couldn't generate questions right now.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsGeneratingQuestions(false);\n    }\n  };\n\n  const handleGetFeedback = async () => {\n    if (!selectedQuestion.trim()) {\n      toast({\n        title: \"Missing Question\",\n        description: \"Please select a question first.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!userAnswer.trim()) {\n      toast({\n        title: \"Missing Answer\",\n        description: \"Please write your answer before getting feedback.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check for AI consent before proceeding\n    const aiConsent = consentsData?.consents?.find((c: any) => c.type === 'ai_processing');\n    if (!aiConsent?.given) {\n      setShowAiConsent(true);\n      return;\n    }\n\n    // Stop timer if active\n    setTimerActive(false);\n    setTimeLeft(0);\n\n    setIsGeneratingFeedback(true);\n    try {\n      // Calculate time spent (if timer was used)\n      const timeSpent = timerDuration > 0 ? timerDuration - timeLeft : null;\n      \n      const response = await apiRequest(\"POST\", \"/api/henry/interview-practice\", {\n        jobTitle: jobTitle.trim(),\n        question: selectedQuestion.trim(),\n        userAnswer: userAnswer.trim(),\n        timeSpent: timeSpent,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to get feedback\");\n      }\n\n      const data = await response.json();\n      setFeedback(data);\n\n      // Refresh interview history to show the new attempt\n      refetchHistory();\n\n      toast({\n        title: \"Feedback Ready!\",\n        description: \"Henry has reviewed your answer with honest feedback.\",\n      });\n\n    } catch (error: any) {\n      toast({\n        title: \"Feedback Failed\",\n        description: error.message || \"Henry couldn't provide feedback right now.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsGeneratingFeedback(false);\n    }\n  };\n\n  const handleConsentGiven = () => {\n    setShowAiConsent(false);\n    toast({\n      title: \"AI Consent Given\",\n      description: \"Thank you! Henry can now help with interview practice.\",\n    });\n  };\n\n  const handleConsentDeclined = () => {\n    setShowAiConsent(false);\n    toast({\n      title: \"AI Consent Declined\",\n      description: \"You can still use the app, but AI features won't be available.\",\n      variant: \"destructive\",\n    });\n  };\n\n  // Format date for display\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-GB', {\n      day: 'numeric',\n      month: 'short',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  // Toggle expansion for history items\n  const toggleItemExpansion = (itemId: string) => {\n    const newExpanded = new Set(expandedItems);\n    if (newExpanded.has(itemId)) {\n      newExpanded.delete(itemId);\n    } else {\n      newExpanded.add(itemId);\n    }\n    setExpandedItems(newExpanded);\n  };\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"henry-interview-practice\">\n      {showAiConsent && (\n        <AiConsentWidget\n          onConsentGiven={handleConsentGiven}\n          onConsentDeclined={handleConsentDeclined}\n        />\n      )}\n\n      {/* Interview History Section */}\n      {historyData && historyData.attempts.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <History className=\"w-5 h-5\" />\n              Your Recent Interview Practice\n            </CardTitle>\n            <CardDescription>\n              Your last {historyData.attempts.length} interview attempts with Henry's feedback\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {historyData.attempts.map((attempt, index) => {\n                const isExpanded = expandedItems.has(attempt.id);\n                return (\n                  <div key={attempt.id} className=\"border border-gray-200 rounded-lg transition-colors\">\n                    {/* Collapsed Header - Always Visible */}\n                    <div \n                      className=\"p-4 cursor-pointer hover:bg-gray-50 flex items-center justify-between\"\n                      onClick={() => toggleItemExpansion(attempt.id)}\n                      data-testid={`history-item-${index}`}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center text-xs font-semibold text-blue-700\">\n                          #{historyData.attempts.length - index}\n                        </div>\n                        <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                          <Calendar className=\"w-3 h-3\" />\n                          {formatDate(attempt.createdAt)}\n                        </div>\n                        {attempt.timeSpent && (\n                          <Badge variant=\"outline\" className=\"text-xs\">\n                            {Math.floor(attempt.timeSpent / 60)}m {attempt.timeSpent % 60}s\n                          </Badge>\n                        )}\n                      </div>\n                      \n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-xs text-gray-500\">\n                          {isExpanded ? 'Collapse' : 'View Details'}\n                        </span>\n                        {isExpanded ? (\n                          <ChevronUp className=\"w-4 h-4 text-gray-400\" />\n                        ) : (\n                          <ChevronDown className=\"w-4 h-4 text-gray-400\" />\n                        )}\n                      </div>\n                    </div>\n\n                    {/* Summary line when collapsed */}\n                    {!isExpanded && (\n                      <div className=\"px-4 pb-4\">\n                        <p className=\"text-sm text-gray-600 italic\">\n                          {attempt.question.length > 100 \n                            ? `${attempt.question.substring(0, 100)}...` \n                            : attempt.question}\n                        </p>\n                      </div>\n                    )}\n                    \n                    {/* Expanded Content */}\n                    {isExpanded && (\n                      <div className=\"px-4 pb-4 border-t border-gray-100 pt-4 space-y-4\">\n                        <div>\n                          <p className=\"text-xs font-medium text-gray-500 mb-2\">Question:</p>\n                          <p className=\"text-sm bg-blue-50 p-3 rounded border-l-4 border-blue-200\">\n                            {attempt.question}\n                          </p>\n                        </div>\n                        \n                        <div>\n                          <p className=\"text-xs font-medium text-gray-500 mb-2\">Your Answer:</p>\n                          <p className=\"text-sm bg-gray-50 p-3 rounded border-l-4 border-gray-200\">\n                            {attempt.answer}\n                          </p>\n                        </div>\n                        \n                        <div>\n                          <p className=\"text-xs font-medium text-gray-500 mb-2\">Henry's Feedback:</p>\n                          <div className=\"bg-red-50 p-3 rounded border-l-4 border-red-200\">\n                            <pre className=\"text-sm text-gray-800 whitespace-pre-wrap font-sans\">\n                              {attempt.feedback}\n                            </pre>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardHeader className=\"flex flex-row items-center gap-4\">\n          <div className=\"w-12 h-12 bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg flex items-center justify-center\">\n            <img src={henryImage} alt=\"Henry\" className=\"w-8 h-8 rounded-full\" />\n          </div>\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <MessageCircleQuestion className=\"w-5 h-5\" />\n              Henry's Interview Practice\n            </CardTitle>\n            <CardDescription>\n              Get realistic NHS interview questions and harsh but constructive feedback to improve your performance\n            </CardDescription>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {/* Step 1: Job Setup */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-2 mb-3\">\n              <div className=\"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-semibold\">1</div>\n              <h3 className=\"text-lg font-semibold\">Interview Setup</h3>\n            </div>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"interview-job-title\">Job Title</Label>\n                <Input\n                  id=\"interview-job-title\"\n                  placeholder=\"e.g., Registered Nurse, Healthcare Assistant\"\n                  value={jobTitle}\n                  onChange={(e) => setJobTitle(e.target.value)}\n                  data-testid=\"input-interview-job-title\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"experience-level\">Experience Level</Label>\n                <Select value={experienceLevel} onValueChange={setExperienceLevel}>\n                  <SelectTrigger data-testid=\"select-experience-level\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"entry\">Entry Level</SelectItem>\n                    <SelectItem value=\"mid\">Mid Level</SelectItem>\n                    <SelectItem value=\"senior\">Senior Level</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <Button \n              onClick={handleGenerateQuestions}\n              disabled={isGeneratingQuestions || !jobTitle.trim()}\n              className=\"w-full md:w-auto\"\n              data-testid=\"button-generate-questions\"\n            >\n              {isGeneratingQuestions ? (\n                <>\n                  <Sparkles className=\"w-4 h-4 mr-2 animate-spin\" />\n                  Henry is creating questions...\n                </>\n              ) : (\n                <>\n                  <Sparkles className=\"w-4 h-4 mr-2\" />\n                  Generate Interview Questions\n                </>\n              )}\n            </Button>\n          </div>\n\n          {/* Step 2: Questions & Practice */}\n          {generatedQuestions && (\n            <div className=\"space-y-4 border-t pt-6\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <div className=\"w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-semibold\">2</div>\n                <h3 className=\"text-lg font-semibold\">Practice Questions</h3>\n                {generatedQuestions.isDemo && (\n                  <Badge variant=\"outline\" className=\"text-orange-600 border-orange-200\">\n                    Demo Mode\n                  </Badge>\n                )}\n              </div>\n\n              <div className=\"space-y-3\">\n                <Label>Choose a question to practice:</Label>\n                {generatedQuestions.questions.map((question, index) => (\n                  <div\n                    key={index}\n                    className={`p-4 border rounded-lg cursor-pointer transition-colors ${\n                      selectedQuestion === question\n                        ? \"border-blue-500 bg-blue-50\"\n                        : \"border-gray-200 hover:border-gray-300\"\n                    }`}\n                    onClick={() => {\n                      setSelectedQuestion(question);\n                      setUserAnswer(\"\");\n                      setFeedback(null);\n                      // Reset timer state\n                      setTimerActive(false);\n                      setTimeLeft(0);\n                      setTimerSelected(false);\n                      setTimerDuration(0);\n                    }}\n                    data-testid={`question-option-${index}`}\n                  >\n                    <div className=\"flex items-start gap-2\">\n                      <span className=\"text-sm font-medium text-blue-600\">Q{index + 1}:</span>\n                      <p className=\"text-sm\">{question}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n\n            </div>\n          )}\n\n          {/* Step 3: Timer Selection */}\n          {selectedQuestion && !timerSelected && (\n            <div className=\"space-y-4 border-t pt-6\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <div className=\"w-6 h-6 bg-purple-500 text-white rounded-full flex items-center justify-center text-sm font-semibold\">3</div>\n                <h3 className=\"text-lg font-semibold\">How long would you like to answer this question?</h3>\n              </div>\n\n              <div className=\"space-y-4 p-6 bg-blue-50 rounded-lg border border-blue-200\">\n                <div className=\"flex items-center gap-3 mb-4\">\n                  <Timer className=\"w-6 h-6 text-blue-600\" />\n                  <span className=\"font-medium text-blue-900\">Choose your time limit</span>\n                </div>\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <Button\n                    onClick={() => selectTimerDuration(120)}\n                    className=\"h-20 flex flex-col gap-2 text-left\"\n                    variant=\"outline\"\n                    data-testid=\"button-select-2min\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <Clock className=\"w-5 h-5\" />\n                      <span className=\"font-semibold\">2 Minutes</span>\n                    </div>\n                    <span className=\"text-sm text-muted-foreground\">I feel confident and want a challenge</span>\n                  </Button>\n                  \n                  <Button\n                    onClick={() => selectTimerDuration(240)}\n                    className=\"h-20 flex flex-col gap-2 text-left\"\n                    variant=\"outline\"\n                    data-testid=\"button-select-4min\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <Clock className=\"w-5 h-5\" />\n                      <span className=\"font-semibold\">4 Minutes</span>\n                    </div>\n                    <span className=\"text-sm text-muted-foreground\">I want more time to think through my answer</span>\n                  </Button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Step 4: Answer Input */}\n          {selectedQuestion && timerSelected && (\n            <div className=\"space-y-4 border-t pt-6\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <div className=\"w-6 h-6 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-semibold\">4</div>\n                <h3 className=\"text-lg font-semibold\">Your Answer</h3>\n              </div>\n\n              <div className=\"bg-gray-50 p-4 rounded-lg\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-700 mb-2\">Selected Question:</p>\n                    <p className=\"text-sm\">{selectedQuestion}</p>\n                  </div>\n                  {timerActive && (\n                    <div className=\"flex items-center gap-2 text-lg font-mono\">\n                      <Clock className=\"w-5 h-5 text-orange-600\" />\n                      <span className={`font-bold ${timeLeft <= 30 ? 'text-red-600' : timeLeft <= 60 ? 'text-orange-600' : 'text-green-600'}`}>\n                        {formatTime(timeLeft)}\n                      </span>\n                    </div>\n                  )}\n                </div>\n                {timerActive && timeLeft <= 30 && (\n                  <p className=\"text-sm text-red-600 animate-pulse mt-2\">Hurry up! Time is running out!</p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"user-answer\">Write your answer (max 2000 characters):</Label>\n                <Textarea\n                  id=\"user-answer\"\n                  placeholder=\"Write your thoughtful answer. Henry will give you honest feedback...\"\n                  value={userAnswer}\n                  onChange={(e) => setUserAnswer(e.target.value)}\n                  className=\"min-h-[120px]\"\n                  maxLength={2000}\n                  data-testid=\"textarea-user-answer\"\n                />\n                <p className=\"text-xs text-gray-500\">{userAnswer.length}/2000 characters</p>\n              </div>\n\n              <Button \n                onClick={handleGetFeedback}\n                disabled={isGeneratingFeedback || !userAnswer.trim()}\n                className=\"w-full md:w-auto\"\n                data-testid=\"button-get-feedback\"\n              >\n                {isGeneratingFeedback ? (\n                  <>\n                    <Target className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Henry is reviewing your answer...\n                  </>\n                ) : (\n                  <>\n                    <img src={henryImage} alt=\"Henry\" className=\"w-4 h-4 mr-2 rounded-full\" />\n                    Get Honest Feedback\n                  </>\n                )}\n              </Button>\n            </div>\n          )}\n\n          {/* Step 5: Feedback */}\n          {feedback && (\n            <div className=\"space-y-4 border-t pt-6\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <div className=\"w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-sm font-semibold\">5</div>\n                <h3 className=\"text-lg font-semibold\">Henry's Honest Feedback</h3>\n                {feedback.isDemo && (\n                  <Badge variant=\"outline\" className=\"text-orange-600 border-orange-200\">\n                    Demo Mode\n                  </Badge>\n                )}\n              </div>\n\n              <div className=\"bg-red-50 border border-red-200 rounded-lg p-6\">\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"w-10 h-10 bg-gradient-to-br from-red-100 to-orange-100 rounded-lg flex items-center justify-center flex-shrink-0\">\n                    <img src={henryImage} alt=\"Henry\" className=\"w-6 h-6 rounded-full\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-3\">\n                      <AlertTriangle className=\"w-4 h-4 text-red-600\" />\n                      <span className=\"font-semibold text-red-900\">Henry's Brutal but Helpful Review</span>\n                    </div>\n                    <div className=\"prose prose-sm max-w-none\">\n                      <pre className=\"whitespace-pre-wrap font-sans text-sm text-gray-800 bg-white p-4 rounded border\">\n{feedback.feedback}\n                      </pre>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex flex-wrap gap-2\">\n                <Button \n                  onClick={() => {\n                    setUserAnswer(\"\");\n                    setFeedback(null);\n                    // Reset timer state\n                    setTimerActive(false);\n                    setTimeLeft(0);\n                    setTimerSelected(false);\n                    setTimerDuration(0);\n                  }}\n                  variant=\"outline\"\n                  data-testid=\"button-try-again\"\n                >\n                  <RotateCcw className=\"w-4 h-4 mr-2\" />\n                  Try This Question Again\n                </Button>\n                <Button \n                  onClick={() => {\n                    setSelectedQuestion(\"\");\n                    setUserAnswer(\"\");\n                    setFeedback(null);\n                    // Reset timer state\n                    setTimerActive(false);\n                    setTimeLeft(0);\n                    setTimerSelected(false);\n                    setTimerDuration(0);\n                  }}\n                  variant=\"outline\"\n                  data-testid=\"button-choose-different-question\"\n                >\n                  Choose Different Question\n                </Button>\n                <Button \n                  onClick={() => {\n                    setGeneratedQuestions(null);\n                    setSelectedQuestion(\"\");\n                    setUserAnswer(\"\");\n                    setFeedback(null);\n                    // Reset timer state\n                    setTimerActive(false);\n                    setTimeLeft(0);\n                    setTimerSelected(false);\n                    setTimerDuration(0);\n                  }}\n                  variant=\"outline\"\n                  data-testid=\"button-start-over\"\n                >\n                  Start Over\n                </Button>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":27143},"client/src/pages/privacy-notice.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport default function PrivacyNotice() {\n  const [, setLocation] = useLocation();\n  const { isAuthenticated } = useAuth();\n  \n  const handleBack = () => {\n    // If user is authenticated, go to dashboard, otherwise go to homepage\n    if (isAuthenticated) {\n      setLocation(\"/\");\n    } else {\n      setLocation(\"/landing\");\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n      <div className=\"space-y-6\">\n        {/* Back Button */}\n        <div className=\"mb-8\">\n          <Button \n            variant=\"ghost\" \n            onClick={handleBack}\n            className=\"flex items-center gap-2 text-muted-foreground hover:text-foreground\"\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"h-4 w-4\" />\n            Back\n          </Button>\n        </div>\n\n        {/* Privacy Notice Content */}\n        <div className=\"prose prose-gray dark:prose-invert max-w-none\">\n          <h1>Privacy Notice</h1>\n          \n          <p><strong>Last updated: 8 September 2025</strong></p>\n\n          <h2>1) Who we are</h2>\n          <p>\n            <strong>Controller:</strong> HealthHire Portal (trading as HealthHire UK)<br/>\n            <strong>Registered office:</strong> 52 Carr Side Crescent ‚Ä¢ <strong>Company no:</strong> 15454323<br/>\n            <strong>Email:</strong> hello@healthhireportal.com\n          </p>\n          \n          <p>We provide an online toolkit to help applicants prepare NHS job applications (profile/CV, Supporting Information & cover letters with \"Henry the Helper\", interview practice, job tracking, resources, and job search & saves).</p>\n\n          <h2>2) The data we collect</h2>\n          <p><strong>Account & profile:</strong> name, email, location, role preferences, experience, education, skills, uploaded CVs/documents.</p>\n          <p><strong>Content you provide:</strong> Supporting Information, cover letters, interview practice answers, notes, job tracker entries.</p>\n          <p><strong>Usage & device:</strong> pages used, actions taken, timestamps, IP address, browser/device type (for security and service improvement).</p>\n          <p><strong>Payments:</strong> we receive payment confirmation and metadata from our payment processor.</p>\n          <p><strong>Referrals & communications:</strong> who invited you, your marketing preferences, messages you send to us.</p>\n\n          <h2>3) How we use your data (and lawful bases)</h2>\n          <ul>\n            <li><strong>Provide the service</strong> (create/maintain your account; generate documents; save jobs; track progress)</li>\n            <li><strong>Paid access & billing</strong> - Legal obligation (tax records).</li>\n            <li><strong>Support & service messages</strong> (password reset, critical updates)</li>\n            <li><strong>Improve and secure the platform</strong> (troubleshooting, analytics, preventing misuse)</li>\n            <li><strong>Optional updates & tips</strong> (newsletters, offers) (you can withdraw anytime).</li>\n          </ul>\n          \n          <p><strong>About \"Henry the Helper\":</strong> We use automated tools to help draft and improve your application content based on the information you provide. This is assistance only; we do not make decisions with legal or similarly significant effects based solely on automated processing.</p>\n\n          <h2>4) Who we share data with (processors)</h2>\n          <p>We use trusted service providers to run the portal. They only process your data under our instructions:</p>\n          \n          <ul>\n            <li><strong>Hosting & infrastructure:</strong> Replit</li>\n            <li><strong>Payments:</strong> Stripe</li>\n            <li><strong>Email & notifications:</strong> Outlook</li>\n            <li><strong>Automated drafting/model provider:</strong> Google (Gemini)</li>\n          </ul>\n          \n          <p>We don't sell your personal data.</p>\n\n          <h2>5) How long we keep data</h2>\n          <ul>\n            <li><strong>Account & profile:</strong> for as long as your account is active.</li>\n            <li><strong>Generated documents & tracker entries:</strong> until you delete them or close your account.</li>\n            <li><strong>Support tickets:</strong> up to 24 months after closure.</li>\n            <li><strong>Technical logs:</strong> up to 12 months for security and troubleshooting.</li>\n            <li><strong>Billing records:</strong> 6 years (legal requirement).</li>\n          </ul>\n          \n          <p>We delete or anonymise data after these periods.</p>\n\n          <h2>6) Your rights</h2>\n          <p>You can <strong>access</strong>, <strong>correct</strong>, <strong>delete</strong>, or <strong>download</strong> your data; <strong>restrict</strong> or <strong>object</strong> to certain processing; and <strong>withdraw consent</strong> (for marketing) at any time.</p>\n          <p>To exercise your rights, email us using email at top of this notice or adjust your privacy notice.</p>\n          <p>You can also complain to the <strong>Information Commissioner's Office (ICO)</strong> if you are unhappy with how we handle your data (see <strong>ico.org.uk</strong>).</p>\n\n          <h2>7) Cookies</h2>\n          <p>We use <strong>essential cookies</strong> to run the site and (with your consent) <strong>optional cookies</strong> for analytics and improvements. You can change your choices anytime in the cookie settings.</p>\n\n          <h2>8) Security</h2>\n          <p>We use appropriate technical and organisational measures to keep your data secure, including encryption in transit, access controls, secret management, and abuse/threat monitoring. You're responsible for keeping your login details confidential.</p>\n\n          <h2>9) Children</h2>\n          <p>Our service is for users <strong>aged 16+</strong>. If you believe a child has used the service, contact us via the email at the top of this notice</p>\n\n          <h2>10) Changes to this notice</h2>\n          <p>We'll post any updates on this page and change the \"Last updated\" date above. If changes are significant, we'll let you know by email or in-app.</p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":6360},"client/src/pages/cookie-policy.tsx":{"content":"import { ArrowLeft } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport default function CookiePolicy() {\n  const [, setLocation] = useLocation();\n  const { isAuthenticated } = useAuth();\n  \n  const handleBack = () => {\n    // If user is authenticated, go to dashboard, otherwise go to homepage\n    if (isAuthenticated) {\n      setLocation(\"/\");\n    } else {\n      setLocation(\"/landing\");\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n        <div className=\"max-w-4xl mx-auto px-6 lg:px-8 py-4\">\n          <div className=\"flex items-center gap-4\">\n            <Button \n              variant=\"ghost\" \n              size=\"sm\" \n              onClick={handleBack}\n              className=\"gap-2\"\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n              Back\n            </Button>\n            <h1 className=\"text-xl font-semibold\">Cookie Policy</h1>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"max-w-4xl mx-auto px-6 lg:px-8 py-8\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-2xl\">Cookie Policy</CardTitle>\n            <p className=\"text-muted-foreground\">Last updated: 8 September 2025</p>\n          </CardHeader>\n          <CardContent className=\"prose prose-sm max-w-none dark:prose-invert\">\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">1) About this policy</h2>\n              <p className=\"mb-4\">\n                This Cookie Policy explains how HealthHire Portal / HealthHire UK (\"we\", \"us\") uses cookies and similar technologies on our website and app. For how we handle personal data more generally, see our Privacy Notice.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">2) What are cookies?</h2>\n              <p className=\"mb-4\">\n                Cookies are small text files placed on your device when you visit a website. They help a site work, remember your preferences, and understand how people use it. We also use similar technologies such as local storage and pixels‚Äîtogether referred to here as \"cookies\".\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">3) How we use cookies</h2>\n              <p className=\"mb-4\">We use cookies for the following purposes:</p>\n              \n              <div className=\"mb-4\">\n                <p className=\"mb-2\"><strong>Essential (strictly necessary):</strong> required to run the site, keep you signed in, secure your account, process payments, and deliver core features. These run on the basis of our legitimate interests in providing a secure, functional service and do not require consent.</p>\n                \n                <p className=\"mb-2\"><strong>Preferences:</strong> remember choices like language or display settings.</p>\n                \n                <p className=\"mb-2\"><strong>Analytics:</strong> help us understand usage (pages visited, features used) so we can improve performance and user experience.</p>\n                \n                <p className=\"mb-2\"><strong>(Optional) Marketing/Attribution:</strong> if enabled, measure the effectiveness of our campaigns and referrals.</p>\n              </div>\n              \n              <p className=\"mb-4\">\n                We only set non-essential cookies (Preferences, Analytics, Marketing) with your consent.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">4) Your choices</h2>\n              <div className=\"mb-4\">\n                <p className=\"mb-2\"><strong>Cookie banner:</strong> On your first visit you can Accept all, Reject all (for non-essential), or Manage settings by category.</p>\n                \n                <p className=\"mb-2\"><strong>Change your mind anytime:</strong> Use the privacy link in the support centre to update your choices or withdraw consent.</p>\n                \n                <p className=\"mb-2\"><strong>Browser controls:</strong> You can block or delete cookies via your browser settings. Blocking essential cookies may break parts of the site.</p>\n                \n                <p className=\"mb-2\"><strong>Quick link:</strong> Cookie settings (opens the preferences manager)</p>\n              </div>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">5) Cookies we use (examples)</h2>\n              <p className=\"mb-4\">\n                These are typical cookies we use or may use. Exact names can vary by provider and environment.\n              </p>\n\n              <div className=\"mb-6\">\n                <h3 className=\"text-md font-semibold mb-3\">A) Essential (always on)</h3>\n                <div className=\"overflow-x-auto\">\n                  <table className=\"w-full border-collapse border border-border text-sm\">\n                    <thead>\n                      <tr className=\"bg-muted\">\n                        <th className=\"border border-border p-2 text-left\">Name</th>\n                        <th className=\"border border-border p-2 text-left\">Provider</th>\n                        <th className=\"border border-border p-2 text-left\">Purpose</th>\n                        <th className=\"border border-border p-2 text-left\">Type</th>\n                        <th className=\"border border-border p-2 text-left\">Duration</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      <tr>\n                        <td className=\"border border-border p-2\">hh_session</td>\n                        <td className=\"border border-border p-2\">HealthHire</td>\n                        <td className=\"border border-border p-2\">Keeps you signed in and ties your actions to your account securely.</td>\n                        <td className=\"border border-border p-2\">First-party</td>\n                        <td className=\"border border-border p-2\">Session</td>\n                      </tr>\n                      <tr>\n                        <td className=\"border border-border p-2\">hh_csrf</td>\n                        <td className=\"border border-border p-2\">HealthHire</td>\n                        <td className=\"border border-border p-2\">Protects forms and actions against CSRF attacks.</td>\n                        <td className=\"border border-border p-2\">First-party</td>\n                        <td className=\"border border-border p-2\">Session</td>\n                      </tr>\n                      <tr>\n                        <td className=\"border border-border p-2\">cookie_consent</td>\n                        <td className=\"border border-border p-2\">HealthHire</td>\n                        <td className=\"border border-border p-2\">Stores your cookie preferences.</td>\n                        <td className=\"border border-border p-2\">First-party</td>\n                        <td className=\"border border-border p-2\">6‚Äì12 months</td>\n                      </tr>\n                      <tr>\n                        <td className=\"border border-border p-2\">__stripe_sid, __stripe_mid</td>\n                        <td className=\"border border-border p-2\">Stripe üî∑</td>\n                        <td className=\"border border-border p-2\">Payment processing and fraud prevention during checkout.</td>\n                        <td className=\"border border-border p-2\">Third-party</td>\n                        <td className=\"border border-border p-2\">Up to 1 year</td>\n                      </tr>\n                      <tr>\n                        <td className=\"border border-border p-2\">cf_bm / __cf_*</td>\n                        <td className=\"border border-border p-2\">Cloudflare/host üî∑</td>\n                        <td className=\"border border-border p-2\">Bot management / performance (if used).</td>\n                        <td className=\"border border-border p-2\">Third-party</td>\n                        <td className=\"border border-border p-2\">30 minutes‚Äì1 day</td>\n                      </tr>\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n\n              <div className=\"mb-6\">\n                <h3 className=\"text-md font-semibold mb-3\">B) Preferences (consent)</h3>\n                <div className=\"overflow-x-auto\">\n                  <table className=\"w-full border-collapse border border-border text-sm\">\n                    <thead>\n                      <tr className=\"bg-muted\">\n                        <th className=\"border border-border p-2 text-left\">Name</th>\n                        <th className=\"border border-border p-2 text-left\">Provider</th>\n                        <th className=\"border border-border p-2 text-left\">Purpose</th>\n                        <th className=\"border border-border p-2 text-left\">Type</th>\n                        <th className=\"border border-border p-2 text-left\">Duration</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      <tr>\n                        <td className=\"border border-border p-2\">hh_ui_pref</td>\n                        <td className=\"border border-border p-2\">HealthHire</td>\n                        <td className=\"border border-border p-2\">Remembers layout/theme/language choices.</td>\n                        <td className=\"border border-border p-2\">First-party</td>\n                        <td className=\"border border-border p-2\">6 months</td>\n                      </tr>\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n\n              <div className=\"mb-6\">\n                <h3 className=\"text-md font-semibold mb-3\">C) Analytics (consent)</h3>\n                <div className=\"overflow-x-auto\">\n                  <table className=\"w-full border-collapse border border-border text-sm\">\n                    <thead>\n                      <tr className=\"bg-muted\">\n                        <th className=\"border border-border p-2 text-left\">Name</th>\n                        <th className=\"border border-border p-2 text-left\">Provider</th>\n                        <th className=\"border border-border p-2 text-left\">Purpose</th>\n                        <th className=\"border border-border p-2 text-left\">Type</th>\n                        <th className=\"border border-border p-2 text-left\">Duration</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      <tr>\n                        <td className=\"border border-border p-2\">_ga, _ga_*</td>\n                        <td className=\"border border-border p-2\">Google Analytics üî∑</td>\n                        <td className=\"border border-border p-2\">Usage analytics (pages, events) to improve the product.</td>\n                        <td className=\"border border-border p-2\">First-party</td>\n                        <td className=\"border border-border p-2\">13 months</td>\n                      </tr>\n                      <tr>\n                        <td className=\"border border-border p-2\">pll_* / plausible_* üî∑</td>\n                        <td className=\"border border-border p-2\">Plausible/Other</td>\n                        <td className=\"border border-border p-2\">Privacy-centred analytics (if enabled).</td>\n                        <td className=\"border border-border p-2\">First-party</td>\n                        <td className=\"border border-border p-2\">6‚Äì12 months</td>\n                      </tr>\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n\n              <div className=\"mb-6\">\n                <h3 className=\"text-md font-semibold mb-3\">D) Marketing/Attribution (consent, if used)</h3>\n                <div className=\"overflow-x-auto\">\n                  <table className=\"w-full border-collapse border border-border text-sm\">\n                    <thead>\n                      <tr className=\"bg-muted\">\n                        <th className=\"border border-border p-2 text-left\">Name</th>\n                        <th className=\"border border-border p-2 text-left\">Provider</th>\n                        <th className=\"border border-border p-2 text-left\">Purpose</th>\n                        <th className=\"border border-border p-2 text-left\">Type</th>\n                        <th className=\"border border-border p-2 text-left\">Duration</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      <tr>\n                        <td className=\"border border-border p-2\">_fbp, _fbc</td>\n                        <td className=\"border border-border p-2\">Meta üî∑</td>\n                        <td className=\"border border-border p-2\">Campaign attribution/retargeting.</td>\n                        <td className=\"border border-border p-2\">First-party</td>\n                        <td className=\"border border-border p-2\">3 months</td>\n                      </tr>\n                      <tr>\n                        <td className=\"border border-border p-2\">_tt_enable_cookie</td>\n                        <td className=\"border border-border p-2\">TikTok üî∑</td>\n                        <td className=\"border border-border p-2\">Campaign attribution.</td>\n                        <td className=\"border border-border p-2\">First-party</td>\n                        <td className=\"border border-border p-2\">13 months</td>\n                      </tr>\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">6) Local storage & similar tech</h2>\n              <p className=\"mb-4\">\n                We may use local storage to cache non-sensitive settings (e.g., UI preferences) and server-side sessions to keep you signed in. We treat these similarly to cookies in terms of consent where they're not strictly necessary.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">7) Third-party cookies</h2>\n              <p className=\"mb-4\">\n                Some features (e.g., payments via Stripe, embedded content, or analytics) are provided by third parties who may set their own cookies. We control which categories are loaded and seek your consent where required, but those providers control how their cookies are used. Please review their policies for details.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">8) Changes to this policy</h2>\n              <p className=\"mb-4\">\n                We may update this Cookie Policy from time to time. We'll post the latest version here and update the \"Last updated\" date.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">9) Contact us</h2>\n              <p className=\"mb-4\">\n                Questions about cookies? Email <strong><a href=\"mailto:hello@healthhireportal.com\" className=\"text-primary hover:underline\">hello@healthhireportal.com</a></strong>\n              </p>\n            </section>\n          </CardContent>\n        </Card>\n      </main>\n    </div>\n  );\n}","size_bytes":15796},"client/src/pages/terms-of-use.tsx":{"content":"import { ArrowLeft } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport default function TermsOfUse() {\n  const [, setLocation] = useLocation();\n  const { isAuthenticated } = useAuth();\n  \n  const handleBack = () => {\n    // If user is authenticated, go to dashboard, otherwise go to homepage\n    if (isAuthenticated) {\n      setLocation(\"/\");\n    } else {\n      setLocation(\"/landing\");\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n        <div className=\"max-w-4xl mx-auto px-6 lg:px-8 py-4\">\n          <div className=\"flex items-center gap-4\">\n            <Button \n              variant=\"ghost\" \n              size=\"sm\" \n              onClick={handleBack}\n              className=\"gap-2\"\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n              Back\n            </Button>\n            <h1 className=\"text-xl font-semibold\">Terms of Use</h1>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"max-w-4xl mx-auto px-6 lg:px-8 py-8\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-2xl\">Terms of Use</CardTitle>\n            <p className=\"text-muted-foreground\">Last updated: 8 September 2025</p>\n          </CardHeader>\n          <CardContent className=\"prose prose-sm max-w-none dark:prose-invert\">\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">1) Who we are</h2>\n              <p className=\"mb-4\">\n                <strong>HealthHire Portal</strong> (run by üî∑ <em>HealthHire UK</em> \"we\", \"us\") provides online tools to help applicants prepare NHS job applications (profile/CV, Supporting Information & cover letters with <strong>Henry the Helper</strong>, interview practice, job tracking, resources, and‚Äîon paid access‚Äîjob search & saves).\n              </p>\n              <p className=\"mb-4\">\n                <strong>Contact:</strong> hello@healthhireportal.com ‚Ä¢ Company no.: 15454323\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">2) Acceptance of these terms</h2>\n              <p className=\"mb-4\">\n                By creating an account or using the Portal, you agree to these Terms and our <strong>Privacy Notice</strong> and <strong>Cookie Policy</strong>. If you do not agree, do not use the service.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">3) Eligibility</h2>\n              <p className=\"mb-4\">\n                You must be <strong>16+</strong>, able to enter a contract, and use the Portal in compliance with UK law and any local laws that apply to you.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">4) Your account</h2>\n              <ul className=\"list-disc pl-6 mb-4 space-y-2\">\n                <li>Keep your account details accurate and secure; you are responsible for all activity under it.</li>\n                <li>Do not share your login or use someone else's.</li>\n                <li>Tell us promptly if you suspect unauthorised use: <strong><a href=\"mailto:hello@healthhireportal.com\" className=\"text-primary hover:underline\">hello@healthhireportal.com</a></strong>.</li>\n              </ul>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">5) Plans & access (Free vs Full Access)</h2>\n              <ul className=\"list-disc pl-6 mb-4 space-y-2\">\n                <li><strong>Free:</strong> build profile & CV (PDF), Supporting Information & cover letters with limits, interview practice with limits, job tracker, resources, referral.</li>\n                <li><strong>Full Access (paid one-time unlock):</strong> everything in Free <strong>plus</strong> job search & saves (and any other gated features we list at checkout).</li>\n                <li>Entitlements are enforced server-side. Attempting to bypass access controls is prohibited.</li>\n              </ul>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">6) Payments & refunds</h2>\n              <ul className=\"list-disc pl-6 mb-4 space-y-2\">\n                <li>Payments are processed by üî∑ <em>Stripe</em> in GBP. Prices include VAT where applicable.</li>\n                <li><strong>One-time purchase</strong> unlocks Full Access. Access starts immediately on payment success.</li>\n                <li>Because access starts straight away, you <strong>agree that we may begin supply immediately</strong> and you <strong>acknowledge losing the 14-day cooling-off right</strong> for digital content that has begun. This does not affect your statutory rights.</li>\n                <li>If we issue a refund (at our discretion or where legally required), we may revoke or adjust entitlements accordingly.</li>\n              </ul>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">7) Fair use & feature limits</h2>\n              <p className=\"mb-4\">\n                To keep the service stable, we apply usage caps (e.g., monthly limits on generations). Hitting \"Try again\" counts as another generation.\n              </p>\n              <ul className=\"list-disc pl-6 mb-4 space-y-2\">\n                <li>You must not attempt to exceed, reset, or circumvent limits (including by scripting, multi-accounting, or tampering).</li>\n                <li>If limits are reached or misuse is detected, features may be temporarily blocked. We'll show an in-product message with the reset time and support contact.</li>\n              </ul>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">8) Henry the Helper (automated drafting)</h2>\n              <p className=\"mb-4\">\n                Henry provides drafting assistance based on information you supply. It <strong>does not</strong> provide legal, clinical, or immigration advice. You are responsible for reviewing, editing, and ensuring your final documents are accurate, appropriate, and compliant with employer policies.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">9) Your content & our licence</h2>\n              <ul className=\"list-disc pl-6 mb-4 space-y-2\">\n                <li>You keep ownership of content you upload or create (e.g., profile, CV, Supporting Info, interview answers).</li>\n                <li>You grant us a worldwide, non-exclusive, royalty-free licence to <strong>host, process, display, and copy</strong> that content <strong>only to operate and improve</strong> the Portal.</li>\n                <li>You confirm you have rights to the content you upload and that it doesn't infringe others' rights.</li>\n              </ul>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">10) Our IP</h2>\n              <p className=\"mb-4\">\n                The Portal, Henry the Helper, text, graphics, logos, and software are our intellectual property or that of our licensors. You must not copy, modify, reverse engineer, or resell any part of the service.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">11) Acceptable use</h2>\n              <p className=\"mb-4\">Do not use the Portal to:</p>\n              <ul className=\"list-disc pl-6 mb-4 space-y-2\">\n                <li>break the law; infringe IP; defame; harass; discriminate; or share harmful content;</li>\n                <li>upload malware or attempt to gain unauthorised access;</li>\n                <li>scrape, bulk-download, or mine data;</li>\n                <li>misrepresent your identity, qualifications, or right to work;</li>\n                <li>send unsolicited marketing through our referral features (follow PECR rules‚Äîuse share-links, not cold emails).</li>\n              </ul>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">12) Privacy, cookies & security</h2>\n              <p className=\"mb-4\">\n                We process personal data as described in our <strong>Privacy Notice</strong>. We use essential and optional cookies (with your consent) as set out in our <strong>Cookie Policy</strong>. We take reasonable technical and organisational measures to secure the service, but no system is perfectly secure.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">13) Third-party services & links</h2>\n              <p className=\"mb-4\">\n                We rely on third-party providers (e.g., hosting, payments, email, model providers) to run the Portal and may link to third-party sites. We are not responsible for their content or policies.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">14) Availability & changes</h2>\n              <p className=\"mb-4\">\n                The Portal is provided <strong>\"as is\" and \"as available.\"</strong> We may change, suspend, or discontinue features (including beta features) at any time. We'll try to give reasonable notice of material changes.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">15) Suspension & termination</h2>\n              <p className=\"mb-4\">\n                We may suspend or close accounts that breach these Terms, present security risks, or engage in misuse. You can close your account at any time via support. After closure, we may retain some records where legally required (see Privacy Notice).\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">16) Disclaimers</h2>\n              <ul className=\"list-disc pl-6 mb-4 space-y-2\">\n                <li>We do not guarantee job outcomes, interview offers, or visas.</li>\n                <li>Guidance and generated text are <strong>assistance only</strong> and may contain errors; you must review and verify all content before use.</li>\n                <li>Nothing here is legal, clinical, or immigration advice.</li>\n              </ul>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">17) Liability</h2>\n              <p className=\"mb-4\">\n                Nothing excludes liability for death or personal injury caused by negligence, fraud, or other liability that cannot be limited by law.\n              </p>\n              <p className=\"mb-4\">\n                Subject to that, our total liability to you for all claims arising out of or in connection with the service is limited to the <strong>greater of ¬£100 or the amount you paid to us in the 12 months</strong> before the claim arose. We are not liable for: loss of profits, revenue, data, goodwill; indirect or consequential losses; or issues caused by third-party services outside our control.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">18) Complaints & disputes</h2>\n              <p className=\"mb-4\">\n                Please contact hello@healthhireportal.com first. These Terms are governed by the laws of <strong>England and Wales</strong>, and the courts of <strong>England and Wales</strong> have exclusive jurisdiction (consumers may also bring claims where they live in the UK, as the law permits).\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold mb-4\">19) Changes to these Terms</h2>\n              <p className=\"mb-4\">\n                We may update these Terms from time to time. We'll post changes here with a new \"Last updated\" date and, where changes are significant, notify you by email or in-app.\n              </p>\n            </section>\n          </CardContent>\n        </Card>\n      </main>\n    </div>\n  );\n}","size_bytes":12759}},"version":1}